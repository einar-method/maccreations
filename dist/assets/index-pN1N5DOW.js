(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const kt=(()=>{let n=!1;typeof window<"u"&&typeof window.localStorage<"u"?n=!!window.localStorage.getItem("loggingEnabled"):n=!1;function t(e){return(...r)=>{n&&console[e](...r)}}return{info:t("info"),debug:t("debug"),error:t("error")}})();function Dt(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var He={exports:{}};(function(n,t){(function(e){n.exports=e()})(function(){return function e(r,i,o){function u(c,d){if(!i[c]){if(!r[c]){var m=typeof Dt=="function"&&Dt;if(!d&&m)return m(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+c+"'")}d=i[c]={exports:{}},r[c][0].call(d.exports,function(U){var L=r[c][1][U];return u(L||U)},d,d.exports,e,r,i,o)}return i[c].exports}for(var a=typeof Dt=="function"&&Dt,h=0;h<o.length;h++)u(o[h]);return u}({1:[function(e,r,i){(function(o,u,a,h,c,d,m,U,L){var A=e("crypto");function j(v,S){S=C(v,S);var l;return(l=S.algorithm!=="passthrough"?A.createHash(S.algorithm):new R).write===void 0&&(l.write=l.update,l.end=l.update),x(S,l).dispatch(v),l.update||l.end(""),l.digest?l.digest(S.encoding==="buffer"?void 0:S.encoding):(v=l.read(),S.encoding!=="buffer"?v.toString(S.encoding):v)}(i=r.exports=j).sha1=function(v){return j(v)},i.keys=function(v){return j(v,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},i.MD5=function(v){return j(v,{algorithm:"md5",encoding:"hex"})},i.keysMD5=function(v){return j(v,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var _=A.getHashes?A.getHashes().slice():["sha1","md5"],k=(_.push("passthrough"),["buffer","hex","binary","base64"]);function C(v,S){var l={};if(l.algorithm=(S=S||{}).algorithm||"sha1",l.encoding=S.encoding||"hex",l.excludeValues=!!S.excludeValues,l.algorithm=l.algorithm.toLowerCase(),l.encoding=l.encoding.toLowerCase(),l.ignoreUnknown=S.ignoreUnknown===!0,l.respectType=S.respectType!==!1,l.respectFunctionNames=S.respectFunctionNames!==!1,l.respectFunctionProperties=S.respectFunctionProperties!==!1,l.unorderedArrays=S.unorderedArrays===!0,l.unorderedSets=S.unorderedSets!==!1,l.unorderedObjects=S.unorderedObjects!==!1,l.replacer=S.replacer||void 0,l.excludeKeys=S.excludeKeys||void 0,v===void 0)throw new Error("Object argument required.");for(var g=0;g<_.length;++g)_[g].toLowerCase()===l.algorithm.toLowerCase()&&(l.algorithm=_[g]);if(_.indexOf(l.algorithm)===-1)throw new Error('Algorithm "'+l.algorithm+'"  not supported. supported values: '+_.join(", "));if(k.indexOf(l.encoding)===-1&&l.algorithm!=="passthrough")throw new Error('Encoding "'+l.encoding+'"  not supported. supported values: '+k.join(", "));return l}function E(v){if(typeof v=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(v))!=null}function x(v,S,l){l=l||[];function g(f){return S.update?S.update(f,"utf8"):S.write(f,"utf8")}return{dispatch:function(f){return this["_"+((f=v.replacer?v.replacer(f):f)===null?"null":typeof f)](f)},_object:function(f){var b,w=Object.prototype.toString.call(f),D=/\[object (.*)\]/i.exec(w);if(D=(D=D?D[1]:"unknown:["+w+"]").toLowerCase(),0<=(w=l.indexOf(f)))return this.dispatch("[CIRCULAR:"+w+"]");if(l.push(f),a!==void 0&&a.isBuffer&&a.isBuffer(f))return g("buffer:"),g(f);if(D==="object"||D==="function"||D==="asyncfunction")return w=Object.keys(f),v.unorderedObjects&&(w=w.sort()),v.respectType===!1||E(f)||w.splice(0,0,"prototype","__proto__","constructor"),v.excludeKeys&&(w=w.filter(function(B){return!v.excludeKeys(B)})),g("object:"+w.length+":"),b=this,w.forEach(function(B){b.dispatch(B),g(":"),v.excludeValues||b.dispatch(f[B]),g(",")});if(!this["_"+D]){if(v.ignoreUnknown)return g("["+D+"]");throw new Error('Unknown object type "'+D+'"')}this["_"+D](f)},_array:function(f,B){B=B!==void 0?B:v.unorderedArrays!==!1;var w=this;if(g("array:"+f.length+":"),!B||f.length<=1)return f.forEach(function(N){return w.dispatch(N)});var D=[],B=f.map(function(N){var T=new R,F=l.slice();return x(v,T,F).dispatch(N),D=D.concat(F.slice(l.length)),T.read().toString()});return l=l.concat(D),B.sort(),this._array(B,!1)},_date:function(f){return g("date:"+f.toJSON())},_symbol:function(f){return g("symbol:"+f.toString())},_error:function(f){return g("error:"+f.toString())},_boolean:function(f){return g("bool:"+f.toString())},_string:function(f){g("string:"+f.length+":"),g(f.toString())},_function:function(f){g("fn:"),E(f)?this.dispatch("[native]"):this.dispatch(f.toString()),v.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(f.name)),v.respectFunctionProperties&&this._object(f)},_number:function(f){return g("number:"+f.toString())},_xml:function(f){return g("xml:"+f.toString())},_null:function(){return g("Null")},_undefined:function(){return g("Undefined")},_regexp:function(f){return g("regex:"+f.toString())},_uint8array:function(f){return g("uint8array:"),this.dispatch(Array.prototype.slice.call(f))},_uint8clampedarray:function(f){return g("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(f))},_int8array:function(f){return g("int8array:"),this.dispatch(Array.prototype.slice.call(f))},_uint16array:function(f){return g("uint16array:"),this.dispatch(Array.prototype.slice.call(f))},_int16array:function(f){return g("int16array:"),this.dispatch(Array.prototype.slice.call(f))},_uint32array:function(f){return g("uint32array:"),this.dispatch(Array.prototype.slice.call(f))},_int32array:function(f){return g("int32array:"),this.dispatch(Array.prototype.slice.call(f))},_float32array:function(f){return g("float32array:"),this.dispatch(Array.prototype.slice.call(f))},_float64array:function(f){return g("float64array:"),this.dispatch(Array.prototype.slice.call(f))},_arraybuffer:function(f){return g("arraybuffer:"),this.dispatch(new Uint8Array(f))},_url:function(f){return g("url:"+f.toString())},_map:function(f){return g("map:"),f=Array.from(f),this._array(f,v.unorderedSets!==!1)},_set:function(f){return g("set:"),f=Array.from(f),this._array(f,v.unorderedSets!==!1)},_file:function(f){return g("file:"),this.dispatch([f.name,f.size,f.type,f.lastModfied])},_blob:function(){if(v.ignoreUnknown)return g("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return g("domwindow")},_bigint:function(f){return g("bigint:"+f.toString())},_process:function(){return g("process")},_timer:function(){return g("timer")},_pipe:function(){return g("pipe")},_tcp:function(){return g("tcp")},_udp:function(){return g("udp")},_tty:function(){return g("tty")},_statwatcher:function(){return g("statwatcher")},_securecontext:function(){return g("securecontext")},_connection:function(){return g("connection")},_zlib:function(){return g("zlib")},_context:function(){return g("context")},_nodescript:function(){return g("nodescript")},_httpparser:function(){return g("httpparser")},_dataview:function(){return g("dataview")},_signal:function(){return g("signal")},_fsevent:function(){return g("fsevent")},_tlswrap:function(){return g("tlswrap")}}}function R(){return{buf:"",write:function(v){this.buf+=v},end:function(v){this.buf+=v},read:function(){return this.buf}}}i.writeToStream=function(v,S,l){return l===void 0&&(l=S,S={}),x(S=C(v,S),l).dispatch(v)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(e,r,i){(function(o,u,a,h,c,d,m,U,L){(function(A){var j=typeof Uint8Array<"u"?Uint8Array:Array,_=43,k=47,C=48,E=97,x=65,R=45,v=95;function S(l){return l=l.charCodeAt(0),l===_||l===R?62:l===k||l===v?63:l<C?-1:l<C+10?l-C+26+26:l<x+26?l-x:l<E+26?l-E+26:void 0}A.toByteArray=function(l){var g,f;if(0<l.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var b=l.length,b=l.charAt(b-2)==="="?2:l.charAt(b-1)==="="?1:0,w=new j(3*l.length/4-b),D=0<b?l.length-4:l.length,B=0;function N(T){w[B++]=T}for(g=0;g<D;g+=4,0)N((16711680&(f=S(l.charAt(g))<<18|S(l.charAt(g+1))<<12|S(l.charAt(g+2))<<6|S(l.charAt(g+3))))>>16),N((65280&f)>>8),N(255&f);return b==2?N(255&(f=S(l.charAt(g))<<2|S(l.charAt(g+1))>>4)):b==1&&(N((f=S(l.charAt(g))<<10|S(l.charAt(g+1))<<4|S(l.charAt(g+2))>>2)>>8&255),N(255&f)),w},A.fromByteArray=function(l){var g,f,b,w,D=l.length%3,B="";function N(T){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(T)}for(g=0,b=l.length-D;g<b;g+=3)f=(l[g]<<16)+(l[g+1]<<8)+l[g+2],B+=N((w=f)>>18&63)+N(w>>12&63)+N(w>>6&63)+N(63&w);switch(D){case 1:B=(B+=N((f=l[l.length-1])>>2))+N(f<<4&63)+"==";break;case 2:B=(B=(B+=N((f=(l[l.length-2]<<8)+l[l.length-1])>>10))+N(f>>4&63))+N(f<<2&63)+"="}return B}})(i===void 0?this.base64js={}:i)}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(e,r,i){(function(o,u,_,h,c,d,m,U,L){var A=e("base64-js"),j=e("ieee754");function _(s,p,y){if(!(this instanceof _))return new _(s,p,y);var I,O,P,$,V=typeof s;if(p==="base64"&&V=="string")for(s=($=s).trim?$.trim():$.replace(/^\s+|\s+$/g,"");s.length%4!=0;)s+="=";if(V=="number")I=J(s);else if(V=="string")I=_.byteLength(s,p);else{if(V!="object")throw new Error("First argument needs to be a number, array or string.");I=J(s.length)}if(_._useTypedArrays?O=_._augment(new Uint8Array(I)):((O=this).length=I,O._isBuffer=!0),_._useTypedArrays&&typeof s.byteLength=="number")O._set(s);else if(z($=s)||_.isBuffer($)||$&&typeof $=="object"&&typeof $.length=="number")for(P=0;P<I;P++)_.isBuffer(s)?O[P]=s.readUInt8(P):O[P]=s[P];else if(V=="string")O.write(s,0,p);else if(V=="number"&&!_._useTypedArrays&&!y)for(P=0;P<I;P++)O[P]=0;return O}function k(s,p,y,I){return _._charsWritten=bt(function(O){for(var P=[],$=0;$<O.length;$++)P.push(255&O.charCodeAt($));return P}(p),s,y,I)}function C(s,p,y,I){return _._charsWritten=bt(function(O){for(var P,$,V=[],K=0;K<O.length;K++)$=O.charCodeAt(K),P=$>>8,$=$%256,V.push($),V.push(P);return V}(p),s,y,I)}function E(s,p,y){var I="";y=Math.min(s.length,y);for(var O=p;O<y;O++)I+=String.fromCharCode(s[O]);return I}function x(s,p,y,P){P||(M(typeof y=="boolean","missing or invalid endian"),M(p!=null,"missing offset"),M(p+1<s.length,"Trying to read beyond buffer length"));var O,P=s.length;if(!(P<=p))return y?(O=s[p],p+1<P&&(O|=s[p+1]<<8)):(O=s[p]<<8,p+1<P&&(O|=s[p+1])),O}function R(s,p,y,P){P||(M(typeof y=="boolean","missing or invalid endian"),M(p!=null,"missing offset"),M(p+3<s.length,"Trying to read beyond buffer length"));var O,P=s.length;if(!(P<=p))return y?(p+2<P&&(O=s[p+2]<<16),p+1<P&&(O|=s[p+1]<<8),O|=s[p],p+3<P&&(O+=s[p+3]<<24>>>0)):(p+1<P&&(O=s[p+1]<<16),p+2<P&&(O|=s[p+2]<<8),p+3<P&&(O|=s[p+3]),O+=s[p]<<24>>>0),O}function v(s,p,y,I){if(I||(M(typeof y=="boolean","missing or invalid endian"),M(p!=null,"missing offset"),M(p+1<s.length,"Trying to read beyond buffer length")),!(s.length<=p))return I=x(s,p,y,!0),32768&I?-1*(65535-I+1):I}function S(s,p,y,I){if(I||(M(typeof y=="boolean","missing or invalid endian"),M(p!=null,"missing offset"),M(p+3<s.length,"Trying to read beyond buffer length")),!(s.length<=p))return I=R(s,p,y,!0),2147483648&I?-1*(4294967295-I+1):I}function l(s,p,y,I){return I||(M(typeof y=="boolean","missing or invalid endian"),M(p+3<s.length,"Trying to read beyond buffer length")),j.read(s,p,y,23,4)}function g(s,p,y,I){return I||(M(typeof y=="boolean","missing or invalid endian"),M(p+7<s.length,"Trying to read beyond buffer length")),j.read(s,p,y,52,8)}function f(s,p,y,I,O){if(O||(M(p!=null,"missing value"),M(typeof I=="boolean","missing or invalid endian"),M(y!=null,"missing offset"),M(y+1<s.length,"trying to write beyond buffer length"),xt(p,65535)),O=s.length,!(O<=y))for(var P=0,$=Math.min(O-y,2);P<$;P++)s[y+P]=(p&255<<8*(I?P:1-P))>>>8*(I?P:1-P)}function b(s,p,y,I,O){if(O||(M(p!=null,"missing value"),M(typeof I=="boolean","missing or invalid endian"),M(y!=null,"missing offset"),M(y+3<s.length,"trying to write beyond buffer length"),xt(p,4294967295)),O=s.length,!(O<=y))for(var P=0,$=Math.min(O-y,4);P<$;P++)s[y+P]=p>>>8*(I?P:3-P)&255}function w(s,p,y,I,O){O||(M(p!=null,"missing value"),M(typeof I=="boolean","missing or invalid endian"),M(y!=null,"missing offset"),M(y+1<s.length,"Trying to write beyond buffer length"),jt(p,32767,-32768)),s.length<=y||f(s,0<=p?p:65535+p+1,y,I,O)}function D(s,p,y,I,O){O||(M(p!=null,"missing value"),M(typeof I=="boolean","missing or invalid endian"),M(y!=null,"missing offset"),M(y+3<s.length,"Trying to write beyond buffer length"),jt(p,2147483647,-2147483648)),s.length<=y||b(s,0<=p?p:4294967295+p+1,y,I,O)}function B(s,p,y,I,O){O||(M(p!=null,"missing value"),M(typeof I=="boolean","missing or invalid endian"),M(y!=null,"missing offset"),M(y+3<s.length,"Trying to write beyond buffer length"),Bt(p,34028234663852886e22,-34028234663852886e22)),s.length<=y||j.write(s,p,y,I,23,4)}function N(s,p,y,I,O){O||(M(p!=null,"missing value"),M(typeof I=="boolean","missing or invalid endian"),M(y!=null,"missing offset"),M(y+7<s.length,"Trying to write beyond buffer length"),Bt(p,17976931348623157e292,-17976931348623157e292)),s.length<=y||j.write(s,p,y,I,52,8)}i.Buffer=_,i.SlowBuffer=_,i.INSPECT_MAX_BYTES=50,_.poolSize=8192,_._useTypedArrays=function(){try{var s=new ArrayBuffer(0),p=new Uint8Array(s);return p.foo=function(){return 42},p.foo()===42&&typeof p.subarray=="function"}catch{return!1}}(),_.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},_.isBuffer=function(s){return!(s==null||!s._isBuffer)},_.byteLength=function(s,p){var y;switch(s+="",p||"utf8"){case"hex":y=s.length/2;break;case"utf8":case"utf-8":y=ut(s).length;break;case"ascii":case"binary":case"raw":y=s.length;break;case"base64":y=ct(s).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":y=2*s.length;break;default:throw new Error("Unknown encoding")}return y},_.concat=function(s,p){if(M(z(s),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),s.length===0)return new _(0);if(s.length===1)return s[0];if(typeof p!="number")for(O=p=0;O<s.length;O++)p+=s[O].length;for(var y=new _(p),I=0,O=0;O<s.length;O++){var P=s[O];P.copy(y,I),I+=P.length}return y},_.prototype.write=function(s,p,y,I){isFinite(p)?isFinite(y)||(I=y,y=void 0):(K=I,I=p,p=y,y=K),p=Number(p)||0;var O,P,$,V,K=this.length-p;switch((!y||K<(y=Number(y)))&&(y=K),I=String(I||"utf8").toLowerCase()){case"hex":O=function(at,et,nt,H){nt=Number(nt)||0;var Y=at.length-nt;(!H||Y<(H=Number(H)))&&(H=Y),M((Y=et.length)%2==0,"Invalid hex string"),Y/2<H&&(H=Y/2);for(var mt=0;mt<H;mt++){var Oe=parseInt(et.substr(2*mt,2),16);M(!isNaN(Oe),"Invalid hex string"),at[nt+mt]=Oe}return _._charsWritten=2*mt,mt}(this,s,p,y);break;case"utf8":case"utf-8":P=this,$=p,V=y,O=_._charsWritten=bt(ut(s),P,$,V);break;case"ascii":case"binary":O=k(this,s,p,y);break;case"base64":P=this,$=p,V=y,O=_._charsWritten=bt(ct(s),P,$,V);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":O=C(this,s,p,y);break;default:throw new Error("Unknown encoding")}return O},_.prototype.toString=function(s,p,y){var I,O,P,$,V=this;if(s=String(s||"utf8").toLowerCase(),p=Number(p)||0,(y=y!==void 0?Number(y):V.length)===p)return"";switch(s){case"hex":I=function(K,at,et){var nt=K.length;(!at||at<0)&&(at=0),(!et||et<0||nt<et)&&(et=nt);for(var H="",Y=at;Y<et;Y++)H+=q(K[Y]);return H}(V,p,y);break;case"utf8":case"utf-8":I=function(K,at,et){var nt="",H="";et=Math.min(K.length,et);for(var Y=at;Y<et;Y++)K[Y]<=127?(nt+=Rt(H)+String.fromCharCode(K[Y]),H=""):H+="%"+K[Y].toString(16);return nt+Rt(H)}(V,p,y);break;case"ascii":case"binary":I=E(V,p,y);break;case"base64":O=V,$=y,I=(P=p)===0&&$===O.length?A.fromByteArray(O):A.fromByteArray(O.slice(P,$));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":I=function(K,at,et){for(var nt=K.slice(at,et),H="",Y=0;Y<nt.length;Y+=2)H+=String.fromCharCode(nt[Y]+256*nt[Y+1]);return H}(V,p,y);break;default:throw new Error("Unknown encoding")}return I},_.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},_.prototype.copy=function(s,p,y,I){if(p=p||0,(I=I||I===0?I:this.length)!==(y=y||0)&&s.length!==0&&this.length!==0){M(y<=I,"sourceEnd < sourceStart"),M(0<=p&&p<s.length,"targetStart out of bounds"),M(0<=y&&y<this.length,"sourceStart out of bounds"),M(0<=I&&I<=this.length,"sourceEnd out of bounds"),I>this.length&&(I=this.length);var O=(I=s.length-p<I-y?s.length-p+y:I)-y;if(O<100||!_._useTypedArrays)for(var P=0;P<O;P++)s[P+p]=this[P+y];else s._set(this.subarray(y,y+O),p)}},_.prototype.slice=function(s,p){var y=this.length;if(s=F(s,y,0),p=F(p,y,y),_._useTypedArrays)return _._augment(this.subarray(s,p));for(var I=p-s,O=new _(I,void 0,!0),P=0;P<I;P++)O[P]=this[P+s];return O},_.prototype.get=function(s){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(s)},_.prototype.set=function(s,p){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(s,p)},_.prototype.readUInt8=function(s,p){if(p||(M(s!=null,"missing offset"),M(s<this.length,"Trying to read beyond buffer length")),!(s>=this.length))return this[s]},_.prototype.readUInt16LE=function(s,p){return x(this,s,!0,p)},_.prototype.readUInt16BE=function(s,p){return x(this,s,!1,p)},_.prototype.readUInt32LE=function(s,p){return R(this,s,!0,p)},_.prototype.readUInt32BE=function(s,p){return R(this,s,!1,p)},_.prototype.readInt8=function(s,p){if(p||(M(s!=null,"missing offset"),M(s<this.length,"Trying to read beyond buffer length")),!(s>=this.length))return 128&this[s]?-1*(255-this[s]+1):this[s]},_.prototype.readInt16LE=function(s,p){return v(this,s,!0,p)},_.prototype.readInt16BE=function(s,p){return v(this,s,!1,p)},_.prototype.readInt32LE=function(s,p){return S(this,s,!0,p)},_.prototype.readInt32BE=function(s,p){return S(this,s,!1,p)},_.prototype.readFloatLE=function(s,p){return l(this,s,!0,p)},_.prototype.readFloatBE=function(s,p){return l(this,s,!1,p)},_.prototype.readDoubleLE=function(s,p){return g(this,s,!0,p)},_.prototype.readDoubleBE=function(s,p){return g(this,s,!1,p)},_.prototype.writeUInt8=function(s,p,y){y||(M(s!=null,"missing value"),M(p!=null,"missing offset"),M(p<this.length,"trying to write beyond buffer length"),xt(s,255)),p>=this.length||(this[p]=s)},_.prototype.writeUInt16LE=function(s,p,y){f(this,s,p,!0,y)},_.prototype.writeUInt16BE=function(s,p,y){f(this,s,p,!1,y)},_.prototype.writeUInt32LE=function(s,p,y){b(this,s,p,!0,y)},_.prototype.writeUInt32BE=function(s,p,y){b(this,s,p,!1,y)},_.prototype.writeInt8=function(s,p,y){y||(M(s!=null,"missing value"),M(p!=null,"missing offset"),M(p<this.length,"Trying to write beyond buffer length"),jt(s,127,-128)),p>=this.length||(0<=s?this.writeUInt8(s,p,y):this.writeUInt8(255+s+1,p,y))},_.prototype.writeInt16LE=function(s,p,y){w(this,s,p,!0,y)},_.prototype.writeInt16BE=function(s,p,y){w(this,s,p,!1,y)},_.prototype.writeInt32LE=function(s,p,y){D(this,s,p,!0,y)},_.prototype.writeInt32BE=function(s,p,y){D(this,s,p,!1,y)},_.prototype.writeFloatLE=function(s,p,y){B(this,s,p,!0,y)},_.prototype.writeFloatBE=function(s,p,y){B(this,s,p,!1,y)},_.prototype.writeDoubleLE=function(s,p,y){N(this,s,p,!0,y)},_.prototype.writeDoubleBE=function(s,p,y){N(this,s,p,!1,y)},_.prototype.fill=function(s,p,y){if(p=p||0,y=y||this.length,M(typeof(s=typeof(s=s||0)=="string"?s.charCodeAt(0):s)=="number"&&!isNaN(s),"value is not a number"),M(p<=y,"end < start"),y!==p&&this.length!==0){M(0<=p&&p<this.length,"start out of bounds"),M(0<=y&&y<=this.length,"end out of bounds");for(var I=p;I<y;I++)this[I]=s}},_.prototype.inspect=function(){for(var s=[],p=this.length,y=0;y<p;y++)if(s[y]=q(this[y]),y===i.INSPECT_MAX_BYTES){s[y+1]="...";break}return"<Buffer "+s.join(" ")+">"},_.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(_._useTypedArrays)return new _(this).buffer;for(var s=new Uint8Array(this.length),p=0,y=s.length;p<y;p+=1)s[p]=this[p];return s.buffer};var T=_.prototype;function F(s,p,y){return typeof s!="number"?y:p<=(s=~~s)?p:0<=s||0<=(s+=p)?s:0}function J(s){return(s=~~Math.ceil(+s))<0?0:s}function z(s){return(Array.isArray||function(p){return Object.prototype.toString.call(p)==="[object Array]"})(s)}function q(s){return s<16?"0"+s.toString(16):s.toString(16)}function ut(s){for(var p=[],y=0;y<s.length;y++){var I=s.charCodeAt(y);if(I<=127)p.push(s.charCodeAt(y));else for(var O=y,P=(55296<=I&&I<=57343&&y++,encodeURIComponent(s.slice(O,y+1)).substr(1).split("%")),$=0;$<P.length;$++)p.push(parseInt(P[$],16))}return p}function ct(s){return A.toByteArray(s)}function bt(s,p,y,I){for(var O=0;O<I&&!(O+y>=p.length||O>=s.length);O++)p[O+y]=s[O];return O}function Rt(s){try{return decodeURIComponent(s)}catch{return"ï¿½"}}function xt(s,p){M(typeof s=="number","cannot write a non-number as a number"),M(0<=s,"specified a negative value for writing an unsigned value"),M(s<=p,"value is larger than maximum value for type"),M(Math.floor(s)===s,"value has a fractional component")}function jt(s,p,y){M(typeof s=="number","cannot write a non-number as a number"),M(s<=p,"value larger than maximum allowed value"),M(y<=s,"value smaller than minimum allowed value"),M(Math.floor(s)===s,"value has a fractional component")}function Bt(s,p,y){M(typeof s=="number","cannot write a non-number as a number"),M(s<=p,"value larger than maximum allowed value"),M(y<=s,"value smaller than minimum allowed value")}function M(s,p){if(!s)throw new Error(p||"Failed assertion")}_._augment=function(s){return s._isBuffer=!0,s._get=s.get,s._set=s.set,s.get=T.get,s.set=T.set,s.write=T.write,s.toString=T.toString,s.toLocaleString=T.toString,s.toJSON=T.toJSON,s.copy=T.copy,s.slice=T.slice,s.readUInt8=T.readUInt8,s.readUInt16LE=T.readUInt16LE,s.readUInt16BE=T.readUInt16BE,s.readUInt32LE=T.readUInt32LE,s.readUInt32BE=T.readUInt32BE,s.readInt8=T.readInt8,s.readInt16LE=T.readInt16LE,s.readInt16BE=T.readInt16BE,s.readInt32LE=T.readInt32LE,s.readInt32BE=T.readInt32BE,s.readFloatLE=T.readFloatLE,s.readFloatBE=T.readFloatBE,s.readDoubleLE=T.readDoubleLE,s.readDoubleBE=T.readDoubleBE,s.writeUInt8=T.writeUInt8,s.writeUInt16LE=T.writeUInt16LE,s.writeUInt16BE=T.writeUInt16BE,s.writeUInt32LE=T.writeUInt32LE,s.writeUInt32BE=T.writeUInt32BE,s.writeInt8=T.writeInt8,s.writeInt16LE=T.writeInt16LE,s.writeInt16BE=T.writeInt16BE,s.writeInt32LE=T.writeInt32LE,s.writeInt32BE=T.writeInt32BE,s.writeFloatLE=T.writeFloatLE,s.writeFloatBE=T.writeFloatBE,s.writeDoubleLE=T.writeDoubleLE,s.writeDoubleBE=T.writeDoubleBE,s.fill=T.fill,s.inspect=T.inspect,s.toArrayBuffer=T.toArrayBuffer,s}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(e,r,i){(function(o,u,A,h,c,d,m,U,L){var A=e("buffer").Buffer,j=4,_=new A(j);_.fill(0),r.exports={hash:function(k,C,E,x){for(var R=C(function(f,b){f.length%j!=0&&(w=f.length+(j-f.length%j),f=A.concat([f,_],w));for(var w,D=[],B=b?f.readInt32BE:f.readInt32LE,N=0;N<f.length;N+=j)D.push(B.call(f,N));return D}(k=A.isBuffer(k)?k:new A(k),x),8*k.length),C=x,v=new A(E),S=C?v.writeInt32BE:v.writeInt32LE,l=0;l<R.length;l++)S.call(v,R[l],4*l,!0);return v}}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(e,r,i){(function(o,u,A,h,c,d,m,U,L){var A=e("buffer").Buffer,j=e("./sha"),_=e("./sha256"),k=e("./rng"),C={sha1:j,sha256:_,md5:e("./md5")},E=64,x=new A(E);function R(f,b){var w=C[f=f||"sha1"],D=[];return w||v("algorithm:",f,"is not yet supported"),{update:function(B){return A.isBuffer(B)||(B=new A(B)),D.push(B),B.length,this},digest:function(B){var N=A.concat(D),N=b?function(T,F,J){A.isBuffer(F)||(F=new A(F)),A.isBuffer(J)||(J=new A(J)),F.length>E?F=T(F):F.length<E&&(F=A.concat([F,x],E));for(var z=new A(E),q=new A(E),ut=0;ut<E;ut++)z[ut]=54^F[ut],q[ut]=92^F[ut];return J=T(A.concat([z,J])),T(A.concat([q,J]))}(w,b,N):w(N);return D=null,B?N.toString(B):N}}}function v(){var f=[].slice.call(arguments).join(" ");throw new Error([f,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}x.fill(0),i.createHash=function(f){return R(f)},i.createHmac=R,i.randomBytes=function(f,b){if(!b||!b.call)return new A(k(f));try{b.call(this,void 0,new A(k(f)))}catch(w){b(w)}};var S,l=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],g=function(f){i[f]=function(){v("sorry,",f,"is not implemented yet")}};for(S in l)g(l[S])}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(e,r,i){(function(o,u,a,h,c,d,m,U,L){var A=e("./helpers");function j(v,S){v[S>>5]|=128<<S%32,v[14+(S+64>>>9<<4)]=S;for(var l=1732584193,g=-271733879,f=-1732584194,b=271733878,w=0;w<v.length;w+=16){var D=l,B=g,N=f,T=b,l=k(l,g,f,b,v[w+0],7,-680876936),b=k(b,l,g,f,v[w+1],12,-389564586),f=k(f,b,l,g,v[w+2],17,606105819),g=k(g,f,b,l,v[w+3],22,-1044525330);l=k(l,g,f,b,v[w+4],7,-176418897),b=k(b,l,g,f,v[w+5],12,1200080426),f=k(f,b,l,g,v[w+6],17,-1473231341),g=k(g,f,b,l,v[w+7],22,-45705983),l=k(l,g,f,b,v[w+8],7,1770035416),b=k(b,l,g,f,v[w+9],12,-1958414417),f=k(f,b,l,g,v[w+10],17,-42063),g=k(g,f,b,l,v[w+11],22,-1990404162),l=k(l,g,f,b,v[w+12],7,1804603682),b=k(b,l,g,f,v[w+13],12,-40341101),f=k(f,b,l,g,v[w+14],17,-1502002290),l=C(l,g=k(g,f,b,l,v[w+15],22,1236535329),f,b,v[w+1],5,-165796510),b=C(b,l,g,f,v[w+6],9,-1069501632),f=C(f,b,l,g,v[w+11],14,643717713),g=C(g,f,b,l,v[w+0],20,-373897302),l=C(l,g,f,b,v[w+5],5,-701558691),b=C(b,l,g,f,v[w+10],9,38016083),f=C(f,b,l,g,v[w+15],14,-660478335),g=C(g,f,b,l,v[w+4],20,-405537848),l=C(l,g,f,b,v[w+9],5,568446438),b=C(b,l,g,f,v[w+14],9,-1019803690),f=C(f,b,l,g,v[w+3],14,-187363961),g=C(g,f,b,l,v[w+8],20,1163531501),l=C(l,g,f,b,v[w+13],5,-1444681467),b=C(b,l,g,f,v[w+2],9,-51403784),f=C(f,b,l,g,v[w+7],14,1735328473),l=E(l,g=C(g,f,b,l,v[w+12],20,-1926607734),f,b,v[w+5],4,-378558),b=E(b,l,g,f,v[w+8],11,-2022574463),f=E(f,b,l,g,v[w+11],16,1839030562),g=E(g,f,b,l,v[w+14],23,-35309556),l=E(l,g,f,b,v[w+1],4,-1530992060),b=E(b,l,g,f,v[w+4],11,1272893353),f=E(f,b,l,g,v[w+7],16,-155497632),g=E(g,f,b,l,v[w+10],23,-1094730640),l=E(l,g,f,b,v[w+13],4,681279174),b=E(b,l,g,f,v[w+0],11,-358537222),f=E(f,b,l,g,v[w+3],16,-722521979),g=E(g,f,b,l,v[w+6],23,76029189),l=E(l,g,f,b,v[w+9],4,-640364487),b=E(b,l,g,f,v[w+12],11,-421815835),f=E(f,b,l,g,v[w+15],16,530742520),l=x(l,g=E(g,f,b,l,v[w+2],23,-995338651),f,b,v[w+0],6,-198630844),b=x(b,l,g,f,v[w+7],10,1126891415),f=x(f,b,l,g,v[w+14],15,-1416354905),g=x(g,f,b,l,v[w+5],21,-57434055),l=x(l,g,f,b,v[w+12],6,1700485571),b=x(b,l,g,f,v[w+3],10,-1894986606),f=x(f,b,l,g,v[w+10],15,-1051523),g=x(g,f,b,l,v[w+1],21,-2054922799),l=x(l,g,f,b,v[w+8],6,1873313359),b=x(b,l,g,f,v[w+15],10,-30611744),f=x(f,b,l,g,v[w+6],15,-1560198380),g=x(g,f,b,l,v[w+13],21,1309151649),l=x(l,g,f,b,v[w+4],6,-145523070),b=x(b,l,g,f,v[w+11],10,-1120210379),f=x(f,b,l,g,v[w+2],15,718787259),g=x(g,f,b,l,v[w+9],21,-343485551),l=R(l,D),g=R(g,B),f=R(f,N),b=R(b,T)}return Array(l,g,f,b)}function _(v,S,l,g,f,b){return R((S=R(R(S,v),R(g,b)))<<f|S>>>32-f,l)}function k(v,S,l,g,f,b,w){return _(S&l|~S&g,v,S,f,b,w)}function C(v,S,l,g,f,b,w){return _(S&g|l&~g,v,S,f,b,w)}function E(v,S,l,g,f,b,w){return _(S^l^g,v,S,f,b,w)}function x(v,S,l,g,f,b,w){return _(l^(S|~g),v,S,f,b,w)}function R(v,S){var l=(65535&v)+(65535&S);return(v>>16)+(S>>16)+(l>>16)<<16|65535&l}r.exports=function(v){return A.hash(v,j,16)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(e,r,i){(function(o,u,a,h,c,d,m,U,L){r.exports=function(A){for(var j,_=new Array(A),k=0;k<A;k++)!(3&k)&&(j=4294967296*Math.random()),_[k]=j>>>((3&k)<<3)&255;return _}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(e,r,i){(function(o,u,a,h,c,d,m,U,L){var A=e("./helpers");function j(C,E){C[E>>5]|=128<<24-E%32,C[15+(E+64>>9<<4)]=E;for(var x,R,v,S=Array(80),l=1732584193,g=-271733879,f=-1732584194,b=271733878,w=-1009589776,D=0;D<C.length;D+=16){for(var B=l,N=g,T=f,F=b,J=w,z=0;z<80;z++){S[z]=z<16?C[D+z]:k(S[z-3]^S[z-8]^S[z-14]^S[z-16],1);var q=_(_(k(l,5),(q=g,R=f,v=b,(x=z)<20?q&R|~q&v:!(x<40)&&x<60?q&R|q&v|R&v:q^R^v)),_(_(w,S[z]),(x=z)<20?1518500249:x<40?1859775393:x<60?-1894007588:-899497514)),w=b,b=f,f=k(g,30),g=l,l=q}l=_(l,B),g=_(g,N),f=_(f,T),b=_(b,F),w=_(w,J)}return Array(l,g,f,b,w)}function _(C,E){var x=(65535&C)+(65535&E);return(C>>16)+(E>>16)+(x>>16)<<16|65535&x}function k(C,E){return C<<E|C>>>32-E}r.exports=function(C){return A.hash(C,j,20,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(e,r,i){(function(o,u,a,h,c,d,m,U,L){function A(E,x){var R=(65535&E)+(65535&x);return(E>>16)+(x>>16)+(R>>16)<<16|65535&R}function j(E,x){var R,v=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),S=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),l=new Array(64);E[x>>5]|=128<<24-x%32,E[15+(x+64>>9<<4)]=x;for(var g,f,b=0;b<E.length;b+=16){for(var w=S[0],D=S[1],B=S[2],N=S[3],T=S[4],F=S[5],J=S[6],z=S[7],q=0;q<64;q++)l[q]=q<16?E[q+b]:A(A(A((f=l[q-2],k(f,17)^k(f,19)^C(f,10)),l[q-7]),(f=l[q-15],k(f,7)^k(f,18)^C(f,3))),l[q-16]),R=A(A(A(A(z,k(f=T,6)^k(f,11)^k(f,25)),T&F^~T&J),v[q]),l[q]),g=A(k(g=w,2)^k(g,13)^k(g,22),w&D^w&B^D&B),z=J,J=F,F=T,T=A(N,R),N=B,B=D,D=w,w=A(R,g);S[0]=A(w,S[0]),S[1]=A(D,S[1]),S[2]=A(B,S[2]),S[3]=A(N,S[3]),S[4]=A(T,S[4]),S[5]=A(F,S[5]),S[6]=A(J,S[6]),S[7]=A(z,S[7])}return S}var _=e("./helpers"),k=function(E,x){return E>>>x|E<<32-x},C=function(E,x){return E>>>x};r.exports=function(E){return _.hash(E,j,32,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(e,r,i){(function(o,u,a,h,c,d,m,U,L){i.read=function(A,j,_,k,b){var E,x,R=8*b-k-1,v=(1<<R)-1,S=v>>1,l=-7,g=_?b-1:0,f=_?-1:1,b=A[j+g];for(g+=f,E=b&(1<<-l)-1,b>>=-l,l+=R;0<l;E=256*E+A[j+g],g+=f,l-=8);for(x=E&(1<<-l)-1,E>>=-l,l+=k;0<l;x=256*x+A[j+g],g+=f,l-=8);if(E===0)E=1-S;else{if(E===v)return x?NaN:1/0*(b?-1:1);x+=Math.pow(2,k),E-=S}return(b?-1:1)*x*Math.pow(2,E-k)},i.write=function(A,j,_,k,C,w){var x,R,v=8*w-C-1,S=(1<<v)-1,l=S>>1,g=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=k?0:w-1,b=k?1:-1,w=j<0||j===0&&1/j<0?1:0;for(j=Math.abs(j),isNaN(j)||j===1/0?(R=isNaN(j)?1:0,x=S):(x=Math.floor(Math.log(j)/Math.LN2),j*(k=Math.pow(2,-x))<1&&(x--,k*=2),2<=(j+=1<=x+l?g/k:g*Math.pow(2,1-l))*k&&(x++,k/=2),S<=x+l?(R=0,x=S):1<=x+l?(R=(j*k-1)*Math.pow(2,C),x+=l):(R=j*Math.pow(2,l-1)*Math.pow(2,C),x=0));8<=C;A[_+f]=255&R,f+=b,R/=256,C-=8);for(x=x<<C|R,v+=C;0<v;A[_+f]=255&x,f+=b,x/=256,v-=8);A[_+f-b]|=128*w}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(e,r,i){(function(o,u,a,h,c,d,m,U,L){var A,j,_;function k(){}(o=r.exports={}).nextTick=(j=typeof window<"u"&&window.setImmediate,_=typeof window<"u"&&window.postMessage&&window.addEventListener,j?function(C){return window.setImmediate(C)}:_?(A=[],window.addEventListener("message",function(C){var E=C.source;E!==window&&E!==null||C.data!=="process-tick"||(C.stopPropagation(),0<A.length&&A.shift()())},!0),function(C){A.push(C),window.postMessage("process-tick","*")}):function(C){setTimeout(C,0)}),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=k,o.addListener=k,o.once=k,o.off=k,o.removeListener=k,o.removeAllListeners=k,o.emit=k,o.binding=function(C){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(C){throw new Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(He);var mn=He.exports;const _t=mn.MD5;function ot(n){for(var t=arguments.length,e=Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+n+(e.length?" "+e.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function St(n){return!!n&&!!n[W]}function pt(n){return!!n&&(function(t){if(!t||typeof t!="object")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;var r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object||typeof r=="function"&&Function.toString.call(r)===kn}(n)||Array.isArray(n)||!!n[Ce]||!!n.constructor[Ce]||pe(n)||ge(n))}function At(n,t,e){e===void 0&&(e=!1),It(n)===0?(e?Object.keys:_e)(n).forEach(function(r){e&&typeof r=="symbol"||t(r,n[r],n)}):n.forEach(function(r,i){return t(i,r,n)})}function It(n){var t=n[W];return t?t.i>3?t.i-4:t.i:Array.isArray(n)?1:pe(n)?2:ge(n)?3:0}function se(n,t){return It(n)===2?n.has(t):Object.prototype.hasOwnProperty.call(n,t)}function _n(n,t){return It(n)===2?n.get(t):n[t]}function Qe(n,t,e){var r=It(n);r===2?n.set(t,e):r===3?(n.delete(t),n.add(e)):n[t]=e}function wn(n,t){return n===t?n!==0||1/n==1/t:n!=n&&t!=t}function pe(n){return xn&&n instanceof Map}function ge(n){return jn&&n instanceof Set}function Q(n){return n.o||n.t}function ye(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var t=Un(n);delete t[W];for(var e=_e(t),r=0;r<e.length;r++){var i=e[r],o=t[i];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),t)}function ve(n,t){return t===void 0&&(t=!1),be(n)||St(n)||!pt(n)||(It(n)>1&&(n.set=n.add=n.clear=n.delete=Sn),Object.freeze(n),t&&At(n,function(e,r){return ve(r,!0)},!0)),n}function Sn(){ot(2)}function be(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function dt(n){var t=ae[n];return t||ot(18,n),t}function An(n,t){ae[n]||(ae[n]=t)}function zt(){return Tt}function te(n,t){t&&(dt("Patches"),n.u=[],n.s=[],n.v=t)}function Jt(n){ue(n),n.p.forEach(On),n.p=null}function ue(n){n===Tt&&(Tt=n.l)}function Ie(n){return Tt={p:[],l:Tt,h:n,m:!0,_:0}}function On(n){var t=n[W];t.i===0||t.i===1?t.j():t.O=!0}function ee(n,t){t._=t.p.length;var e=t.p[0],r=n!==void 0&&n!==e;return t.h.g||dt("ES5").S(t,n,r),r?(e[W].P&&(Jt(t),ot(4)),pt(n)&&(n=Vt(t,n),t.l||Yt(t,n)),t.u&&dt("Patches").M(e[W].t,n,t.u,t.s)):n=Vt(t,e,[]),Jt(t),t.u&&t.v(t.u,t.s),n!==Ge?n:void 0}function Vt(n,t,e){if(be(t))return t;var r=t[W];if(!r)return At(t,function(o,u){return Ee(n,r,t,o,u,e)},!0),t;if(r.A!==n)return t;if(!r.P)return Yt(n,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=r.i===4||r.i===5?r.o=ye(r.k):r.o;At(r.i===3?new Set(i):i,function(o,u){return Ee(n,r,i,o,u,e)}),Yt(n,i,!1),e&&n.u&&dt("Patches").R(r,e,n.u,n.s)}return r.o}function Ee(n,t,e,r,i,o){if(St(i)){var u=Vt(n,i,o&&t&&t.i!==3&&!se(t.D,r)?o.concat(r):void 0);if(Qe(e,r,u),!St(u))return;n.m=!1}if(pt(i)&&!be(i)){if(!n.h.F&&n._<1)return;Vt(n,i),t&&t.A.l||Yt(n,i)}}function Yt(n,t,e){e===void 0&&(e=!1),n.h.F&&n.m&&ve(t,e)}function ne(n,t){var e=n[W];return(e?Q(e):n)[t]}function xe(n,t){if(t in n)for(var e=Object.getPrototypeOf(n);e;){var r=Object.getOwnPropertyDescriptor(e,t);if(r)return r;e=Object.getPrototypeOf(e)}}function lt(n){n.P||(n.P=!0,n.l&&lt(n.l))}function re(n){n.o||(n.o=ye(n.t))}function Ct(n,t,e){var r=pe(t)?dt("MapSet").N(t,e):ge(t)?dt("MapSet").T(t,e):n.g?function(i,o){var u=Array.isArray(i),a={i:u?1:0,A:o?o.A:zt(),P:!1,I:!1,D:{},l:o,t:i,k:null,o:null,j:null,C:!1},h=a,c=ce;u&&(h=[a],c=Ut);var d=Proxy.revocable(h,c),m=d.revoke,U=d.proxy;return a.k=U,a.j=m,U}(t,e):dt("ES5").J(t,e);return(e?e.A:zt()).p.push(r),r}function In(n){return St(n)||ot(22,n),function t(e){if(!pt(e))return e;var r,i=e[W],o=It(e);if(i){if(!i.P&&(i.i<4||!dt("ES5").K(i)))return i.t;i.I=!0,r=je(e,o),i.I=!1}else r=je(e,o);return At(r,function(u,a){i&&_n(i.t,u)===a||Qe(r,u,t(a))}),o===3?new Set(r):r}(n)}function je(n,t){switch(t){case 2:return new Map(n);case 3:return Array.from(n)}return ye(n)}function En(){function n(a,h){function c(){this.constructor=a}i(a,h),a.prototype=(c.prototype=h.prototype,new c)}function t(a){a.o||(a.D=new Map,a.o=new Map(a.t))}function e(a){a.o||(a.o=new Set,a.t.forEach(function(h){if(pt(h)){var c=Ct(a.A.h,h,a);a.p.set(h,c),a.o.add(c)}else a.o.add(h)}))}function r(a){a.O&&ot(3,JSON.stringify(Q(a)))}var i=function(a,h){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var m in d)d.hasOwnProperty(m)&&(c[m]=d[m])})(a,h)},o=function(){function a(c,d){return this[W]={i:2,l:d,A:d?d.A:zt(),P:!1,I:!1,o:void 0,D:void 0,t:c,k:this,C:!1,O:!1},this}n(a,Map);var h=a.prototype;return Object.defineProperty(h,"size",{get:function(){return Q(this[W]).size}}),h.has=function(c){return Q(this[W]).has(c)},h.set=function(c,d){var m=this[W];return r(m),Q(m).has(c)&&Q(m).get(c)===d||(t(m),lt(m),m.D.set(c,!0),m.o.set(c,d),m.D.set(c,!0)),this},h.delete=function(c){if(!this.has(c))return!1;var d=this[W];return r(d),t(d),lt(d),d.t.has(c)?d.D.set(c,!1):d.D.delete(c),d.o.delete(c),!0},h.clear=function(){var c=this[W];r(c),Q(c).size&&(t(c),lt(c),c.D=new Map,At(c.t,function(d){c.D.set(d,!1)}),c.o.clear())},h.forEach=function(c,d){var m=this;Q(this[W]).forEach(function(U,L){c.call(d,m.get(L),L,m)})},h.get=function(c){var d=this[W];r(d);var m=Q(d).get(c);if(d.I||!pt(m)||m!==d.t.get(c))return m;var U=Ct(d.A.h,m,d);return t(d),d.o.set(c,U),U},h.keys=function(){return Q(this[W]).keys()},h.values=function(){var c,d=this,m=this.keys();return(c={})[Nt]=function(){return d.values()},c.next=function(){var U=m.next();return U.done?U:{done:!1,value:d.get(U.value)}},c},h.entries=function(){var c,d=this,m=this.keys();return(c={})[Nt]=function(){return d.entries()},c.next=function(){var U=m.next();if(U.done)return U;var L=d.get(U.value);return{done:!1,value:[U.value,L]}},c},h[Nt]=function(){return this.entries()},a}(),u=function(){function a(c,d){return this[W]={i:3,l:d,A:d?d.A:zt(),P:!1,I:!1,o:void 0,t:c,k:this,p:new Map,O:!1,C:!1},this}n(a,Set);var h=a.prototype;return Object.defineProperty(h,"size",{get:function(){return Q(this[W]).size}}),h.has=function(c){var d=this[W];return r(d),d.o?!!d.o.has(c)||!(!d.p.has(c)||!d.o.has(d.p.get(c))):d.t.has(c)},h.add=function(c){var d=this[W];return r(d),this.has(c)||(e(d),lt(d),d.o.add(c)),this},h.delete=function(c){if(!this.has(c))return!1;var d=this[W];return r(d),e(d),lt(d),d.o.delete(c)||!!d.p.has(c)&&d.o.delete(d.p.get(c))},h.clear=function(){var c=this[W];r(c),Q(c).size&&(e(c),lt(c),c.o.clear())},h.values=function(){var c=this[W];return r(c),e(c),c.o.values()},h.entries=function(){var c=this[W];return r(c),e(c),c.o.entries()},h.keys=function(){return this.values()},h[Nt]=function(){return this.values()},h.forEach=function(c,d){for(var m=this.values(),U=m.next();!U.done;)c.call(d,U.value,U.value,this),U=m.next()},a}();An("MapSet",{N:function(a,h){return new o(a,h)},T:function(a,h){return new u(a,h)}})}var ke,Tt,me=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",xn=typeof Map<"u",jn=typeof Set<"u",Ue=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Ge=me?Symbol.for("immer-nothing"):((ke={})["immer-nothing"]=!0,ke),Ce=me?Symbol.for("immer-draftable"):"__$immer_draftable",W=me?Symbol.for("immer-state"):"__$immer_state",Nt=typeof Symbol<"u"&&Symbol.iterator||"@@iterator",kn=""+Object.prototype.constructor,_e=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Un=Object.getOwnPropertyDescriptors||function(n){var t={};return _e(n).forEach(function(e){t[e]=Object.getOwnPropertyDescriptor(n,e)}),t},ae={},ce={get:function(n,t){if(t===W)return n;var e=Q(n);if(!se(e,t))return function(i,o,u){var a,h=xe(o,u);return h?"value"in h?h.value:(a=h.get)===null||a===void 0?void 0:a.call(i.k):void 0}(n,e,t);var r=e[t];return n.I||!pt(r)?r:r===ne(n.t,t)?(re(n),n.o[t]=Ct(n.A.h,r,n)):r},has:function(n,t){return t in Q(n)},ownKeys:function(n){return Reflect.ownKeys(Q(n))},set:function(n,t,e){var r=xe(Q(n),t);if(r!=null&&r.set)return r.set.call(n.k,e),!0;if(!n.P){var i=ne(Q(n),t),o=i==null?void 0:i[W];if(o&&o.t===e)return n.o[t]=e,n.D[t]=!1,!0;if(wn(e,i)&&(e!==void 0||se(n.t,t)))return!0;re(n),lt(n)}return n.o[t]===e&&typeof e!="number"&&(e!==void 0||t in n.o)||(n.o[t]=e,n.D[t]=!0,!0)},deleteProperty:function(n,t){return ne(n.t,t)!==void 0||t in n.t?(n.D[t]=!1,re(n),lt(n)):delete n.D[t],n.o&&delete n.o[t],!0},getOwnPropertyDescriptor:function(n,t){var e=Q(n),r=Reflect.getOwnPropertyDescriptor(e,t);return r&&{writable:!0,configurable:n.i!==1||t!=="length",enumerable:r.enumerable,value:e[t]}},defineProperty:function(){ot(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){ot(12)}},Ut={};At(ce,function(n,t){Ut[n]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Ut.deleteProperty=function(n,t){return Ut.set.call(this,n,t,void 0)},Ut.set=function(n,t,e){return ce.set.call(this,n[0],t,e,n[0])};var Cn=function(){function n(e){var r=this;this.g=Ue,this.F=!0,this.produce=function(i,o,u){if(typeof i=="function"&&typeof o!="function"){var a=o;o=i;var h=r;return function(j){var _=this;j===void 0&&(j=a);for(var k=arguments.length,C=Array(k>1?k-1:0),E=1;E<k;E++)C[E-1]=arguments[E];return h.produce(j,function(x){var R;return(R=o).call.apply(R,[_,x].concat(C))})}}var c;if(typeof o!="function"&&ot(6),u!==void 0&&typeof u!="function"&&ot(7),pt(i)){var d=Ie(r),m=Ct(r,i,void 0),U=!0;try{c=o(m),U=!1}finally{U?Jt(d):ue(d)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(j){return te(d,u),ee(j,d)},function(j){throw Jt(d),j}):(te(d,u),ee(c,d))}if(!i||typeof i!="object"){if((c=o(i))===void 0&&(c=i),c===Ge&&(c=void 0),r.F&&ve(c,!0),u){var L=[],A=[];dt("Patches").M(i,c,L,A),u(L,A)}return c}ot(21,i)},this.produceWithPatches=function(i,o){if(typeof i=="function")return function(c){for(var d=arguments.length,m=Array(d>1?d-1:0),U=1;U<d;U++)m[U-1]=arguments[U];return r.produceWithPatches(c,function(L){return i.apply(void 0,[L].concat(m))})};var u,a,h=r.produce(i,o,function(c,d){u=c,a=d});return typeof Promise<"u"&&h instanceof Promise?h.then(function(c){return[c,u,a]}):[h,u,a]},typeof(e==null?void 0:e.useProxies)=="boolean"&&this.setUseProxies(e.useProxies),typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze)}var t=n.prototype;return t.createDraft=function(e){pt(e)||ot(8),St(e)&&(e=In(e));var r=Ie(this),i=Ct(this,e,void 0);return i[W].C=!0,ue(r),i},t.finishDraft=function(e,r){var i=e&&e[W],o=i.A;return te(o,r),ee(void 0,o)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!Ue&&ot(20),this.g=e},t.applyPatches=function(e,r){var i;for(i=r.length-1;i>=0;i--){var o=r[i];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}i>-1&&(r=r.slice(i+1));var u=dt("Patches").$;return St(e)?u(e,r):this.produce(e,function(a){return u(a,r)})},n}(),it=new Cn,Tn=it.produce;it.produceWithPatches.bind(it);it.setAutoFreeze.bind(it);it.setUseProxies.bind(it);it.applyPatches.bind(it);it.createDraft.bind(it);it.finishDraft.bind(it);function Xe(n,t){const e=Object.keys(n),r=Object.keys(t);return e.length===r.length&&Object.keys(n).every(i=>t.hasOwnProperty(i))}function Te(n,t){return Object.keys(n).length===Object.keys(t).length&&Object.keys(n).every(e=>t.hasOwnProperty(e)&&n[e]===t[e])}function Wt(n,t){return typeof n!="object"||typeof t!="object"||n===null||t===null?n===t:Xe(n,t)?Object.keys(n).every(e=>Wt(n[e],t[e])):!1}function Ze(n,t){if(!wt(n)||!wt(t))return t;const e={};for(const r of Object.keys(n))e[r]=n[r];for(const r of Object.keys(t)){if(t[r]===null)continue;const i=wt(n[r])&&wt(t[r]);e[r]=i?Ze(n[r],t[r]):t[r]}return e}function tn(n,t,e){if(!wt(n))return n;const r={};for(const[i,o]of Object.entries(n))r[i]=wt(o)?tn(o,t,e):o===t?e:o;return r}function wt(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}En();function Mn(n){return n.cardinality==="one"}function we(n){return n["value-type"]==="ref"}function Pn(n){return n["value-type"]==="blob"}function Qt(n,t){return n[t]}function Se(n,t){return t.reduce((e,r)=>e&&e.get(r),n)}function ht(n,t){if(t.length===0)throw new Error("path must have at least one element");if(t.length===1){n.delete(t[0]);return}const[e,...r]=t;n.has(e)&&ht(n.get(e),r)}function ft(n,t,e){if(t.length===0)throw new Error("path must have at least one element");if(t.length===1){n.set(t[0],e);return}const[r,...i]=t;let o=n.get(r);o||(o=new Map,n.set(r,o)),ft(o,i,e)}function en(n,t){const e=new Map,r=new Map,i=new Map;for(const o of t){const[u,a,h,c]=o,d=Qt(n,a);if(!d){console.warn("no such attr",u,n);continue}we(d)&&ft(i,[h,a,u],o),ft(e,[u,a,h],o),ft(r,[a,u,h],o)}return{eav:e,aev:r,vae:i}}function Me(n,t,e,r){const i=en(n,t);return i.attrs=n,i.cardinalityInference=e,i.linkIndex=r,i}function Gt(n,t){var e,r;let i;if(Array.isArray(t[0])){const[u,a]=t[0],h=n.aev.get(u);if(!h)return null;i=(e=yt(h,2).find(d=>d[2]===a))===null||e===void 0?void 0:e[0]}else i=t[0];if(!i)return null;const o=t[2];if(Array.isArray(o)&&o.length===2&&n.aev.get(o[0])){const[u,a]=o,h=n.aev.get(u);if(!h)return null;const d=(r=yt(h,2).find(j=>j[2]===a))===null||r===void 0?void 0:r[0];if(!d)return null;const[m,U,L,...A]=t;return[i,U,d,...A]}else{const[u,...a]=t;return[i,...a]}}function Ln(n,t){const e=Gt(n,t);if(!e)return;const[r,i,o]=e,u=Qt(n.attrs,i);u&&(ht(n.eav,[r,i,o]),ht(n.aev,[i,r,o]),we(u)&&ht(n.vae,[o,i,r]))}let Rn=0;function nn(n,t,e){const[r,i,o]=e;let u;const a=Se(n.ea,[r,i,o]);return a&&(u=a[3]),u||Date.now()*10+Rn++}function Bn(n,t){var e;const r=Gt(n,t);if(!r)return;const[i,o,u]=r,a=Qt(n.attrs,o);if(!a)return;const h=Se(n.eav,[i,o,u]),c=(e=h==null?void 0:h[3])!==null&&e!==void 0?e:nn(n,a,r),d=[i,o,u,c];Mn(a)?(ft(n.eav,[i,o],new Map([[u,d]])),ft(n.aev,[o,i],new Map([[u,d]]))):(ft(n.eav,[i,o,u],d),ft(n.aev,[o,i,u],d)),we(a)&&ft(n.vae,[u,o,i],d)}function Dn(n,t){var e;const r=Gt(n,t);if(!r)return;const[i,o,u]=r,a=Qt(n.attrs,o);if(!a)return;if(!Pn(a))throw new Error("merge operation is not supported for links");const h=Se(n.eav,[i,o]);if(!h)return;const c=(e=h.values().next())===null||e===void 0?void 0:e.value;if(!c)return;const d=c[2],m=Ze(d,u),U=[i,o,m,nn(n,a,c)];ft(n.eav,[i,o],new Map([[m,U]]))}function Nn(n,t){const e=Gt(n,t);if(!e)return;const[r]=e,i=n.eav.get(r);if(i)for(const u of i.keys())ht(n.aev,[u,r]);ht(n.eav,[r]);const o=n.vae.get(r)&&yt(n.vae.get(r),2);o&&o.forEach(u=>{const[a,h,c]=u;ht(n.eav,[a,h,c]),ht(n.aev,[h,a,c])}),ht(n.vae,[r])}function rn(n,t){const e=en(n.attrs,t);Object.keys(e).forEach(r=>{n[r]=e[r]})}function $n(n,[t]){n.attrs[t.id]=t}function on(n){return yt(n.eav,3)}function Fn(n,[t]){if(!n.attrs[t])return;const e=on(n).filter(([r,i])=>i!==t);delete n.attrs[t],rn(n,e)}function qn(n,[t]){const e=n.attrs[t.id];e&&(n.attrs[t.id]=Object.assign(Object.assign({},e),t),rn(n,on(n)))}function Wn(n,t){const[e,...r]=t;switch(e){case"add-triple":Bn(n,r);break;case"deep-merge-triple":Dn(n,r);break;case"retract-triple":Ln(n,r);break;case"delete-entity":Nn(n,r);break;case"add-attr":$n(n,r);break;case"delete-attr":Fn(n,r);break;case"update-attr":qn(n,r);break;default:throw new Error(`unhandled transaction action: ${e}`)}}function yt(n,t,e=[]){if(!n||t===0)return e;if(t===1){for(const r of n.values())e.push(r);return e}for(const r of n.values())yt(r,t-1,e);return e}function $t(n,t){const e=[],r=t.in?t.in:[t];for(const i of r){const o=n.get(i);o&&e.push(o)}return e}function zn(n,t,e){let r="";return n!==void 0&&(r+="e"),t!==void 0&&(r+="a"),e!==void 0&&(r+="v"),r}function Jn(n,[t,e,r]){var i,o;switch(zn(t,e,r)){case"e":{const a=n.eav.get(t);return yt(a,2)}case"ea":{const a=(i=n.eav.get(t))===null||i===void 0?void 0:i.get(e);return yt(a,1)}case"eav":{const a=(o=n.eav.get(t))===null||o===void 0?void 0:o.get(e);return a?$t(a,r):[]}case"ev":{const a=n.eav.get(t);if(!a)return[];const h=[];for(const c of a.values())h.push(...$t(c,r));return h}case"av":{const a=n.aev.get(e);if(!a)return[];const h=[];for(const c of a.values())h.push(...$t(c,r));return h}case"v":{const a=[];for(const h of n.eav.values())for(const c of h.values())a.push(...$t(c,r))}default:return yt(n.eav,3)}}function Vn(n,t){return Tn(n,e=>{t.forEach(r=>{Wn(e,r)})})}function Yn(n){return typeof n=="string"&&n.startsWith("?")}function Kn(n,t,e){if(e.hasOwnProperty(n)){const r=e[n];return sn(r,t,e)}return Object.assign(Object.assign({},e),{[n]:t})}function Pe(n,t,e){return n===t?e:null}function Hn(n,t,e){const{in:r}=n;return r&&r.includes(t)?e:null}function Qn(n){switch(typeof n){case"string":return n.startsWith("?")?Kn:Pe;case"object":return Hn;default:return Pe}}function sn(n,t,e){return e?Qn(n)(n,t,e):null}function Gn(n,t,e){return n.reduce((r,i,o)=>{const u=t[o];return sn(i,u,r)},e)}function Xn(n,t,e){return er(n,t,e).map(r=>Gn(t,r,e)).filter(r=>r)}function Zn(n,t,e){return t.or?t.or.patterns.flatMap(r=>fe(n,r,e)):t.and?t.and.patterns.reduce((r,i)=>fe(n,i,r),e):e.flatMap(r=>Xn(n,t,r))}function fe(n,t,e=[{}]){return t.reduce((r,i)=>Zn(n,i,r),e)}function Ae(n,t){return Array.isArray(t)?t.map(e=>Ae(n,e)):Yn(t)?n[t]:t}function tr(n,{find:t,where:e}){return fe(n,e).map(i=>Ae(i,t))}function er(n,t,e){return Jn(n,Ae(e,t))}let Ft;const nr=new Uint8Array(16);function rr(){if(!Ft&&(Ft=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ft))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ft(nr)}const G=[];for(let n=0;n<256;++n)G.push((n+256).toString(16).slice(1));function ir(n,t=0){return G[n[t+0]]+G[n[t+1]]+G[n[t+2]]+G[n[t+3]]+"-"+G[n[t+4]]+G[n[t+5]]+"-"+G[n[t+6]]+G[n[t+7]]+"-"+G[n[t+8]]+G[n[t+9]]+"-"+G[n[t+10]]+G[n[t+11]]+G[n[t+12]]+G[n[t+13]]+G[n[t+14]]+G[n[t+15]]}const or=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Le={randomUUID:or};function sr(n,t,e){if(Le.randomUUID&&!t&&!n)return Le.randomUUID();n=n||{};const r=n.random||(n.rng||rr)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ir(r)}function Re(n){const t=n.replace(/-/g,""),e=[];for(let r=0;r<t.length;r+=2)e.push(parseInt(t.substring(r,r+2),16));return e}function ur(n,t){for(let e=0;e<n.length;e++){if(n[e]<t[e])return-1;if(n[e]>t[e])return 1}return 0}function Be(n,t){return ur(Re(n),Re(t))}function Z(){return sr()}function de(n,t,e){return new Proxy({},{get:(r,i)=>i==="__ops"?e:o=>de(n,t,[...e,[i,n,t,o]])})}function le(n){return n.startsWith("lookup__")}function un(n){const[t,e,...r]=n.split("__");return[e,JSON.parse(r.join("__"))]}function ar(n){return new Proxy({},{get(t,e){return le(e)?de(n,un(e),[]):de(n,e,[])}})}function an(){return new Proxy({},{get(n,t){return ar(t)}})}const Mt=an();function cr(n){return n.__ops}function fr(n,t){const{attrIdMap:e,refSwapAttrIds:r}=n,i=[];for(const u of t){const a=e[u];if(a)i.push(a);else if(Array.isArray(u)&&u.length==2&&e[u[0]]){const[h,c]=u;i.push([e[h],c])}else i.push(u)}const[o]=t;if((o==="add-triple"||o==="retract-triple")&&r.has(t[2])){const u=i[1];i[1]=i[3],i[3]=u}return i}function tt(n,t,e){return Object.values(n).find(r=>{const[i,o,u]=r["forward-identity"];return o===t&&u===e})}function Ot(n,t,e){return Object.values(n).find(r=>{const i=r["reverse-identity"];if(!i)return!1;const[o,u,a]=i;return u===t&&a===e})}function dr(n){if(Array.isArray(n))return n;const t=Object.entries(n);if(t.length!==1)throw new Error("lookup must be an object with a single unique attr and value.");return t[0]}function cn(n,t,e){return e.indexOf(".")!==-1&&!tt(n,t,e)}function fn(n){const[t,e,...r]=n.split(".");if(r.length>0||e!=="id")throw new Error(`${n} is not a valid lookup attribute.`);return t}function lr(n,t,e){if(!cn(n,t,e))return tt(n,t,e);const r=fn(e),i=tt(n,t,r);if(i&&i["value-type"]!=="ref")throw new Error(`${e} does not reference a valid link attribute.`);return i}function dn(n){return typeof n=="string"&&!le(n)?null:typeof n=="string"&&le(n)?un(n):dr(n)}function st(n,t,e){const r=dn(e);if(r===null)return e;const[i,o]=r,u=lr(n,t,i);if(!u||!u["unique?"])throw new Error(`${i} is not a unique attribute.`);return[u.id,o]}function hr(n,[t,e,r]){return Object.entries(r).flatMap(([o,u])=>{const a=Array.isArray(u)?u:[u],h=tt(n,t,o),c=Ot(n,t,o);return a.map(d=>h?["add-triple",st(n,t,e),h.id,st(n,h["reverse-identity"][1],d)]:["add-triple",st(n,c["forward-identity"][1],d),c.id,st(n,t,e)])})}function pr(n,[t,e,r]){return Object.entries(r).flatMap(([o,u])=>{const a=Array.isArray(u)?u:[u],h=tt(n,t,o),c=Ot(n,t,o);return a.map(d=>h?["retract-triple",st(n,t,e),h.id,st(n,h["reverse-identity"][1],d)]:["retract-triple",st(n,c["forward-identity"][1],d),c.id,st(n,t,e)])})}function gr(n,[t,e,r]){const i=st(n,t,e);return[["id",st(n,t,e)]].concat(Object.entries(r)).map(([u,a])=>{const h=tt(n,t,u);return["add-triple",i,h.id,a]})}function yr(n,[t,e]){return[["delete-entity",st(n,t,e)]]}function vr(n,[t,e,r]){const i=st(n,t,e),o=Object.entries(r).map(([a,h])=>{const c=tt(n,t,a),d=tn(h,void 0,null);return["deep-merge-triple",i,c.id,d]});return[["add-triple",i,tt(n,t,"id").id,i]].concat(o)}function br(n,[t,...e]){switch(t){case"merge":return vr(n,e);case"update":return gr(n,e);case"link":return hr(n,e);case"unlink":return pr(n,e);case"delete":return yr(n,e);default:throw new Error(`unsupported action ${t}`)}}function De(n,t,e){const r=Z(),o=[Z(),n,t];return Object.assign({id:r,"forward-identity":o,"value-type":"blob",cardinality:"one","unique?":!1,"index?":!1,isUnsynced:!0},e||{})}function Ne(n,t,e){const r=Z(),i=Z(),o=Z();return Object.assign({id:r,"forward-identity":[i,n,t],"reverse-identity":[o,t,n],"value-type":"ref",cardinality:"many","unique?":!1,"index?":!1,isUnsynced:!0},e||{})}const mr=new Set(["update","merge","link","unlink"]),_r=new Set(["link","unlink"]),wr=new Set(["update","merge"]),Sr=new Set(["link","unlink","update","merge","delete"]),ln={"unique?":!0,"index?":!0},Ar=Object.assign(Object.assign({},ln),{cardinality:"one"});function Or(n,t){const[e,r,i]=[new Set,Object.assign({},n),[]];function o(a){r[a.id]=a,i.push(["add-attr",a]),e.add(a.id)}function u(a){a!=null&&a.isUnsynced&&!e.has(a.id)&&(i.push(["add-attr",a]),e.add(a.id))}for(const a of t){const[h,c,d,m]=a;if(Sr.has(h)){const U=dn(d);if(U){const L=U[0];if(cn(r,c,L)){const A=fn(L),j=tt(r,c,A),_=Ot(r,c,A);!j&&!_&&o(Ne(c,A,Ar)),u(j),u(_)}else{const A=tt(r,c,L);A||o(De(c,L,ln)),u(A)}}}}for(const a of t){const[h,c,d,m]=a;if(mr.has(h)){const U=Object.keys(m);U.push("id");for(const L of U){const A=tt(r,c,L);if(u(A),wr.has(h)&&(A||o(De(c,L))),_r.has(h)){const j=Ot(r,c,L);!A&&!j&&o(Ne(c,L)),u(j)}}}}return[r,i]}function Ir(n,t){const r=(Array.isArray(t)?t:[t]).flatMap(a=>cr(a)),[i,o]=Or(n,r),u=r.flatMap(a=>br(i,a));return[...o,...u]}let Er=0;function Kt(n){return Xt(`_${n}`,Er++)}function Xt(n,t){return`?${n}-${t}`}class Pt extends Error{constructor(t){super(t),this.name="AttrNotFoundError"}}function xr(n,t){const e=Object.values(n.attrs).find(r=>{var i;return r["primary?"]&&((i=r["forward-identity"])===null||i===void 0?void 0:i[1])===t});return e||tt(n.attrs,t,"id")}function jr(n,t){const e=xr(n,t);if(!e)throw new Pt(`Could not find id attr for ${t}`);return e}function $e(n,t,e,r){return[kr(n,t,e,r),Ur(n,e,r)]}function kr(n,t,e,r){return[n(e,r),jr(t,e).id,n(e,r),Kt("time")]}function Ur(n,t,e){return[n(t,e),n("attr",e),n("val",e),n("time",e)]}function Cr(n,t,e){return n.map(r=>r===t?e:r)}function hn(n,t,e,r,i){const o=tt(t.attrs,e,i),u=Ot(t.attrs,e,i),a=o||u;if(!a)throw new Pt(`Could not find attr for ${[e,i]}`);if(a["value-type"]!=="ref")throw new Error(`Attr ${a.id} is not a ref`);const[h,c]=a["forward-identity"],[d,m]=a["reverse-identity"],U=r+1,L=o?[n(c,r),a.id,n(m,U),Kt("time")]:[n(c,U),a.id,n(m,r),Kt("time")];return[o?m:c,U,L,a,!!o]}function Tr(n,t,e,r,i,o){const u=tt(t.attrs,e,i);if(!u)throw new Pt(`No attr for etype = ${e} label = ${i} value-label`);return[n(e,r),u.id,o,Kt("time")]}function Mr(n,t,e,r,i){const[o,u,a]=i.reduce((h,c)=>{const[d,m,U]=h,[L,A,j]=hn(n,t,d,m,c);return[L,A,[...U,j]]},[e,r,[]]);return[o,u,a]}function Pr(n,t,e,r,i,o){const u=i.slice(0,i.length-1),a=i[i.length-1],[h,c,d]=Mr(n,t,e,r,u),m=Tr(n,t,h,c,a,o);return d.concat([m])}function Lr(n,t){return t?[t].concat(n):n}function Rr([n,t]){return n==="or"&&Array.isArray(t)}function Br([n,t]){return n==="and"&&Array.isArray(t)}function Dr(n,t,e){return(r,i)=>r==t?n(r,i):`${n(r,i)}-${e}`}function Fe(n,t,e,r,i,o){const u=o.map((h,c)=>{const d=Dr(n,r,c);return pn(d,e,r,i,h)}),a=n(r,i);return{[t]:{patterns:u,joinSym:a}}}function pn(n,t,e,r,i){return Object.entries(i).flatMap(([o,u])=>{if(Rr([o,u]))return Fe(n,"or",t,e,r,u);if(Br([o,u]))return Fe(n,"and",t,e,r,u);const a=o.split(".");return Pr(n,t,e,r,a,u)})}function Nr(n,t,e,r){const i=Xt;return r?pn(i,n,t,e,r).concat($e(i,n,t,e)):$e(i,n,t,e)}function $r(n,t,e){return[n(t,e),n("attr",e),n("val",e),n("time",e)]}function Fr(n,t,e,r,i,o){const[u,a,h,c,d]=hn(n,t,e,r,i),m=Cr(h,n(e,r),o);return[u,a,m,c,d]}function qr(n,t,{etype:e,level:r,form:i},o){const u=Object.keys(i).filter(a=>a!=="$");return u.length?Object.entries(o).map(([a,h])=>u.map(d=>{var m,U,L;const A=!!(t.cardinalityInference&&(!((L=(U=(m=t.linkIndex)===null||m===void 0?void 0:m[e])===null||U===void 0?void 0:U[d])===null||L===void 0)&&L.isSingular));try{const[j,_,k]=Fr(n,t,e,r,d,a),C=gn(t,{etype:j,level:_,form:i[d],join:k}),E=A?C[0]:C;return{[d]:E}}catch(j){if(j instanceof Pt)return{[d]:A?void 0:[]};throw j}}).reduce((d,m)=>Object.assign(Object.assign({},d),m),h)):Object.values(o)}function Wr(n,t){const e=n[t];return e["value-type"]==="ref"&&e["forward-identity"][2]!=="id"}function qe(n,t){switch(n){case"asc":switch(t){case"number":return(e,r)=>e<r;case"uuid":return(e,r)=>Be(e,r)===-1}case"desc":switch(t){case"number":return(e,r)=>e>r;case"uuid":return(e,r)=>Be(e,r)===1}}}function zr(n,t,[e,r,i,o]){return qe(t,"number")(o,n[3])||o===n[3]&&qe(t,"uuid")(e,n[0])}function Jr(n,t,e,r,i){const o=r==null?void 0:r["start-cursor"],u=[],a=tr(n,i).sort((h,c)=>{const d=h[3],m=c[3];return e==="desc"?m-d:d-m}).reduce((h,c)=>{const[d,m,U]=c;if(Wr(n.attrs,m))return h;const L=n.attrs[m],[A,j,_]=L["forward-identity"];return j!==t||(o&&m===o[1]&&zr(o,e,c)&&u.push(d),h[d]=h[d]||{},h[d][_]=U),h},{});for(const h of u)delete a[h];return a}function Vr(n){var t;const e=(t=n.$)===null||t===void 0?void 0:t.order;return e&&e[Object.keys(e)[0]]||"asc"}function Yr(n,{etype:t,level:e,form:r,join:i,pageInfo:o}){var u,a,h,c,d,m,U;const L=((u=r.$)===null||u===void 0?void 0:u.limit)||((a=r.$)===null||a===void 0?void 0:a.first)||((h=r.$)===null||h===void 0?void 0:h.last),A=(c=r.$)===null||c===void 0?void 0:c.offset,j=(d=r.$)===null||d===void 0?void 0:d.before,_=(m=r.$)===null||m===void 0?void 0:m.after;if((A||j||_)&&(!o||!o["start-cursor"]))return[];const k=Lr(Nr(n,t,e,(U=r.$)===null||U===void 0?void 0:U.where),i),C=$r(Xt,t,e),E=Jr(n,t,Vr(r),o,{where:k,find:C});if(L!=null){const x=Object.entries(E);return x.length<=L?E:Object.fromEntries(x.slice(0,L))}return E}function Kr(n,t){try{return Yr(n,t)}catch(e){if(e instanceof Pt)return{};throw e}}function gn(n,t){const e=Kr(n,t);return qr(Xt,n,t,e)}function Hr(n){const t={};for(const[e,r]of Object.entries(n))t[e]={startCursor:r["start-cursor"],endCursor:r["end-cursor"],hasNextPage:r["has-next-page?"],hasPreviousPage:r["has-previous-page?"]};return t}function Qr({store:n,pageInfo:t,aggregate:e},r){const o={data:Object.keys(r).reduce((u,a)=>(e!=null&&e[a]||(u[a]=gn(n,{etype:a,form:r[a],level:0,pageInfo:t==null?void 0:t[a]})),u),{})};return t&&(o.pageInfo=Hr(t)),e&&(o.aggregate=e),o}var We=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(d){try{c(r.next(d))}catch(m){u(m)}}function h(d){try{c(r.throw(d))}catch(m){u(m)}}function c(d){d.done?o(d.value):i(d.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};class yn{constructor(t){this.dbName=t,this._storeName="kv",this._dbPromise=this._init()}_init(){return new Promise((t,e)=>{const r=indexedDB.open(this.dbName,1);r.onerror=i=>{e(i)},r.onsuccess=i=>{t(i.target.result)},r.onupgradeneeded=i=>{i.target.result.createObjectStore(this._storeName)}})}getItem(t){return We(this,void 0,void 0,function*(){const e=yield this._dbPromise;return new Promise((r,i)=>{const a=e.transaction([this._storeName],"readonly").objectStore(this._storeName).get(t);a.onerror=h=>{i(h)},a.onsuccess=h=>{a.result?r(a.result):r(null)}})})}setItem(t,e){return We(this,void 0,void 0,function*(){const r=yield this._dbPromise;return new Promise((i,o)=>{const h=r.transaction([this._storeName],"readwrite").objectStore(this._storeName).put(e,t);h.onerror=c=>{o(c)},h.onsuccess=c=>{i()}})})}}var Gr=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(d){try{c(r.next(d))}catch(m){u(m)}}function h(d){try{c(r.throw(d))}catch(m){u(m)}}function c(d){d.done?o(d.value):i(d.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};class vn{static getIsOnline(){return Gr(this,void 0,void 0,function*(){return navigator.onLine})}static listen(t){const e=()=>{t(!0)},r=()=>{t(!1)};return addEventListener("online",e),addEventListener("offline",r),()=>{removeEventListener("online",e),removeEventListener("offline",r)}}}var Xr=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(d){try{c(r.next(d))}catch(m){u(m)}}function h(d){try{c(r.throw(d))}catch(m){u(m)}}function c(d){d.done?o(d.value):i(d.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};function gt(n,t){return Xr(this,void 0,void 0,function*(){const e=yield fetch(n,t),r=yield e.json();return e.status===200?Promise.resolve(r):Promise.reject({status:e.status,body:r})})}var Lt=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(d){try{c(r.next(d))}catch(m){u(m)}}function h(d){try{c(r.throw(d))}catch(m){u(m)}}function c(d){d.done?o(d.value):i(d.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};function Zr({apiURI:n,appId:t,email:e}){return gt(`${n}/runtime/auth/send_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":t,email:e})})}function ti(n){return Lt(this,arguments,void 0,function*({apiURI:t,appId:e,email:r,code:i}){return yield gt(`${t}/runtime/auth/verify_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,email:r,code:i})})})}function ei(n){return Lt(this,arguments,void 0,function*({apiURI:t,appId:e,refreshToken:r}){return yield gt(`${t}/runtime/auth/verify_refresh_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,"refresh-token":r})})})}function ze(n){return Lt(this,arguments,void 0,function*({apiURI:t,appId:e,code:r,codeVerifier:i}){return yield gt(`${t}/runtime/oauth/token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,code:r,code_verifier:i})})})}function ni(n){return Lt(this,arguments,void 0,function*({apiURI:t,appId:e,nonce:r,idToken:i,clientName:o,refreshToken:u}){return yield gt(`${t}/runtime/oauth/id_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,nonce:r,id_token:i,client_name:o,refresh_token:u})})})}function ri(n){return Lt(this,arguments,void 0,function*({apiURI:t,appId:e,refreshToken:r}){return yield gt(`${t}/runtime/signout`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,refresh_token:r})})})}var Zt=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(d){try{c(r.next(d))}catch(m){u(m)}}function h(d){try{c(r.throw(d))}catch(m){u(m)}}function c(d){d.done?o(d.value):i(d.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};function ii(n){return Zt(this,arguments,void 0,function*({apiURI:t,appId:e,fileName:r,refreshToken:i,metadata:o={}}){const{data:u}=yield gt(`${t}/storage/signed-upload-url`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${i}`},body:JSON.stringify({app_id:e,filename:r})});return u})}function oi(n,t){return Zt(this,void 0,void 0,function*(){return(yield fetch(n,{method:"PUT",body:t,headers:{"Content-Type":t.type}})).ok})}function si(n){return Zt(this,arguments,void 0,function*({apiURI:t,appId:e,path:r,refreshToken:i}){const{data:o}=yield gt(`${t}/storage/signed-download-url?app_id=${e}&filename=${encodeURIComponent(r)}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return o})}function ui(n){return Zt(this,arguments,void 0,function*({apiURI:t,appId:e,path:r,refreshToken:i}){const{data:o}=yield gt(`${t}/storage/files?app_id=${e}&filename=${encodeURIComponent(r)}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return o})}function Je(n,t){if(!t)return n;const e={};return t.forEach(r=>{e[r]=n[r]}),e}function ai(n,t){var e,r;const i={peers:{}};if(t&&"user"in t?t.user:!0){const u=Je((e=n.user)!==null&&e!==void 0?e:{},t==null?void 0:t.keys);i.user=u}for(const u of Object.keys((r=n.peers)!==null&&r!==void 0?r:{})){const a=(t==null?void 0:t.peers)===void 0,h=Array.isArray(t==null?void 0:t.peers)&&(t==null?void 0:t.peers.includes(u));if(a||h){const c=Je(n.peers[u],t==null?void 0:t.keys);i.peers[u]=c}}return i}function ci(n,t){if(n.isLoading!==t.isLoading||n.error!==t.error||(n.user||t.user)&&(!n.user||!t.user||!Te(n.user,t.user))||!Xe(n.peers,t.peers))return!0;for(const r of Object.keys(n.peers))if(!Te(n.peers[r],t.peers[r]))return!0;return!1}class fi{constructor(){this.promise=new Promise((t,e)=>{this._resolve=t,this._reject=e})}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}var Ve=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(d){try{c(r.next(d))}catch(m){u(m)}}function h(d){try{c(r.throw(d))}catch(m){u(m)}}function c(d){d.done?o(d.value):i(d.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};class Ye{constructor(t,e,r,i,o=a=>JSON.stringify(a),u=a=>JSON.parse(a)){this._persister=t,this._key=e,this._onMerge=i,this._loadedCbs=[],this._isLoading=!0,this.currentValue=r,this.toJSON=o,this.fromJSON=u,this._load()}_load(){return Ve(this,void 0,void 0,function*(){const t=this.fromJSON(yield this._persister.getItem(this._key));this._isLoading=!1,this._onMerge(t,this.currentValue);for(const e of this._loadedCbs)e()})}waitForLoaded(){return Ve(this,void 0,void 0,function*(){if(!this._isLoading)return;yield new Promise(e=>{this._loadedCbs.push(e)})})}set(t,e){this.currentValue=t(this.currentValue),this._isLoading||setTimeout(()=>{this._persister.setItem(this._key,this.toJSON(this.currentValue)),e&&e()},0)}}function bn(n,t=[]){n.forEach(e=>{const{data:r}=e,{"datalog-result":i}=r,{"join-rows":o}=i;for(const u of o)for(const a of u)t.push(a);bn(e["child-nodes"],t)})}function Ke(n){const t=[];return bn(n,t),t}function di(n,t){return t instanceof Map?{__type:"m",entries:[...t.entries()]}:t}function li(n,t){return t&&typeof t=="object"&&t.__type==="m"?new Map(t.entries):t}function hi(n){return JSON.stringify(n,di)}function pi(n){return JSON.parse(n,li)}function gi(n){return Object.values(n.links).reduce((t,e)=>{var r,i,o,u;return(r=t[o=e.forward.on])!==null&&r!==void 0||(t[o]={}),t[e.forward.on][e.forward.label]={isForward:!0,isSingular:e.forward.has==="one",link:e},(i=t[u=e.reverse.on])!==null&&i!==void 0||(t[u]={}),t[e.reverse.on][e.reverse.label]={isForward:!1,isSingular:e.reverse.has==="one",link:e},t},{})}var X=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(d){try{c(r.next(d))}catch(m){u(m)}}function h(d){try{c(r.throw(d))}catch(m){u(m)}}function c(d){d.done?o(d.value):i(d.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};const vt={CONNECTING:"connecting",OPENED:"opened",AUTHENTICATED:"authenticated",CLOSED:"closed",ERRORED:"errored"},yi=1,vi={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"},ie="_instant_oauth_redirect",oe="currentUser";function bi(){return typeof window<"u"||typeof chrome<"u"}class mi{constructor(t,e=yn,r=vn){this._isOnline=!0,this._isShutdown=!1,this.status=vt.CONNECTING,this.queryCbs={},this.authCbs=[],this.attrsCbs=[],this.mutationErrorCbs=[],this.mutationDeferredStore=new Map,this._reconnectTimeoutId=null,this._reconnectTimeoutMs=0,this._localIdPromises={},this._errorMessage=null,this._oauthCallbackResponse=null,this._linkIndex=null,this._presence={},this._broadcastSubs={},this._currentUserCached={isLoading:!0,error:void 0,user:void 0},this._onMergeQuerySubs=(i,o)=>{const u=i||{},a=Object.assign({},o);Object.entries(o).forEach(([c,d])=>{var m;const U=(m=u==null?void 0:u[c])===null||m===void 0?void 0:m.result,L=d.result;U&&!L&&(a[c].result=U)}),Object.keys(u).filter(c=>!o[c]).slice(0,10).forEach(c=>{a[c]=u[c]}),this.querySubs.set(c=>a),this.notifyAll()},this._onMergePendingMutations=(i,o)=>{const u=new Map([...i.entries(),...o.entries()]);this.pendingMutations.set(h=>u),this._rewriteMutations(this.attrs,i).forEach((h,c)=>{!o.has(c)&&!h["tx-id"]&&this._sendMutation(c,h)})},this.getPreviousResult=i=>{var o,u,a;const h=_t(i),c=this._errorMessage,d=(a=(u=(o=this.querySubs)===null||o===void 0?void 0:o.currentValue)===null||u===void 0?void 0:u[h])===null||a===void 0?void 0:a.result;if(c)return{error:c};if(d)return this.dataForResult(i,d)},this.notifyOne=i=>{const o=this.queryCbs[i]||[];if(!o)return;const u=this._errorMessage;if(u){o.forEach(m=>m({error:u}));return}const{q:a,result:h,iqlResult:c}=this.querySubs.currentValue[i]||{};if(!h)return;const d=this.dataForResult(a,h);Wt(d.data,c)||(this.querySubs.currentValue[i].iqlResult=h.data,o.forEach(m=>m(d)))},this.notifyQueryError=(i,o)=>{(this.queryCbs[i]||[]).forEach(a=>a({error:o}))},this.pushTx=i=>{try{const o=Ir(this.optimisticAttrs(),i);return this.pushOps(o)}catch(o){return this.pushOps([],o)}},this.pushOps=(i,o)=>{const u=Z(),a={op:"transact","tx-steps":i,error:o};this.pendingMutations.set(c=>(c.set(u,a),c));const h=new fi;return this.mutationDeferredStore.set(u,h),this._sendMutation(u,a),this.notifyAll(),h.promise},this._wsOnOpen=()=>{kt.info("[socket] connected"),this._setStatus(vt.OPENED),this.getCurrentUser().then(i=>{var o;this._trySend(Z(),{op:"init","app-id":this.config.appId,"refresh-token":(o=i.user)===null||o===void 0?void 0:o.refresh_token,"__admin-token":this.config.__adminToken})})},this._wsOnMessage=i=>{this._handleReceive(JSON.parse(i.data.toString()))},this._wsOnError=i=>{kt.error("[socket] error: ",i)},this._wsOnClose=()=>{if(this._setStatus(vt.CLOSED),this._isShutdown){kt.info("[socket-close] socket has been shut down and will not reconnect");return}kt.info("[socket-close] scheduling reconnect",this._reconnectTimeoutMs),setTimeout(()=>{if(this._reconnectTimeoutMs=Math.min(this._reconnectTimeoutMs+1e3,1e4),!this._isOnline){kt.info("[socket-close] we are offline, no need to start socket");return}this._startSocket()},this._reconnectTimeoutMs)},this.config=Object.assign(Object.assign({},vi),t),this.config.schema&&(this._linkIndex=gi(this.config.schema)),bi()&&(typeof BroadcastChannel=="function"&&(this._broadcastChannel=new BroadcastChannel("@instantdb"),this._broadcastChannel.addEventListener("message",i=>X(this,void 0,void 0,function*(){var o;if(((o=i.data)===null||o===void 0?void 0:o.type)==="auth"){const u=yield this.getCurrentUser();this.updateUser(u.user)}}))),this._oauthCallbackResponse=this._oauthLoginInit(),this._initStorage(e),this.getCurrentUser(),r.getIsOnline().then(i=>{this._isOnline=i,this._startSocket(),r.listen(o=>{o!==this._isOnline&&(this._isOnline=o,this._isOnline&&this._startSocket())})}))}_initStorage(t){this._persister=new t(`instant_${this.config.appId}_4`),this.querySubs=new Ye(this._persister,"querySubs",{},this._onMergeQuerySubs,hi,pi),this.pendingMutations=new Ye(this._persister,"pendingMutations",new Map,this._onMergePendingMutations,e=>JSON.stringify([...e.entries()]),e=>new Map(JSON.parse(e)))}_finishTransaction(t,e,r,i){const o=this.mutationDeferredStore.get(r);this.mutationDeferredStore.delete(r),!o&&!t&&console.error("Mutation failed",Object.assign({status:e,clientId:r},i)),o&&(t?o.resolve({status:e,clientId:r}):o.reject(Object.assign({status:e,clientId:r},i)))}_setStatus(t,e){this.status=t,this._errorMessage=e}_cleanPendingMutations(t){this.pendingMutations.set(e=>{const r=new Map(e);return[...e.entries()].forEach(([i,o])=>{o["tx-id"]<=t&&r.delete(i)}),r})}_handleReceive(t){var e,r,i,o;const u=!!this.config.schema&&("cardinalityInference"in this.config?!!this.config.cardinalityInference:!0);switch(t.op){case"init-ok":this._setStatus(vt.AUTHENTICATED),this._reconnectTimeoutMs=0,this._setAttrs(t.attrs),this._flushPendingMessages(),this._sessionId=t["session-id"];break;case"add-query-ok":const{q:a,result:h,"processed-tx-id":c}=t;this._cleanPendingMutations(c);const d=_t(a),m=(r=(e=h==null?void 0:h[0])===null||e===void 0?void 0:e.data)===null||r===void 0?void 0:r["page-info"],U=(o=(i=h==null?void 0:h[0])===null||i===void 0?void 0:i.data)===null||o===void 0?void 0:o.aggregate,L=Ke(h),A=Me(this.attrs,L,u,this._linkIndex);this.querySubs.set(T=>(T[d].result={store:A,pageInfo:m,aggregate:U},T)),this.notifyOne(d);break;case"refresh-ok":const{computations:j,attrs:_,"processed-tx-id":k}=t;this._cleanPendingMutations(k),this._setAttrs(_);const C=j.map(T=>{var F,J,z,q;const ut=T["instaql-query"],ct=T["instaql-result"],bt=_t(ut),Rt=Ke(ct),xt=Me(this.attrs,Rt,u,this._linkIndex),jt=(J=(F=ct==null?void 0:ct[0])===null||F===void 0?void 0:F.data)===null||J===void 0?void 0:J["page-info"],Bt=(q=(z=ct==null?void 0:ct[0])===null||z===void 0?void 0:z.data)===null||q===void 0?void 0:q.aggregate;return{hash:bt,store:xt,pageInfo:jt,aggregate:Bt}});C.forEach(({hash:T,store:F,pageInfo:J,aggregate:z})=>{this.querySubs.set(q=>(q[T].result={store:F,pageInfo:J,aggregate:z},q))}),C.forEach(({hash:T})=>{this.notifyOne(T)});break;case"transact-ok":const{"client-event-id":E,"tx-id":x}=t,v=this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).get(E);if(!v)break;const S=Object.assign(Object.assign({},v),{"tx-id":x});this.pendingMutations.set(T=>(T.set(E,S),T)),this._finishTransaction(!0,"synced",E);const l=v["tx-steps"].filter(([T,...F])=>T==="add-attr").map(([T,F])=>F).concat(Object.values(this.attrs));this._setAttrs(l);break;case"refresh-presence":const g=t["room-id"];this._setPresencePeers(g,t.data),this._notifyPresenceSubs(g);break;case"server-broadcast":const f=t["room-id"],b=t.topic;this._notifyBroadcastSubs(f,b,t);break;case"join-room-ok":const w=t["room-id"],D=this._presence[w];D&&(D.isLoading=!1),this._notifyPresenceSubs(w);break;case"join-room-error":const B=t["room-id"],N=this._presence[B];N&&(N.error=t.error),this._notifyPresenceSubs(B);break;case"error":this._handleReceiveError(t);break}}_handleReceiveError(t){var e,r,i;const o=t["client-event-id"];if(this.pendingMutations.currentValue.get(o)){this.pendingMutations.set(m=>(m.delete(o),m)),this.notifyAll(),this.notifyAttrsSubs(),this.notifyMutationErrorSubs(t);const d={message:t.message,hint:t.hint};this._finishTransaction(!1,"error",o,d);return}const a=t.q||((e=t["original-event"])===null||e===void 0?void 0:e.q);if(a){this.querySubs.set(d=>{const m=_t(a);return delete d[m],d}),this.notifyQueryError(_t(a),{message:t.message||"Uh-oh, something went wrong. Ping Joe & Stopa."});return}if(((r=t["original-event"])===null||r===void 0?void 0:r.op)==="init"){if(t.type==="record-not-found"&&((i=t.hint)===null||i===void 0?void 0:i["record-type"])==="app-user"){this.changeCurrentUser(null);return}const d={message:t.message||"Uh-oh, something went wrong. Ping Joe & Stopa."};this._setStatus(vt.ERRORED,d),this.notifyAll();return}const c=Object.assign({},t);delete c.message,delete c.hint,console.error(t.message,c),t.hint&&console.error(`This error comes with some debugging information. Here it is: 
`,t.hint)}_setAttrs(t){this.attrs=t.reduce((e,r)=>(e[r.id]=r,e),{}),this.notifyAttrsSubs()}subscribeQuery(t,e){const r=Z(),i=_t(t);this.queryCbs[i]=this.queryCbs[i]||[],this.queryCbs[i].push(e),this.querySubs.set(u=>(u[i]=u[i]||{q:t,result:null,eventId:r},u)),this._trySendAuthed(r,{op:"add-query",q:t});const o=this.getPreviousResult(t);return o&&e(o),()=>{this.queryCbs[i]=this.queryCbs[i].filter(u=>u!==e)}}_rewriteMutations(t,e){if(!t)return e;const r=h=>{const[c,d,m]=h["forward-identity"];return tt(t,d,m)},i=h=>{const[c,d,m]=h["forward-identity"];return Ot(t,d,m)},o={attrIdMap:{},refSwapAttrIds:new Set},u=h=>{const c=[];for(const d of h){const[m]=d;if(m==="add-attr"){const[L,A]=d,j=r(A);if(j){o.attrIdMap[A.id]=j.id;continue}if(A["value-type"]==="ref"){const _=i(A);if(_){o.attrIdMap[A.id]=_.id,o.refSwapAttrIds.add(A.id);continue}}}const U=fr(o,d);c.push(U)}return c},a=new Map;for(const[h,c]of e.entries())a.set(h,Object.assign(Object.assign({},c),{"tx-steps":u(c["tx-steps"])}));return a}optimisticAttrs(){var t;const e=[...this.pendingMutations.currentValue.values()].flatMap(a=>a["tx-steps"]),r=new Set(e.filter(([a,h])=>a==="delete-attr").map(([a,h])=>h)),i=[];for(const[a,h]of e)if(a==="add-attr")i.push(h);else if(a==="update-attr"&&h.id&&(!((t=this.attrs)===null||t===void 0)&&t[h.id])){const c=Object.assign(Object.assign({},this.attrs[h.id]),h);i.push(c)}const o=[...Object.values(this.attrs||{}),...i].filter(a=>!r.has(a.id));return Object.fromEntries(o.map(a=>[a.id,a]))}dataForResult(t,{store:e,pageInfo:r,aggregate:i}){const u=[...this._rewriteMutations(e.attrs,this.pendingMutations.currentValue).values()].flatMap(c=>c["tx-steps"]),a=Vn(e,u);return Qr({store:a,pageInfo:r,aggregate:i},t)}notifyAll(){Object.keys(this.queryCbs).forEach(t=>{this.notifyOne(t)})}shutdown(){this._isShutdown=!0,this._ws.close()}_sendMutation(t,e){if(e.error){this._finishTransaction(!1,"error",t,{error:e.error,message:e.error.message}),this.pendingMutations.set(i=>(i.delete(t),i));return}if(this.status!==vt.AUTHENTICATED){this._finishTransaction(!0,"enqueued",t);return}const r=Math.max(5e3,this.pendingMutations.currentValue.size*5e3);this._isOnline?(this._trySend(t,e),setTimeout(()=>{this._finishTransaction(!0,"pending",t)},3e3),setTimeout(()=>{if(!this._isOnline)return;const i=this.pendingMutations.currentValue.get(t);i&&!i["tx-id"]&&(this.pendingMutations.set(o=>(o.delete(t),o)),this._finishTransaction(!1,"timeout",t),console.error("mutation timed out",i))},r)):this._finishTransaction(!0,"enqueued",t)}_flushPendingMessages(){Object.keys(this.queryCbs).map(u=>this.querySubs.currentValue[u]).filter(u=>u).forEach(({eventId:u,q:a})=>{this._trySendAuthed(u,{op:"add-query",q:a})}),this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).forEach((u,a)=>{u["tx-id"]||this._sendMutation(a,u)}),Object.keys(this._presence).forEach(u=>{this._trySendAuthed(Z(),{op:"join-room","room-id":u})}),Object.entries(this._presence).forEach(([u,{result:a}])=>{const h=a==null?void 0:a.user;h&&this._trySendAuthed(Z(),{op:"set-presence","room-id":u,data:h})})}_trySendAuthed(t,e){this.status===vt.AUTHENTICATED&&this._trySend(t,e)}_trySend(t,e){this._ws.readyState===yi&&this._ws.send(JSON.stringify(Object.assign({"client-event-id":t},e)))}_startSocket(){this._ws=new WebSocket(`${this.config.websocketURI}?app_id=${this.config.appId}`),this._ws.onopen=this._wsOnOpen,this._ws.onmessage=this._wsOnMessage,this._ws.onclose=this._wsOnClose}getLocalId(t){return X(this,void 0,void 0,function*(){const e=`localToken_${t}`,r=yield this._persister.getItem(e);if(r)return r;if(this._localIdPromises[e])return this._localIdPromises[e];const i=Z();return this._localIdPromises[e]=this._persister.setItem(e,i).then(()=>i),this._localIdPromises[e]})}_replaceUrlAfterOAuth(){if(typeof URL>"u")return;const t=new URL(window.location.href);if(t.searchParams.get(ie)){const e=t.toString();t.searchParams.delete(ie),t.searchParams.delete("code"),t.searchParams.delete("error");const r=t.pathname+(t.searchParams.size?"?"+t.searchParams:"")+t.hash;if(history.replaceState(history.state,"",r),typeof navigation=="object"&&typeof navigation.addEventListener=="function"&&typeof navigation.removeEventListener=="function"){let i=!1;const o=u=>{var a;i||(i=!0,navigation.removeEventListener("navigate",o),!u.userInitiated&&u.navigationType==="replace"&&((a=u.destination)===null||a===void 0?void 0:a.url)===e&&history.replaceState(history.state,"",r))};navigation.addEventListener("navigate",o)}}}_oauthLoginInit(){return X(this,void 0,void 0,function*(){var t,e,r,i;if(typeof window>"u"||typeof window.location>"u"||typeof URLSearchParams>"u")return null;const o=new URLSearchParams(window.location.search);if(!o.get(ie))return null;const u=o.get("error");if(u)return this._replaceUrlAfterOAuth(),{error:{message:u}};const a=o.get("code");if(!a)return null;this._replaceUrlAfterOAuth();try{const{user:h}=yield ze({apiURI:this.config.apiURI,appId:this.config.appId,code:a});return this.setCurrentUser(h),null}catch(h){return((t=h==null?void 0:h.body)===null||t===void 0?void 0:t.type)==="record-not-found"&&((r=(e=h==null?void 0:h.body)===null||e===void 0?void 0:e.hint)===null||r===void 0?void 0:r["record-type"])==="app-oauth-code"&&(yield this._hasCurrentUser())?null:{error:{message:((i=h==null?void 0:h.body)===null||i===void 0?void 0:i.message)||"Error logging in."}}}})}_waitForOAuthCallbackResponse(){return X(this,void 0,void 0,function*(){return yield this._oauthCallbackResponse})}__subscribeMutationErrors(t){return this.mutationErrorCbs.push(t),()=>{this.mutationErrorCbs=this.mutationErrorCbs.filter(e=>e!==t)}}subscribeAuth(t){this.authCbs.push(t);const e=this._currentUserCached;e.isLoading||t(this._currentUserCached);let r=!1;return this.getCurrentUser().then(i=>{r||Wt(i,e)||t(i)}),()=>{r=!0,this.authCbs=this.authCbs.filter(i=>i!==t)}}subscribeAttrs(t){return this.attrsCbs.push(t),this.attrs&&t(this.attrs),()=>{this.attrsCbs=this.attrsCbs.filter(e=>e!==t)}}notifyAuthSubs(t){this.authCbs.forEach(e=>e(t))}notifyMutationErrorSubs(t){this.mutationErrorCbs.forEach(e=>e(t))}notifyAttrsSubs(){if(!this.attrs)return;const t=this.optimisticAttrs();this.attrsCbs.forEach(e=>e(t))}setCurrentUser(t){return X(this,void 0,void 0,function*(){yield this._persister.setItem(oe,JSON.stringify(t))})}getCurrentUserCached(){return this._currentUserCached}getCurrentUser(){return X(this,void 0,void 0,function*(){const t=yield this._waitForOAuthCallbackResponse();if(t!=null&&t.error){const i={error:t.error,user:void 0};return this._currentUserCached=Object.assign({isLoading:!1},i),i}const e=yield this._persister.getItem(oe),r={user:JSON.parse(e),error:void 0};return this._currentUserCached=Object.assign({isLoading:!1},r),r})}_hasCurrentUser(){return X(this,void 0,void 0,function*(){const t=yield this._persister.getItem(oe);return JSON.parse(t)!=null})}changeCurrentUser(t){return X(this,void 0,void 0,function*(){var e;const{user:r}=yield this.getCurrentUser();if(!Wt(r,t)){yield this.setCurrentUser(t),this.updateUser(t);try{(e=this._broadcastChannel)===null||e===void 0||e.postMessage({type:"auth"})}catch(i){console.error("Error posting message to broadcast channel",i)}}})}updateUser(t){const e={error:void 0,user:t};this._currentUserCached=Object.assign({isLoading:!1},e),this.querySubs.set(r=>(Object.keys(r).forEach(i=>{delete r[i].result}),r)),this._reconnectTimeoutMs=0,this._ws.close(),this._oauthCallbackResponse=null,this.notifyAuthSubs(e)}sendMagicCode({email:t}){return Zr({apiURI:this.config.apiURI,appId:this.config.appId,email:t})}signInWithMagicCode(t){return X(this,arguments,void 0,function*({email:e,code:r}){const i=yield ti({apiURI:this.config.apiURI,appId:this.config.appId,email:e,code:r});return this.changeCurrentUser(i.user),i})}signInWithCustomToken(t){return X(this,void 0,void 0,function*(){const e=yield ei({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:t});this.changeCurrentUser(e.user)})}signOut(){return X(this,void 0,void 0,function*(){var t;const e=yield this.getCurrentUser(),r=(t=e==null?void 0:e.user)===null||t===void 0?void 0:t.refresh_token;if(r)try{yield ri({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:r})}catch{}this.changeCurrentUser(null)})}createAuthorizationURL({clientName:t,redirectURL:e}){const{apiURI:r,appId:i}=this.config;return`${r}/runtime/oauth/start?app_id=${i}&client_name=${t}&redirect_uri=${e}`}exchangeCodeForToken(t){return X(this,arguments,void 0,function*({code:e,codeVerifier:r}){const i=yield ze({apiURI:this.config.apiURI,appId:this.config.appId,code:e,codeVerifier:r});return this.changeCurrentUser(i.user),i})}issuerURI(){const{apiURI:t,appId:e}=this.config;return`${t}/runtime/${e}`}signInWithIdToken(t){return X(this,arguments,void 0,function*({idToken:e,clientName:r,nonce:i}){var o;const u=yield this.getCurrentUser(),a=(o=u==null?void 0:u.user)===null||o===void 0?void 0:o.refresh_token,h=yield ni({apiURI:this.config.apiURI,appId:this.config.appId,idToken:e,clientName:r,nonce:i,refreshToken:a});return this.changeCurrentUser(h.user),h})}joinRoom(t){return this._trySendAuthed(Z(),{op:"join-room","room-id":t}),()=>{this._cleanupRoom(t)}}_cleanupRoom(t){var e,r,i;!(!((r=(e=this._presence[t])===null||e===void 0?void 0:e.handlers)===null||r===void 0)&&r.length)&&!Object.keys((i=this._broadcastSubs[t])!==null&&i!==void 0?i:{}).length&&(delete this._presence[t],delete this._broadcastSubs[t],this._trySendAuthed(Z(),{op:"leave-room","room-id":t}))}getPresence(t,e,r={}){const i=this._presence[e];return!i||!i.result?null:Object.assign(Object.assign({},ai(i.result,r)),{isLoading:i.isLoading,error:i.error})}publishPresence(t,e,r){var i,o;const u=Object.assign(Object.assign({},(o=(i=this._presence[e])===null||i===void 0?void 0:i.result)===null||o===void 0?void 0:o.user),r);this._trySendAuthed(Z(),{op:"set-presence","room-id":e,data:u}),this._presence[e]=this._presence[e]||{},this._presence[e].result=this._presence[e].result||{},this._presence[e].result.user=u,this._notifyPresenceSubs(e)}subscribePresence(t,e,r,i){const o=this.joinRoom(e),u=Object.assign(Object.assign({},r),{roomId:e,cb:i,prev:null});return this._presence[e]=this._presence[e]||{},this._presence[e].isLoading=!0,this._presence[e].handlers=this._presence[e].handlers||[],this._presence[e].handlers.push(u),this._notifyPresenceSub(e,u),()=>{var a,h,c;this._presence[e].handlers=(c=(h=(a=this._presence[e])===null||a===void 0?void 0:a.handlers)===null||h===void 0?void 0:h.filter(d=>d!==u))!==null&&c!==void 0?c:[],o()}}_notifyPresenceSubs(t){var e,r;(r=(e=this._presence[t])===null||e===void 0?void 0:e.handlers)===null||r===void 0||r.forEach(i=>{this._notifyPresenceSub(t,i)})}_notifyPresenceSub(t,e){const r=this.getPresence("",t,e);r&&(e.prev&&!ci(r,e.prev)||(e.prev=r,e.cb(r)))}_setPresencePeers(t,e){const r=Object.assign({},e);delete r[this._sessionId];const i=Object.fromEntries(Object.entries(r).map(([o,u])=>[o,u.data]));this._presence[t]=this._presence[t]||{},this._presence[t].result=this._presence[t].result||{},this._presence[t].result.peers=i}publishTopic({roomType:t,roomId:e,topic:r,data:i}){this._trySendAuthed(Z(),{op:"client-broadcast","room-id":e,roomType:t,topic:r,data:i})}subscribeTopic(t,e,r){const i=this.joinRoom(t);return this._broadcastSubs[t]=this._broadcastSubs[t]||{},this._broadcastSubs[t][e]=this._broadcastSubs[t][e]||[],this._broadcastSubs[t][e].push(r),this._presence[t]=this._presence[t]||{},()=>{this._broadcastSubs[t][e]=this._broadcastSubs[t][e].filter(o=>o!==r),this._broadcastSubs[t][e].length||delete this._broadcastSubs[t][e],i()}}_notifyBroadcastSubs(t,e,r){var i,o,u;(u=(o=(i=this._broadcastSubs)===null||i===void 0?void 0:i[t])===null||o===void 0?void 0:o[e])===null||u===void 0||u.forEach(a=>{var h,c,d,m,U,L;const A=(h=r.data)===null||h===void 0?void 0:h.data,j=r.data["peer-id"]===this._sessionId?(d=(c=this._presence[t])===null||c===void 0?void 0:c.result)===null||d===void 0?void 0:d.user:(L=(U=(m=this._presence[t])===null||m===void 0?void 0:m.result)===null||U===void 0?void 0:U.peers)===null||L===void 0?void 0:L[r.data["peer-id"]];return a(A,j)})}upload(t,e){return X(this,void 0,void 0,function*(){var r;const i=yield this.getCurrentUser(),o=(r=i==null?void 0:i.user)===null||r===void 0?void 0:r.refresh_token,u=t||e.name,a=yield ii({apiURI:this.config.apiURI,appId:this.config.appId,fileName:u,refreshToken:o});return yield oi(a,e)})}getDownloadUrl(t){return X(this,void 0,void 0,function*(){var e;const r=yield this.getCurrentUser(),i=(e=r==null?void 0:r.user)===null||e===void 0?void 0:e.refresh_token;return yield si({apiURI:this.config.apiURI,appId:this.config.appId,path:t,refreshToken:i})})}deleteFile(t){return X(this,void 0,void 0,function*(){var e;const r=yield this.getCurrentUser(),i=(e=r==null?void 0:r.user)===null||e===void 0?void 0:e.refresh_token;return yield ui({apiURI:this.config.apiURI,appId:this.config.appId,path:t,refreshToken:i})})}}let qt;function _i(n){qt==null||qt.dispose();const t=Oi(),e=Ai(u),r=Si(wi(n));function i(c){var d;c.source===r.element.contentWindow&&((d=c.data)===null||d===void 0?void 0:d.type)==="close"&&t.isVisible()&&u()}function o(c){const d=c.shiftKey&&c.ctrlKey&&c.key==="0",m=c.key==="Escape"||c.key==="Esc";(d||m)&&u()}function u(){t.isVisible()?t.element.style.display="none":(t.element.style.display="block",t.element.contains(r.element)||t.element.appendChild(r.element))}function a(){t.element.remove(),e.element.remove(),removeEventListener("keydown",o),removeEventListener("message",i)}function h(){document.body.appendChild(t.element),document.body.appendChild(e.element),addEventListener("keydown",o),addEventListener("message",i),qt={dispose:a}}return h()}function wi(n){return`${window.DEV_DEVTOOL?"http://localhost:3000":"https://instantdb.com"}/_devtool?appId=${n}`}function Si(n){const t=document.createElement("iframe");return t.src=n,Object.assign(t.style,{width:"100%",height:"100%",borderRadius:"4px",backgroundColor:"white",border:"none"}),{element:t}}function Ai(n){const t=`
    <svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect width="512" height="512" fill="black"/>
      <rect x="97.0973" y="91.3297" width="140" height="330" fill="white"/>
    </svg>
  `,e=document.createElement("button");return e.innerHTML=t,Object.assign(e.style,{position:"fixed",bottom:"24px",left:"24px",height:"32px",width:"32px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0",margin:"0",border:"none",cursor:"pointer"}),e.addEventListener("click",n),{element:e}}function Oi(){const n=document.createElement("div");Object.assign(n.style,{position:"fixed",bottom:"24px",right:"24px",left:"60px",top:"72px",display:"block",borderRadius:"4px",border:"1px #ccc solid",boxShadow:"0px 0px 8px #00000044",backgroundColor:"#eee",zIndex:"999990"}),n.style.display="none";function t(){return n.style.display!=="none"}return{element:n,isVisible:t}}const Ii=!0,Ei={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"};function xi(){var n;return globalThis.__instantDbStore=(n=globalThis.__instantDbStore)!==null&&n!==void 0?n:{},globalThis.__instantDbStore}const he=xi();function ji(n,t,e){return ki(n)}function ki(n,t,e){const r=he[n.appId];if(r)return r;const i=new mi(Object.assign(Object.assign({},Ei),n),yn,vn),o=new Ui(i);return he[n.appId]=o,typeof window<"u"&&typeof window.location<"u"&&("devtool"in n?n.devtool:Ii)&&window.location.hostname==="localhost"&&!globalThis._nodevtool&&_i(n.appId),o}class Ui{constructor(t){this.tx=an(),this._reactor=t,this.auth=new Ci(this._reactor),this.storage=new Ti(this._reactor)}transact(t){return this._reactor.pushTx(t)}getLocalId(t){return this._reactor.getLocalId(t)}subscribeQuery(t,e){return this._reactor.subscribeQuery(t,e)}subscribeAuth(t){return this._reactor.subscribeAuth(t)}joinRoom(t="_defaultRoomType",e="_defaultRoomId"){return{leaveRoom:this._reactor.joinRoom(e),subscribeTopic:(i,o)=>this._reactor.subscribeTopic(e,i,o),subscribePresence:(i,o)=>this._reactor.subscribePresence(t,e,i,o),publishTopic:(i,o)=>this._reactor.publishTopic({roomType:t,roomId:e,topic:i,data:o}),publishPresence:i=>this._reactor.publishPresence(t,e,i),getPresence:i=>this._reactor.getPresence(t,e,i)}}shutdown(){delete he[this._reactor.config.appId],this._reactor.shutdown()}}class Ci{constructor(t){this.db=t,this.sendMagicCode=e=>this.db.sendMagicCode(e),this.signInWithMagicCode=e=>this.db.signInWithMagicCode(e),this.signInWithToken=e=>this.db.signInWithCustomToken(e),this.createAuthorizationURL=e=>this.db.createAuthorizationURL(e),this.signInWithIdToken=e=>this.db.signInWithIdToken(e),this.exchangeOAuthCode=e=>this.db.exchangeCodeForToken(e),this.issuerURI=()=>this.db.issuerURI(),this.signOut=()=>this.db.signOut()}}class Ti{constructor(t){this.db=t,this.upload=(e,r)=>this.db.upload(e,r),this.put=this.upload,this.getDownloadUrl=e=>this.db.getDownloadUrl(e),this.delete=e=>this.db.deleteFile(e)}}const Mi="bcc500de-07a9-4fde-9025-c87906e63bf3",Et=ji({appId:Mi});Et.subscribeQuery({todos:{}},n=>{if(n.error){$i(n.error.message);return}n.data&&Ni(n.data)});function Pi(n){Et.transact(Mt.todos[Z()].update({text:n,done:!1,createdAt:Date.now()})),zi()}function Li(n){Et.transact(Mt.todos[n.id].delete())}function Ri(n){Et.transact(Mt.todos[n.id].update({done:!n.done}))}function Bi(n){const e=n.filter(r=>r.done).map(r=>Mt.todos[r.id].delete());Et.transact(e)}function Di(n){const t=!n.every(e=>e.done);Et.transact(n.map(e=>Mt.todos[e.id].update({done:t})))}const rt={container:`
    box-sizing: border-box;
    background-color: #fafafa;
    font-family: code, monospace;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  `,header:`
    letter-spacing: 2px;
    font-size: 50px;
    color: lightgray;
    margin-bottom: 10px;
  `,form:`
    box-sizing: inherit;
    display: flex;
    border: 1px solid lightgray;
    border-bottom-width: 0px;
    width: 350px;
  `,toggleAll:`
    font-size: 30px;
    cursor: pointer;
    margin-left: 11px;
    margin-top: -6px;
    width: 15px;
    margin-right: 12px;
  `,input:`
    background-color: transparent;
    font-family: code, monospace;
    width: 287px;
    padding: 10px;
    font-style: italic;
  `,todoList:`
    box-sizing: inherit;
    width: 350px;
  `,checkbox:`
    font-size: 30px;
    margin-left: 5px;
    margin-right: 20px;
    cursor: pointer;
  `,todo:`
    display: flex;
    align-items: center;
    padding: 10px;
    border: 1px solid lightgray;
    border-bottom-width: 0px;
  `,todoText:`
    flex-grow: 1;
    overflow: hidden;
  `,delete:`
    width: 25px;
    cursor: pointer;
    color: lightgray;
  `,actionBar:`
    display: flex;
    justify-content: space-between;
    width: 328px;
    padding: 10px;
    border: 1px solid lightgray;
    font-size: 10px;
  `,footer:`
    margin-top: 20px;
    font-size: 10px;
  `},Ht=document.getElementById("app");Ht.style.cssText=rt.container;function Ni(n){var r,i,o;Ht.innerHTML="";const{todos:t}=n,e=`
    <div style="${rt.container}">
      <div style="${rt.header}">todos</div>
      ${Fi()}
      ${qi(t)}
      ${Wi(t)}
      <div style="${rt.footer}">Open another tab to see todos update in realtime!</div>
    </div>
  `;Ht.innerHTML=e,(r=document.querySelector(".toggle-all"))==null||r.addEventListener("click",()=>Di(t)),(i=document.querySelector("form"))==null||i.addEventListener("submit",Ji),t.forEach(u=>{var a,h;(a=document.getElementById(`toggle-${u.id}`))==null||a.addEventListener("change",()=>Ri(u)),(h=document.getElementById(`delete-${u.id}`))==null||h.addEventListener("click",()=>Li(u))}),(o=document.querySelector(".delete-completed"))==null||o.addEventListener("click",()=>Bi(t))}function $i(n){Ht.innerHTML=`
    <div>${n}</div>
  `}function Fi(){return`
    <div style="${rt.form}">
      <div class="toggle-all" style="${rt.toggleAll}">â</div>
      <form>
        <input style="${rt.input}" placeholder="What needs to be done?" type="text" autofocus>
      </form>
    </div>
  `}function qi(n){return`
    <div style="${rt.todoList}">
      ${n.map(t=>`
        <div style="${rt.todo}">
          <input id="toggle-${t.id}" type="checkbox" style="${rt.checkbox}" ${t.done?"checked":""}>
          <div style="${rt.todoText}">
            ${t.done?`<span style="text-decoration: line-through;">${t.text}</span>`:`<span>${t.text}</span>`}
          </div>
          <span id="delete-${t.id}" style="${rt.delete}">ð</span>
        </div>
      `).join("")}
    </div>
  `}function Wi(n){return`
    <div style="${rt.actionBar}">
      <div>Remaining todos: ${n.filter(t=>!t.done).length}</div>
      <div class="delete-completed" style="cursor: pointer;">Delete Completed</div>
    </div>
  `}function zi(){const n=document.querySelector('input[type="text"]');n&&n.focus()}function Ji(n){n.preventDefault();const t=n.target.querySelector("input");t&&t.value.trim()&&(Pi(t.value),t.value="")}
