(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const jt=(()=>{let n=!1;typeof window<"u"&&typeof window.localStorage<"u"?n=!!window.localStorage.getItem("loggingEnabled"):n=!1;function t(e){return(...r)=>{n&&console[e](...r)}}return{info:t("info"),debug:t("debug"),error:t("error")}})();function Lt(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ye={exports:{}};(function(n,t){(function(e){n.exports=e()})(function(){return function e(r,i,o){function u(c,f){if(!i[c]){if(!r[c]){var _=typeof Lt=="function"&&Lt;if(!f&&_)return _(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+c+"'")}f=i[c]={exports:{}},r[c][0].call(f.exports,function(C){var L=r[c][1][C];return u(L||C)},f,f.exports,e,r,i,o)}return i[c].exports}for(var a=typeof Lt=="function"&&Lt,h=0;h<o.length;h++)u(o[h]);return u}({1:[function(e,r,i){(function(o,u,a,h,c,f,_,C,L){var A=e("crypto");function k(v,S){S=U(v,S);var d;return(d=S.algorithm!=="passthrough"?A.createHash(S.algorithm):new R).write===void 0&&(d.write=d.update,d.end=d.update),j(S,d).dispatch(v),d.update||d.end(""),d.digest?d.digest(S.encoding==="buffer"?void 0:S.encoding):(v=d.read(),S.encoding!=="buffer"?v.toString(S.encoding):v)}(i=r.exports=k).sha1=function(v){return k(v)},i.keys=function(v){return k(v,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},i.MD5=function(v){return k(v,{algorithm:"md5",encoding:"hex"})},i.keysMD5=function(v){return k(v,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var m=A.getHashes?A.getHashes().slice():["sha1","md5"],x=(m.push("passthrough"),["buffer","hex","binary","base64"]);function U(v,S){var d={};if(d.algorithm=(S=S||{}).algorithm||"sha1",d.encoding=S.encoding||"hex",d.excludeValues=!!S.excludeValues,d.algorithm=d.algorithm.toLowerCase(),d.encoding=d.encoding.toLowerCase(),d.ignoreUnknown=S.ignoreUnknown===!0,d.respectType=S.respectType!==!1,d.respectFunctionNames=S.respectFunctionNames!==!1,d.respectFunctionProperties=S.respectFunctionProperties!==!1,d.unorderedArrays=S.unorderedArrays===!0,d.unorderedSets=S.unorderedSets!==!1,d.unorderedObjects=S.unorderedObjects!==!1,d.replacer=S.replacer||void 0,d.excludeKeys=S.excludeKeys||void 0,v===void 0)throw new Error("Object argument required.");for(var g=0;g<m.length;++g)m[g].toLowerCase()===d.algorithm.toLowerCase()&&(d.algorithm=m[g]);if(m.indexOf(d.algorithm)===-1)throw new Error('Algorithm "'+d.algorithm+'"  not supported. supported values: '+m.join(", "));if(x.indexOf(d.encoding)===-1&&d.algorithm!=="passthrough")throw new Error('Encoding "'+d.encoding+'"  not supported. supported values: '+x.join(", "));return d}function I(v){if(typeof v=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(v))!=null}function j(v,S,d){d=d||[];function g(l){return S.update?S.update(l,"utf8"):S.write(l,"utf8")}return{dispatch:function(l){return this["_"+((l=v.replacer?v.replacer(l):l)===null?"null":typeof l)](l)},_object:function(l){var b,w=Object.prototype.toString.call(l),D=/\[object (.*)\]/i.exec(w);if(D=(D=D?D[1]:"unknown:["+w+"]").toLowerCase(),0<=(w=d.indexOf(l)))return this.dispatch("[CIRCULAR:"+w+"]");if(d.push(l),a!==void 0&&a.isBuffer&&a.isBuffer(l))return g("buffer:"),g(l);if(D==="object"||D==="function"||D==="asyncfunction")return w=Object.keys(l),v.unorderedObjects&&(w=w.sort()),v.respectType===!1||I(l)||w.splice(0,0,"prototype","__proto__","constructor"),v.excludeKeys&&(w=w.filter(function(B){return!v.excludeKeys(B)})),g("object:"+w.length+":"),b=this,w.forEach(function(B){b.dispatch(B),g(":"),v.excludeValues||b.dispatch(l[B]),g(",")});if(!this["_"+D]){if(v.ignoreUnknown)return g("["+D+"]");throw new Error('Unknown object type "'+D+'"')}this["_"+D](l)},_array:function(l,B){B=B!==void 0?B:v.unorderedArrays!==!1;var w=this;if(g("array:"+l.length+":"),!B||l.length<=1)return l.forEach(function(N){return w.dispatch(N)});var D=[],B=l.map(function(N){var M=new R,q=d.slice();return j(v,M,q).dispatch(N),D=D.concat(q.slice(d.length)),M.read().toString()});return d=d.concat(D),B.sort(),this._array(B,!1)},_date:function(l){return g("date:"+l.toJSON())},_symbol:function(l){return g("symbol:"+l.toString())},_error:function(l){return g("error:"+l.toString())},_boolean:function(l){return g("bool:"+l.toString())},_string:function(l){g("string:"+l.length+":"),g(l.toString())},_function:function(l){g("fn:"),I(l)?this.dispatch("[native]"):this.dispatch(l.toString()),v.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(l.name)),v.respectFunctionProperties&&this._object(l)},_number:function(l){return g("number:"+l.toString())},_xml:function(l){return g("xml:"+l.toString())},_null:function(){return g("Null")},_undefined:function(){return g("Undefined")},_regexp:function(l){return g("regex:"+l.toString())},_uint8array:function(l){return g("uint8array:"),this.dispatch(Array.prototype.slice.call(l))},_uint8clampedarray:function(l){return g("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(l))},_int8array:function(l){return g("int8array:"),this.dispatch(Array.prototype.slice.call(l))},_uint16array:function(l){return g("uint16array:"),this.dispatch(Array.prototype.slice.call(l))},_int16array:function(l){return g("int16array:"),this.dispatch(Array.prototype.slice.call(l))},_uint32array:function(l){return g("uint32array:"),this.dispatch(Array.prototype.slice.call(l))},_int32array:function(l){return g("int32array:"),this.dispatch(Array.prototype.slice.call(l))},_float32array:function(l){return g("float32array:"),this.dispatch(Array.prototype.slice.call(l))},_float64array:function(l){return g("float64array:"),this.dispatch(Array.prototype.slice.call(l))},_arraybuffer:function(l){return g("arraybuffer:"),this.dispatch(new Uint8Array(l))},_url:function(l){return g("url:"+l.toString())},_map:function(l){return g("map:"),l=Array.from(l),this._array(l,v.unorderedSets!==!1)},_set:function(l){return g("set:"),l=Array.from(l),this._array(l,v.unorderedSets!==!1)},_file:function(l){return g("file:"),this.dispatch([l.name,l.size,l.type,l.lastModfied])},_blob:function(){if(v.ignoreUnknown)return g("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return g("domwindow")},_bigint:function(l){return g("bigint:"+l.toString())},_process:function(){return g("process")},_timer:function(){return g("timer")},_pipe:function(){return g("pipe")},_tcp:function(){return g("tcp")},_udp:function(){return g("udp")},_tty:function(){return g("tty")},_statwatcher:function(){return g("statwatcher")},_securecontext:function(){return g("securecontext")},_connection:function(){return g("connection")},_zlib:function(){return g("zlib")},_context:function(){return g("context")},_nodescript:function(){return g("nodescript")},_httpparser:function(){return g("httpparser")},_dataview:function(){return g("dataview")},_signal:function(){return g("signal")},_fsevent:function(){return g("fsevent")},_tlswrap:function(){return g("tlswrap")}}}function R(){return{buf:"",write:function(v){this.buf+=v},end:function(v){this.buf+=v},read:function(){return this.buf}}}i.writeToStream=function(v,S,d){return d===void 0&&(d=S,S={}),j(S=U(v,S),d).dispatch(v)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(e,r,i){(function(o,u,a,h,c,f,_,C,L){(function(A){var k=typeof Uint8Array<"u"?Uint8Array:Array,m=43,x=47,U=48,I=97,j=65,R=45,v=95;function S(d){return d=d.charCodeAt(0),d===m||d===R?62:d===x||d===v?63:d<U?-1:d<U+10?d-U+26+26:d<j+26?d-j:d<I+26?d-I+26:void 0}A.toByteArray=function(d){var g,l;if(0<d.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var b=d.length,b=d.charAt(b-2)==="="?2:d.charAt(b-1)==="="?1:0,w=new k(3*d.length/4-b),D=0<b?d.length-4:d.length,B=0;function N(M){w[B++]=M}for(g=0;g<D;g+=4,0)N((16711680&(l=S(d.charAt(g))<<18|S(d.charAt(g+1))<<12|S(d.charAt(g+2))<<6|S(d.charAt(g+3))))>>16),N((65280&l)>>8),N(255&l);return b==2?N(255&(l=S(d.charAt(g))<<2|S(d.charAt(g+1))>>4)):b==1&&(N((l=S(d.charAt(g))<<10|S(d.charAt(g+1))<<4|S(d.charAt(g+2))>>2)>>8&255),N(255&l)),w},A.fromByteArray=function(d){var g,l,b,w,D=d.length%3,B="";function N(M){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(M)}for(g=0,b=d.length-D;g<b;g+=3)l=(d[g]<<16)+(d[g+1]<<8)+d[g+2],B+=N((w=l)>>18&63)+N(w>>12&63)+N(w>>6&63)+N(63&w);switch(D){case 1:B=(B+=N((l=d[d.length-1])>>2))+N(l<<4&63)+"==";break;case 2:B=(B=(B+=N((l=(d[d.length-2]<<8)+d[d.length-1])>>10))+N(l>>4&63))+N(l<<2&63)+"="}return B}})(i===void 0?this.base64js={}:i)}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(e,r,i){(function(o,u,m,h,c,f,_,C,L){var A=e("base64-js"),k=e("ieee754");function m(s,p,y){if(!(this instanceof m))return new m(s,p,y);var O,E,P,$,z=typeof s;if(p==="base64"&&z=="string")for(s=($=s).trim?$.trim():$.replace(/^\s+|\s+$/g,"");s.length%4!=0;)s+="=";if(z=="number")O=V(s);else if(z=="string")O=m.byteLength(s,p);else{if(z!="object")throw new Error("First argument needs to be a number, array or string.");O=V(s.length)}if(m._useTypedArrays?E=m._augment(new Uint8Array(O)):((E=this).length=O,E._isBuffer=!0),m._useTypedArrays&&typeof s.byteLength=="number")E._set(s);else if(J($=s)||m.isBuffer($)||$&&typeof $=="object"&&typeof $.length=="number")for(P=0;P<O;P++)m.isBuffer(s)?E[P]=s.readUInt8(P):E[P]=s[P];else if(z=="string")E.write(s,0,p);else if(z=="number"&&!m._useTypedArrays&&!y)for(P=0;P<O;P++)E[P]=0;return E}function x(s,p,y,O){return m._charsWritten=vt(function(E){for(var P=[],$=0;$<E.length;$++)P.push(255&E.charCodeAt($));return P}(p),s,y,O)}function U(s,p,y,O){return m._charsWritten=vt(function(E){for(var P,$,z=[],H=0;H<E.length;H++)$=E.charCodeAt(H),P=$>>8,$=$%256,z.push($),z.push(P);return z}(p),s,y,O)}function I(s,p,y){var O="";y=Math.min(s.length,y);for(var E=p;E<y;E++)O+=String.fromCharCode(s[E]);return O}function j(s,p,y,P){P||(T(typeof y=="boolean","missing or invalid endian"),T(p!=null,"missing offset"),T(p+1<s.length,"Trying to read beyond buffer length"));var E,P=s.length;if(!(P<=p))return y?(E=s[p],p+1<P&&(E|=s[p+1]<<8)):(E=s[p]<<8,p+1<P&&(E|=s[p+1])),E}function R(s,p,y,P){P||(T(typeof y=="boolean","missing or invalid endian"),T(p!=null,"missing offset"),T(p+3<s.length,"Trying to read beyond buffer length"));var E,P=s.length;if(!(P<=p))return y?(p+2<P&&(E=s[p+2]<<16),p+1<P&&(E|=s[p+1]<<8),E|=s[p],p+3<P&&(E+=s[p+3]<<24>>>0)):(p+1<P&&(E=s[p+1]<<16),p+2<P&&(E|=s[p+2]<<8),p+3<P&&(E|=s[p+3]),E+=s[p]<<24>>>0),E}function v(s,p,y,O){if(O||(T(typeof y=="boolean","missing or invalid endian"),T(p!=null,"missing offset"),T(p+1<s.length,"Trying to read beyond buffer length")),!(s.length<=p))return O=j(s,p,y,!0),32768&O?-1*(65535-O+1):O}function S(s,p,y,O){if(O||(T(typeof y=="boolean","missing or invalid endian"),T(p!=null,"missing offset"),T(p+3<s.length,"Trying to read beyond buffer length")),!(s.length<=p))return O=R(s,p,y,!0),2147483648&O?-1*(4294967295-O+1):O}function d(s,p,y,O){return O||(T(typeof y=="boolean","missing or invalid endian"),T(p+3<s.length,"Trying to read beyond buffer length")),k.read(s,p,y,23,4)}function g(s,p,y,O){return O||(T(typeof y=="boolean","missing or invalid endian"),T(p+7<s.length,"Trying to read beyond buffer length")),k.read(s,p,y,52,8)}function l(s,p,y,O,E){if(E||(T(p!=null,"missing value"),T(typeof O=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+1<s.length,"trying to write beyond buffer length"),Ot(p,65535)),E=s.length,!(E<=y))for(var P=0,$=Math.min(E-y,2);P<$;P++)s[y+P]=(p&255<<8*(O?P:1-P))>>>8*(O?P:1-P)}function b(s,p,y,O,E){if(E||(T(p!=null,"missing value"),T(typeof O=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+3<s.length,"trying to write beyond buffer length"),Ot(p,4294967295)),E=s.length,!(E<=y))for(var P=0,$=Math.min(E-y,4);P<$;P++)s[y+P]=p>>>8*(O?P:3-P)&255}function w(s,p,y,O,E){E||(T(p!=null,"missing value"),T(typeof O=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+1<s.length,"Trying to write beyond buffer length"),It(p,32767,-32768)),s.length<=y||l(s,0<=p?p:65535+p+1,y,O,E)}function D(s,p,y,O,E){E||(T(p!=null,"missing value"),T(typeof O=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+3<s.length,"Trying to write beyond buffer length"),It(p,2147483647,-2147483648)),s.length<=y||b(s,0<=p?p:4294967295+p+1,y,O,E)}function B(s,p,y,O,E){E||(T(p!=null,"missing value"),T(typeof O=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+3<s.length,"Trying to write beyond buffer length"),Pt(p,34028234663852886e22,-34028234663852886e22)),s.length<=y||k.write(s,p,y,O,23,4)}function N(s,p,y,O,E){E||(T(p!=null,"missing value"),T(typeof O=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+7<s.length,"Trying to write beyond buffer length"),Pt(p,17976931348623157e292,-17976931348623157e292)),s.length<=y||k.write(s,p,y,O,52,8)}i.Buffer=m,i.SlowBuffer=m,i.INSPECT_MAX_BYTES=50,m.poolSize=8192,m._useTypedArrays=function(){try{var s=new ArrayBuffer(0),p=new Uint8Array(s);return p.foo=function(){return 42},p.foo()===42&&typeof p.subarray=="function"}catch{return!1}}(),m.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},m.isBuffer=function(s){return!(s==null||!s._isBuffer)},m.byteLength=function(s,p){var y;switch(s+="",p||"utf8"){case"hex":y=s.length/2;break;case"utf8":case"utf-8":y=st(s).length;break;case"ascii":case"binary":case"raw":y=s.length;break;case"base64":y=at(s).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":y=2*s.length;break;default:throw new Error("Unknown encoding")}return y},m.concat=function(s,p){if(T(J(s),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),s.length===0)return new m(0);if(s.length===1)return s[0];if(typeof p!="number")for(E=p=0;E<s.length;E++)p+=s[E].length;for(var y=new m(p),O=0,E=0;E<s.length;E++){var P=s[E];P.copy(y,O),O+=P.length}return y},m.prototype.write=function(s,p,y,O){isFinite(p)?isFinite(y)||(O=y,y=void 0):(H=O,O=p,p=y,y=H),p=Number(p)||0;var E,P,$,z,H=this.length-p;switch((!y||H<(y=Number(y)))&&(y=H),O=String(O||"utf8").toLowerCase()){case"hex":E=function(ut,et,nt,K){nt=Number(nt)||0;var Y=ut.length-nt;(!K||Y<(K=Number(K)))&&(K=Y),T((Y=et.length)%2==0,"Invalid hex string"),Y/2<K&&(K=Y/2);for(var bt=0;bt<K;bt++){var we=parseInt(et.substr(2*bt,2),16);T(!isNaN(we),"Invalid hex string"),ut[nt+bt]=we}return m._charsWritten=2*bt,bt}(this,s,p,y);break;case"utf8":case"utf-8":P=this,$=p,z=y,E=m._charsWritten=vt(st(s),P,$,z);break;case"ascii":case"binary":E=x(this,s,p,y);break;case"base64":P=this,$=p,z=y,E=m._charsWritten=vt(at(s),P,$,z);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":E=U(this,s,p,y);break;default:throw new Error("Unknown encoding")}return E},m.prototype.toString=function(s,p,y){var O,E,P,$,z=this;if(s=String(s||"utf8").toLowerCase(),p=Number(p)||0,(y=y!==void 0?Number(y):z.length)===p)return"";switch(s){case"hex":O=function(H,ut,et){var nt=H.length;(!ut||ut<0)&&(ut=0),(!et||et<0||nt<et)&&(et=nt);for(var K="",Y=ut;Y<et;Y++)K+=F(H[Y]);return K}(z,p,y);break;case"utf8":case"utf-8":O=function(H,ut,et){var nt="",K="";et=Math.min(H.length,et);for(var Y=ut;Y<et;Y++)H[Y]<=127?(nt+=Tt(K)+String.fromCharCode(H[Y]),K=""):K+="%"+H[Y].toString(16);return nt+Tt(K)}(z,p,y);break;case"ascii":case"binary":O=I(z,p,y);break;case"base64":E=z,$=y,O=(P=p)===0&&$===E.length?A.fromByteArray(E):A.fromByteArray(E.slice(P,$));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":O=function(H,ut,et){for(var nt=H.slice(ut,et),K="",Y=0;Y<nt.length;Y+=2)K+=String.fromCharCode(nt[Y]+256*nt[Y+1]);return K}(z,p,y);break;default:throw new Error("Unknown encoding")}return O},m.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},m.prototype.copy=function(s,p,y,O){if(p=p||0,(O=O||O===0?O:this.length)!==(y=y||0)&&s.length!==0&&this.length!==0){T(y<=O,"sourceEnd < sourceStart"),T(0<=p&&p<s.length,"targetStart out of bounds"),T(0<=y&&y<this.length,"sourceStart out of bounds"),T(0<=O&&O<=this.length,"sourceEnd out of bounds"),O>this.length&&(O=this.length);var E=(O=s.length-p<O-y?s.length-p+y:O)-y;if(E<100||!m._useTypedArrays)for(var P=0;P<E;P++)s[P+p]=this[P+y];else s._set(this.subarray(y,y+E),p)}},m.prototype.slice=function(s,p){var y=this.length;if(s=q(s,y,0),p=q(p,y,y),m._useTypedArrays)return m._augment(this.subarray(s,p));for(var O=p-s,E=new m(O,void 0,!0),P=0;P<O;P++)E[P]=this[P+s];return E},m.prototype.get=function(s){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(s)},m.prototype.set=function(s,p){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(s,p)},m.prototype.readUInt8=function(s,p){if(p||(T(s!=null,"missing offset"),T(s<this.length,"Trying to read beyond buffer length")),!(s>=this.length))return this[s]},m.prototype.readUInt16LE=function(s,p){return j(this,s,!0,p)},m.prototype.readUInt16BE=function(s,p){return j(this,s,!1,p)},m.prototype.readUInt32LE=function(s,p){return R(this,s,!0,p)},m.prototype.readUInt32BE=function(s,p){return R(this,s,!1,p)},m.prototype.readInt8=function(s,p){if(p||(T(s!=null,"missing offset"),T(s<this.length,"Trying to read beyond buffer length")),!(s>=this.length))return 128&this[s]?-1*(255-this[s]+1):this[s]},m.prototype.readInt16LE=function(s,p){return v(this,s,!0,p)},m.prototype.readInt16BE=function(s,p){return v(this,s,!1,p)},m.prototype.readInt32LE=function(s,p){return S(this,s,!0,p)},m.prototype.readInt32BE=function(s,p){return S(this,s,!1,p)},m.prototype.readFloatLE=function(s,p){return d(this,s,!0,p)},m.prototype.readFloatBE=function(s,p){return d(this,s,!1,p)},m.prototype.readDoubleLE=function(s,p){return g(this,s,!0,p)},m.prototype.readDoubleBE=function(s,p){return g(this,s,!1,p)},m.prototype.writeUInt8=function(s,p,y){y||(T(s!=null,"missing value"),T(p!=null,"missing offset"),T(p<this.length,"trying to write beyond buffer length"),Ot(s,255)),p>=this.length||(this[p]=s)},m.prototype.writeUInt16LE=function(s,p,y){l(this,s,p,!0,y)},m.prototype.writeUInt16BE=function(s,p,y){l(this,s,p,!1,y)},m.prototype.writeUInt32LE=function(s,p,y){b(this,s,p,!0,y)},m.prototype.writeUInt32BE=function(s,p,y){b(this,s,p,!1,y)},m.prototype.writeInt8=function(s,p,y){y||(T(s!=null,"missing value"),T(p!=null,"missing offset"),T(p<this.length,"Trying to write beyond buffer length"),It(s,127,-128)),p>=this.length||(0<=s?this.writeUInt8(s,p,y):this.writeUInt8(255+s+1,p,y))},m.prototype.writeInt16LE=function(s,p,y){w(this,s,p,!0,y)},m.prototype.writeInt16BE=function(s,p,y){w(this,s,p,!1,y)},m.prototype.writeInt32LE=function(s,p,y){D(this,s,p,!0,y)},m.prototype.writeInt32BE=function(s,p,y){D(this,s,p,!1,y)},m.prototype.writeFloatLE=function(s,p,y){B(this,s,p,!0,y)},m.prototype.writeFloatBE=function(s,p,y){B(this,s,p,!1,y)},m.prototype.writeDoubleLE=function(s,p,y){N(this,s,p,!0,y)},m.prototype.writeDoubleBE=function(s,p,y){N(this,s,p,!1,y)},m.prototype.fill=function(s,p,y){if(p=p||0,y=y||this.length,T(typeof(s=typeof(s=s||0)=="string"?s.charCodeAt(0):s)=="number"&&!isNaN(s),"value is not a number"),T(p<=y,"end < start"),y!==p&&this.length!==0){T(0<=p&&p<this.length,"start out of bounds"),T(0<=y&&y<=this.length,"end out of bounds");for(var O=p;O<y;O++)this[O]=s}},m.prototype.inspect=function(){for(var s=[],p=this.length,y=0;y<p;y++)if(s[y]=F(this[y]),y===i.INSPECT_MAX_BYTES){s[y+1]="...";break}return"<Buffer "+s.join(" ")+">"},m.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(m._useTypedArrays)return new m(this).buffer;for(var s=new Uint8Array(this.length),p=0,y=s.length;p<y;p+=1)s[p]=this[p];return s.buffer};var M=m.prototype;function q(s,p,y){return typeof s!="number"?y:p<=(s=~~s)?p:0<=s||0<=(s+=p)?s:0}function V(s){return(s=~~Math.ceil(+s))<0?0:s}function J(s){return(Array.isArray||function(p){return Object.prototype.toString.call(p)==="[object Array]"})(s)}function F(s){return s<16?"0"+s.toString(16):s.toString(16)}function st(s){for(var p=[],y=0;y<s.length;y++){var O=s.charCodeAt(y);if(O<=127)p.push(s.charCodeAt(y));else for(var E=y,P=(55296<=O&&O<=57343&&y++,encodeURIComponent(s.slice(E,y+1)).substr(1).split("%")),$=0;$<P.length;$++)p.push(parseInt(P[$],16))}return p}function at(s){return A.toByteArray(s)}function vt(s,p,y,O){for(var E=0;E<O&&!(E+y>=p.length||E>=s.length);E++)p[E+y]=s[E];return E}function Tt(s){try{return decodeURIComponent(s)}catch{return"ï¿½"}}function Ot(s,p){T(typeof s=="number","cannot write a non-number as a number"),T(0<=s,"specified a negative value for writing an unsigned value"),T(s<=p,"value is larger than maximum value for type"),T(Math.floor(s)===s,"value has a fractional component")}function It(s,p,y){T(typeof s=="number","cannot write a non-number as a number"),T(s<=p,"value larger than maximum allowed value"),T(y<=s,"value smaller than minimum allowed value"),T(Math.floor(s)===s,"value has a fractional component")}function Pt(s,p,y){T(typeof s=="number","cannot write a non-number as a number"),T(s<=p,"value larger than maximum allowed value"),T(y<=s,"value smaller than minimum allowed value")}function T(s,p){if(!s)throw new Error(p||"Failed assertion")}m._augment=function(s){return s._isBuffer=!0,s._get=s.get,s._set=s.set,s.get=M.get,s.set=M.set,s.write=M.write,s.toString=M.toString,s.toLocaleString=M.toString,s.toJSON=M.toJSON,s.copy=M.copy,s.slice=M.slice,s.readUInt8=M.readUInt8,s.readUInt16LE=M.readUInt16LE,s.readUInt16BE=M.readUInt16BE,s.readUInt32LE=M.readUInt32LE,s.readUInt32BE=M.readUInt32BE,s.readInt8=M.readInt8,s.readInt16LE=M.readInt16LE,s.readInt16BE=M.readInt16BE,s.readInt32LE=M.readInt32LE,s.readInt32BE=M.readInt32BE,s.readFloatLE=M.readFloatLE,s.readFloatBE=M.readFloatBE,s.readDoubleLE=M.readDoubleLE,s.readDoubleBE=M.readDoubleBE,s.writeUInt8=M.writeUInt8,s.writeUInt16LE=M.writeUInt16LE,s.writeUInt16BE=M.writeUInt16BE,s.writeUInt32LE=M.writeUInt32LE,s.writeUInt32BE=M.writeUInt32BE,s.writeInt8=M.writeInt8,s.writeInt16LE=M.writeInt16LE,s.writeInt16BE=M.writeInt16BE,s.writeInt32LE=M.writeInt32LE,s.writeInt32BE=M.writeInt32BE,s.writeFloatLE=M.writeFloatLE,s.writeFloatBE=M.writeFloatBE,s.writeDoubleLE=M.writeDoubleLE,s.writeDoubleBE=M.writeDoubleBE,s.fill=M.fill,s.inspect=M.inspect,s.toArrayBuffer=M.toArrayBuffer,s}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(e,r,i){(function(o,u,A,h,c,f,_,C,L){var A=e("buffer").Buffer,k=4,m=new A(k);m.fill(0),r.exports={hash:function(x,U,I,j){for(var R=U(function(l,b){l.length%k!=0&&(w=l.length+(k-l.length%k),l=A.concat([l,m],w));for(var w,D=[],B=b?l.readInt32BE:l.readInt32LE,N=0;N<l.length;N+=k)D.push(B.call(l,N));return D}(x=A.isBuffer(x)?x:new A(x),j),8*x.length),U=j,v=new A(I),S=U?v.writeInt32BE:v.writeInt32LE,d=0;d<R.length;d++)S.call(v,R[d],4*d,!0);return v}}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(e,r,i){(function(o,u,A,h,c,f,_,C,L){var A=e("buffer").Buffer,k=e("./sha"),m=e("./sha256"),x=e("./rng"),U={sha1:k,sha256:m,md5:e("./md5")},I=64,j=new A(I);function R(l,b){var w=U[l=l||"sha1"],D=[];return w||v("algorithm:",l,"is not yet supported"),{update:function(B){return A.isBuffer(B)||(B=new A(B)),D.push(B),B.length,this},digest:function(B){var N=A.concat(D),N=b?function(M,q,V){A.isBuffer(q)||(q=new A(q)),A.isBuffer(V)||(V=new A(V)),q.length>I?q=M(q):q.length<I&&(q=A.concat([q,j],I));for(var J=new A(I),F=new A(I),st=0;st<I;st++)J[st]=54^q[st],F[st]=92^q[st];return V=M(A.concat([J,V])),M(A.concat([F,V]))}(w,b,N):w(N);return D=null,B?N.toString(B):N}}}function v(){var l=[].slice.call(arguments).join(" ");throw new Error([l,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}j.fill(0),i.createHash=function(l){return R(l)},i.createHmac=R,i.randomBytes=function(l,b){if(!b||!b.call)return new A(x(l));try{b.call(this,void 0,new A(x(l)))}catch(w){b(w)}};var S,d=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],g=function(l){i[l]=function(){v("sorry,",l,"is not implemented yet")}};for(S in d)g(d[S])}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(e,r,i){(function(o,u,a,h,c,f,_,C,L){var A=e("./helpers");function k(v,S){v[S>>5]|=128<<S%32,v[14+(S+64>>>9<<4)]=S;for(var d=1732584193,g=-271733879,l=-1732584194,b=271733878,w=0;w<v.length;w+=16){var D=d,B=g,N=l,M=b,d=x(d,g,l,b,v[w+0],7,-680876936),b=x(b,d,g,l,v[w+1],12,-389564586),l=x(l,b,d,g,v[w+2],17,606105819),g=x(g,l,b,d,v[w+3],22,-1044525330);d=x(d,g,l,b,v[w+4],7,-176418897),b=x(b,d,g,l,v[w+5],12,1200080426),l=x(l,b,d,g,v[w+6],17,-1473231341),g=x(g,l,b,d,v[w+7],22,-45705983),d=x(d,g,l,b,v[w+8],7,1770035416),b=x(b,d,g,l,v[w+9],12,-1958414417),l=x(l,b,d,g,v[w+10],17,-42063),g=x(g,l,b,d,v[w+11],22,-1990404162),d=x(d,g,l,b,v[w+12],7,1804603682),b=x(b,d,g,l,v[w+13],12,-40341101),l=x(l,b,d,g,v[w+14],17,-1502002290),d=U(d,g=x(g,l,b,d,v[w+15],22,1236535329),l,b,v[w+1],5,-165796510),b=U(b,d,g,l,v[w+6],9,-1069501632),l=U(l,b,d,g,v[w+11],14,643717713),g=U(g,l,b,d,v[w+0],20,-373897302),d=U(d,g,l,b,v[w+5],5,-701558691),b=U(b,d,g,l,v[w+10],9,38016083),l=U(l,b,d,g,v[w+15],14,-660478335),g=U(g,l,b,d,v[w+4],20,-405537848),d=U(d,g,l,b,v[w+9],5,568446438),b=U(b,d,g,l,v[w+14],9,-1019803690),l=U(l,b,d,g,v[w+3],14,-187363961),g=U(g,l,b,d,v[w+8],20,1163531501),d=U(d,g,l,b,v[w+13],5,-1444681467),b=U(b,d,g,l,v[w+2],9,-51403784),l=U(l,b,d,g,v[w+7],14,1735328473),d=I(d,g=U(g,l,b,d,v[w+12],20,-1926607734),l,b,v[w+5],4,-378558),b=I(b,d,g,l,v[w+8],11,-2022574463),l=I(l,b,d,g,v[w+11],16,1839030562),g=I(g,l,b,d,v[w+14],23,-35309556),d=I(d,g,l,b,v[w+1],4,-1530992060),b=I(b,d,g,l,v[w+4],11,1272893353),l=I(l,b,d,g,v[w+7],16,-155497632),g=I(g,l,b,d,v[w+10],23,-1094730640),d=I(d,g,l,b,v[w+13],4,681279174),b=I(b,d,g,l,v[w+0],11,-358537222),l=I(l,b,d,g,v[w+3],16,-722521979),g=I(g,l,b,d,v[w+6],23,76029189),d=I(d,g,l,b,v[w+9],4,-640364487),b=I(b,d,g,l,v[w+12],11,-421815835),l=I(l,b,d,g,v[w+15],16,530742520),d=j(d,g=I(g,l,b,d,v[w+2],23,-995338651),l,b,v[w+0],6,-198630844),b=j(b,d,g,l,v[w+7],10,1126891415),l=j(l,b,d,g,v[w+14],15,-1416354905),g=j(g,l,b,d,v[w+5],21,-57434055),d=j(d,g,l,b,v[w+12],6,1700485571),b=j(b,d,g,l,v[w+3],10,-1894986606),l=j(l,b,d,g,v[w+10],15,-1051523),g=j(g,l,b,d,v[w+1],21,-2054922799),d=j(d,g,l,b,v[w+8],6,1873313359),b=j(b,d,g,l,v[w+15],10,-30611744),l=j(l,b,d,g,v[w+6],15,-1560198380),g=j(g,l,b,d,v[w+13],21,1309151649),d=j(d,g,l,b,v[w+4],6,-145523070),b=j(b,d,g,l,v[w+11],10,-1120210379),l=j(l,b,d,g,v[w+2],15,718787259),g=j(g,l,b,d,v[w+9],21,-343485551),d=R(d,D),g=R(g,B),l=R(l,N),b=R(b,M)}return Array(d,g,l,b)}function m(v,S,d,g,l,b){return R((S=R(R(S,v),R(g,b)))<<l|S>>>32-l,d)}function x(v,S,d,g,l,b,w){return m(S&d|~S&g,v,S,l,b,w)}function U(v,S,d,g,l,b,w){return m(S&g|d&~g,v,S,l,b,w)}function I(v,S,d,g,l,b,w){return m(S^d^g,v,S,l,b,w)}function j(v,S,d,g,l,b,w){return m(d^(S|~g),v,S,l,b,w)}function R(v,S){var d=(65535&v)+(65535&S);return(v>>16)+(S>>16)+(d>>16)<<16|65535&d}r.exports=function(v){return A.hash(v,k,16)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(e,r,i){(function(o,u,a,h,c,f,_,C,L){r.exports=function(A){for(var k,m=new Array(A),x=0;x<A;x++)!(3&x)&&(k=4294967296*Math.random()),m[x]=k>>>((3&x)<<3)&255;return m}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(e,r,i){(function(o,u,a,h,c,f,_,C,L){var A=e("./helpers");function k(U,I){U[I>>5]|=128<<24-I%32,U[15+(I+64>>9<<4)]=I;for(var j,R,v,S=Array(80),d=1732584193,g=-271733879,l=-1732584194,b=271733878,w=-1009589776,D=0;D<U.length;D+=16){for(var B=d,N=g,M=l,q=b,V=w,J=0;J<80;J++){S[J]=J<16?U[D+J]:x(S[J-3]^S[J-8]^S[J-14]^S[J-16],1);var F=m(m(x(d,5),(F=g,R=l,v=b,(j=J)<20?F&R|~F&v:!(j<40)&&j<60?F&R|F&v|R&v:F^R^v)),m(m(w,S[J]),(j=J)<20?1518500249:j<40?1859775393:j<60?-1894007588:-899497514)),w=b,b=l,l=x(g,30),g=d,d=F}d=m(d,B),g=m(g,N),l=m(l,M),b=m(b,q),w=m(w,V)}return Array(d,g,l,b,w)}function m(U,I){var j=(65535&U)+(65535&I);return(U>>16)+(I>>16)+(j>>16)<<16|65535&j}function x(U,I){return U<<I|U>>>32-I}r.exports=function(U){return A.hash(U,k,20,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(e,r,i){(function(o,u,a,h,c,f,_,C,L){function A(I,j){var R=(65535&I)+(65535&j);return(I>>16)+(j>>16)+(R>>16)<<16|65535&R}function k(I,j){var R,v=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),S=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),d=new Array(64);I[j>>5]|=128<<24-j%32,I[15+(j+64>>9<<4)]=j;for(var g,l,b=0;b<I.length;b+=16){for(var w=S[0],D=S[1],B=S[2],N=S[3],M=S[4],q=S[5],V=S[6],J=S[7],F=0;F<64;F++)d[F]=F<16?I[F+b]:A(A(A((l=d[F-2],x(l,17)^x(l,19)^U(l,10)),d[F-7]),(l=d[F-15],x(l,7)^x(l,18)^U(l,3))),d[F-16]),R=A(A(A(A(J,x(l=M,6)^x(l,11)^x(l,25)),M&q^~M&V),v[F]),d[F]),g=A(x(g=w,2)^x(g,13)^x(g,22),w&D^w&B^D&B),J=V,V=q,q=M,M=A(N,R),N=B,B=D,D=w,w=A(R,g);S[0]=A(w,S[0]),S[1]=A(D,S[1]),S[2]=A(B,S[2]),S[3]=A(N,S[3]),S[4]=A(M,S[4]),S[5]=A(q,S[5]),S[6]=A(V,S[6]),S[7]=A(J,S[7])}return S}var m=e("./helpers"),x=function(I,j){return I>>>j|I<<32-j},U=function(I,j){return I>>>j};r.exports=function(I){return m.hash(I,k,32,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(e,r,i){(function(o,u,a,h,c,f,_,C,L){i.read=function(A,k,m,x,b){var I,j,R=8*b-x-1,v=(1<<R)-1,S=v>>1,d=-7,g=m?b-1:0,l=m?-1:1,b=A[k+g];for(g+=l,I=b&(1<<-d)-1,b>>=-d,d+=R;0<d;I=256*I+A[k+g],g+=l,d-=8);for(j=I&(1<<-d)-1,I>>=-d,d+=x;0<d;j=256*j+A[k+g],g+=l,d-=8);if(I===0)I=1-S;else{if(I===v)return j?NaN:1/0*(b?-1:1);j+=Math.pow(2,x),I-=S}return(b?-1:1)*j*Math.pow(2,I-x)},i.write=function(A,k,m,x,U,w){var j,R,v=8*w-U-1,S=(1<<v)-1,d=S>>1,g=U===23?Math.pow(2,-24)-Math.pow(2,-77):0,l=x?0:w-1,b=x?1:-1,w=k<0||k===0&&1/k<0?1:0;for(k=Math.abs(k),isNaN(k)||k===1/0?(R=isNaN(k)?1:0,j=S):(j=Math.floor(Math.log(k)/Math.LN2),k*(x=Math.pow(2,-j))<1&&(j--,x*=2),2<=(k+=1<=j+d?g/x:g*Math.pow(2,1-d))*x&&(j++,x/=2),S<=j+d?(R=0,j=S):1<=j+d?(R=(k*x-1)*Math.pow(2,U),j+=d):(R=k*Math.pow(2,d-1)*Math.pow(2,U),j=0));8<=U;A[m+l]=255&R,l+=b,R/=256,U-=8);for(j=j<<U|R,v+=U;0<v;A[m+l]=255&j,l+=b,j/=256,v-=8);A[m+l-b]|=128*w}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(e,r,i){(function(o,u,a,h,c,f,_,C,L){var A,k,m;function x(){}(o=r.exports={}).nextTick=(k=typeof window<"u"&&window.setImmediate,m=typeof window<"u"&&window.postMessage&&window.addEventListener,k?function(U){return window.setImmediate(U)}:m?(A=[],window.addEventListener("message",function(U){var I=U.source;I!==window&&I!==null||U.data!=="process-tick"||(U.stopPropagation(),0<A.length&&A.shift()())},!0),function(U){A.push(U),window.postMessage("process-tick","*")}):function(U){setTimeout(U,0)}),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=x,o.addListener=x,o.once=x,o.off=x,o.removeListener=x,o.removeAllListeners=x,o.emit=x,o.binding=function(U){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(U){throw new Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(Ye);var vn=Ye.exports;const _t=vn.MD5;function it(n){for(var t=arguments.length,e=Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+n+(e.length?" "+e.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function wt(n){return!!n&&!!n[W]}function ht(n){return!!n&&(function(t){if(!t||typeof t!="object")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;var r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object||typeof r=="function"&&Function.toString.call(r)===jn}(n)||Array.isArray(n)||!!n[ke]||!!n.constructor[ke]||fe(n)||de(n))}function St(n,t,e){e===void 0&&(e=!1),Et(n)===0?(e?Object.keys:ve)(n).forEach(function(r){e&&typeof r=="symbol"||t(r,n[r],n)}):n.forEach(function(r,i){return t(i,r,n)})}function Et(n){var t=n[W];return t?t.i>3?t.i-4:t.i:Array.isArray(n)?1:fe(n)?2:de(n)?3:0}function ne(n,t){return Et(n)===2?n.has(t):Object.prototype.hasOwnProperty.call(n,t)}function bn(n,t){return Et(n)===2?n.get(t):n[t]}function He(n,t,e){var r=Et(n);r===2?n.set(t,e):r===3?(n.delete(t),n.add(e)):n[t]=e}function _n(n,t){return n===t?n!==0||1/n==1/t:n!=n&&t!=t}function fe(n){return On&&n instanceof Map}function de(n){return In&&n instanceof Set}function Q(n){return n.o||n.t}function he(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var t=kn(n);delete t[W];for(var e=ve(t),r=0;r<e.length;r++){var i=e[r],o=t[i];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),t)}function pe(n,t){return t===void 0&&(t=!1),ge(n)||wt(n)||!ht(n)||(Et(n)>1&&(n.set=n.add=n.clear=n.delete=mn),Object.freeze(n),t&&St(n,function(e,r){return pe(r,!0)},!0)),n}function mn(){it(2)}function ge(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function lt(n){var t=ie[n];return t||it(18,n),t}function wn(n,t){ie[n]||(ie[n]=t)}function qt(){return Ct}function Qt(n,t){t&&(lt("Patches"),n.u=[],n.s=[],n.v=t)}function Ft(n){re(n),n.p.forEach(Sn),n.p=null}function re(n){n===Ct&&(Ct=n.l)}function Se(n){return Ct={p:[],l:Ct,h:n,m:!0,_:0}}function Sn(n){var t=n[W];t.i===0||t.i===1?t.j():t.O=!0}function Gt(n,t){t._=t.p.length;var e=t.p[0],r=n!==void 0&&n!==e;return t.h.g||lt("ES5").S(t,n,r),r?(e[W].P&&(Ft(t),it(4)),ht(n)&&(n=Wt(t,n),t.l||Jt(t,n)),t.u&&lt("Patches").M(e[W].t,n,t.u,t.s)):n=Wt(t,e,[]),Ft(t),t.u&&t.v(t.u,t.s),n!==Ke?n:void 0}function Wt(n,t,e){if(ge(t))return t;var r=t[W];if(!r)return St(t,function(o,u){return Ae(n,r,t,o,u,e)},!0),t;if(r.A!==n)return t;if(!r.P)return Jt(n,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=r.i===4||r.i===5?r.o=he(r.k):r.o;St(r.i===3?new Set(i):i,function(o,u){return Ae(n,r,i,o,u,e)}),Jt(n,i,!1),e&&n.u&&lt("Patches").R(r,e,n.u,n.s)}return r.o}function Ae(n,t,e,r,i,o){if(wt(i)){var u=Wt(n,i,o&&t&&t.i!==3&&!ne(t.D,r)?o.concat(r):void 0);if(He(e,r,u),!wt(u))return;n.m=!1}if(ht(i)&&!ge(i)){if(!n.h.F&&n._<1)return;Wt(n,i),t&&t.A.l||Jt(n,i)}}function Jt(n,t,e){e===void 0&&(e=!1),n.h.F&&n.m&&pe(t,e)}function Xt(n,t){var e=n[W];return(e?Q(e):n)[t]}function Ee(n,t){if(t in n)for(var e=Object.getPrototypeOf(n);e;){var r=Object.getOwnPropertyDescriptor(e,t);if(r)return r;e=Object.getPrototypeOf(e)}}function ft(n){n.P||(n.P=!0,n.l&&ft(n.l))}function Zt(n){n.o||(n.o=he(n.t))}function xt(n,t,e){var r=fe(t)?lt("MapSet").N(t,e):de(t)?lt("MapSet").T(t,e):n.g?function(i,o){var u=Array.isArray(i),a={i:u?1:0,A:o?o.A:qt(),P:!1,I:!1,D:{},l:o,t:i,k:null,o:null,j:null,C:!1},h=a,c=oe;u&&(h=[a],c=kt);var f=Proxy.revocable(h,c),_=f.revoke,C=f.proxy;return a.k=C,a.j=_,C}(t,e):lt("ES5").J(t,e);return(e?e.A:qt()).p.push(r),r}function An(n){return wt(n)||it(22,n),function t(e){if(!ht(e))return e;var r,i=e[W],o=Et(e);if(i){if(!i.P&&(i.i<4||!lt("ES5").K(i)))return i.t;i.I=!0,r=Oe(e,o),i.I=!1}else r=Oe(e,o);return St(r,function(u,a){i&&bn(i.t,u)===a||He(r,u,t(a))}),o===3?new Set(r):r}(n)}function Oe(n,t){switch(t){case 2:return new Map(n);case 3:return Array.from(n)}return he(n)}function En(){function n(a,h){function c(){this.constructor=a}i(a,h),a.prototype=(c.prototype=h.prototype,new c)}function t(a){a.o||(a.D=new Map,a.o=new Map(a.t))}function e(a){a.o||(a.o=new Set,a.t.forEach(function(h){if(ht(h)){var c=xt(a.A.h,h,a);a.p.set(h,c),a.o.add(c)}else a.o.add(h)}))}function r(a){a.O&&it(3,JSON.stringify(Q(a)))}var i=function(a,h){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,f){c.__proto__=f}||function(c,f){for(var _ in f)f.hasOwnProperty(_)&&(c[_]=f[_])})(a,h)},o=function(){function a(c,f){return this[W]={i:2,l:f,A:f?f.A:qt(),P:!1,I:!1,o:void 0,D:void 0,t:c,k:this,C:!1,O:!1},this}n(a,Map);var h=a.prototype;return Object.defineProperty(h,"size",{get:function(){return Q(this[W]).size}}),h.has=function(c){return Q(this[W]).has(c)},h.set=function(c,f){var _=this[W];return r(_),Q(_).has(c)&&Q(_).get(c)===f||(t(_),ft(_),_.D.set(c,!0),_.o.set(c,f),_.D.set(c,!0)),this},h.delete=function(c){if(!this.has(c))return!1;var f=this[W];return r(f),t(f),ft(f),f.t.has(c)?f.D.set(c,!1):f.D.delete(c),f.o.delete(c),!0},h.clear=function(){var c=this[W];r(c),Q(c).size&&(t(c),ft(c),c.D=new Map,St(c.t,function(f){c.D.set(f,!1)}),c.o.clear())},h.forEach=function(c,f){var _=this;Q(this[W]).forEach(function(C,L){c.call(f,_.get(L),L,_)})},h.get=function(c){var f=this[W];r(f);var _=Q(f).get(c);if(f.I||!ht(_)||_!==f.t.get(c))return _;var C=xt(f.A.h,_,f);return t(f),f.o.set(c,C),C},h.keys=function(){return Q(this[W]).keys()},h.values=function(){var c,f=this,_=this.keys();return(c={})[Rt]=function(){return f.values()},c.next=function(){var C=_.next();return C.done?C:{done:!1,value:f.get(C.value)}},c},h.entries=function(){var c,f=this,_=this.keys();return(c={})[Rt]=function(){return f.entries()},c.next=function(){var C=_.next();if(C.done)return C;var L=f.get(C.value);return{done:!1,value:[C.value,L]}},c},h[Rt]=function(){return this.entries()},a}(),u=function(){function a(c,f){return this[W]={i:3,l:f,A:f?f.A:qt(),P:!1,I:!1,o:void 0,t:c,k:this,p:new Map,O:!1,C:!1},this}n(a,Set);var h=a.prototype;return Object.defineProperty(h,"size",{get:function(){return Q(this[W]).size}}),h.has=function(c){var f=this[W];return r(f),f.o?!!f.o.has(c)||!(!f.p.has(c)||!f.o.has(f.p.get(c))):f.t.has(c)},h.add=function(c){var f=this[W];return r(f),this.has(c)||(e(f),ft(f),f.o.add(c)),this},h.delete=function(c){if(!this.has(c))return!1;var f=this[W];return r(f),e(f),ft(f),f.o.delete(c)||!!f.p.has(c)&&f.o.delete(f.p.get(c))},h.clear=function(){var c=this[W];r(c),Q(c).size&&(e(c),ft(c),c.o.clear())},h.values=function(){var c=this[W];return r(c),e(c),c.o.values()},h.entries=function(){var c=this[W];return r(c),e(c),c.o.entries()},h.keys=function(){return this.values()},h[Rt]=function(){return this.values()},h.forEach=function(c,f){for(var _=this.values(),C=_.next();!C.done;)c.call(f,C.value,C.value,this),C=_.next()},a}();wn("MapSet",{N:function(a,h){return new o(a,h)},T:function(a,h){return new u(a,h)}})}var Ie,Ct,ye=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",On=typeof Map<"u",In=typeof Set<"u",je=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Ke=ye?Symbol.for("immer-nothing"):((Ie={})["immer-nothing"]=!0,Ie),ke=ye?Symbol.for("immer-draftable"):"__$immer_draftable",W=ye?Symbol.for("immer-state"):"__$immer_state",Rt=typeof Symbol<"u"&&Symbol.iterator||"@@iterator",jn=""+Object.prototype.constructor,ve=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,kn=Object.getOwnPropertyDescriptors||function(n){var t={};return ve(n).forEach(function(e){t[e]=Object.getOwnPropertyDescriptor(n,e)}),t},ie={},oe={get:function(n,t){if(t===W)return n;var e=Q(n);if(!ne(e,t))return function(i,o,u){var a,h=Ee(o,u);return h?"value"in h?h.value:(a=h.get)===null||a===void 0?void 0:a.call(i.k):void 0}(n,e,t);var r=e[t];return n.I||!ht(r)?r:r===Xt(n.t,t)?(Zt(n),n.o[t]=xt(n.A.h,r,n)):r},has:function(n,t){return t in Q(n)},ownKeys:function(n){return Reflect.ownKeys(Q(n))},set:function(n,t,e){var r=Ee(Q(n),t);if(r!=null&&r.set)return r.set.call(n.k,e),!0;if(!n.P){var i=Xt(Q(n),t),o=i==null?void 0:i[W];if(o&&o.t===e)return n.o[t]=e,n.D[t]=!1,!0;if(_n(e,i)&&(e!==void 0||ne(n.t,t)))return!0;Zt(n),ft(n)}return n.o[t]===e&&typeof e!="number"&&(e!==void 0||t in n.o)||(n.o[t]=e,n.D[t]=!0,!0)},deleteProperty:function(n,t){return Xt(n.t,t)!==void 0||t in n.t?(n.D[t]=!1,Zt(n),ft(n)):delete n.D[t],n.o&&delete n.o[t],!0},getOwnPropertyDescriptor:function(n,t){var e=Q(n),r=Reflect.getOwnPropertyDescriptor(e,t);return r&&{writable:!0,configurable:n.i!==1||t!=="length",enumerable:r.enumerable,value:e[t]}},defineProperty:function(){it(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){it(12)}},kt={};St(oe,function(n,t){kt[n]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),kt.deleteProperty=function(n,t){return kt.set.call(this,n,t,void 0)},kt.set=function(n,t,e){return oe.set.call(this,n[0],t,e,n[0])};var xn=function(){function n(e){var r=this;this.g=je,this.F=!0,this.produce=function(i,o,u){if(typeof i=="function"&&typeof o!="function"){var a=o;o=i;var h=r;return function(k){var m=this;k===void 0&&(k=a);for(var x=arguments.length,U=Array(x>1?x-1:0),I=1;I<x;I++)U[I-1]=arguments[I];return h.produce(k,function(j){var R;return(R=o).call.apply(R,[m,j].concat(U))})}}var c;if(typeof o!="function"&&it(6),u!==void 0&&typeof u!="function"&&it(7),ht(i)){var f=Se(r),_=xt(r,i,void 0),C=!0;try{c=o(_),C=!1}finally{C?Ft(f):re(f)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(k){return Qt(f,u),Gt(k,f)},function(k){throw Ft(f),k}):(Qt(f,u),Gt(c,f))}if(!i||typeof i!="object"){if((c=o(i))===void 0&&(c=i),c===Ke&&(c=void 0),r.F&&pe(c,!0),u){var L=[],A=[];lt("Patches").M(i,c,L,A),u(L,A)}return c}it(21,i)},this.produceWithPatches=function(i,o){if(typeof i=="function")return function(c){for(var f=arguments.length,_=Array(f>1?f-1:0),C=1;C<f;C++)_[C-1]=arguments[C];return r.produceWithPatches(c,function(L){return i.apply(void 0,[L].concat(_))})};var u,a,h=r.produce(i,o,function(c,f){u=c,a=f});return typeof Promise<"u"&&h instanceof Promise?h.then(function(c){return[c,u,a]}):[h,u,a]},typeof(e==null?void 0:e.useProxies)=="boolean"&&this.setUseProxies(e.useProxies),typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze)}var t=n.prototype;return t.createDraft=function(e){ht(e)||it(8),wt(e)&&(e=An(e));var r=Se(this),i=xt(this,e,void 0);return i[W].C=!0,re(r),i},t.finishDraft=function(e,r){var i=e&&e[W],o=i.A;return Qt(o,r),Gt(void 0,o)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!je&&it(20),this.g=e},t.applyPatches=function(e,r){var i;for(i=r.length-1;i>=0;i--){var o=r[i];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}i>-1&&(r=r.slice(i+1));var u=lt("Patches").$;return wt(e)?u(e,r):this.produce(e,function(a){return u(a,r)})},n}(),rt=new xn,Cn=rt.produce;rt.produceWithPatches.bind(rt);rt.setAutoFreeze.bind(rt);rt.setUseProxies.bind(rt);rt.applyPatches.bind(rt);rt.createDraft.bind(rt);rt.finishDraft.bind(rt);function Qe(n,t){const e=Object.keys(n),r=Object.keys(t);return e.length===r.length&&Object.keys(n).every(i=>t.hasOwnProperty(i))}function xe(n,t){return Object.keys(n).length===Object.keys(t).length&&Object.keys(n).every(e=>t.hasOwnProperty(e)&&n[e]===t[e])}function $t(n,t){return typeof n!="object"||typeof t!="object"||n===null||t===null?n===t:Qe(n,t)?Object.keys(n).every(e=>$t(n[e],t[e])):!1}function Ge(n,t){if(!mt(n)||!mt(t))return t;const e={};for(const r of Object.keys(n))e[r]=n[r];for(const r of Object.keys(t)){if(t[r]===null)continue;const i=mt(n[r])&&mt(t[r]);e[r]=i?Ge(n[r],t[r]):t[r]}return e}function Xe(n,t,e){if(!mt(n))return n;const r={};for(const[i,o]of Object.entries(n))r[i]=mt(o)?Xe(o,t,e):o===t?e:o;return r}function mt(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}En();function Un(n){return n.cardinality==="one"}function be(n){return n["value-type"]==="ref"}function Mn(n){return n["value-type"]==="blob"}function zt(n,t){return n[t]}function _e(n,t){return t.reduce((e,r)=>e&&e.get(r),n)}function dt(n,t){if(t.length===0)throw new Error("path must have at least one element");if(t.length===1){n.delete(t[0]);return}const[e,...r]=t;n.has(e)&&dt(n.get(e),r)}function ct(n,t,e){if(t.length===0)throw new Error("path must have at least one element");if(t.length===1){n.set(t[0],e);return}const[r,...i]=t;let o=n.get(r);o||(o=new Map,n.set(r,o)),ct(o,i,e)}function Ze(n,t){const e=new Map,r=new Map,i=new Map;for(const o of t){const[u,a,h,c]=o,f=zt(n,a);if(!f){console.warn("no such attr",u,n);continue}be(f)&&ct(i,[h,a,u],o),ct(e,[u,a,h],o),ct(r,[a,u,h],o)}return{eav:e,aev:r,vae:i}}function Ce(n,t,e,r){const i=Ze(n,t);return i.attrs=n,i.cardinalityInference=e,i.linkIndex=r,i}function Yt(n,t){var e,r;let i;if(Array.isArray(t[0])){const[u,a]=t[0],h=n.aev.get(u);if(!h)return null;i=(e=gt(h,2).find(f=>f[2]===a))===null||e===void 0?void 0:e[0]}else i=t[0];if(!i)return null;const o=t[2];if(Array.isArray(o)&&o.length===2&&n.aev.get(o[0])){const[u,a]=o,h=n.aev.get(u);if(!h)return null;const f=(r=gt(h,2).find(k=>k[2]===a))===null||r===void 0?void 0:r[0];if(!f)return null;const[_,C,L,...A]=t;return[i,C,f,...A]}else{const[u,...a]=t;return[i,...a]}}function Tn(n,t){const e=Yt(n,t);if(!e)return;const[r,i,o]=e,u=zt(n.attrs,i);u&&(dt(n.eav,[r,i,o]),dt(n.aev,[i,r,o]),be(u)&&dt(n.vae,[o,i,r]))}let Pn=0;function tn(n,t,e){const[r,i,o]=e;let u;const a=_e(n.ea,[r,i,o]);return a&&(u=a[3]),u||Date.now()*10+Pn++}function Ln(n,t){var e;const r=Yt(n,t);if(!r)return;const[i,o,u]=r,a=zt(n.attrs,o);if(!a)return;const h=_e(n.eav,[i,o,u]),c=(e=h==null?void 0:h[3])!==null&&e!==void 0?e:tn(n,a,r),f=[i,o,u,c];Un(a)?(ct(n.eav,[i,o],new Map([[u,f]])),ct(n.aev,[o,i],new Map([[u,f]]))):(ct(n.eav,[i,o,u],f),ct(n.aev,[o,i,u],f)),be(a)&&ct(n.vae,[u,o,i],f)}function Rn(n,t){var e;const r=Yt(n,t);if(!r)return;const[i,o,u]=r,a=zt(n.attrs,o);if(!a)return;if(!Mn(a))throw new Error("merge operation is not supported for links");const h=_e(n.eav,[i,o]);if(!h)return;const c=(e=h.values().next())===null||e===void 0?void 0:e.value;if(!c)return;const f=c[2],_=Ge(f,u),C=[i,o,_,tn(n,a,c)];ct(n.eav,[i,o],new Map([[_,C]]))}function Bn(n,t){const e=Yt(n,t);if(!e)return;const[r]=e,i=n.eav.get(r);if(i)for(const u of i.keys())dt(n.aev,[u,r]);dt(n.eav,[r]);const o=n.vae.get(r)&&gt(n.vae.get(r),2);o&&o.forEach(u=>{const[a,h,c]=u;dt(n.eav,[a,h,c]),dt(n.aev,[h,a,c])}),dt(n.vae,[r])}function en(n,t){const e=Ze(n.attrs,t);Object.keys(e).forEach(r=>{n[r]=e[r]})}function Dn(n,[t]){n.attrs[t.id]=t}function nn(n){return gt(n.eav,3)}function Nn(n,[t]){if(!n.attrs[t])return;const e=nn(n).filter(([r,i])=>i!==t);delete n.attrs[t],en(n,e)}function $n(n,[t]){const e=n.attrs[t.id];e&&(n.attrs[t.id]=Object.assign(Object.assign({},e),t),en(n,nn(n)))}function qn(n,t){const[e,...r]=t;switch(e){case"add-triple":Ln(n,r);break;case"deep-merge-triple":Rn(n,r);break;case"retract-triple":Tn(n,r);break;case"delete-entity":Bn(n,r);break;case"add-attr":Dn(n,r);break;case"delete-attr":Nn(n,r);break;case"update-attr":$n(n,r);break;default:throw new Error(`unhandled transaction action: ${e}`)}}function gt(n,t,e=[]){if(!n||t===0)return e;if(t===1){for(const r of n.values())e.push(r);return e}for(const r of n.values())gt(r,t-1,e);return e}function Bt(n,t){const e=[],r=t.in?t.in:[t];for(const i of r){const o=n.get(i);o&&e.push(o)}return e}function Fn(n,t,e){let r="";return n!==void 0&&(r+="e"),t!==void 0&&(r+="a"),e!==void 0&&(r+="v"),r}function Wn(n,[t,e,r]){var i,o;switch(Fn(t,e,r)){case"e":{const a=n.eav.get(t);return gt(a,2)}case"ea":{const a=(i=n.eav.get(t))===null||i===void 0?void 0:i.get(e);return gt(a,1)}case"eav":{const a=(o=n.eav.get(t))===null||o===void 0?void 0:o.get(e);return a?Bt(a,r):[]}case"ev":{const a=n.eav.get(t);if(!a)return[];const h=[];for(const c of a.values())h.push(...Bt(c,r));return h}case"av":{const a=n.aev.get(e);if(!a)return[];const h=[];for(const c of a.values())h.push(...Bt(c,r));return h}case"v":{const a=[];for(const h of n.eav.values())for(const c of h.values())a.push(...Bt(c,r))}default:return gt(n.eav,3)}}function Jn(n,t){return Cn(n,e=>{t.forEach(r=>{qn(e,r)})})}function Vn(n){return typeof n=="string"&&n.startsWith("?")}function zn(n,t,e){if(e.hasOwnProperty(n)){const r=e[n];return rn(r,t,e)}return Object.assign(Object.assign({},e),{[n]:t})}function Ue(n,t,e){return n===t?e:null}function Yn(n,t,e){const{in:r}=n;return r&&r.includes(t)?e:null}function Hn(n){switch(typeof n){case"string":return n.startsWith("?")?zn:Ue;case"object":return Yn;default:return Ue}}function rn(n,t,e){return e?Hn(n)(n,t,e):null}function Kn(n,t,e){return n.reduce((r,i,o)=>{const u=t[o];return rn(i,u,r)},e)}function Qn(n,t,e){return Zn(n,t,e).map(r=>Kn(t,r,e)).filter(r=>r)}function Gn(n,t,e){return t.or?t.or.patterns.flatMap(r=>se(n,r,e)):t.and?t.and.patterns.reduce((r,i)=>se(n,i,r),e):e.flatMap(r=>Qn(n,t,r))}function se(n,t,e=[{}]){return t.reduce((r,i)=>Gn(n,i,r),e)}function me(n,t){return Array.isArray(t)?t.map(e=>me(n,e)):Vn(t)?n[t]:t}function Xn(n,{find:t,where:e}){return se(n,e).map(i=>me(i,t))}function Zn(n,t,e){return Wn(n,me(e,t))}let Dt;const tr=new Uint8Array(16);function er(){if(!Dt&&(Dt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Dt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Dt(tr)}const G=[];for(let n=0;n<256;++n)G.push((n+256).toString(16).slice(1));function nr(n,t=0){return G[n[t+0]]+G[n[t+1]]+G[n[t+2]]+G[n[t+3]]+"-"+G[n[t+4]]+G[n[t+5]]+"-"+G[n[t+6]]+G[n[t+7]]+"-"+G[n[t+8]]+G[n[t+9]]+"-"+G[n[t+10]]+G[n[t+11]]+G[n[t+12]]+G[n[t+13]]+G[n[t+14]]+G[n[t+15]]}const rr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Me={randomUUID:rr};function ir(n,t,e){if(Me.randomUUID&&!t&&!n)return Me.randomUUID();n=n||{};const r=n.random||(n.rng||er)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,nr(r)}function Te(n){const t=n.replace(/-/g,""),e=[];for(let r=0;r<t.length;r+=2)e.push(parseInt(t.substring(r,r+2),16));return e}function or(n,t){for(let e=0;e<n.length;e++){if(n[e]<t[e])return-1;if(n[e]>t[e])return 1}return 0}function Pe(n,t){return or(Te(n),Te(t))}function Z(){return ir()}function ue(n,t,e){return new Proxy({},{get:(r,i)=>i==="__ops"?e:o=>ue(n,t,[...e,[i,n,t,o]])})}function ae(n){return n.startsWith("lookup__")}function on(n){const[t,e,...r]=n.split("__");return[e,JSON.parse(r.join("__"))]}function sr(n){return new Proxy({},{get(t,e){return ae(e)?ue(n,on(e),[]):ue(n,e,[])}})}function sn(){return new Proxy({},{get(n,t){return sr(t)}})}sn();function ur(n){return n.__ops}function ar(n,t){const{attrIdMap:e,refSwapAttrIds:r}=n,i=[];for(const u of t){const a=e[u];if(a)i.push(a);else if(Array.isArray(u)&&u.length==2&&e[u[0]]){const[h,c]=u;i.push([e[h],c])}else i.push(u)}const[o]=t;if((o==="add-triple"||o==="retract-triple")&&r.has(t[2])){const u=i[1];i[1]=i[3],i[3]=u}return i}function tt(n,t,e){return Object.values(n).find(r=>{const[i,o,u]=r["forward-identity"];return o===t&&u===e})}function At(n,t,e){return Object.values(n).find(r=>{const i=r["reverse-identity"];if(!i)return!1;const[o,u,a]=i;return u===t&&a===e})}function cr(n){if(Array.isArray(n))return n;const t=Object.entries(n);if(t.length!==1)throw new Error("lookup must be an object with a single unique attr and value.");return t[0]}function un(n,t,e){return e.indexOf(".")!==-1&&!tt(n,t,e)}function an(n){const[t,e,...r]=n.split(".");if(r.length>0||e!=="id")throw new Error(`${n} is not a valid lookup attribute.`);return t}function lr(n,t,e){if(!un(n,t,e))return tt(n,t,e);const r=an(e),i=tt(n,t,r);if(i&&i["value-type"]!=="ref")throw new Error(`${e} does not reference a valid link attribute.`);return i}function cn(n){return typeof n=="string"&&!ae(n)?null:typeof n=="string"&&ae(n)?on(n):cr(n)}function ot(n,t,e){const r=cn(e);if(r===null)return e;const[i,o]=r,u=lr(n,t,i);if(!u||!u["unique?"])throw new Error(`${i} is not a unique attribute.`);return[u.id,o]}function fr(n,[t,e,r]){return Object.entries(r).flatMap(([o,u])=>{const a=Array.isArray(u)?u:[u],h=tt(n,t,o),c=At(n,t,o);return a.map(f=>h?["add-triple",ot(n,t,e),h.id,ot(n,h["reverse-identity"][1],f)]:["add-triple",ot(n,c["forward-identity"][1],f),c.id,ot(n,t,e)])})}function dr(n,[t,e,r]){return Object.entries(r).flatMap(([o,u])=>{const a=Array.isArray(u)?u:[u],h=tt(n,t,o),c=At(n,t,o);return a.map(f=>h?["retract-triple",ot(n,t,e),h.id,ot(n,h["reverse-identity"][1],f)]:["retract-triple",ot(n,c["forward-identity"][1],f),c.id,ot(n,t,e)])})}function hr(n,[t,e,r]){const i=ot(n,t,e);return[["id",ot(n,t,e)]].concat(Object.entries(r)).map(([u,a])=>{const h=tt(n,t,u);return["add-triple",i,h.id,a]})}function pr(n,[t,e]){return[["delete-entity",ot(n,t,e)]]}function gr(n,[t,e,r]){const i=ot(n,t,e),o=Object.entries(r).map(([a,h])=>{const c=tt(n,t,a),f=Xe(h,void 0,null);return["deep-merge-triple",i,c.id,f]});return[["add-triple",i,tt(n,t,"id").id,i]].concat(o)}function yr(n,[t,...e]){switch(t){case"merge":return gr(n,e);case"update":return hr(n,e);case"link":return fr(n,e);case"unlink":return dr(n,e);case"delete":return pr(n,e);default:throw new Error(`unsupported action ${t}`)}}function Le(n,t,e){const r=Z(),o=[Z(),n,t];return Object.assign({id:r,"forward-identity":o,"value-type":"blob",cardinality:"one","unique?":!1,"index?":!1,isUnsynced:!0},e||{})}function Re(n,t,e){const r=Z(),i=Z(),o=Z();return Object.assign({id:r,"forward-identity":[i,n,t],"reverse-identity":[o,t,n],"value-type":"ref",cardinality:"many","unique?":!1,"index?":!1,isUnsynced:!0},e||{})}const vr=new Set(["update","merge","link","unlink"]),br=new Set(["link","unlink"]),_r=new Set(["update","merge"]),mr=new Set(["link","unlink","update","merge","delete"]),ln={"unique?":!0,"index?":!0},wr=Object.assign(Object.assign({},ln),{cardinality:"one"});function Sr(n,t){const[e,r,i]=[new Set,Object.assign({},n),[]];function o(a){r[a.id]=a,i.push(["add-attr",a]),e.add(a.id)}function u(a){a!=null&&a.isUnsynced&&!e.has(a.id)&&(i.push(["add-attr",a]),e.add(a.id))}for(const a of t){const[h,c,f,_]=a;if(mr.has(h)){const C=cn(f);if(C){const L=C[0];if(un(r,c,L)){const A=an(L),k=tt(r,c,A),m=At(r,c,A);!k&&!m&&o(Re(c,A,wr)),u(k),u(m)}else{const A=tt(r,c,L);A||o(Le(c,L,ln)),u(A)}}}}for(const a of t){const[h,c,f,_]=a;if(vr.has(h)){const C=Object.keys(_);C.push("id");for(const L of C){const A=tt(r,c,L);if(u(A),_r.has(h)&&(A||o(Le(c,L))),br.has(h)){const k=At(r,c,L);!A&&!k&&o(Re(c,L)),u(k)}}}}return[r,i]}function Ar(n,t){const r=(Array.isArray(t)?t:[t]).flatMap(a=>ur(a)),[i,o]=Sr(n,r),u=r.flatMap(a=>yr(i,a));return[...o,...u]}let Er=0;function Vt(n){return Ht(`_${n}`,Er++)}function Ht(n,t){return`?${n}-${t}`}class Ut extends Error{constructor(t){super(t),this.name="AttrNotFoundError"}}function Or(n,t){const e=Object.values(n.attrs).find(r=>{var i;return r["primary?"]&&((i=r["forward-identity"])===null||i===void 0?void 0:i[1])===t});return e||tt(n.attrs,t,"id")}function Ir(n,t){const e=Or(n,t);if(!e)throw new Ut(`Could not find id attr for ${t}`);return e}function Be(n,t,e,r){return[jr(n,t,e,r),kr(n,e,r)]}function jr(n,t,e,r){return[n(e,r),Ir(t,e).id,n(e,r),Vt("time")]}function kr(n,t,e){return[n(t,e),n("attr",e),n("val",e),n("time",e)]}function xr(n,t,e){return n.map(r=>r===t?e:r)}function fn(n,t,e,r,i){const o=tt(t.attrs,e,i),u=At(t.attrs,e,i),a=o||u;if(!a)throw new Ut(`Could not find attr for ${[e,i]}`);if(a["value-type"]!=="ref")throw new Error(`Attr ${a.id} is not a ref`);const[h,c]=a["forward-identity"],[f,_]=a["reverse-identity"],C=r+1,L=o?[n(c,r),a.id,n(_,C),Vt("time")]:[n(c,C),a.id,n(_,r),Vt("time")];return[o?_:c,C,L,a,!!o]}function Cr(n,t,e,r,i,o){const u=tt(t.attrs,e,i);if(!u)throw new Ut(`No attr for etype = ${e} label = ${i} value-label`);return[n(e,r),u.id,o,Vt("time")]}function Ur(n,t,e,r,i){const[o,u,a]=i.reduce((h,c)=>{const[f,_,C]=h,[L,A,k]=fn(n,t,f,_,c);return[L,A,[...C,k]]},[e,r,[]]);return[o,u,a]}function Mr(n,t,e,r,i,o){const u=i.slice(0,i.length-1),a=i[i.length-1],[h,c,f]=Ur(n,t,e,r,u),_=Cr(n,t,h,c,a,o);return f.concat([_])}function Tr(n,t){return t?[t].concat(n):n}function Pr([n,t]){return n==="or"&&Array.isArray(t)}function Lr([n,t]){return n==="and"&&Array.isArray(t)}function Rr(n,t,e){return(r,i)=>r==t?n(r,i):`${n(r,i)}-${e}`}function De(n,t,e,r,i,o){const u=o.map((h,c)=>{const f=Rr(n,r,c);return dn(f,e,r,i,h)}),a=n(r,i);return{[t]:{patterns:u,joinSym:a}}}function dn(n,t,e,r,i){return Object.entries(i).flatMap(([o,u])=>{if(Pr([o,u]))return De(n,"or",t,e,r,u);if(Lr([o,u]))return De(n,"and",t,e,r,u);const a=o.split(".");return Mr(n,t,e,r,a,u)})}function Br(n,t,e,r){const i=Ht;return r?dn(i,n,t,e,r).concat(Be(i,n,t,e)):Be(i,n,t,e)}function Dr(n,t,e){return[n(t,e),n("attr",e),n("val",e),n("time",e)]}function Nr(n,t,e,r,i,o){const[u,a,h,c,f]=fn(n,t,e,r,i),_=xr(h,n(e,r),o);return[u,a,_,c,f]}function $r(n,t,{etype:e,level:r,form:i},o){const u=Object.keys(i).filter(a=>a!=="$");return u.length?Object.entries(o).map(([a,h])=>u.map(f=>{var _,C,L;const A=!!(t.cardinalityInference&&(!((L=(C=(_=t.linkIndex)===null||_===void 0?void 0:_[e])===null||C===void 0?void 0:C[f])===null||L===void 0)&&L.isSingular));try{const[k,m,x]=Nr(n,t,e,r,f,a),U=hn(t,{etype:k,level:m,form:i[f],join:x}),I=A?U[0]:U;return{[f]:I}}catch(k){if(k instanceof Ut)return{[f]:A?void 0:[]};throw k}}).reduce((f,_)=>Object.assign(Object.assign({},f),_),h)):Object.values(o)}function qr(n,t){const e=n[t];return e["value-type"]==="ref"&&e["forward-identity"][2]!=="id"}function Ne(n,t){switch(n){case"asc":switch(t){case"number":return(e,r)=>e<r;case"uuid":return(e,r)=>Pe(e,r)===-1}case"desc":switch(t){case"number":return(e,r)=>e>r;case"uuid":return(e,r)=>Pe(e,r)===1}}}function Fr(n,t,[e,r,i,o]){return Ne(t,"number")(o,n[3])||o===n[3]&&Ne(t,"uuid")(e,n[0])}function Wr(n,t,e,r,i){const o=r==null?void 0:r["start-cursor"],u=[],a=Xn(n,i).sort((h,c)=>{const f=h[3],_=c[3];return e==="desc"?_-f:f-_}).reduce((h,c)=>{const[f,_,C]=c;if(qr(n.attrs,_))return h;const L=n.attrs[_],[A,k,m]=L["forward-identity"];return k!==t||(o&&_===o[1]&&Fr(o,e,c)&&u.push(f),h[f]=h[f]||{},h[f][m]=C),h},{});for(const h of u)delete a[h];return a}function Jr(n){var t;const e=(t=n.$)===null||t===void 0?void 0:t.order;return e&&e[Object.keys(e)[0]]||"asc"}function Vr(n,{etype:t,level:e,form:r,join:i,pageInfo:o}){var u,a,h,c,f,_,C;const L=((u=r.$)===null||u===void 0?void 0:u.limit)||((a=r.$)===null||a===void 0?void 0:a.first)||((h=r.$)===null||h===void 0?void 0:h.last),A=(c=r.$)===null||c===void 0?void 0:c.offset,k=(f=r.$)===null||f===void 0?void 0:f.before,m=(_=r.$)===null||_===void 0?void 0:_.after;if((A||k||m)&&(!o||!o["start-cursor"]))return[];const x=Tr(Br(n,t,e,(C=r.$)===null||C===void 0?void 0:C.where),i),U=Dr(Ht,t,e),I=Wr(n,t,Jr(r),o,{where:x,find:U});if(L!=null){const j=Object.entries(I);return j.length<=L?I:Object.fromEntries(j.slice(0,L))}return I}function zr(n,t){try{return Vr(n,t)}catch(e){if(e instanceof Ut)return{};throw e}}function hn(n,t){const e=zr(n,t);return $r(Ht,n,t,e)}function Yr(n){const t={};for(const[e,r]of Object.entries(n))t[e]={startCursor:r["start-cursor"],endCursor:r["end-cursor"],hasNextPage:r["has-next-page?"],hasPreviousPage:r["has-previous-page?"]};return t}function Hr({store:n,pageInfo:t,aggregate:e},r){const o={data:Object.keys(r).reduce((u,a)=>(e!=null&&e[a]||(u[a]=hn(n,{etype:a,form:r[a],level:0,pageInfo:t==null?void 0:t[a]})),u),{})};return t&&(o.pageInfo=Yr(t)),e&&(o.aggregate=e),o}var $e=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(f){try{c(r.next(f))}catch(_){u(_)}}function h(f){try{c(r.throw(f))}catch(_){u(_)}}function c(f){f.done?o(f.value):i(f.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};class pn{constructor(t){this.dbName=t,this._storeName="kv",this._dbPromise=this._init()}_init(){return new Promise((t,e)=>{const r=indexedDB.open(this.dbName,1);r.onerror=i=>{e(i)},r.onsuccess=i=>{t(i.target.result)},r.onupgradeneeded=i=>{i.target.result.createObjectStore(this._storeName)}})}getItem(t){return $e(this,void 0,void 0,function*(){const e=yield this._dbPromise;return new Promise((r,i)=>{const a=e.transaction([this._storeName],"readonly").objectStore(this._storeName).get(t);a.onerror=h=>{i(h)},a.onsuccess=h=>{a.result?r(a.result):r(null)}})})}setItem(t,e){return $e(this,void 0,void 0,function*(){const r=yield this._dbPromise;return new Promise((i,o)=>{const h=r.transaction([this._storeName],"readwrite").objectStore(this._storeName).put(e,t);h.onerror=c=>{o(c)},h.onsuccess=c=>{i()}})})}}var Kr=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(f){try{c(r.next(f))}catch(_){u(_)}}function h(f){try{c(r.throw(f))}catch(_){u(_)}}function c(f){f.done?o(f.value):i(f.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};class gn{static getIsOnline(){return Kr(this,void 0,void 0,function*(){return navigator.onLine})}static listen(t){const e=()=>{t(!0)},r=()=>{t(!1)};return addEventListener("online",e),addEventListener("offline",r),()=>{removeEventListener("online",e),removeEventListener("offline",r)}}}var Qr=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(f){try{c(r.next(f))}catch(_){u(_)}}function h(f){try{c(r.throw(f))}catch(_){u(_)}}function c(f){f.done?o(f.value):i(f.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};function pt(n,t){return Qr(this,void 0,void 0,function*(){const e=yield fetch(n,t),r=yield e.json();return e.status===200?Promise.resolve(r):Promise.reject({status:e.status,body:r})})}var Mt=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(f){try{c(r.next(f))}catch(_){u(_)}}function h(f){try{c(r.throw(f))}catch(_){u(_)}}function c(f){f.done?o(f.value):i(f.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};function Gr({apiURI:n,appId:t,email:e}){return pt(`${n}/runtime/auth/send_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":t,email:e})})}function Xr(n){return Mt(this,arguments,void 0,function*({apiURI:t,appId:e,email:r,code:i}){return yield pt(`${t}/runtime/auth/verify_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,email:r,code:i})})})}function Zr(n){return Mt(this,arguments,void 0,function*({apiURI:t,appId:e,refreshToken:r}){return yield pt(`${t}/runtime/auth/verify_refresh_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,"refresh-token":r})})})}function qe(n){return Mt(this,arguments,void 0,function*({apiURI:t,appId:e,code:r,codeVerifier:i}){return yield pt(`${t}/runtime/oauth/token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,code:r,code_verifier:i})})})}function ti(n){return Mt(this,arguments,void 0,function*({apiURI:t,appId:e,nonce:r,idToken:i,clientName:o,refreshToken:u}){return yield pt(`${t}/runtime/oauth/id_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,nonce:r,id_token:i,client_name:o,refresh_token:u})})})}function ei(n){return Mt(this,arguments,void 0,function*({apiURI:t,appId:e,refreshToken:r}){return yield pt(`${t}/runtime/signout`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,refresh_token:r})})})}var Kt=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(f){try{c(r.next(f))}catch(_){u(_)}}function h(f){try{c(r.throw(f))}catch(_){u(_)}}function c(f){f.done?o(f.value):i(f.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};function ni(n){return Kt(this,arguments,void 0,function*({apiURI:t,appId:e,fileName:r,refreshToken:i,metadata:o={}}){const{data:u}=yield pt(`${t}/storage/signed-upload-url`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${i}`},body:JSON.stringify({app_id:e,filename:r})});return u})}function ri(n,t){return Kt(this,void 0,void 0,function*(){return(yield fetch(n,{method:"PUT",body:t,headers:{"Content-Type":t.type}})).ok})}function ii(n){return Kt(this,arguments,void 0,function*({apiURI:t,appId:e,path:r,refreshToken:i}){const{data:o}=yield pt(`${t}/storage/signed-download-url?app_id=${e}&filename=${encodeURIComponent(r)}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return o})}function oi(n){return Kt(this,arguments,void 0,function*({apiURI:t,appId:e,path:r,refreshToken:i}){const{data:o}=yield pt(`${t}/storage/files?app_id=${e}&filename=${encodeURIComponent(r)}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return o})}function Fe(n,t){if(!t)return n;const e={};return t.forEach(r=>{e[r]=n[r]}),e}function si(n,t){var e,r;const i={peers:{}};if(t&&"user"in t?t.user:!0){const u=Fe((e=n.user)!==null&&e!==void 0?e:{},t==null?void 0:t.keys);i.user=u}for(const u of Object.keys((r=n.peers)!==null&&r!==void 0?r:{})){const a=(t==null?void 0:t.peers)===void 0,h=Array.isArray(t==null?void 0:t.peers)&&(t==null?void 0:t.peers.includes(u));if(a||h){const c=Fe(n.peers[u],t==null?void 0:t.keys);i.peers[u]=c}}return i}function ui(n,t){if(n.isLoading!==t.isLoading||n.error!==t.error||(n.user||t.user)&&(!n.user||!t.user||!xe(n.user,t.user))||!Qe(n.peers,t.peers))return!0;for(const r of Object.keys(n.peers))if(!xe(n.peers[r],t.peers[r]))return!0;return!1}class ai{constructor(){this.promise=new Promise((t,e)=>{this._resolve=t,this._reject=e})}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}var We=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(f){try{c(r.next(f))}catch(_){u(_)}}function h(f){try{c(r.throw(f))}catch(_){u(_)}}function c(f){f.done?o(f.value):i(f.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};class Je{constructor(t,e,r,i,o=a=>JSON.stringify(a),u=a=>JSON.parse(a)){this._persister=t,this._key=e,this._onMerge=i,this._loadedCbs=[],this._isLoading=!0,this.currentValue=r,this.toJSON=o,this.fromJSON=u,this._load()}_load(){return We(this,void 0,void 0,function*(){const t=this.fromJSON(yield this._persister.getItem(this._key));this._isLoading=!1,this._onMerge(t,this.currentValue);for(const e of this._loadedCbs)e()})}waitForLoaded(){return We(this,void 0,void 0,function*(){if(!this._isLoading)return;yield new Promise(e=>{this._loadedCbs.push(e)})})}set(t,e){this.currentValue=t(this.currentValue),this._isLoading||setTimeout(()=>{this._persister.setItem(this._key,this.toJSON(this.currentValue)),e&&e()},0)}}function yn(n,t=[]){n.forEach(e=>{const{data:r}=e,{"datalog-result":i}=r,{"join-rows":o}=i;for(const u of o)for(const a of u)t.push(a);yn(e["child-nodes"],t)})}function Ve(n){const t=[];return yn(n,t),t}function ci(n,t){return t instanceof Map?{__type:"m",entries:[...t.entries()]}:t}function li(n,t){return t&&typeof t=="object"&&t.__type==="m"?new Map(t.entries):t}function fi(n){return JSON.stringify(n,ci)}function di(n){return JSON.parse(n,li)}function hi(n){return Object.values(n.links).reduce((t,e)=>{var r,i,o,u;return(r=t[o=e.forward.on])!==null&&r!==void 0||(t[o]={}),t[e.forward.on][e.forward.label]={isForward:!0,isSingular:e.forward.has==="one",link:e},(i=t[u=e.reverse.on])!==null&&i!==void 0||(t[u]={}),t[e.reverse.on][e.reverse.label]={isForward:!1,isSingular:e.reverse.has==="one",link:e},t},{})}var X=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(u){u(o)})}return new(e||(e=Promise))(function(o,u){function a(f){try{c(r.next(f))}catch(_){u(_)}}function h(f){try{c(r.throw(f))}catch(_){u(_)}}function c(f){f.done?o(f.value):i(f.value).then(a,h)}c((r=r.apply(n,t||[])).next())})};const yt={CONNECTING:"connecting",OPENED:"opened",AUTHENTICATED:"authenticated",CLOSED:"closed",ERRORED:"errored"},pi=1,gi={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"},te="_instant_oauth_redirect",ee="currentUser";function yi(){return typeof window<"u"||typeof chrome<"u"}class vi{constructor(t,e=pn,r=gn){this._isOnline=!0,this._isShutdown=!1,this.status=yt.CONNECTING,this.queryCbs={},this.authCbs=[],this.attrsCbs=[],this.mutationErrorCbs=[],this.mutationDeferredStore=new Map,this._reconnectTimeoutId=null,this._reconnectTimeoutMs=0,this._localIdPromises={},this._errorMessage=null,this._oauthCallbackResponse=null,this._linkIndex=null,this._presence={},this._broadcastSubs={},this._currentUserCached={isLoading:!0,error:void 0,user:void 0},this._onMergeQuerySubs=(i,o)=>{const u=i||{},a=Object.assign({},o);Object.entries(o).forEach(([c,f])=>{var _;const C=(_=u==null?void 0:u[c])===null||_===void 0?void 0:_.result,L=f.result;C&&!L&&(a[c].result=C)}),Object.keys(u).filter(c=>!o[c]).slice(0,10).forEach(c=>{a[c]=u[c]}),this.querySubs.set(c=>a),this.notifyAll()},this._onMergePendingMutations=(i,o)=>{const u=new Map([...i.entries(),...o.entries()]);this.pendingMutations.set(h=>u),this._rewriteMutations(this.attrs,i).forEach((h,c)=>{!o.has(c)&&!h["tx-id"]&&this._sendMutation(c,h)})},this.getPreviousResult=i=>{var o,u,a;const h=_t(i),c=this._errorMessage,f=(a=(u=(o=this.querySubs)===null||o===void 0?void 0:o.currentValue)===null||u===void 0?void 0:u[h])===null||a===void 0?void 0:a.result;if(c)return{error:c};if(f)return this.dataForResult(i,f)},this.notifyOne=i=>{const o=this.queryCbs[i]||[];if(!o)return;const u=this._errorMessage;if(u){o.forEach(_=>_({error:u}));return}const{q:a,result:h,iqlResult:c}=this.querySubs.currentValue[i]||{};if(!h)return;const f=this.dataForResult(a,h);$t(f.data,c)||(this.querySubs.currentValue[i].iqlResult=h.data,o.forEach(_=>_(f)))},this.notifyQueryError=(i,o)=>{(this.queryCbs[i]||[]).forEach(a=>a({error:o}))},this.pushTx=i=>{try{const o=Ar(this.optimisticAttrs(),i);return this.pushOps(o)}catch(o){return this.pushOps([],o)}},this.pushOps=(i,o)=>{const u=Z(),a={op:"transact","tx-steps":i,error:o};this.pendingMutations.set(c=>(c.set(u,a),c));const h=new ai;return this.mutationDeferredStore.set(u,h),this._sendMutation(u,a),this.notifyAll(),h.promise},this._wsOnOpen=()=>{jt.info("[socket] connected"),this._setStatus(yt.OPENED),this.getCurrentUser().then(i=>{var o;this._trySend(Z(),{op:"init","app-id":this.config.appId,"refresh-token":(o=i.user)===null||o===void 0?void 0:o.refresh_token,"__admin-token":this.config.__adminToken})})},this._wsOnMessage=i=>{this._handleReceive(JSON.parse(i.data.toString()))},this._wsOnError=i=>{jt.error("[socket] error: ",i)},this._wsOnClose=()=>{if(this._setStatus(yt.CLOSED),this._isShutdown){jt.info("[socket-close] socket has been shut down and will not reconnect");return}jt.info("[socket-close] scheduling reconnect",this._reconnectTimeoutMs),setTimeout(()=>{if(this._reconnectTimeoutMs=Math.min(this._reconnectTimeoutMs+1e3,1e4),!this._isOnline){jt.info("[socket-close] we are offline, no need to start socket");return}this._startSocket()},this._reconnectTimeoutMs)},this.config=Object.assign(Object.assign({},gi),t),this.config.schema&&(this._linkIndex=hi(this.config.schema)),yi()&&(typeof BroadcastChannel=="function"&&(this._broadcastChannel=new BroadcastChannel("@instantdb"),this._broadcastChannel.addEventListener("message",i=>X(this,void 0,void 0,function*(){var o;if(((o=i.data)===null||o===void 0?void 0:o.type)==="auth"){const u=yield this.getCurrentUser();this.updateUser(u.user)}}))),this._oauthCallbackResponse=this._oauthLoginInit(),this._initStorage(e),this.getCurrentUser(),r.getIsOnline().then(i=>{this._isOnline=i,this._startSocket(),r.listen(o=>{o!==this._isOnline&&(this._isOnline=o,this._isOnline&&this._startSocket())})}))}_initStorage(t){this._persister=new t(`instant_${this.config.appId}_4`),this.querySubs=new Je(this._persister,"querySubs",{},this._onMergeQuerySubs,fi,di),this.pendingMutations=new Je(this._persister,"pendingMutations",new Map,this._onMergePendingMutations,e=>JSON.stringify([...e.entries()]),e=>new Map(JSON.parse(e)))}_finishTransaction(t,e,r,i){const o=this.mutationDeferredStore.get(r);this.mutationDeferredStore.delete(r),!o&&!t&&console.error("Mutation failed",Object.assign({status:e,clientId:r},i)),o&&(t?o.resolve({status:e,clientId:r}):o.reject(Object.assign({status:e,clientId:r},i)))}_setStatus(t,e){this.status=t,this._errorMessage=e}_cleanPendingMutations(t){this.pendingMutations.set(e=>{const r=new Map(e);return[...e.entries()].forEach(([i,o])=>{o["tx-id"]<=t&&r.delete(i)}),r})}_handleReceive(t){var e,r,i,o;const u=!!this.config.schema&&("cardinalityInference"in this.config?!!this.config.cardinalityInference:!0);switch(t.op){case"init-ok":this._setStatus(yt.AUTHENTICATED),this._reconnectTimeoutMs=0,this._setAttrs(t.attrs),this._flushPendingMessages(),this._sessionId=t["session-id"];break;case"add-query-ok":const{q:a,result:h,"processed-tx-id":c}=t;this._cleanPendingMutations(c);const f=_t(a),_=(r=(e=h==null?void 0:h[0])===null||e===void 0?void 0:e.data)===null||r===void 0?void 0:r["page-info"],C=(o=(i=h==null?void 0:h[0])===null||i===void 0?void 0:i.data)===null||o===void 0?void 0:o.aggregate,L=Ve(h),A=Ce(this.attrs,L,u,this._linkIndex);this.querySubs.set(M=>(M[f].result={store:A,pageInfo:_,aggregate:C},M)),this.notifyOne(f);break;case"refresh-ok":const{computations:k,attrs:m,"processed-tx-id":x}=t;this._cleanPendingMutations(x),this._setAttrs(m);const U=k.map(M=>{var q,V,J,F;const st=M["instaql-query"],at=M["instaql-result"],vt=_t(st),Tt=Ve(at),Ot=Ce(this.attrs,Tt,u,this._linkIndex),It=(V=(q=at==null?void 0:at[0])===null||q===void 0?void 0:q.data)===null||V===void 0?void 0:V["page-info"],Pt=(F=(J=at==null?void 0:at[0])===null||J===void 0?void 0:J.data)===null||F===void 0?void 0:F.aggregate;return{hash:vt,store:Ot,pageInfo:It,aggregate:Pt}});U.forEach(({hash:M,store:q,pageInfo:V,aggregate:J})=>{this.querySubs.set(F=>(F[M].result={store:q,pageInfo:V,aggregate:J},F))}),U.forEach(({hash:M})=>{this.notifyOne(M)});break;case"transact-ok":const{"client-event-id":I,"tx-id":j}=t,v=this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).get(I);if(!v)break;const S=Object.assign(Object.assign({},v),{"tx-id":j});this.pendingMutations.set(M=>(M.set(I,S),M)),this._finishTransaction(!0,"synced",I);const d=v["tx-steps"].filter(([M,...q])=>M==="add-attr").map(([M,q])=>q).concat(Object.values(this.attrs));this._setAttrs(d);break;case"refresh-presence":const g=t["room-id"];this._setPresencePeers(g,t.data),this._notifyPresenceSubs(g);break;case"server-broadcast":const l=t["room-id"],b=t.topic;this._notifyBroadcastSubs(l,b,t);break;case"join-room-ok":const w=t["room-id"],D=this._presence[w];D&&(D.isLoading=!1),this._notifyPresenceSubs(w);break;case"join-room-error":const B=t["room-id"],N=this._presence[B];N&&(N.error=t.error),this._notifyPresenceSubs(B);break;case"error":this._handleReceiveError(t);break}}_handleReceiveError(t){var e,r,i;const o=t["client-event-id"];if(this.pendingMutations.currentValue.get(o)){this.pendingMutations.set(_=>(_.delete(o),_)),this.notifyAll(),this.notifyAttrsSubs(),this.notifyMutationErrorSubs(t);const f={message:t.message,hint:t.hint};this._finishTransaction(!1,"error",o,f);return}const a=t.q||((e=t["original-event"])===null||e===void 0?void 0:e.q);if(a){this.querySubs.set(f=>{const _=_t(a);return delete f[_],f}),this.notifyQueryError(_t(a),{message:t.message||"Uh-oh, something went wrong. Ping Joe & Stopa."});return}if(((r=t["original-event"])===null||r===void 0?void 0:r.op)==="init"){if(t.type==="record-not-found"&&((i=t.hint)===null||i===void 0?void 0:i["record-type"])==="app-user"){this.changeCurrentUser(null);return}const f={message:t.message||"Uh-oh, something went wrong. Ping Joe & Stopa."};this._setStatus(yt.ERRORED,f),this.notifyAll();return}const c=Object.assign({},t);delete c.message,delete c.hint,console.error(t.message,c),t.hint&&console.error(`This error comes with some debugging information. Here it is: 
`,t.hint)}_setAttrs(t){this.attrs=t.reduce((e,r)=>(e[r.id]=r,e),{}),this.notifyAttrsSubs()}subscribeQuery(t,e){const r=Z(),i=_t(t);this.queryCbs[i]=this.queryCbs[i]||[],this.queryCbs[i].push(e),this.querySubs.set(u=>(u[i]=u[i]||{q:t,result:null,eventId:r},u)),this._trySendAuthed(r,{op:"add-query",q:t});const o=this.getPreviousResult(t);return o&&e(o),()=>{this.queryCbs[i]=this.queryCbs[i].filter(u=>u!==e)}}_rewriteMutations(t,e){if(!t)return e;const r=h=>{const[c,f,_]=h["forward-identity"];return tt(t,f,_)},i=h=>{const[c,f,_]=h["forward-identity"];return At(t,f,_)},o={attrIdMap:{},refSwapAttrIds:new Set},u=h=>{const c=[];for(const f of h){const[_]=f;if(_==="add-attr"){const[L,A]=f,k=r(A);if(k){o.attrIdMap[A.id]=k.id;continue}if(A["value-type"]==="ref"){const m=i(A);if(m){o.attrIdMap[A.id]=m.id,o.refSwapAttrIds.add(A.id);continue}}}const C=ar(o,f);c.push(C)}return c},a=new Map;for(const[h,c]of e.entries())a.set(h,Object.assign(Object.assign({},c),{"tx-steps":u(c["tx-steps"])}));return a}optimisticAttrs(){var t;const e=[...this.pendingMutations.currentValue.values()].flatMap(a=>a["tx-steps"]),r=new Set(e.filter(([a,h])=>a==="delete-attr").map(([a,h])=>h)),i=[];for(const[a,h]of e)if(a==="add-attr")i.push(h);else if(a==="update-attr"&&h.id&&(!((t=this.attrs)===null||t===void 0)&&t[h.id])){const c=Object.assign(Object.assign({},this.attrs[h.id]),h);i.push(c)}const o=[...Object.values(this.attrs||{}),...i].filter(a=>!r.has(a.id));return Object.fromEntries(o.map(a=>[a.id,a]))}dataForResult(t,{store:e,pageInfo:r,aggregate:i}){const u=[...this._rewriteMutations(e.attrs,this.pendingMutations.currentValue).values()].flatMap(c=>c["tx-steps"]),a=Jn(e,u);return Hr({store:a,pageInfo:r,aggregate:i},t)}notifyAll(){Object.keys(this.queryCbs).forEach(t=>{this.notifyOne(t)})}shutdown(){this._isShutdown=!0,this._ws.close()}_sendMutation(t,e){if(e.error){this._finishTransaction(!1,"error",t,{error:e.error,message:e.error.message}),this.pendingMutations.set(i=>(i.delete(t),i));return}if(this.status!==yt.AUTHENTICATED){this._finishTransaction(!0,"enqueued",t);return}const r=Math.max(5e3,this.pendingMutations.currentValue.size*5e3);this._isOnline?(this._trySend(t,e),setTimeout(()=>{this._finishTransaction(!0,"pending",t)},3e3),setTimeout(()=>{if(!this._isOnline)return;const i=this.pendingMutations.currentValue.get(t);i&&!i["tx-id"]&&(this.pendingMutations.set(o=>(o.delete(t),o)),this._finishTransaction(!1,"timeout",t),console.error("mutation timed out",i))},r)):this._finishTransaction(!0,"enqueued",t)}_flushPendingMessages(){Object.keys(this.queryCbs).map(u=>this.querySubs.currentValue[u]).filter(u=>u).forEach(({eventId:u,q:a})=>{this._trySendAuthed(u,{op:"add-query",q:a})}),this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).forEach((u,a)=>{u["tx-id"]||this._sendMutation(a,u)}),Object.keys(this._presence).forEach(u=>{this._trySendAuthed(Z(),{op:"join-room","room-id":u})}),Object.entries(this._presence).forEach(([u,{result:a}])=>{const h=a==null?void 0:a.user;h&&this._trySendAuthed(Z(),{op:"set-presence","room-id":u,data:h})})}_trySendAuthed(t,e){this.status===yt.AUTHENTICATED&&this._trySend(t,e)}_trySend(t,e){this._ws.readyState===pi&&this._ws.send(JSON.stringify(Object.assign({"client-event-id":t},e)))}_startSocket(){this._ws=new WebSocket(`${this.config.websocketURI}?app_id=${this.config.appId}`),this._ws.onopen=this._wsOnOpen,this._ws.onmessage=this._wsOnMessage,this._ws.onclose=this._wsOnClose}getLocalId(t){return X(this,void 0,void 0,function*(){const e=`localToken_${t}`,r=yield this._persister.getItem(e);if(r)return r;if(this._localIdPromises[e])return this._localIdPromises[e];const i=Z();return this._localIdPromises[e]=this._persister.setItem(e,i).then(()=>i),this._localIdPromises[e]})}_replaceUrlAfterOAuth(){if(typeof URL>"u")return;const t=new URL(window.location.href);if(t.searchParams.get(te)){const e=t.toString();t.searchParams.delete(te),t.searchParams.delete("code"),t.searchParams.delete("error");const r=t.pathname+(t.searchParams.size?"?"+t.searchParams:"")+t.hash;if(history.replaceState(history.state,"",r),typeof navigation=="object"&&typeof navigation.addEventListener=="function"&&typeof navigation.removeEventListener=="function"){let i=!1;const o=u=>{var a;i||(i=!0,navigation.removeEventListener("navigate",o),!u.userInitiated&&u.navigationType==="replace"&&((a=u.destination)===null||a===void 0?void 0:a.url)===e&&history.replaceState(history.state,"",r))};navigation.addEventListener("navigate",o)}}}_oauthLoginInit(){return X(this,void 0,void 0,function*(){var t,e,r,i;if(typeof window>"u"||typeof window.location>"u"||typeof URLSearchParams>"u")return null;const o=new URLSearchParams(window.location.search);if(!o.get(te))return null;const u=o.get("error");if(u)return this._replaceUrlAfterOAuth(),{error:{message:u}};const a=o.get("code");if(!a)return null;this._replaceUrlAfterOAuth();try{const{user:h}=yield qe({apiURI:this.config.apiURI,appId:this.config.appId,code:a});return this.setCurrentUser(h),null}catch(h){return((t=h==null?void 0:h.body)===null||t===void 0?void 0:t.type)==="record-not-found"&&((r=(e=h==null?void 0:h.body)===null||e===void 0?void 0:e.hint)===null||r===void 0?void 0:r["record-type"])==="app-oauth-code"&&(yield this._hasCurrentUser())?null:{error:{message:((i=h==null?void 0:h.body)===null||i===void 0?void 0:i.message)||"Error logging in."}}}})}_waitForOAuthCallbackResponse(){return X(this,void 0,void 0,function*(){return yield this._oauthCallbackResponse})}__subscribeMutationErrors(t){return this.mutationErrorCbs.push(t),()=>{this.mutationErrorCbs=this.mutationErrorCbs.filter(e=>e!==t)}}subscribeAuth(t){this.authCbs.push(t);const e=this._currentUserCached;e.isLoading||t(this._currentUserCached);let r=!1;return this.getCurrentUser().then(i=>{r||$t(i,e)||t(i)}),()=>{r=!0,this.authCbs=this.authCbs.filter(i=>i!==t)}}subscribeAttrs(t){return this.attrsCbs.push(t),this.attrs&&t(this.attrs),()=>{this.attrsCbs=this.attrsCbs.filter(e=>e!==t)}}notifyAuthSubs(t){this.authCbs.forEach(e=>e(t))}notifyMutationErrorSubs(t){this.mutationErrorCbs.forEach(e=>e(t))}notifyAttrsSubs(){if(!this.attrs)return;const t=this.optimisticAttrs();this.attrsCbs.forEach(e=>e(t))}setCurrentUser(t){return X(this,void 0,void 0,function*(){yield this._persister.setItem(ee,JSON.stringify(t))})}getCurrentUserCached(){return this._currentUserCached}getCurrentUser(){return X(this,void 0,void 0,function*(){const t=yield this._waitForOAuthCallbackResponse();if(t!=null&&t.error){const i={error:t.error,user:void 0};return this._currentUserCached=Object.assign({isLoading:!1},i),i}const e=yield this._persister.getItem(ee),r={user:JSON.parse(e),error:void 0};return this._currentUserCached=Object.assign({isLoading:!1},r),r})}_hasCurrentUser(){return X(this,void 0,void 0,function*(){const t=yield this._persister.getItem(ee);return JSON.parse(t)!=null})}changeCurrentUser(t){return X(this,void 0,void 0,function*(){var e;const{user:r}=yield this.getCurrentUser();if(!$t(r,t)){yield this.setCurrentUser(t),this.updateUser(t);try{(e=this._broadcastChannel)===null||e===void 0||e.postMessage({type:"auth"})}catch(i){console.error("Error posting message to broadcast channel",i)}}})}updateUser(t){const e={error:void 0,user:t};this._currentUserCached=Object.assign({isLoading:!1},e),this.querySubs.set(r=>(Object.keys(r).forEach(i=>{delete r[i].result}),r)),this._reconnectTimeoutMs=0,this._ws.close(),this._oauthCallbackResponse=null,this.notifyAuthSubs(e)}sendMagicCode({email:t}){return Gr({apiURI:this.config.apiURI,appId:this.config.appId,email:t})}signInWithMagicCode(t){return X(this,arguments,void 0,function*({email:e,code:r}){const i=yield Xr({apiURI:this.config.apiURI,appId:this.config.appId,email:e,code:r});return this.changeCurrentUser(i.user),i})}signInWithCustomToken(t){return X(this,void 0,void 0,function*(){const e=yield Zr({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:t});this.changeCurrentUser(e.user)})}signOut(){return X(this,void 0,void 0,function*(){var t;const e=yield this.getCurrentUser(),r=(t=e==null?void 0:e.user)===null||t===void 0?void 0:t.refresh_token;if(r)try{yield ei({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:r})}catch{}this.changeCurrentUser(null)})}createAuthorizationURL({clientName:t,redirectURL:e}){const{apiURI:r,appId:i}=this.config;return`${r}/runtime/oauth/start?app_id=${i}&client_name=${t}&redirect_uri=${e}`}exchangeCodeForToken(t){return X(this,arguments,void 0,function*({code:e,codeVerifier:r}){const i=yield qe({apiURI:this.config.apiURI,appId:this.config.appId,code:e,codeVerifier:r});return this.changeCurrentUser(i.user),i})}issuerURI(){const{apiURI:t,appId:e}=this.config;return`${t}/runtime/${e}`}signInWithIdToken(t){return X(this,arguments,void 0,function*({idToken:e,clientName:r,nonce:i}){var o;const u=yield this.getCurrentUser(),a=(o=u==null?void 0:u.user)===null||o===void 0?void 0:o.refresh_token,h=yield ti({apiURI:this.config.apiURI,appId:this.config.appId,idToken:e,clientName:r,nonce:i,refreshToken:a});return this.changeCurrentUser(h.user),h})}joinRoom(t){return this._trySendAuthed(Z(),{op:"join-room","room-id":t}),()=>{this._cleanupRoom(t)}}_cleanupRoom(t){var e,r,i;!(!((r=(e=this._presence[t])===null||e===void 0?void 0:e.handlers)===null||r===void 0)&&r.length)&&!Object.keys((i=this._broadcastSubs[t])!==null&&i!==void 0?i:{}).length&&(delete this._presence[t],delete this._broadcastSubs[t],this._trySendAuthed(Z(),{op:"leave-room","room-id":t}))}getPresence(t,e,r={}){const i=this._presence[e];return!i||!i.result?null:Object.assign(Object.assign({},si(i.result,r)),{isLoading:i.isLoading,error:i.error})}publishPresence(t,e,r){var i,o;const u=Object.assign(Object.assign({},(o=(i=this._presence[e])===null||i===void 0?void 0:i.result)===null||o===void 0?void 0:o.user),r);this._trySendAuthed(Z(),{op:"set-presence","room-id":e,data:u}),this._presence[e]=this._presence[e]||{},this._presence[e].result=this._presence[e].result||{},this._presence[e].result.user=u,this._notifyPresenceSubs(e)}subscribePresence(t,e,r,i){const o=this.joinRoom(e),u=Object.assign(Object.assign({},r),{roomId:e,cb:i,prev:null});return this._presence[e]=this._presence[e]||{},this._presence[e].isLoading=!0,this._presence[e].handlers=this._presence[e].handlers||[],this._presence[e].handlers.push(u),this._notifyPresenceSub(e,u),()=>{var a,h,c;this._presence[e].handlers=(c=(h=(a=this._presence[e])===null||a===void 0?void 0:a.handlers)===null||h===void 0?void 0:h.filter(f=>f!==u))!==null&&c!==void 0?c:[],o()}}_notifyPresenceSubs(t){var e,r;(r=(e=this._presence[t])===null||e===void 0?void 0:e.handlers)===null||r===void 0||r.forEach(i=>{this._notifyPresenceSub(t,i)})}_notifyPresenceSub(t,e){const r=this.getPresence("",t,e);r&&(e.prev&&!ui(r,e.prev)||(e.prev=r,e.cb(r)))}_setPresencePeers(t,e){const r=Object.assign({},e);delete r[this._sessionId];const i=Object.fromEntries(Object.entries(r).map(([o,u])=>[o,u.data]));this._presence[t]=this._presence[t]||{},this._presence[t].result=this._presence[t].result||{},this._presence[t].result.peers=i}publishTopic({roomType:t,roomId:e,topic:r,data:i}){this._trySendAuthed(Z(),{op:"client-broadcast","room-id":e,roomType:t,topic:r,data:i})}subscribeTopic(t,e,r){const i=this.joinRoom(t);return this._broadcastSubs[t]=this._broadcastSubs[t]||{},this._broadcastSubs[t][e]=this._broadcastSubs[t][e]||[],this._broadcastSubs[t][e].push(r),this._presence[t]=this._presence[t]||{},()=>{this._broadcastSubs[t][e]=this._broadcastSubs[t][e].filter(o=>o!==r),this._broadcastSubs[t][e].length||delete this._broadcastSubs[t][e],i()}}_notifyBroadcastSubs(t,e,r){var i,o,u;(u=(o=(i=this._broadcastSubs)===null||i===void 0?void 0:i[t])===null||o===void 0?void 0:o[e])===null||u===void 0||u.forEach(a=>{var h,c,f,_,C,L;const A=(h=r.data)===null||h===void 0?void 0:h.data,k=r.data["peer-id"]===this._sessionId?(f=(c=this._presence[t])===null||c===void 0?void 0:c.result)===null||f===void 0?void 0:f.user:(L=(C=(_=this._presence[t])===null||_===void 0?void 0:_.result)===null||C===void 0?void 0:C.peers)===null||L===void 0?void 0:L[r.data["peer-id"]];return a(A,k)})}upload(t,e){return X(this,void 0,void 0,function*(){var r;const i=yield this.getCurrentUser(),o=(r=i==null?void 0:i.user)===null||r===void 0?void 0:r.refresh_token,u=t||e.name,a=yield ni({apiURI:this.config.apiURI,appId:this.config.appId,fileName:u,refreshToken:o});return yield ri(a,e)})}getDownloadUrl(t){return X(this,void 0,void 0,function*(){var e;const r=yield this.getCurrentUser(),i=(e=r==null?void 0:r.user)===null||e===void 0?void 0:e.refresh_token;return yield ii({apiURI:this.config.apiURI,appId:this.config.appId,path:t,refreshToken:i})})}deleteFile(t){return X(this,void 0,void 0,function*(){var e;const r=yield this.getCurrentUser(),i=(e=r==null?void 0:r.user)===null||e===void 0?void 0:e.refresh_token;return yield oi({apiURI:this.config.apiURI,appId:this.config.appId,path:t,refreshToken:i})})}}let Nt;function bi(n){Nt==null||Nt.dispose();const t=Si(),e=wi(u),r=mi(_i(n));function i(c){var f;c.source===r.element.contentWindow&&((f=c.data)===null||f===void 0?void 0:f.type)==="close"&&t.isVisible()&&u()}function o(c){const f=c.shiftKey&&c.ctrlKey&&c.key==="0",_=c.key==="Escape"||c.key==="Esc";(f||_)&&u()}function u(){t.isVisible()?t.element.style.display="none":(t.element.style.display="block",t.element.contains(r.element)||t.element.appendChild(r.element))}function a(){t.element.remove(),e.element.remove(),removeEventListener("keydown",o),removeEventListener("message",i)}function h(){document.body.appendChild(t.element),document.body.appendChild(e.element),addEventListener("keydown",o),addEventListener("message",i),Nt={dispose:a}}return h()}function _i(n){return`${window.DEV_DEVTOOL?"http://localhost:3000":"https://instantdb.com"}/_devtool?appId=${n}`}function mi(n){const t=document.createElement("iframe");return t.src=n,Object.assign(t.style,{width:"100%",height:"100%",borderRadius:"4px",backgroundColor:"white",border:"none"}),{element:t}}function wi(n){const t=`
    <svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect width="512" height="512" fill="black"/>
      <rect x="97.0973" y="91.3297" width="140" height="330" fill="white"/>
    </svg>
  `,e=document.createElement("button");return e.innerHTML=t,Object.assign(e.style,{position:"fixed",bottom:"24px",left:"24px",height:"32px",width:"32px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0",margin:"0",border:"none",cursor:"pointer"}),e.addEventListener("click",n),{element:e}}function Si(){const n=document.createElement("div");Object.assign(n.style,{position:"fixed",bottom:"24px",right:"24px",left:"60px",top:"72px",display:"block",borderRadius:"4px",border:"1px #ccc solid",boxShadow:"0px 0px 8px #00000044",backgroundColor:"#eee",zIndex:"999990"}),n.style.display="none";function t(){return n.style.display!=="none"}return{element:n,isVisible:t}}const Ai=!0,Ei={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"};function Oi(){var n;return globalThis.__instantDbStore=(n=globalThis.__instantDbStore)!==null&&n!==void 0?n:{},globalThis.__instantDbStore}const ce=Oi();function Ii(n,t,e){return ji(n)}function ji(n,t,e){const r=ce[n.appId];if(r)return r;const i=new vi(Object.assign(Object.assign({},Ei),n),pn,gn),o=new ki(i);return ce[n.appId]=o,typeof window<"u"&&typeof window.location<"u"&&("devtool"in n?n.devtool:Ai)&&window.location.hostname==="localhost"&&!globalThis._nodevtool&&bi(n.appId),o}class ki{constructor(t){this.tx=sn(),this._reactor=t,this.auth=new xi(this._reactor),this.storage=new Ci(this._reactor)}transact(t){return this._reactor.pushTx(t)}getLocalId(t){return this._reactor.getLocalId(t)}subscribeQuery(t,e){return this._reactor.subscribeQuery(t,e)}subscribeAuth(t){return this._reactor.subscribeAuth(t)}joinRoom(t="_defaultRoomType",e="_defaultRoomId"){return{leaveRoom:this._reactor.joinRoom(e),subscribeTopic:(i,o)=>this._reactor.subscribeTopic(e,i,o),subscribePresence:(i,o)=>this._reactor.subscribePresence(t,e,i,o),publishTopic:(i,o)=>this._reactor.publishTopic({roomType:t,roomId:e,topic:i,data:o}),publishPresence:i=>this._reactor.publishPresence(t,e,i),getPresence:i=>this._reactor.getPresence(t,e,i)}}shutdown(){delete ce[this._reactor.config.appId],this._reactor.shutdown()}}class xi{constructor(t){this.db=t,this.sendMagicCode=e=>this.db.sendMagicCode(e),this.signInWithMagicCode=e=>this.db.signInWithMagicCode(e),this.signInWithToken=e=>this.db.signInWithCustomToken(e),this.createAuthorizationURL=e=>this.db.createAuthorizationURL(e),this.signInWithIdToken=e=>this.db.signInWithIdToken(e),this.exchangeOAuthCode=e=>this.db.exchangeCodeForToken(e),this.issuerURI=()=>this.db.issuerURI(),this.signOut=()=>this.db.signOut()}}class Ci{constructor(t){this.db=t,this.upload=(e,r)=>this.db.upload(e,r),this.put=this.upload,this.getDownloadUrl=e=>this.db.getDownloadUrl(e),this.delete=e=>this.db.deleteFile(e)}}const Ui="bcc500de-07a9-4fde-9025-c87906e63bf3",Mi=Ii({appId:Ui});Mi.subscribeQuery({blog:{}},n=>{if(n.error){Pi(n.error.message);return}n.data&&(Ti(n.data),console.log(n.data))});const le=document.getElementById("app");function Ti(n){le.innerHTML="",console.log(n);const{blog:t}=n;console.log(t);const{todos:e}=n;console.log(e);const r=`
    ${Bi()}
    <main class="blog__page">
      ${Ri()}
      ${Li(t)}
    </main>
  `;le.innerHTML=r,document.querySelectorAll(".blog__post").forEach(i=>{i.addEventListener("click",function(){const o=this.getAttribute("id");Ni(t,o)})})}function Pi(n){le.innerHTML=`
    <div>${n}</div>
  `}function Li(n){return`
    <section class="blog__section">
        ${n.map(t=>`
          <article class="blog__post" id="blogID${t.id}">
            <h2 class="blog__header">${t.title}</h2>
            <h3 class="blog__subheader">${t.subtitle}</h3>
            <p class="blog__paragraph">${Di(t.content)}</p>
            <p class="blog__date">Date: ${t.postDate}</p>
          </article>
        `).join("")}
    </section>
  `}function Ri(){return`
    <div class="card">
      <div id="tab" class="inner-box">
        <fieldset 
            id="tab-toggle" 
            class="tab-options" 
        >

        <p class="form-para">
            <input 
            type="radio" 
            name="tool-toggle" 
            id="pc-tools" 
            value="pc-tools"
            class="tool-toggle"
            checked>
            <label for="pc-tools">stories</label>
        </p>

        <p class="form-para">
            <input 
            type="radio" 
            name="tool-toggle" 
            id="rr-tools" 
            value="rr-tools"
            class="tool-toggle">
            <label for="rr-tools">musings</label>
        </p>
        <p class="form-para">
            <input 
            type="radio" 
            name="tool-toggle" 
            id="dice-tools" 
            value="dice-tools"
            class="tool-toggle">
            <label for="dice-tools">games</label>
        </p>
        </fieldset>
      </div>
    </div>
  `}function Bi(){return`
    <header id="header">
        <button class="h-btns" id="home" onclick="window.location.href='#';">home</button>
        <button class="h-btns" id="ezd6" onclick="window.location.href='EZD6/ez-index.html';">portfolio</button>
        <button class="h-btns" id="itch" onclick="window.location.href='itch.html';">store</button>
        <button class="h-btns" id="substack" onclick="window.location.href='substack.html';">blog</button>
    </header>
  `}function Di(n){const t=n[1],e=document.createElement("div");e.innerHTML=t;const r=e.textContent||e.innerText||"",i=r.split(" ");return i.length>20?i.slice(0,20).join(" ")+"...":r}function Ni(n,t){console.log("Article clicked:",t);const e=n.find(r=>"blogID"+r.id===t);e?(console.log("Selected post:",e),$i(e.content)):console.log("Post not found!")}function $i(n){if(!document.getElementById("myNav")){const t=`
    <div id="myNav" class="blogPost__overlay">
        
        <div class="blogPost__overlay_content" id="postContent">
          <a href="javascript:void(0)" class="blog__closebtn_top">&times;</a>
          ${n.map(e=>e).join("")}
        </div>
        <div class="blogPost__overlay_footer">
            <button class="like-btn">Like</button>
            <button class="scroll-top-btn">To Top</button>
            <button class="blog__closebtn_bottom">&times;</button>
        </div>
    </div>
  `;document.body.insertAdjacentHTML("beforeend",t),document.querySelector(".blog__closebtn_top").addEventListener("click",ze),document.querySelector(".blog__closebtn_bottom").addEventListener("click",ze),document.querySelector(".like-btn").addEventListener("click",Fi),document.querySelector(".scroll-top-btn").addEventListener("click",qi)}document.getElementById("myNav").style.width="100%"}function ze(){const n=document.getElementById("myNav");n&&n.remove()}function qi(){const n=document.querySelector(".blogPost__overlay_content");n&&n.scrollIntoView({behavior:"smooth",block:"start"})}function Fi(){console.log("User added a like")}function Wi(){document.querySelectorAll("*").forEach(t=>{const e=window.getComputedStyle(t);e.position==="fixed"&&e.bottom==="24px"&&e.left==="24px"&&e.height==="32px"&&e.width==="32px"&&e.display==="flex"&&e.alignItems==="center"&&(t.remove(),console.log("Element removed:",t))})}document.addEventListener("DOMContentLoaded",function(){Wi()});
