(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const xt=(()=>{let n=!1;typeof window<"u"&&typeof window.localStorage<"u"?n=!!window.localStorage.getItem("loggingEnabled"):n=!1;function t(e){return(...r)=>{n&&console[e](...r)}}return{info:t("info"),debug:t("debug"),error:t("error")}})();function Lt(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Qe={exports:{}};(function(n,t){(function(e){n.exports=e()})(function(){return function e(r,i,o){function a(c,d){if(!i[c]){if(!r[c]){var m=typeof Lt=="function"&&Lt;if(!d&&m)return m(c,!0);if(u)return u(c,!0);throw new Error("Cannot find module '"+c+"'")}d=i[c]={exports:{}},r[c][0].call(d.exports,function(C){var U=r[c][1][C];return a(U||C)},d,d.exports,e,r,i,o)}return i[c].exports}for(var u=typeof Lt=="function"&&Lt,h=0;h<o.length;h++)a(o[h]);return a}({1:[function(e,r,i){(function(o,a,u,h,c,d,m,C,U){var E=e("crypto");function x(v,S){S=P(v,S);var f;return(f=S.algorithm!=="passthrough"?E.createHash(S.algorithm):new L).write===void 0&&(f.write=f.update,f.end=f.update),O(S,f).dispatch(v),f.update||f.end(""),f.digest?f.digest(S.encoding==="buffer"?void 0:S.encoding):(v=f.read(),S.encoding!=="buffer"?v.toString(S.encoding):v)}(i=r.exports=x).sha1=function(v){return x(v)},i.keys=function(v){return x(v,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},i.MD5=function(v){return x(v,{algorithm:"md5",encoding:"hex"})},i.keysMD5=function(v){return x(v,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var _=E.getHashes?E.getHashes().slice():["sha1","md5"],j=(_.push("passthrough"),["buffer","hex","binary","base64"]);function P(v,S){var f={};if(f.algorithm=(S=S||{}).algorithm||"sha1",f.encoding=S.encoding||"hex",f.excludeValues=!!S.excludeValues,f.algorithm=f.algorithm.toLowerCase(),f.encoding=f.encoding.toLowerCase(),f.ignoreUnknown=S.ignoreUnknown===!0,f.respectType=S.respectType!==!1,f.respectFunctionNames=S.respectFunctionNames!==!1,f.respectFunctionProperties=S.respectFunctionProperties!==!1,f.unorderedArrays=S.unorderedArrays===!0,f.unorderedSets=S.unorderedSets!==!1,f.unorderedObjects=S.unorderedObjects!==!1,f.replacer=S.replacer||void 0,f.excludeKeys=S.excludeKeys||void 0,v===void 0)throw new Error("Object argument required.");for(var g=0;g<_.length;++g)_[g].toLowerCase()===f.algorithm.toLowerCase()&&(f.algorithm=_[g]);if(_.indexOf(f.algorithm)===-1)throw new Error('Algorithm "'+f.algorithm+'"  not supported. supported values: '+_.join(", "));if(j.indexOf(f.encoding)===-1&&f.algorithm!=="passthrough")throw new Error('Encoding "'+f.encoding+'"  not supported. supported values: '+j.join(", "));return f}function k(v){if(typeof v=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(v))!=null}function O(v,S,f){f=f||[];function g(l){return S.update?S.update(l,"utf8"):S.write(l,"utf8")}return{dispatch:function(l){return this["_"+((l=v.replacer?v.replacer(l):l)===null?"null":typeof l)](l)},_object:function(l){var b,w=Object.prototype.toString.call(l),N=/\[object (.*)\]/i.exec(w);if(N=(N=N?N[1]:"unknown:["+w+"]").toLowerCase(),0<=(w=f.indexOf(l)))return this.dispatch("[CIRCULAR:"+w+"]");if(f.push(l),u!==void 0&&u.isBuffer&&u.isBuffer(l))return g("buffer:"),g(l);if(N==="object"||N==="function"||N==="asyncfunction")return w=Object.keys(l),v.unorderedObjects&&(w=w.sort()),v.respectType===!1||k(l)||w.splice(0,0,"prototype","__proto__","constructor"),v.excludeKeys&&(w=w.filter(function(R){return!v.excludeKeys(R)})),g("object:"+w.length+":"),b=this,w.forEach(function(R){b.dispatch(R),g(":"),v.excludeValues||b.dispatch(l[R]),g(",")});if(!this["_"+N]){if(v.ignoreUnknown)return g("["+N+"]");throw new Error('Unknown object type "'+N+'"')}this["_"+N](l)},_array:function(l,R){R=R!==void 0?R:v.unorderedArrays!==!1;var w=this;if(g("array:"+l.length+":"),!R||l.length<=1)return l.forEach(function(D){return w.dispatch(D)});var N=[],R=l.map(function(D){var M=new L,F=f.slice();return O(v,M,F).dispatch(D),N=N.concat(F.slice(f.length)),M.read().toString()});return f=f.concat(N),R.sort(),this._array(R,!1)},_date:function(l){return g("date:"+l.toJSON())},_symbol:function(l){return g("symbol:"+l.toString())},_error:function(l){return g("error:"+l.toString())},_boolean:function(l){return g("bool:"+l.toString())},_string:function(l){g("string:"+l.length+":"),g(l.toString())},_function:function(l){g("fn:"),k(l)?this.dispatch("[native]"):this.dispatch(l.toString()),v.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(l.name)),v.respectFunctionProperties&&this._object(l)},_number:function(l){return g("number:"+l.toString())},_xml:function(l){return g("xml:"+l.toString())},_null:function(){return g("Null")},_undefined:function(){return g("Undefined")},_regexp:function(l){return g("regex:"+l.toString())},_uint8array:function(l){return g("uint8array:"),this.dispatch(Array.prototype.slice.call(l))},_uint8clampedarray:function(l){return g("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(l))},_int8array:function(l){return g("int8array:"),this.dispatch(Array.prototype.slice.call(l))},_uint16array:function(l){return g("uint16array:"),this.dispatch(Array.prototype.slice.call(l))},_int16array:function(l){return g("int16array:"),this.dispatch(Array.prototype.slice.call(l))},_uint32array:function(l){return g("uint32array:"),this.dispatch(Array.prototype.slice.call(l))},_int32array:function(l){return g("int32array:"),this.dispatch(Array.prototype.slice.call(l))},_float32array:function(l){return g("float32array:"),this.dispatch(Array.prototype.slice.call(l))},_float64array:function(l){return g("float64array:"),this.dispatch(Array.prototype.slice.call(l))},_arraybuffer:function(l){return g("arraybuffer:"),this.dispatch(new Uint8Array(l))},_url:function(l){return g("url:"+l.toString())},_map:function(l){return g("map:"),l=Array.from(l),this._array(l,v.unorderedSets!==!1)},_set:function(l){return g("set:"),l=Array.from(l),this._array(l,v.unorderedSets!==!1)},_file:function(l){return g("file:"),this.dispatch([l.name,l.size,l.type,l.lastModfied])},_blob:function(){if(v.ignoreUnknown)return g("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return g("domwindow")},_bigint:function(l){return g("bigint:"+l.toString())},_process:function(){return g("process")},_timer:function(){return g("timer")},_pipe:function(){return g("pipe")},_tcp:function(){return g("tcp")},_udp:function(){return g("udp")},_tty:function(){return g("tty")},_statwatcher:function(){return g("statwatcher")},_securecontext:function(){return g("securecontext")},_connection:function(){return g("connection")},_zlib:function(){return g("zlib")},_context:function(){return g("context")},_nodescript:function(){return g("nodescript")},_httpparser:function(){return g("httpparser")},_dataview:function(){return g("dataview")},_signal:function(){return g("signal")},_fsevent:function(){return g("fsevent")},_tlswrap:function(){return g("tlswrap")}}}function L(){return{buf:"",write:function(v){this.buf+=v},end:function(v){this.buf+=v},read:function(){return this.buf}}}i.writeToStream=function(v,S,f){return f===void 0&&(f=S,S={}),O(S=P(v,S),f).dispatch(v)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(e,r,i){(function(o,a,u,h,c,d,m,C,U){(function(E){var x=typeof Uint8Array<"u"?Uint8Array:Array,_=43,j=47,P=48,k=97,O=65,L=45,v=95;function S(f){return f=f.charCodeAt(0),f===_||f===L?62:f===j||f===v?63:f<P?-1:f<P+10?f-P+26+26:f<O+26?f-O:f<k+26?f-k+26:void 0}E.toByteArray=function(f){var g,l;if(0<f.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var b=f.length,b=f.charAt(b-2)==="="?2:f.charAt(b-1)==="="?1:0,w=new x(3*f.length/4-b),N=0<b?f.length-4:f.length,R=0;function D(M){w[R++]=M}for(g=0;g<N;g+=4,0)D((16711680&(l=S(f.charAt(g))<<18|S(f.charAt(g+1))<<12|S(f.charAt(g+2))<<6|S(f.charAt(g+3))))>>16),D((65280&l)>>8),D(255&l);return b==2?D(255&(l=S(f.charAt(g))<<2|S(f.charAt(g+1))>>4)):b==1&&(D((l=S(f.charAt(g))<<10|S(f.charAt(g+1))<<4|S(f.charAt(g+2))>>2)>>8&255),D(255&l)),w},E.fromByteArray=function(f){var g,l,b,w,N=f.length%3,R="";function D(M){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(M)}for(g=0,b=f.length-N;g<b;g+=3)l=(f[g]<<16)+(f[g+1]<<8)+f[g+2],R+=D((w=l)>>18&63)+D(w>>12&63)+D(w>>6&63)+D(63&w);switch(N){case 1:R=(R+=D((l=f[f.length-1])>>2))+D(l<<4&63)+"==";break;case 2:R=(R=(R+=D((l=(f[f.length-2]<<8)+f[f.length-1])>>10))+D(l>>4&63))+D(l<<2&63)+"="}return R}})(i===void 0?this.base64js={}:i)}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(e,r,i){(function(o,a,_,h,c,d,m,C,U){var E=e("base64-js"),x=e("ieee754");function _(s,p,y){if(!(this instanceof _))return new _(s,p,y);var I,A,B,$,H=typeof s;if(p==="base64"&&H=="string")for(s=($=s).trim?$.trim():$.replace(/^\s+|\s+$/g,"");s.length%4!=0;)s+="=";if(H=="number")I=z(s);else if(H=="string")I=_.byteLength(s,p);else{if(H!="object")throw new Error("First argument needs to be a number, array or string.");I=z(s.length)}if(_._useTypedArrays?A=_._augment(new Uint8Array(I)):((A=this).length=I,A._isBuffer=!0),_._useTypedArrays&&typeof s.byteLength=="number")A._set(s);else if(J($=s)||_.isBuffer($)||$&&typeof $=="object"&&typeof $.length=="number")for(B=0;B<I;B++)_.isBuffer(s)?A[B]=s.readUInt8(B):A[B]=s[B];else if(H=="string")A.write(s,0,p);else if(H=="number"&&!_._useTypedArrays&&!y)for(B=0;B<I;B++)A[B]=0;return A}function j(s,p,y,I){return _._charsWritten=vt(function(A){for(var B=[],$=0;$<A.length;$++)B.push(255&A.charCodeAt($));return B}(p),s,y,I)}function P(s,p,y,I){return _._charsWritten=vt(function(A){for(var B,$,H=[],Y=0;Y<A.length;Y++)$=A.charCodeAt(Y),B=$>>8,$=$%256,H.push($),H.push(B);return H}(p),s,y,I)}function k(s,p,y){var I="";y=Math.min(s.length,y);for(var A=p;A<y;A++)I+=String.fromCharCode(s[A]);return I}function O(s,p,y,B){B||(T(typeof y=="boolean","missing or invalid endian"),T(p!=null,"missing offset"),T(p+1<s.length,"Trying to read beyond buffer length"));var A,B=s.length;if(!(B<=p))return y?(A=s[p],p+1<B&&(A|=s[p+1]<<8)):(A=s[p]<<8,p+1<B&&(A|=s[p+1])),A}function L(s,p,y,B){B||(T(typeof y=="boolean","missing or invalid endian"),T(p!=null,"missing offset"),T(p+3<s.length,"Trying to read beyond buffer length"));var A,B=s.length;if(!(B<=p))return y?(p+2<B&&(A=s[p+2]<<16),p+1<B&&(A|=s[p+1]<<8),A|=s[p],p+3<B&&(A+=s[p+3]<<24>>>0)):(p+1<B&&(A=s[p+1]<<16),p+2<B&&(A|=s[p+2]<<8),p+3<B&&(A|=s[p+3]),A+=s[p]<<24>>>0),A}function v(s,p,y,I){if(I||(T(typeof y=="boolean","missing or invalid endian"),T(p!=null,"missing offset"),T(p+1<s.length,"Trying to read beyond buffer length")),!(s.length<=p))return I=O(s,p,y,!0),32768&I?-1*(65535-I+1):I}function S(s,p,y,I){if(I||(T(typeof y=="boolean","missing or invalid endian"),T(p!=null,"missing offset"),T(p+3<s.length,"Trying to read beyond buffer length")),!(s.length<=p))return I=L(s,p,y,!0),2147483648&I?-1*(4294967295-I+1):I}function f(s,p,y,I){return I||(T(typeof y=="boolean","missing or invalid endian"),T(p+3<s.length,"Trying to read beyond buffer length")),x.read(s,p,y,23,4)}function g(s,p,y,I){return I||(T(typeof y=="boolean","missing or invalid endian"),T(p+7<s.length,"Trying to read beyond buffer length")),x.read(s,p,y,52,8)}function l(s,p,y,I,A){if(A||(T(p!=null,"missing value"),T(typeof I=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+1<s.length,"trying to write beyond buffer length"),kt(p,65535)),A=s.length,!(A<=y))for(var B=0,$=Math.min(A-y,2);B<$;B++)s[y+B]=(p&255<<8*(I?B:1-B))>>>8*(I?B:1-B)}function b(s,p,y,I,A){if(A||(T(p!=null,"missing value"),T(typeof I=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+3<s.length,"trying to write beyond buffer length"),kt(p,4294967295)),A=s.length,!(A<=y))for(var B=0,$=Math.min(A-y,4);B<$;B++)s[y+B]=p>>>8*(I?B:3-B)&255}function w(s,p,y,I,A){A||(T(p!=null,"missing value"),T(typeof I=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+1<s.length,"Trying to write beyond buffer length"),Ot(p,32767,-32768)),s.length<=y||l(s,0<=p?p:65535+p+1,y,I,A)}function N(s,p,y,I,A){A||(T(p!=null,"missing value"),T(typeof I=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+3<s.length,"Trying to write beyond buffer length"),Ot(p,2147483647,-2147483648)),s.length<=y||b(s,0<=p?p:4294967295+p+1,y,I,A)}function R(s,p,y,I,A){A||(T(p!=null,"missing value"),T(typeof I=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+3<s.length,"Trying to write beyond buffer length"),Ut(p,34028234663852886e22,-34028234663852886e22)),s.length<=y||x.write(s,p,y,I,23,4)}function D(s,p,y,I,A){A||(T(p!=null,"missing value"),T(typeof I=="boolean","missing or invalid endian"),T(y!=null,"missing offset"),T(y+7<s.length,"Trying to write beyond buffer length"),Ut(p,17976931348623157e292,-17976931348623157e292)),s.length<=y||x.write(s,p,y,I,52,8)}i.Buffer=_,i.SlowBuffer=_,i.INSPECT_MAX_BYTES=50,_.poolSize=8192,_._useTypedArrays=function(){try{var s=new ArrayBuffer(0),p=new Uint8Array(s);return p.foo=function(){return 42},p.foo()===42&&typeof p.subarray=="function"}catch{return!1}}(),_.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},_.isBuffer=function(s){return!(s==null||!s._isBuffer)},_.byteLength=function(s,p){var y;switch(s+="",p||"utf8"){case"hex":y=s.length/2;break;case"utf8":case"utf-8":y=st(s).length;break;case"ascii":case"binary":case"raw":y=s.length;break;case"base64":y=ut(s).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":y=2*s.length;break;default:throw new Error("Unknown encoding")}return y},_.concat=function(s,p){if(T(J(s),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),s.length===0)return new _(0);if(s.length===1)return s[0];if(typeof p!="number")for(A=p=0;A<s.length;A++)p+=s[A].length;for(var y=new _(p),I=0,A=0;A<s.length;A++){var B=s[A];B.copy(y,I),I+=B.length}return y},_.prototype.write=function(s,p,y,I){isFinite(p)?isFinite(y)||(I=y,y=void 0):(Y=I,I=p,p=y,y=Y),p=Number(p)||0;var A,B,$,H,Y=this.length-p;switch((!y||Y<(y=Number(y)))&&(y=Y),I=String(I||"utf8").toLowerCase()){case"hex":A=function(at,et,nt,K){nt=Number(nt)||0;var V=at.length-nt;(!K||V<(K=Number(K)))&&(K=V),T((V=et.length)%2==0,"Invalid hex string"),V/2<K&&(K=V/2);for(var bt=0;bt<K;bt++){var Ee=parseInt(et.substr(2*bt,2),16);T(!isNaN(Ee),"Invalid hex string"),at[nt+bt]=Ee}return _._charsWritten=2*bt,bt}(this,s,p,y);break;case"utf8":case"utf-8":B=this,$=p,H=y,A=_._charsWritten=vt(st(s),B,$,H);break;case"ascii":case"binary":A=j(this,s,p,y);break;case"base64":B=this,$=p,H=y,A=_._charsWritten=vt(ut(s),B,$,H);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":A=P(this,s,p,y);break;default:throw new Error("Unknown encoding")}return A},_.prototype.toString=function(s,p,y){var I,A,B,$,H=this;if(s=String(s||"utf8").toLowerCase(),p=Number(p)||0,(y=y!==void 0?Number(y):H.length)===p)return"";switch(s){case"hex":I=function(Y,at,et){var nt=Y.length;(!at||at<0)&&(at=0),(!et||et<0||nt<et)&&(et=nt);for(var K="",V=at;V<et;V++)K+=q(Y[V]);return K}(H,p,y);break;case"utf8":case"utf-8":I=function(Y,at,et){var nt="",K="";et=Math.min(Y.length,et);for(var V=at;V<et;V++)Y[V]<=127?(nt+=Bt(K)+String.fromCharCode(Y[V]),K=""):K+="%"+Y[V].toString(16);return nt+Bt(K)}(H,p,y);break;case"ascii":case"binary":I=k(H,p,y);break;case"base64":A=H,$=y,I=(B=p)===0&&$===A.length?E.fromByteArray(A):E.fromByteArray(A.slice(B,$));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":I=function(Y,at,et){for(var nt=Y.slice(at,et),K="",V=0;V<nt.length;V+=2)K+=String.fromCharCode(nt[V]+256*nt[V+1]);return K}(H,p,y);break;default:throw new Error("Unknown encoding")}return I},_.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},_.prototype.copy=function(s,p,y,I){if(p=p||0,(I=I||I===0?I:this.length)!==(y=y||0)&&s.length!==0&&this.length!==0){T(y<=I,"sourceEnd < sourceStart"),T(0<=p&&p<s.length,"targetStart out of bounds"),T(0<=y&&y<this.length,"sourceStart out of bounds"),T(0<=I&&I<=this.length,"sourceEnd out of bounds"),I>this.length&&(I=this.length);var A=(I=s.length-p<I-y?s.length-p+y:I)-y;if(A<100||!_._useTypedArrays)for(var B=0;B<A;B++)s[B+p]=this[B+y];else s._set(this.subarray(y,y+A),p)}},_.prototype.slice=function(s,p){var y=this.length;if(s=F(s,y,0),p=F(p,y,y),_._useTypedArrays)return _._augment(this.subarray(s,p));for(var I=p-s,A=new _(I,void 0,!0),B=0;B<I;B++)A[B]=this[B+s];return A},_.prototype.get=function(s){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(s)},_.prototype.set=function(s,p){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(s,p)},_.prototype.readUInt8=function(s,p){if(p||(T(s!=null,"missing offset"),T(s<this.length,"Trying to read beyond buffer length")),!(s>=this.length))return this[s]},_.prototype.readUInt16LE=function(s,p){return O(this,s,!0,p)},_.prototype.readUInt16BE=function(s,p){return O(this,s,!1,p)},_.prototype.readUInt32LE=function(s,p){return L(this,s,!0,p)},_.prototype.readUInt32BE=function(s,p){return L(this,s,!1,p)},_.prototype.readInt8=function(s,p){if(p||(T(s!=null,"missing offset"),T(s<this.length,"Trying to read beyond buffer length")),!(s>=this.length))return 128&this[s]?-1*(255-this[s]+1):this[s]},_.prototype.readInt16LE=function(s,p){return v(this,s,!0,p)},_.prototype.readInt16BE=function(s,p){return v(this,s,!1,p)},_.prototype.readInt32LE=function(s,p){return S(this,s,!0,p)},_.prototype.readInt32BE=function(s,p){return S(this,s,!1,p)},_.prototype.readFloatLE=function(s,p){return f(this,s,!0,p)},_.prototype.readFloatBE=function(s,p){return f(this,s,!1,p)},_.prototype.readDoubleLE=function(s,p){return g(this,s,!0,p)},_.prototype.readDoubleBE=function(s,p){return g(this,s,!1,p)},_.prototype.writeUInt8=function(s,p,y){y||(T(s!=null,"missing value"),T(p!=null,"missing offset"),T(p<this.length,"trying to write beyond buffer length"),kt(s,255)),p>=this.length||(this[p]=s)},_.prototype.writeUInt16LE=function(s,p,y){l(this,s,p,!0,y)},_.prototype.writeUInt16BE=function(s,p,y){l(this,s,p,!1,y)},_.prototype.writeUInt32LE=function(s,p,y){b(this,s,p,!0,y)},_.prototype.writeUInt32BE=function(s,p,y){b(this,s,p,!1,y)},_.prototype.writeInt8=function(s,p,y){y||(T(s!=null,"missing value"),T(p!=null,"missing offset"),T(p<this.length,"Trying to write beyond buffer length"),Ot(s,127,-128)),p>=this.length||(0<=s?this.writeUInt8(s,p,y):this.writeUInt8(255+s+1,p,y))},_.prototype.writeInt16LE=function(s,p,y){w(this,s,p,!0,y)},_.prototype.writeInt16BE=function(s,p,y){w(this,s,p,!1,y)},_.prototype.writeInt32LE=function(s,p,y){N(this,s,p,!0,y)},_.prototype.writeInt32BE=function(s,p,y){N(this,s,p,!1,y)},_.prototype.writeFloatLE=function(s,p,y){R(this,s,p,!0,y)},_.prototype.writeFloatBE=function(s,p,y){R(this,s,p,!1,y)},_.prototype.writeDoubleLE=function(s,p,y){D(this,s,p,!0,y)},_.prototype.writeDoubleBE=function(s,p,y){D(this,s,p,!1,y)},_.prototype.fill=function(s,p,y){if(p=p||0,y=y||this.length,T(typeof(s=typeof(s=s||0)=="string"?s.charCodeAt(0):s)=="number"&&!isNaN(s),"value is not a number"),T(p<=y,"end < start"),y!==p&&this.length!==0){T(0<=p&&p<this.length,"start out of bounds"),T(0<=y&&y<=this.length,"end out of bounds");for(var I=p;I<y;I++)this[I]=s}},_.prototype.inspect=function(){for(var s=[],p=this.length,y=0;y<p;y++)if(s[y]=q(this[y]),y===i.INSPECT_MAX_BYTES){s[y+1]="...";break}return"<Buffer "+s.join(" ")+">"},_.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(_._useTypedArrays)return new _(this).buffer;for(var s=new Uint8Array(this.length),p=0,y=s.length;p<y;p+=1)s[p]=this[p];return s.buffer};var M=_.prototype;function F(s,p,y){return typeof s!="number"?y:p<=(s=~~s)?p:0<=s||0<=(s+=p)?s:0}function z(s){return(s=~~Math.ceil(+s))<0?0:s}function J(s){return(Array.isArray||function(p){return Object.prototype.toString.call(p)==="[object Array]"})(s)}function q(s){return s<16?"0"+s.toString(16):s.toString(16)}function st(s){for(var p=[],y=0;y<s.length;y++){var I=s.charCodeAt(y);if(I<=127)p.push(s.charCodeAt(y));else for(var A=y,B=(55296<=I&&I<=57343&&y++,encodeURIComponent(s.slice(A,y+1)).substr(1).split("%")),$=0;$<B.length;$++)p.push(parseInt(B[$],16))}return p}function ut(s){return E.toByteArray(s)}function vt(s,p,y,I){for(var A=0;A<I&&!(A+y>=p.length||A>=s.length);A++)p[A+y]=s[A];return A}function Bt(s){try{return decodeURIComponent(s)}catch{return"�"}}function kt(s,p){T(typeof s=="number","cannot write a non-number as a number"),T(0<=s,"specified a negative value for writing an unsigned value"),T(s<=p,"value is larger than maximum value for type"),T(Math.floor(s)===s,"value has a fractional component")}function Ot(s,p,y){T(typeof s=="number","cannot write a non-number as a number"),T(s<=p,"value larger than maximum allowed value"),T(y<=s,"value smaller than minimum allowed value"),T(Math.floor(s)===s,"value has a fractional component")}function Ut(s,p,y){T(typeof s=="number","cannot write a non-number as a number"),T(s<=p,"value larger than maximum allowed value"),T(y<=s,"value smaller than minimum allowed value")}function T(s,p){if(!s)throw new Error(p||"Failed assertion")}_._augment=function(s){return s._isBuffer=!0,s._get=s.get,s._set=s.set,s.get=M.get,s.set=M.set,s.write=M.write,s.toString=M.toString,s.toLocaleString=M.toString,s.toJSON=M.toJSON,s.copy=M.copy,s.slice=M.slice,s.readUInt8=M.readUInt8,s.readUInt16LE=M.readUInt16LE,s.readUInt16BE=M.readUInt16BE,s.readUInt32LE=M.readUInt32LE,s.readUInt32BE=M.readUInt32BE,s.readInt8=M.readInt8,s.readInt16LE=M.readInt16LE,s.readInt16BE=M.readInt16BE,s.readInt32LE=M.readInt32LE,s.readInt32BE=M.readInt32BE,s.readFloatLE=M.readFloatLE,s.readFloatBE=M.readFloatBE,s.readDoubleLE=M.readDoubleLE,s.readDoubleBE=M.readDoubleBE,s.writeUInt8=M.writeUInt8,s.writeUInt16LE=M.writeUInt16LE,s.writeUInt16BE=M.writeUInt16BE,s.writeUInt32LE=M.writeUInt32LE,s.writeUInt32BE=M.writeUInt32BE,s.writeInt8=M.writeInt8,s.writeInt16LE=M.writeInt16LE,s.writeInt16BE=M.writeInt16BE,s.writeInt32LE=M.writeInt32LE,s.writeInt32BE=M.writeInt32BE,s.writeFloatLE=M.writeFloatLE,s.writeFloatBE=M.writeFloatBE,s.writeDoubleLE=M.writeDoubleLE,s.writeDoubleBE=M.writeDoubleBE,s.fill=M.fill,s.inspect=M.inspect,s.toArrayBuffer=M.toArrayBuffer,s}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(e,r,i){(function(o,a,E,h,c,d,m,C,U){var E=e("buffer").Buffer,x=4,_=new E(x);_.fill(0),r.exports={hash:function(j,P,k,O){for(var L=P(function(l,b){l.length%x!=0&&(w=l.length+(x-l.length%x),l=E.concat([l,_],w));for(var w,N=[],R=b?l.readInt32BE:l.readInt32LE,D=0;D<l.length;D+=x)N.push(R.call(l,D));return N}(j=E.isBuffer(j)?j:new E(j),O),8*j.length),P=O,v=new E(k),S=P?v.writeInt32BE:v.writeInt32LE,f=0;f<L.length;f++)S.call(v,L[f],4*f,!0);return v}}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(e,r,i){(function(o,a,E,h,c,d,m,C,U){var E=e("buffer").Buffer,x=e("./sha"),_=e("./sha256"),j=e("./rng"),P={sha1:x,sha256:_,md5:e("./md5")},k=64,O=new E(k);function L(l,b){var w=P[l=l||"sha1"],N=[];return w||v("algorithm:",l,"is not yet supported"),{update:function(R){return E.isBuffer(R)||(R=new E(R)),N.push(R),R.length,this},digest:function(R){var D=E.concat(N),D=b?function(M,F,z){E.isBuffer(F)||(F=new E(F)),E.isBuffer(z)||(z=new E(z)),F.length>k?F=M(F):F.length<k&&(F=E.concat([F,O],k));for(var J=new E(k),q=new E(k),st=0;st<k;st++)J[st]=54^F[st],q[st]=92^F[st];return z=M(E.concat([J,z])),M(E.concat([q,z]))}(w,b,D):w(D);return N=null,R?D.toString(R):D}}}function v(){var l=[].slice.call(arguments).join(" ");throw new Error([l,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}O.fill(0),i.createHash=function(l){return L(l)},i.createHmac=L,i.randomBytes=function(l,b){if(!b||!b.call)return new E(j(l));try{b.call(this,void 0,new E(j(l)))}catch(w){b(w)}};var S,f=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],g=function(l){i[l]=function(){v("sorry,",l,"is not implemented yet")}};for(S in f)g(f[S])}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(e,r,i){(function(o,a,u,h,c,d,m,C,U){var E=e("./helpers");function x(v,S){v[S>>5]|=128<<S%32,v[14+(S+64>>>9<<4)]=S;for(var f=1732584193,g=-271733879,l=-1732584194,b=271733878,w=0;w<v.length;w+=16){var N=f,R=g,D=l,M=b,f=j(f,g,l,b,v[w+0],7,-680876936),b=j(b,f,g,l,v[w+1],12,-389564586),l=j(l,b,f,g,v[w+2],17,606105819),g=j(g,l,b,f,v[w+3],22,-1044525330);f=j(f,g,l,b,v[w+4],7,-176418897),b=j(b,f,g,l,v[w+5],12,1200080426),l=j(l,b,f,g,v[w+6],17,-1473231341),g=j(g,l,b,f,v[w+7],22,-45705983),f=j(f,g,l,b,v[w+8],7,1770035416),b=j(b,f,g,l,v[w+9],12,-1958414417),l=j(l,b,f,g,v[w+10],17,-42063),g=j(g,l,b,f,v[w+11],22,-1990404162),f=j(f,g,l,b,v[w+12],7,1804603682),b=j(b,f,g,l,v[w+13],12,-40341101),l=j(l,b,f,g,v[w+14],17,-1502002290),f=P(f,g=j(g,l,b,f,v[w+15],22,1236535329),l,b,v[w+1],5,-165796510),b=P(b,f,g,l,v[w+6],9,-1069501632),l=P(l,b,f,g,v[w+11],14,643717713),g=P(g,l,b,f,v[w+0],20,-373897302),f=P(f,g,l,b,v[w+5],5,-701558691),b=P(b,f,g,l,v[w+10],9,38016083),l=P(l,b,f,g,v[w+15],14,-660478335),g=P(g,l,b,f,v[w+4],20,-405537848),f=P(f,g,l,b,v[w+9],5,568446438),b=P(b,f,g,l,v[w+14],9,-1019803690),l=P(l,b,f,g,v[w+3],14,-187363961),g=P(g,l,b,f,v[w+8],20,1163531501),f=P(f,g,l,b,v[w+13],5,-1444681467),b=P(b,f,g,l,v[w+2],9,-51403784),l=P(l,b,f,g,v[w+7],14,1735328473),f=k(f,g=P(g,l,b,f,v[w+12],20,-1926607734),l,b,v[w+5],4,-378558),b=k(b,f,g,l,v[w+8],11,-2022574463),l=k(l,b,f,g,v[w+11],16,1839030562),g=k(g,l,b,f,v[w+14],23,-35309556),f=k(f,g,l,b,v[w+1],4,-1530992060),b=k(b,f,g,l,v[w+4],11,1272893353),l=k(l,b,f,g,v[w+7],16,-155497632),g=k(g,l,b,f,v[w+10],23,-1094730640),f=k(f,g,l,b,v[w+13],4,681279174),b=k(b,f,g,l,v[w+0],11,-358537222),l=k(l,b,f,g,v[w+3],16,-722521979),g=k(g,l,b,f,v[w+6],23,76029189),f=k(f,g,l,b,v[w+9],4,-640364487),b=k(b,f,g,l,v[w+12],11,-421815835),l=k(l,b,f,g,v[w+15],16,530742520),f=O(f,g=k(g,l,b,f,v[w+2],23,-995338651),l,b,v[w+0],6,-198630844),b=O(b,f,g,l,v[w+7],10,1126891415),l=O(l,b,f,g,v[w+14],15,-1416354905),g=O(g,l,b,f,v[w+5],21,-57434055),f=O(f,g,l,b,v[w+12],6,1700485571),b=O(b,f,g,l,v[w+3],10,-1894986606),l=O(l,b,f,g,v[w+10],15,-1051523),g=O(g,l,b,f,v[w+1],21,-2054922799),f=O(f,g,l,b,v[w+8],6,1873313359),b=O(b,f,g,l,v[w+15],10,-30611744),l=O(l,b,f,g,v[w+6],15,-1560198380),g=O(g,l,b,f,v[w+13],21,1309151649),f=O(f,g,l,b,v[w+4],6,-145523070),b=O(b,f,g,l,v[w+11],10,-1120210379),l=O(l,b,f,g,v[w+2],15,718787259),g=O(g,l,b,f,v[w+9],21,-343485551),f=L(f,N),g=L(g,R),l=L(l,D),b=L(b,M)}return Array(f,g,l,b)}function _(v,S,f,g,l,b){return L((S=L(L(S,v),L(g,b)))<<l|S>>>32-l,f)}function j(v,S,f,g,l,b,w){return _(S&f|~S&g,v,S,l,b,w)}function P(v,S,f,g,l,b,w){return _(S&g|f&~g,v,S,l,b,w)}function k(v,S,f,g,l,b,w){return _(S^f^g,v,S,l,b,w)}function O(v,S,f,g,l,b,w){return _(f^(S|~g),v,S,l,b,w)}function L(v,S){var f=(65535&v)+(65535&S);return(v>>16)+(S>>16)+(f>>16)<<16|65535&f}r.exports=function(v){return E.hash(v,x,16)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(e,r,i){(function(o,a,u,h,c,d,m,C,U){r.exports=function(E){for(var x,_=new Array(E),j=0;j<E;j++)!(3&j)&&(x=4294967296*Math.random()),_[j]=x>>>((3&j)<<3)&255;return _}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(e,r,i){(function(o,a,u,h,c,d,m,C,U){var E=e("./helpers");function x(P,k){P[k>>5]|=128<<24-k%32,P[15+(k+64>>9<<4)]=k;for(var O,L,v,S=Array(80),f=1732584193,g=-271733879,l=-1732584194,b=271733878,w=-1009589776,N=0;N<P.length;N+=16){for(var R=f,D=g,M=l,F=b,z=w,J=0;J<80;J++){S[J]=J<16?P[N+J]:j(S[J-3]^S[J-8]^S[J-14]^S[J-16],1);var q=_(_(j(f,5),(q=g,L=l,v=b,(O=J)<20?q&L|~q&v:!(O<40)&&O<60?q&L|q&v|L&v:q^L^v)),_(_(w,S[J]),(O=J)<20?1518500249:O<40?1859775393:O<60?-1894007588:-899497514)),w=b,b=l,l=j(g,30),g=f,f=q}f=_(f,R),g=_(g,D),l=_(l,M),b=_(b,F),w=_(w,z)}return Array(f,g,l,b,w)}function _(P,k){var O=(65535&P)+(65535&k);return(P>>16)+(k>>16)+(O>>16)<<16|65535&O}function j(P,k){return P<<k|P>>>32-k}r.exports=function(P){return E.hash(P,x,20,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(e,r,i){(function(o,a,u,h,c,d,m,C,U){function E(k,O){var L=(65535&k)+(65535&O);return(k>>16)+(O>>16)+(L>>16)<<16|65535&L}function x(k,O){var L,v=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),S=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),f=new Array(64);k[O>>5]|=128<<24-O%32,k[15+(O+64>>9<<4)]=O;for(var g,l,b=0;b<k.length;b+=16){for(var w=S[0],N=S[1],R=S[2],D=S[3],M=S[4],F=S[5],z=S[6],J=S[7],q=0;q<64;q++)f[q]=q<16?k[q+b]:E(E(E((l=f[q-2],j(l,17)^j(l,19)^P(l,10)),f[q-7]),(l=f[q-15],j(l,7)^j(l,18)^P(l,3))),f[q-16]),L=E(E(E(E(J,j(l=M,6)^j(l,11)^j(l,25)),M&F^~M&z),v[q]),f[q]),g=E(j(g=w,2)^j(g,13)^j(g,22),w&N^w&R^N&R),J=z,z=F,F=M,M=E(D,L),D=R,R=N,N=w,w=E(L,g);S[0]=E(w,S[0]),S[1]=E(N,S[1]),S[2]=E(R,S[2]),S[3]=E(D,S[3]),S[4]=E(M,S[4]),S[5]=E(F,S[5]),S[6]=E(z,S[6]),S[7]=E(J,S[7])}return S}var _=e("./helpers"),j=function(k,O){return k>>>O|k<<32-O},P=function(k,O){return k>>>O};r.exports=function(k){return _.hash(k,x,32,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(e,r,i){(function(o,a,u,h,c,d,m,C,U){i.read=function(E,x,_,j,b){var k,O,L=8*b-j-1,v=(1<<L)-1,S=v>>1,f=-7,g=_?b-1:0,l=_?-1:1,b=E[x+g];for(g+=l,k=b&(1<<-f)-1,b>>=-f,f+=L;0<f;k=256*k+E[x+g],g+=l,f-=8);for(O=k&(1<<-f)-1,k>>=-f,f+=j;0<f;O=256*O+E[x+g],g+=l,f-=8);if(k===0)k=1-S;else{if(k===v)return O?NaN:1/0*(b?-1:1);O+=Math.pow(2,j),k-=S}return(b?-1:1)*O*Math.pow(2,k-j)},i.write=function(E,x,_,j,P,w){var O,L,v=8*w-P-1,S=(1<<v)-1,f=S>>1,g=P===23?Math.pow(2,-24)-Math.pow(2,-77):0,l=j?0:w-1,b=j?1:-1,w=x<0||x===0&&1/x<0?1:0;for(x=Math.abs(x),isNaN(x)||x===1/0?(L=isNaN(x)?1:0,O=S):(O=Math.floor(Math.log(x)/Math.LN2),x*(j=Math.pow(2,-O))<1&&(O--,j*=2),2<=(x+=1<=O+f?g/j:g*Math.pow(2,1-f))*j&&(O++,j/=2),S<=O+f?(L=0,O=S):1<=O+f?(L=(x*j-1)*Math.pow(2,P),O+=f):(L=x*Math.pow(2,f-1)*Math.pow(2,P),O=0));8<=P;E[_+l]=255&L,l+=b,L/=256,P-=8);for(O=O<<P|L,v+=P;0<v;E[_+l]=255&O,l+=b,O/=256,v-=8);E[_+l-b]|=128*w}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(e,r,i){(function(o,a,u,h,c,d,m,C,U){var E,x,_;function j(){}(o=r.exports={}).nextTick=(x=typeof window<"u"&&window.setImmediate,_=typeof window<"u"&&window.postMessage&&window.addEventListener,x?function(P){return window.setImmediate(P)}:_?(E=[],window.addEventListener("message",function(P){var k=P.source;k!==window&&k!==null||P.data!=="process-tick"||(P.stopPropagation(),0<E.length&&E.shift()())},!0),function(P){E.push(P),window.postMessage("process-tick","*")}):function(P){setTimeout(P,0)}),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=j,o.addListener=j,o.once=j,o.off=j,o.removeListener=j,o.removeAllListeners=j,o.emit=j,o.binding=function(P){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(P){throw new Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(Qe);var Sn=Qe.exports;const mt=Sn.MD5;function it(n){for(var t=arguments.length,e=Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+n+(e.length?" "+e.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function St(n){return!!n&&!!n[W]}function ht(n){return!!n&&(function(t){if(!t||typeof t!="object")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;var r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object||typeof r=="function"&&Function.toString.call(r)===Mn}(n)||Array.isArray(n)||!!n[Ce]||!!n.constructor[Ce]||he(n)||pe(n))}function Et(n,t,e){e===void 0&&(e=!1),It(n)===0?(e?Object.keys:me)(n).forEach(function(r){e&&typeof r=="symbol"||t(r,n[r],n)}):n.forEach(function(r,i){return t(i,r,n)})}function It(n){var t=n[W];return t?t.i>3?t.i-4:t.i:Array.isArray(n)?1:he(n)?2:pe(n)?3:0}function oe(n,t){return It(n)===2?n.has(t):Object.prototype.hasOwnProperty.call(n,t)}function En(n,t){return It(n)===2?n.get(t):n[t]}function Xe(n,t,e){var r=It(n);r===2?n.set(t,e):r===3?(n.delete(t),n.add(e)):n[t]=e}function An(n,t){return n===t?n!==0||1/n==1/t:n!=n&&t!=t}function he(n){return Cn&&n instanceof Map}function pe(n){return Pn&&n instanceof Set}function G(n){return n.o||n.t}function ge(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var t=Tn(n);delete t[W];for(var e=me(t),r=0;r<e.length;r++){var i=e[r],o=t[i];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),t)}function ye(n,t){return t===void 0&&(t=!1),ve(n)||St(n)||!ht(n)||(It(n)>1&&(n.set=n.add=n.clear=n.delete=In),Object.freeze(n),t&&Et(n,function(e,r){return ye(r,!0)},!0)),n}function In(){it(2)}function ve(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function lt(n){var t=ae[n];return t||it(18,n),t}function kn(n,t){ae[n]||(ae[n]=t)}function Jt(){return Pt}function Zt(n,t){t&&(lt("Patches"),n.u=[],n.s=[],n.v=t)}function zt(n){se(n),n.p.forEach(On),n.p=null}function se(n){n===Pt&&(Pt=n.l)}function Ae(n){return Pt={p:[],l:Pt,h:n,m:!0,_:0}}function On(n){var t=n[W];t.i===0||t.i===1?t.j():t.O=!0}function te(n,t){t._=t.p.length;var e=t.p[0],r=n!==void 0&&n!==e;return t.h.g||lt("ES5").S(t,n,r),r?(e[W].P&&(zt(t),it(4)),ht(n)&&(n=Ht(t,n),t.l||Vt(t,n)),t.u&&lt("Patches").M(e[W].t,n,t.u,t.s)):n=Ht(t,e,[]),zt(t),t.u&&t.v(t.u,t.s),n!==Ze?n:void 0}function Ht(n,t,e){if(ve(t))return t;var r=t[W];if(!r)return Et(t,function(o,a){return Ie(n,r,t,o,a,e)},!0),t;if(r.A!==n)return t;if(!r.P)return Vt(n,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=r.i===4||r.i===5?r.o=ge(r.k):r.o;Et(r.i===3?new Set(i):i,function(o,a){return Ie(n,r,i,o,a,e)}),Vt(n,i,!1),e&&n.u&&lt("Patches").R(r,e,n.u,n.s)}return r.o}function Ie(n,t,e,r,i,o){if(St(i)){var a=Ht(n,i,o&&t&&t.i!==3&&!oe(t.D,r)?o.concat(r):void 0);if(Xe(e,r,a),!St(a))return;n.m=!1}if(ht(i)&&!ve(i)){if(!n.h.F&&n._<1)return;Ht(n,i),t&&t.A.l||Vt(n,i)}}function Vt(n,t,e){e===void 0&&(e=!1),n.h.F&&n.m&&ye(t,e)}function ee(n,t){var e=n[W];return(e?G(e):n)[t]}function ke(n,t){if(t in n)for(var e=Object.getPrototypeOf(n);e;){var r=Object.getOwnPropertyDescriptor(e,t);if(r)return r;e=Object.getPrototypeOf(e)}}function dt(n){n.P||(n.P=!0,n.l&&dt(n.l))}function ne(n){n.o||(n.o=ge(n.t))}function Ct(n,t,e){var r=he(t)?lt("MapSet").N(t,e):pe(t)?lt("MapSet").T(t,e):n.g?function(i,o){var a=Array.isArray(i),u={i:a?1:0,A:o?o.A:Jt(),P:!1,I:!1,D:{},l:o,t:i,k:null,o:null,j:null,C:!1},h=u,c=ue;a&&(h=[u],c=jt);var d=Proxy.revocable(h,c),m=d.revoke,C=d.proxy;return u.k=C,u.j=m,C}(t,e):lt("ES5").J(t,e);return(e?e.A:Jt()).p.push(r),r}function xn(n){return St(n)||it(22,n),function t(e){if(!ht(e))return e;var r,i=e[W],o=It(e);if(i){if(!i.P&&(i.i<4||!lt("ES5").K(i)))return i.t;i.I=!0,r=Oe(e,o),i.I=!1}else r=Oe(e,o);return Et(r,function(a,u){i&&En(i.t,a)===u||Xe(r,a,t(u))}),o===3?new Set(r):r}(n)}function Oe(n,t){switch(t){case 2:return new Map(n);case 3:return Array.from(n)}return ge(n)}function jn(){function n(u,h){function c(){this.constructor=u}i(u,h),u.prototype=(c.prototype=h.prototype,new c)}function t(u){u.o||(u.D=new Map,u.o=new Map(u.t))}function e(u){u.o||(u.o=new Set,u.t.forEach(function(h){if(ht(h)){var c=Ct(u.A.h,h,u);u.p.set(h,c),u.o.add(c)}else u.o.add(h)}))}function r(u){u.O&&it(3,JSON.stringify(G(u)))}var i=function(u,h){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var m in d)d.hasOwnProperty(m)&&(c[m]=d[m])})(u,h)},o=function(){function u(c,d){return this[W]={i:2,l:d,A:d?d.A:Jt(),P:!1,I:!1,o:void 0,D:void 0,t:c,k:this,C:!1,O:!1},this}n(u,Map);var h=u.prototype;return Object.defineProperty(h,"size",{get:function(){return G(this[W]).size}}),h.has=function(c){return G(this[W]).has(c)},h.set=function(c,d){var m=this[W];return r(m),G(m).has(c)&&G(m).get(c)===d||(t(m),dt(m),m.D.set(c,!0),m.o.set(c,d),m.D.set(c,!0)),this},h.delete=function(c){if(!this.has(c))return!1;var d=this[W];return r(d),t(d),dt(d),d.t.has(c)?d.D.set(c,!1):d.D.delete(c),d.o.delete(c),!0},h.clear=function(){var c=this[W];r(c),G(c).size&&(t(c),dt(c),c.D=new Map,Et(c.t,function(d){c.D.set(d,!1)}),c.o.clear())},h.forEach=function(c,d){var m=this;G(this[W]).forEach(function(C,U){c.call(d,m.get(U),U,m)})},h.get=function(c){var d=this[W];r(d);var m=G(d).get(c);if(d.I||!ht(m)||m!==d.t.get(c))return m;var C=Ct(d.A.h,m,d);return t(d),d.o.set(c,C),C},h.keys=function(){return G(this[W]).keys()},h.values=function(){var c,d=this,m=this.keys();return(c={})[Rt]=function(){return d.values()},c.next=function(){var C=m.next();return C.done?C:{done:!1,value:d.get(C.value)}},c},h.entries=function(){var c,d=this,m=this.keys();return(c={})[Rt]=function(){return d.entries()},c.next=function(){var C=m.next();if(C.done)return C;var U=d.get(C.value);return{done:!1,value:[C.value,U]}},c},h[Rt]=function(){return this.entries()},u}(),a=function(){function u(c,d){return this[W]={i:3,l:d,A:d?d.A:Jt(),P:!1,I:!1,o:void 0,t:c,k:this,p:new Map,O:!1,C:!1},this}n(u,Set);var h=u.prototype;return Object.defineProperty(h,"size",{get:function(){return G(this[W]).size}}),h.has=function(c){var d=this[W];return r(d),d.o?!!d.o.has(c)||!(!d.p.has(c)||!d.o.has(d.p.get(c))):d.t.has(c)},h.add=function(c){var d=this[W];return r(d),this.has(c)||(e(d),dt(d),d.o.add(c)),this},h.delete=function(c){if(!this.has(c))return!1;var d=this[W];return r(d),e(d),dt(d),d.o.delete(c)||!!d.p.has(c)&&d.o.delete(d.p.get(c))},h.clear=function(){var c=this[W];r(c),G(c).size&&(e(c),dt(c),c.o.clear())},h.values=function(){var c=this[W];return r(c),e(c),c.o.values()},h.entries=function(){var c=this[W];return r(c),e(c),c.o.entries()},h.keys=function(){return this.values()},h[Rt]=function(){return this.values()},h.forEach=function(c,d){for(var m=this.values(),C=m.next();!C.done;)c.call(d,C.value,C.value,this),C=m.next()},u}();kn("MapSet",{N:function(u,h){return new o(u,h)},T:function(u,h){return new a(u,h)}})}var xe,Pt,be=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Cn=typeof Map<"u",Pn=typeof Set<"u",je=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Ze=be?Symbol.for("immer-nothing"):((xe={})["immer-nothing"]=!0,xe),Ce=be?Symbol.for("immer-draftable"):"__$immer_draftable",W=be?Symbol.for("immer-state"):"__$immer_state",Rt=typeof Symbol<"u"&&Symbol.iterator||"@@iterator",Mn=""+Object.prototype.constructor,me=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Tn=Object.getOwnPropertyDescriptors||function(n){var t={};return me(n).forEach(function(e){t[e]=Object.getOwnPropertyDescriptor(n,e)}),t},ae={},ue={get:function(n,t){if(t===W)return n;var e=G(n);if(!oe(e,t))return function(i,o,a){var u,h=ke(o,a);return h?"value"in h?h.value:(u=h.get)===null||u===void 0?void 0:u.call(i.k):void 0}(n,e,t);var r=e[t];return n.I||!ht(r)?r:r===ee(n.t,t)?(ne(n),n.o[t]=Ct(n.A.h,r,n)):r},has:function(n,t){return t in G(n)},ownKeys:function(n){return Reflect.ownKeys(G(n))},set:function(n,t,e){var r=ke(G(n),t);if(r!=null&&r.set)return r.set.call(n.k,e),!0;if(!n.P){var i=ee(G(n),t),o=i==null?void 0:i[W];if(o&&o.t===e)return n.o[t]=e,n.D[t]=!1,!0;if(An(e,i)&&(e!==void 0||oe(n.t,t)))return!0;ne(n),dt(n)}return n.o[t]===e&&typeof e!="number"&&(e!==void 0||t in n.o)||(n.o[t]=e,n.D[t]=!0,!0)},deleteProperty:function(n,t){return ee(n.t,t)!==void 0||t in n.t?(n.D[t]=!1,ne(n),dt(n)):delete n.D[t],n.o&&delete n.o[t],!0},getOwnPropertyDescriptor:function(n,t){var e=G(n),r=Reflect.getOwnPropertyDescriptor(e,t);return r&&{writable:!0,configurable:n.i!==1||t!=="length",enumerable:r.enumerable,value:e[t]}},defineProperty:function(){it(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){it(12)}},jt={};Et(ue,function(n,t){jt[n]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),jt.deleteProperty=function(n,t){return jt.set.call(this,n,t,void 0)},jt.set=function(n,t,e){return ue.set.call(this,n[0],t,e,n[0])};var Bn=function(){function n(e){var r=this;this.g=je,this.F=!0,this.produce=function(i,o,a){if(typeof i=="function"&&typeof o!="function"){var u=o;o=i;var h=r;return function(x){var _=this;x===void 0&&(x=u);for(var j=arguments.length,P=Array(j>1?j-1:0),k=1;k<j;k++)P[k-1]=arguments[k];return h.produce(x,function(O){var L;return(L=o).call.apply(L,[_,O].concat(P))})}}var c;if(typeof o!="function"&&it(6),a!==void 0&&typeof a!="function"&&it(7),ht(i)){var d=Ae(r),m=Ct(r,i,void 0),C=!0;try{c=o(m),C=!1}finally{C?zt(d):se(d)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(x){return Zt(d,a),te(x,d)},function(x){throw zt(d),x}):(Zt(d,a),te(c,d))}if(!i||typeof i!="object"){if((c=o(i))===void 0&&(c=i),c===Ze&&(c=void 0),r.F&&ye(c,!0),a){var U=[],E=[];lt("Patches").M(i,c,U,E),a(U,E)}return c}it(21,i)},this.produceWithPatches=function(i,o){if(typeof i=="function")return function(c){for(var d=arguments.length,m=Array(d>1?d-1:0),C=1;C<d;C++)m[C-1]=arguments[C];return r.produceWithPatches(c,function(U){return i.apply(void 0,[U].concat(m))})};var a,u,h=r.produce(i,o,function(c,d){a=c,u=d});return typeof Promise<"u"&&h instanceof Promise?h.then(function(c){return[c,a,u]}):[h,a,u]},typeof(e==null?void 0:e.useProxies)=="boolean"&&this.setUseProxies(e.useProxies),typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze)}var t=n.prototype;return t.createDraft=function(e){ht(e)||it(8),St(e)&&(e=xn(e));var r=Ae(this),i=Ct(this,e,void 0);return i[W].C=!0,se(r),i},t.finishDraft=function(e,r){var i=e&&e[W],o=i.A;return Zt(o,r),te(void 0,o)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!je&&it(20),this.g=e},t.applyPatches=function(e,r){var i;for(i=r.length-1;i>=0;i--){var o=r[i];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}i>-1&&(r=r.slice(i+1));var a=lt("Patches").$;return St(e)?a(e,r):this.produce(e,function(u){return a(u,r)})},n}(),rt=new Bn,Un=rt.produce;rt.produceWithPatches.bind(rt);rt.setAutoFreeze.bind(rt);rt.setUseProxies.bind(rt);rt.applyPatches.bind(rt);rt.createDraft.bind(rt);rt.finishDraft.bind(rt);function tn(n,t){const e=Object.keys(n),r=Object.keys(t);return e.length===r.length&&Object.keys(n).every(i=>t.hasOwnProperty(i))}function Pe(n,t){return Object.keys(n).length===Object.keys(t).length&&Object.keys(n).every(e=>t.hasOwnProperty(e)&&n[e]===t[e])}function Wt(n,t){return typeof n!="object"||typeof t!="object"||n===null||t===null?n===t:tn(n,t)?Object.keys(n).every(e=>Wt(n[e],t[e])):!1}function en(n,t){if(!_t(n)||!_t(t))return t;const e={};for(const r of Object.keys(n))e[r]=n[r];for(const r of Object.keys(t)){if(t[r]===null)continue;const i=_t(n[r])&&_t(t[r]);e[r]=i?en(n[r],t[r]):t[r]}return e}function nn(n,t,e){if(!_t(n))return n;const r={};for(const[i,o]of Object.entries(n))r[i]=_t(o)?nn(o,t,e):o===t?e:o;return r}function _t(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}jn();function Ln(n){return n.cardinality==="one"}function _e(n){return n["value-type"]==="ref"}function Rn(n){return n["value-type"]==="blob"}function Kt(n,t){return n[t]}function we(n,t){return t.reduce((e,r)=>e&&e.get(r),n)}function ft(n,t){if(t.length===0)throw new Error("path must have at least one element");if(t.length===1){n.delete(t[0]);return}const[e,...r]=t;n.has(e)&&ft(n.get(e),r)}function ct(n,t,e){if(t.length===0)throw new Error("path must have at least one element");if(t.length===1){n.set(t[0],e);return}const[r,...i]=t;let o=n.get(r);o||(o=new Map,n.set(r,o)),ct(o,i,e)}function rn(n,t){const e=new Map,r=new Map,i=new Map;for(const o of t){const[a,u,h,c]=o,d=Kt(n,u);if(!d){console.warn("no such attr",a,n);continue}_e(d)&&ct(i,[h,u,a],o),ct(e,[a,u,h],o),ct(r,[u,a,h],o)}return{eav:e,aev:r,vae:i}}function Me(n,t,e,r){const i=rn(n,t);return i.attrs=n,i.cardinalityInference=e,i.linkIndex=r,i}function Gt(n,t){var e,r;let i;if(Array.isArray(t[0])){const[a,u]=t[0],h=n.aev.get(a);if(!h)return null;i=(e=gt(h,2).find(d=>d[2]===u))===null||e===void 0?void 0:e[0]}else i=t[0];if(!i)return null;const o=t[2];if(Array.isArray(o)&&o.length===2&&n.aev.get(o[0])){const[a,u]=o,h=n.aev.get(a);if(!h)return null;const d=(r=gt(h,2).find(x=>x[2]===u))===null||r===void 0?void 0:r[0];if(!d)return null;const[m,C,U,...E]=t;return[i,C,d,...E]}else{const[a,...u]=t;return[i,...u]}}function Nn(n,t){const e=Gt(n,t);if(!e)return;const[r,i,o]=e,a=Kt(n.attrs,i);a&&(ft(n.eav,[r,i,o]),ft(n.aev,[i,r,o]),_e(a)&&ft(n.vae,[o,i,r]))}let Dn=0;function on(n,t,e){const[r,i,o]=e;let a;const u=we(n.ea,[r,i,o]);return u&&(a=u[3]),a||Date.now()*10+Dn++}function $n(n,t){var e;const r=Gt(n,t);if(!r)return;const[i,o,a]=r,u=Kt(n.attrs,o);if(!u)return;const h=we(n.eav,[i,o,a]),c=(e=h==null?void 0:h[3])!==null&&e!==void 0?e:on(n,u,r),d=[i,o,a,c];Ln(u)?(ct(n.eav,[i,o],new Map([[a,d]])),ct(n.aev,[o,i],new Map([[a,d]]))):(ct(n.eav,[i,o,a],d),ct(n.aev,[o,i,a],d)),_e(u)&&ct(n.vae,[a,o,i],d)}function Fn(n,t){var e;const r=Gt(n,t);if(!r)return;const[i,o,a]=r,u=Kt(n.attrs,o);if(!u)return;if(!Rn(u))throw new Error("merge operation is not supported for links");const h=we(n.eav,[i,o]);if(!h)return;const c=(e=h.values().next())===null||e===void 0?void 0:e.value;if(!c)return;const d=c[2],m=en(d,a),C=[i,o,m,on(n,u,c)];ct(n.eav,[i,o],new Map([[m,C]]))}function qn(n,t){const e=Gt(n,t);if(!e)return;const[r]=e,i=n.eav.get(r);if(i)for(const a of i.keys())ft(n.aev,[a,r]);ft(n.eav,[r]);const o=n.vae.get(r)&&gt(n.vae.get(r),2);o&&o.forEach(a=>{const[u,h,c]=a;ft(n.eav,[u,h,c]),ft(n.aev,[h,u,c])}),ft(n.vae,[r])}function sn(n,t){const e=rn(n.attrs,t);Object.keys(e).forEach(r=>{n[r]=e[r]})}function Wn(n,[t]){n.attrs[t.id]=t}function an(n){return gt(n.eav,3)}function Jn(n,[t]){if(!n.attrs[t])return;const e=an(n).filter(([r,i])=>i!==t);delete n.attrs[t],sn(n,e)}function zn(n,[t]){const e=n.attrs[t.id];e&&(n.attrs[t.id]=Object.assign(Object.assign({},e),t),sn(n,an(n)))}function Hn(n,t){const[e,...r]=t;switch(e){case"add-triple":$n(n,r);break;case"deep-merge-triple":Fn(n,r);break;case"retract-triple":Nn(n,r);break;case"delete-entity":qn(n,r);break;case"add-attr":Wn(n,r);break;case"delete-attr":Jn(n,r);break;case"update-attr":zn(n,r);break;default:throw new Error(`unhandled transaction action: ${e}`)}}function gt(n,t,e=[]){if(!n||t===0)return e;if(t===1){for(const r of n.values())e.push(r);return e}for(const r of n.values())gt(r,t-1,e);return e}function Nt(n,t){const e=[],r=t.in?t.in:[t];for(const i of r){const o=n.get(i);o&&e.push(o)}return e}function Vn(n,t,e){let r="";return n!==void 0&&(r+="e"),t!==void 0&&(r+="a"),e!==void 0&&(r+="v"),r}function Yn(n,[t,e,r]){var i,o;switch(Vn(t,e,r)){case"e":{const u=n.eav.get(t);return gt(u,2)}case"ea":{const u=(i=n.eav.get(t))===null||i===void 0?void 0:i.get(e);return gt(u,1)}case"eav":{const u=(o=n.eav.get(t))===null||o===void 0?void 0:o.get(e);return u?Nt(u,r):[]}case"ev":{const u=n.eav.get(t);if(!u)return[];const h=[];for(const c of u.values())h.push(...Nt(c,r));return h}case"av":{const u=n.aev.get(e);if(!u)return[];const h=[];for(const c of u.values())h.push(...Nt(c,r));return h}case"v":{const u=[];for(const h of n.eav.values())for(const c of h.values())u.push(...Nt(c,r))}default:return gt(n.eav,3)}}function Kn(n,t){return Un(n,e=>{t.forEach(r=>{Hn(e,r)})})}function Gn(n){return typeof n=="string"&&n.startsWith("?")}function Qn(n,t,e){if(e.hasOwnProperty(n)){const r=e[n];return un(r,t,e)}return Object.assign(Object.assign({},e),{[n]:t})}function Te(n,t,e){return n===t?e:null}function Xn(n,t,e){const{in:r}=n;return r&&r.includes(t)?e:null}function Zn(n){switch(typeof n){case"string":return n.startsWith("?")?Qn:Te;case"object":return Xn;default:return Te}}function un(n,t,e){return e?Zn(n)(n,t,e):null}function tr(n,t,e){return n.reduce((r,i,o)=>{const a=t[o];return un(i,a,r)},e)}function er(n,t,e){return ir(n,t,e).map(r=>tr(t,r,e)).filter(r=>r)}function nr(n,t,e){return t.or?t.or.patterns.flatMap(r=>ce(n,r,e)):t.and?t.and.patterns.reduce((r,i)=>ce(n,i,r),e):e.flatMap(r=>er(n,t,r))}function ce(n,t,e=[{}]){return t.reduce((r,i)=>nr(n,i,r),e)}function Se(n,t){return Array.isArray(t)?t.map(e=>Se(n,e)):Gn(t)?n[t]:t}function rr(n,{find:t,where:e}){return ce(n,e).map(i=>Se(i,t))}function ir(n,t,e){return Yn(n,Se(e,t))}let Dt;const or=new Uint8Array(16);function sr(){if(!Dt&&(Dt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Dt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Dt(or)}const Q=[];for(let n=0;n<256;++n)Q.push((n+256).toString(16).slice(1));function ar(n,t=0){return Q[n[t+0]]+Q[n[t+1]]+Q[n[t+2]]+Q[n[t+3]]+"-"+Q[n[t+4]]+Q[n[t+5]]+"-"+Q[n[t+6]]+Q[n[t+7]]+"-"+Q[n[t+8]]+Q[n[t+9]]+"-"+Q[n[t+10]]+Q[n[t+11]]+Q[n[t+12]]+Q[n[t+13]]+Q[n[t+14]]+Q[n[t+15]]}const ur=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Be={randomUUID:ur};function cr(n,t,e){if(Be.randomUUID&&!t&&!n)return Be.randomUUID();n=n||{};const r=n.random||(n.rng||sr)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ar(r)}function Ue(n){const t=n.replace(/-/g,""),e=[];for(let r=0;r<t.length;r+=2)e.push(parseInt(t.substring(r,r+2),16));return e}function lr(n,t){for(let e=0;e<n.length;e++){if(n[e]<t[e])return-1;if(n[e]>t[e])return 1}return 0}function Le(n,t){return lr(Ue(n),Ue(t))}function Z(){return cr()}function le(n,t,e){return new Proxy({},{get:(r,i)=>i==="__ops"?e:o=>le(n,t,[...e,[i,n,t,o]])})}function de(n){return n.startsWith("lookup__")}function cn(n){const[t,e,...r]=n.split("__");return[e,JSON.parse(r.join("__"))]}function dr(n){return new Proxy({},{get(t,e){return de(e)?le(n,cn(e),[]):le(n,e,[])}})}function ln(){return new Proxy({},{get(n,t){return dr(t)}})}ln();function fr(n){return n.__ops}function hr(n,t){const{attrIdMap:e,refSwapAttrIds:r}=n,i=[];for(const a of t){const u=e[a];if(u)i.push(u);else if(Array.isArray(a)&&a.length==2&&e[a[0]]){const[h,c]=a;i.push([e[h],c])}else i.push(a)}const[o]=t;if((o==="add-triple"||o==="retract-triple")&&r.has(t[2])){const a=i[1];i[1]=i[3],i[3]=a}return i}function tt(n,t,e){return Object.values(n).find(r=>{const[i,o,a]=r["forward-identity"];return o===t&&a===e})}function At(n,t,e){return Object.values(n).find(r=>{const i=r["reverse-identity"];if(!i)return!1;const[o,a,u]=i;return a===t&&u===e})}function pr(n){if(Array.isArray(n))return n;const t=Object.entries(n);if(t.length!==1)throw new Error("lookup must be an object with a single unique attr and value.");return t[0]}function dn(n,t,e){return e.indexOf(".")!==-1&&!tt(n,t,e)}function fn(n){const[t,e,...r]=n.split(".");if(r.length>0||e!=="id")throw new Error(`${n} is not a valid lookup attribute.`);return t}function gr(n,t,e){if(!dn(n,t,e))return tt(n,t,e);const r=fn(e),i=tt(n,t,r);if(i&&i["value-type"]!=="ref")throw new Error(`${e} does not reference a valid link attribute.`);return i}function hn(n){return typeof n=="string"&&!de(n)?null:typeof n=="string"&&de(n)?cn(n):pr(n)}function ot(n,t,e){const r=hn(e);if(r===null)return e;const[i,o]=r,a=gr(n,t,i);if(!a||!a["unique?"])throw new Error(`${i} is not a unique attribute.`);return[a.id,o]}function yr(n,[t,e,r]){return Object.entries(r).flatMap(([o,a])=>{const u=Array.isArray(a)?a:[a],h=tt(n,t,o),c=At(n,t,o);return u.map(d=>h?["add-triple",ot(n,t,e),h.id,ot(n,h["reverse-identity"][1],d)]:["add-triple",ot(n,c["forward-identity"][1],d),c.id,ot(n,t,e)])})}function vr(n,[t,e,r]){return Object.entries(r).flatMap(([o,a])=>{const u=Array.isArray(a)?a:[a],h=tt(n,t,o),c=At(n,t,o);return u.map(d=>h?["retract-triple",ot(n,t,e),h.id,ot(n,h["reverse-identity"][1],d)]:["retract-triple",ot(n,c["forward-identity"][1],d),c.id,ot(n,t,e)])})}function br(n,[t,e,r]){const i=ot(n,t,e);return[["id",ot(n,t,e)]].concat(Object.entries(r)).map(([a,u])=>{const h=tt(n,t,a);return["add-triple",i,h.id,u]})}function mr(n,[t,e]){return[["delete-entity",ot(n,t,e)]]}function _r(n,[t,e,r]){const i=ot(n,t,e),o=Object.entries(r).map(([u,h])=>{const c=tt(n,t,u),d=nn(h,void 0,null);return["deep-merge-triple",i,c.id,d]});return[["add-triple",i,tt(n,t,"id").id,i]].concat(o)}function wr(n,[t,...e]){switch(t){case"merge":return _r(n,e);case"update":return br(n,e);case"link":return yr(n,e);case"unlink":return vr(n,e);case"delete":return mr(n,e);default:throw new Error(`unsupported action ${t}`)}}function Re(n,t,e){const r=Z(),o=[Z(),n,t];return Object.assign({id:r,"forward-identity":o,"value-type":"blob",cardinality:"one","unique?":!1,"index?":!1,isUnsynced:!0},e||{})}function Ne(n,t,e){const r=Z(),i=Z(),o=Z();return Object.assign({id:r,"forward-identity":[i,n,t],"reverse-identity":[o,t,n],"value-type":"ref",cardinality:"many","unique?":!1,"index?":!1,isUnsynced:!0},e||{})}const Sr=new Set(["update","merge","link","unlink"]),Er=new Set(["link","unlink"]),Ar=new Set(["update","merge"]),Ir=new Set(["link","unlink","update","merge","delete"]),pn={"unique?":!0,"index?":!0},kr=Object.assign(Object.assign({},pn),{cardinality:"one"});function Or(n,t){const[e,r,i]=[new Set,Object.assign({},n),[]];function o(u){r[u.id]=u,i.push(["add-attr",u]),e.add(u.id)}function a(u){u!=null&&u.isUnsynced&&!e.has(u.id)&&(i.push(["add-attr",u]),e.add(u.id))}for(const u of t){const[h,c,d,m]=u;if(Ir.has(h)){const C=hn(d);if(C){const U=C[0];if(dn(r,c,U)){const E=fn(U),x=tt(r,c,E),_=At(r,c,E);!x&&!_&&o(Ne(c,E,kr)),a(x),a(_)}else{const E=tt(r,c,U);E||o(Re(c,U,pn)),a(E)}}}}for(const u of t){const[h,c,d,m]=u;if(Sr.has(h)){const C=Object.keys(m);C.push("id");for(const U of C){const E=tt(r,c,U);if(a(E),Ar.has(h)&&(E||o(Re(c,U))),Er.has(h)){const x=At(r,c,U);!E&&!x&&o(Ne(c,U)),a(x)}}}}return[r,i]}function xr(n,t){const r=(Array.isArray(t)?t:[t]).flatMap(u=>fr(u)),[i,o]=Or(n,r),a=r.flatMap(u=>wr(i,u));return[...o,...a]}let jr=0;function Yt(n){return Qt(`_${n}`,jr++)}function Qt(n,t){return`?${n}-${t}`}class Mt extends Error{constructor(t){super(t),this.name="AttrNotFoundError"}}function Cr(n,t){const e=Object.values(n.attrs).find(r=>{var i;return r["primary?"]&&((i=r["forward-identity"])===null||i===void 0?void 0:i[1])===t});return e||tt(n.attrs,t,"id")}function Pr(n,t){const e=Cr(n,t);if(!e)throw new Mt(`Could not find id attr for ${t}`);return e}function De(n,t,e,r){return[Mr(n,t,e,r),Tr(n,e,r)]}function Mr(n,t,e,r){return[n(e,r),Pr(t,e).id,n(e,r),Yt("time")]}function Tr(n,t,e){return[n(t,e),n("attr",e),n("val",e),n("time",e)]}function Br(n,t,e){return n.map(r=>r===t?e:r)}function gn(n,t,e,r,i){const o=tt(t.attrs,e,i),a=At(t.attrs,e,i),u=o||a;if(!u)throw new Mt(`Could not find attr for ${[e,i]}`);if(u["value-type"]!=="ref")throw new Error(`Attr ${u.id} is not a ref`);const[h,c]=u["forward-identity"],[d,m]=u["reverse-identity"],C=r+1,U=o?[n(c,r),u.id,n(m,C),Yt("time")]:[n(c,C),u.id,n(m,r),Yt("time")];return[o?m:c,C,U,u,!!o]}function Ur(n,t,e,r,i,o){const a=tt(t.attrs,e,i);if(!a)throw new Mt(`No attr for etype = ${e} label = ${i} value-label`);return[n(e,r),a.id,o,Yt("time")]}function Lr(n,t,e,r,i){const[o,a,u]=i.reduce((h,c)=>{const[d,m,C]=h,[U,E,x]=gn(n,t,d,m,c);return[U,E,[...C,x]]},[e,r,[]]);return[o,a,u]}function Rr(n,t,e,r,i,o){const a=i.slice(0,i.length-1),u=i[i.length-1],[h,c,d]=Lr(n,t,e,r,a),m=Ur(n,t,h,c,u,o);return d.concat([m])}function Nr(n,t){return t?[t].concat(n):n}function Dr([n,t]){return n==="or"&&Array.isArray(t)}function $r([n,t]){return n==="and"&&Array.isArray(t)}function Fr(n,t,e){return(r,i)=>r==t?n(r,i):`${n(r,i)}-${e}`}function $e(n,t,e,r,i,o){const a=o.map((h,c)=>{const d=Fr(n,r,c);return yn(d,e,r,i,h)}),u=n(r,i);return{[t]:{patterns:a,joinSym:u}}}function yn(n,t,e,r,i){return Object.entries(i).flatMap(([o,a])=>{if(Dr([o,a]))return $e(n,"or",t,e,r,a);if($r([o,a]))return $e(n,"and",t,e,r,a);const u=o.split(".");return Rr(n,t,e,r,u,a)})}function qr(n,t,e,r){const i=Qt;return r?yn(i,n,t,e,r).concat(De(i,n,t,e)):De(i,n,t,e)}function Wr(n,t,e){return[n(t,e),n("attr",e),n("val",e),n("time",e)]}function Jr(n,t,e,r,i,o){const[a,u,h,c,d]=gn(n,t,e,r,i),m=Br(h,n(e,r),o);return[a,u,m,c,d]}function zr(n,t,{etype:e,level:r,form:i},o){const a=Object.keys(i).filter(u=>u!=="$");return a.length?Object.entries(o).map(([u,h])=>a.map(d=>{var m,C,U;const E=!!(t.cardinalityInference&&(!((U=(C=(m=t.linkIndex)===null||m===void 0?void 0:m[e])===null||C===void 0?void 0:C[d])===null||U===void 0)&&U.isSingular));try{const[x,_,j]=Jr(n,t,e,r,d,u),P=vn(t,{etype:x,level:_,form:i[d],join:j}),k=E?P[0]:P;return{[d]:k}}catch(x){if(x instanceof Mt)return{[d]:E?void 0:[]};throw x}}).reduce((d,m)=>Object.assign(Object.assign({},d),m),h)):Object.values(o)}function Hr(n,t){const e=n[t];return e["value-type"]==="ref"&&e["forward-identity"][2]!=="id"}function Fe(n,t){switch(n){case"asc":switch(t){case"number":return(e,r)=>e<r;case"uuid":return(e,r)=>Le(e,r)===-1}case"desc":switch(t){case"number":return(e,r)=>e>r;case"uuid":return(e,r)=>Le(e,r)===1}}}function Vr(n,t,[e,r,i,o]){return Fe(t,"number")(o,n[3])||o===n[3]&&Fe(t,"uuid")(e,n[0])}function Yr(n,t,e,r,i){const o=r==null?void 0:r["start-cursor"],a=[],u=rr(n,i).sort((h,c)=>{const d=h[3],m=c[3];return e==="desc"?m-d:d-m}).reduce((h,c)=>{const[d,m,C]=c;if(Hr(n.attrs,m))return h;const U=n.attrs[m],[E,x,_]=U["forward-identity"];return x!==t||(o&&m===o[1]&&Vr(o,e,c)&&a.push(d),h[d]=h[d]||{},h[d][_]=C),h},{});for(const h of a)delete u[h];return u}function Kr(n){var t;const e=(t=n.$)===null||t===void 0?void 0:t.order;return e&&e[Object.keys(e)[0]]||"asc"}function Gr(n,{etype:t,level:e,form:r,join:i,pageInfo:o}){var a,u,h,c,d,m,C;const U=((a=r.$)===null||a===void 0?void 0:a.limit)||((u=r.$)===null||u===void 0?void 0:u.first)||((h=r.$)===null||h===void 0?void 0:h.last),E=(c=r.$)===null||c===void 0?void 0:c.offset,x=(d=r.$)===null||d===void 0?void 0:d.before,_=(m=r.$)===null||m===void 0?void 0:m.after;if((E||x||_)&&(!o||!o["start-cursor"]))return[];const j=Nr(qr(n,t,e,(C=r.$)===null||C===void 0?void 0:C.where),i),P=Wr(Qt,t,e),k=Yr(n,t,Kr(r),o,{where:j,find:P});if(U!=null){const O=Object.entries(k);return O.length<=U?k:Object.fromEntries(O.slice(0,U))}return k}function Qr(n,t){try{return Gr(n,t)}catch(e){if(e instanceof Mt)return{};throw e}}function vn(n,t){const e=Qr(n,t);return zr(Qt,n,t,e)}function Xr(n){const t={};for(const[e,r]of Object.entries(n))t[e]={startCursor:r["start-cursor"],endCursor:r["end-cursor"],hasNextPage:r["has-next-page?"],hasPreviousPage:r["has-previous-page?"]};return t}function Zr({store:n,pageInfo:t,aggregate:e},r){const o={data:Object.keys(r).reduce((a,u)=>(e!=null&&e[u]||(a[u]=vn(n,{etype:u,form:r[u],level:0,pageInfo:t==null?void 0:t[u]})),a),{})};return t&&(o.pageInfo=Xr(t)),e&&(o.aggregate=e),o}var qe=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function h(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,h)}c((r=r.apply(n,t||[])).next())})};class bn{constructor(t){this.dbName=t,this._storeName="kv",this._dbPromise=this._init()}_init(){return new Promise((t,e)=>{const r=indexedDB.open(this.dbName,1);r.onerror=i=>{e(i)},r.onsuccess=i=>{t(i.target.result)},r.onupgradeneeded=i=>{i.target.result.createObjectStore(this._storeName)}})}getItem(t){return qe(this,void 0,void 0,function*(){const e=yield this._dbPromise;return new Promise((r,i)=>{const u=e.transaction([this._storeName],"readonly").objectStore(this._storeName).get(t);u.onerror=h=>{i(h)},u.onsuccess=h=>{u.result?r(u.result):r(null)}})})}setItem(t,e){return qe(this,void 0,void 0,function*(){const r=yield this._dbPromise;return new Promise((i,o)=>{const h=r.transaction([this._storeName],"readwrite").objectStore(this._storeName).put(e,t);h.onerror=c=>{o(c)},h.onsuccess=c=>{i()}})})}}var ti=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function h(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,h)}c((r=r.apply(n,t||[])).next())})};class mn{static getIsOnline(){return ti(this,void 0,void 0,function*(){return navigator.onLine})}static listen(t){const e=()=>{t(!0)},r=()=>{t(!1)};return addEventListener("online",e),addEventListener("offline",r),()=>{removeEventListener("online",e),removeEventListener("offline",r)}}}var ei=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function h(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,h)}c((r=r.apply(n,t||[])).next())})};function pt(n,t){return ei(this,void 0,void 0,function*(){const e=yield fetch(n,t),r=yield e.json();return e.status===200?Promise.resolve(r):Promise.reject({status:e.status,body:r})})}var Tt=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function h(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,h)}c((r=r.apply(n,t||[])).next())})};function ni({apiURI:n,appId:t,email:e}){return pt(`${n}/runtime/auth/send_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":t,email:e})})}function ri(n){return Tt(this,arguments,void 0,function*({apiURI:t,appId:e,email:r,code:i}){return yield pt(`${t}/runtime/auth/verify_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,email:r,code:i})})})}function ii(n){return Tt(this,arguments,void 0,function*({apiURI:t,appId:e,refreshToken:r}){return yield pt(`${t}/runtime/auth/verify_refresh_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,"refresh-token":r})})})}function We(n){return Tt(this,arguments,void 0,function*({apiURI:t,appId:e,code:r,codeVerifier:i}){return yield pt(`${t}/runtime/oauth/token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,code:r,code_verifier:i})})})}function oi(n){return Tt(this,arguments,void 0,function*({apiURI:t,appId:e,nonce:r,idToken:i,clientName:o,refreshToken:a}){return yield pt(`${t}/runtime/oauth/id_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,nonce:r,id_token:i,client_name:o,refresh_token:a})})})}function si(n){return Tt(this,arguments,void 0,function*({apiURI:t,appId:e,refreshToken:r}){return yield pt(`${t}/runtime/signout`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,refresh_token:r})})})}var Xt=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function h(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,h)}c((r=r.apply(n,t||[])).next())})};function ai(n){return Xt(this,arguments,void 0,function*({apiURI:t,appId:e,fileName:r,refreshToken:i,metadata:o={}}){const{data:a}=yield pt(`${t}/storage/signed-upload-url`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${i}`},body:JSON.stringify({app_id:e,filename:r})});return a})}function ui(n,t){return Xt(this,void 0,void 0,function*(){return(yield fetch(n,{method:"PUT",body:t,headers:{"Content-Type":t.type}})).ok})}function ci(n){return Xt(this,arguments,void 0,function*({apiURI:t,appId:e,path:r,refreshToken:i}){const{data:o}=yield pt(`${t}/storage/signed-download-url?app_id=${e}&filename=${encodeURIComponent(r)}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return o})}function li(n){return Xt(this,arguments,void 0,function*({apiURI:t,appId:e,path:r,refreshToken:i}){const{data:o}=yield pt(`${t}/storage/files?app_id=${e}&filename=${encodeURIComponent(r)}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return o})}function Je(n,t){if(!t)return n;const e={};return t.forEach(r=>{e[r]=n[r]}),e}function di(n,t){var e,r;const i={peers:{}};if(t&&"user"in t?t.user:!0){const a=Je((e=n.user)!==null&&e!==void 0?e:{},t==null?void 0:t.keys);i.user=a}for(const a of Object.keys((r=n.peers)!==null&&r!==void 0?r:{})){const u=(t==null?void 0:t.peers)===void 0,h=Array.isArray(t==null?void 0:t.peers)&&(t==null?void 0:t.peers.includes(a));if(u||h){const c=Je(n.peers[a],t==null?void 0:t.keys);i.peers[a]=c}}return i}function fi(n,t){if(n.isLoading!==t.isLoading||n.error!==t.error||(n.user||t.user)&&(!n.user||!t.user||!Pe(n.user,t.user))||!tn(n.peers,t.peers))return!0;for(const r of Object.keys(n.peers))if(!Pe(n.peers[r],t.peers[r]))return!0;return!1}class hi{constructor(){this.promise=new Promise((t,e)=>{this._resolve=t,this._reject=e})}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}var ze=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function h(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,h)}c((r=r.apply(n,t||[])).next())})};class He{constructor(t,e,r,i,o=u=>JSON.stringify(u),a=u=>JSON.parse(u)){this._persister=t,this._key=e,this._onMerge=i,this._loadedCbs=[],this._isLoading=!0,this.currentValue=r,this.toJSON=o,this.fromJSON=a,this._load()}_load(){return ze(this,void 0,void 0,function*(){const t=this.fromJSON(yield this._persister.getItem(this._key));this._isLoading=!1,this._onMerge(t,this.currentValue);for(const e of this._loadedCbs)e()})}waitForLoaded(){return ze(this,void 0,void 0,function*(){if(!this._isLoading)return;yield new Promise(e=>{this._loadedCbs.push(e)})})}set(t,e){this.currentValue=t(this.currentValue),this._isLoading||setTimeout(()=>{this._persister.setItem(this._key,this.toJSON(this.currentValue)),e&&e()},0)}}function _n(n,t=[]){n.forEach(e=>{const{data:r}=e,{"datalog-result":i}=r,{"join-rows":o}=i;for(const a of o)for(const u of a)t.push(u);_n(e["child-nodes"],t)})}function Ve(n){const t=[];return _n(n,t),t}function pi(n,t){return t instanceof Map?{__type:"m",entries:[...t.entries()]}:t}function gi(n,t){return t&&typeof t=="object"&&t.__type==="m"?new Map(t.entries):t}function yi(n){return JSON.stringify(n,pi)}function vi(n){return JSON.parse(n,gi)}function bi(n){return Object.values(n.links).reduce((t,e)=>{var r,i,o,a;return(r=t[o=e.forward.on])!==null&&r!==void 0||(t[o]={}),t[e.forward.on][e.forward.label]={isForward:!0,isSingular:e.forward.has==="one",link:e},(i=t[a=e.reverse.on])!==null&&i!==void 0||(t[a]={}),t[e.reverse.on][e.reverse.label]={isForward:!1,isSingular:e.reverse.has==="one",link:e},t},{})}var X=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function h(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,h)}c((r=r.apply(n,t||[])).next())})};const yt={CONNECTING:"connecting",OPENED:"opened",AUTHENTICATED:"authenticated",CLOSED:"closed",ERRORED:"errored"},mi=1,_i={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"},re="_instant_oauth_redirect",ie="currentUser";function wi(){return typeof window<"u"||typeof chrome<"u"}class Si{constructor(t,e=bn,r=mn){this._isOnline=!0,this._isShutdown=!1,this.status=yt.CONNECTING,this.queryCbs={},this.authCbs=[],this.attrsCbs=[],this.mutationErrorCbs=[],this.mutationDeferredStore=new Map,this._reconnectTimeoutId=null,this._reconnectTimeoutMs=0,this._localIdPromises={},this._errorMessage=null,this._oauthCallbackResponse=null,this._linkIndex=null,this._presence={},this._broadcastSubs={},this._currentUserCached={isLoading:!0,error:void 0,user:void 0},this._onMergeQuerySubs=(i,o)=>{const a=i||{},u=Object.assign({},o);Object.entries(o).forEach(([c,d])=>{var m;const C=(m=a==null?void 0:a[c])===null||m===void 0?void 0:m.result,U=d.result;C&&!U&&(u[c].result=C)}),Object.keys(a).filter(c=>!o[c]).slice(0,10).forEach(c=>{u[c]=a[c]}),this.querySubs.set(c=>u),this.notifyAll()},this._onMergePendingMutations=(i,o)=>{const a=new Map([...i.entries(),...o.entries()]);this.pendingMutations.set(h=>a),this._rewriteMutations(this.attrs,i).forEach((h,c)=>{!o.has(c)&&!h["tx-id"]&&this._sendMutation(c,h)})},this.getPreviousResult=i=>{var o,a,u;const h=mt(i),c=this._errorMessage,d=(u=(a=(o=this.querySubs)===null||o===void 0?void 0:o.currentValue)===null||a===void 0?void 0:a[h])===null||u===void 0?void 0:u.result;if(c)return{error:c};if(d)return this.dataForResult(i,d)},this.notifyOne=i=>{const o=this.queryCbs[i]||[];if(!o)return;const a=this._errorMessage;if(a){o.forEach(m=>m({error:a}));return}const{q:u,result:h,iqlResult:c}=this.querySubs.currentValue[i]||{};if(!h)return;const d=this.dataForResult(u,h);Wt(d.data,c)||(this.querySubs.currentValue[i].iqlResult=h.data,o.forEach(m=>m(d)))},this.notifyQueryError=(i,o)=>{(this.queryCbs[i]||[]).forEach(u=>u({error:o}))},this.pushTx=i=>{try{const o=xr(this.optimisticAttrs(),i);return this.pushOps(o)}catch(o){return this.pushOps([],o)}},this.pushOps=(i,o)=>{const a=Z(),u={op:"transact","tx-steps":i,error:o};this.pendingMutations.set(c=>(c.set(a,u),c));const h=new hi;return this.mutationDeferredStore.set(a,h),this._sendMutation(a,u),this.notifyAll(),h.promise},this._wsOnOpen=()=>{xt.info("[socket] connected"),this._setStatus(yt.OPENED),this.getCurrentUser().then(i=>{var o;this._trySend(Z(),{op:"init","app-id":this.config.appId,"refresh-token":(o=i.user)===null||o===void 0?void 0:o.refresh_token,"__admin-token":this.config.__adminToken})})},this._wsOnMessage=i=>{this._handleReceive(JSON.parse(i.data.toString()))},this._wsOnError=i=>{xt.error("[socket] error: ",i)},this._wsOnClose=()=>{if(this._setStatus(yt.CLOSED),this._isShutdown){xt.info("[socket-close] socket has been shut down and will not reconnect");return}xt.info("[socket-close] scheduling reconnect",this._reconnectTimeoutMs),setTimeout(()=>{if(this._reconnectTimeoutMs=Math.min(this._reconnectTimeoutMs+1e3,1e4),!this._isOnline){xt.info("[socket-close] we are offline, no need to start socket");return}this._startSocket()},this._reconnectTimeoutMs)},this.config=Object.assign(Object.assign({},_i),t),this.config.schema&&(this._linkIndex=bi(this.config.schema)),wi()&&(typeof BroadcastChannel=="function"&&(this._broadcastChannel=new BroadcastChannel("@instantdb"),this._broadcastChannel.addEventListener("message",i=>X(this,void 0,void 0,function*(){var o;if(((o=i.data)===null||o===void 0?void 0:o.type)==="auth"){const a=yield this.getCurrentUser();this.updateUser(a.user)}}))),this._oauthCallbackResponse=this._oauthLoginInit(),this._initStorage(e),this.getCurrentUser(),r.getIsOnline().then(i=>{this._isOnline=i,this._startSocket(),r.listen(o=>{o!==this._isOnline&&(this._isOnline=o,this._isOnline&&this._startSocket())})}))}_initStorage(t){this._persister=new t(`instant_${this.config.appId}_4`),this.querySubs=new He(this._persister,"querySubs",{},this._onMergeQuerySubs,yi,vi),this.pendingMutations=new He(this._persister,"pendingMutations",new Map,this._onMergePendingMutations,e=>JSON.stringify([...e.entries()]),e=>new Map(JSON.parse(e)))}_finishTransaction(t,e,r,i){const o=this.mutationDeferredStore.get(r);this.mutationDeferredStore.delete(r),!o&&!t&&console.error("Mutation failed",Object.assign({status:e,clientId:r},i)),o&&(t?o.resolve({status:e,clientId:r}):o.reject(Object.assign({status:e,clientId:r},i)))}_setStatus(t,e){this.status=t,this._errorMessage=e}_cleanPendingMutations(t){this.pendingMutations.set(e=>{const r=new Map(e);return[...e.entries()].forEach(([i,o])=>{o["tx-id"]<=t&&r.delete(i)}),r})}_handleReceive(t){var e,r,i,o;const a=!!this.config.schema&&("cardinalityInference"in this.config?!!this.config.cardinalityInference:!0);switch(t.op){case"init-ok":this._setStatus(yt.AUTHENTICATED),this._reconnectTimeoutMs=0,this._setAttrs(t.attrs),this._flushPendingMessages(),this._sessionId=t["session-id"];break;case"add-query-ok":const{q:u,result:h,"processed-tx-id":c}=t;this._cleanPendingMutations(c);const d=mt(u),m=(r=(e=h==null?void 0:h[0])===null||e===void 0?void 0:e.data)===null||r===void 0?void 0:r["page-info"],C=(o=(i=h==null?void 0:h[0])===null||i===void 0?void 0:i.data)===null||o===void 0?void 0:o.aggregate,U=Ve(h),E=Me(this.attrs,U,a,this._linkIndex);this.querySubs.set(M=>(M[d].result={store:E,pageInfo:m,aggregate:C},M)),this.notifyOne(d);break;case"refresh-ok":const{computations:x,attrs:_,"processed-tx-id":j}=t;this._cleanPendingMutations(j),this._setAttrs(_);const P=x.map(M=>{var F,z,J,q;const st=M["instaql-query"],ut=M["instaql-result"],vt=mt(st),Bt=Ve(ut),kt=Me(this.attrs,Bt,a,this._linkIndex),Ot=(z=(F=ut==null?void 0:ut[0])===null||F===void 0?void 0:F.data)===null||z===void 0?void 0:z["page-info"],Ut=(q=(J=ut==null?void 0:ut[0])===null||J===void 0?void 0:J.data)===null||q===void 0?void 0:q.aggregate;return{hash:vt,store:kt,pageInfo:Ot,aggregate:Ut}});P.forEach(({hash:M,store:F,pageInfo:z,aggregate:J})=>{this.querySubs.set(q=>(q[M].result={store:F,pageInfo:z,aggregate:J},q))}),P.forEach(({hash:M})=>{this.notifyOne(M)});break;case"transact-ok":const{"client-event-id":k,"tx-id":O}=t,v=this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).get(k);if(!v)break;const S=Object.assign(Object.assign({},v),{"tx-id":O});this.pendingMutations.set(M=>(M.set(k,S),M)),this._finishTransaction(!0,"synced",k);const f=v["tx-steps"].filter(([M,...F])=>M==="add-attr").map(([M,F])=>F).concat(Object.values(this.attrs));this._setAttrs(f);break;case"refresh-presence":const g=t["room-id"];this._setPresencePeers(g,t.data),this._notifyPresenceSubs(g);break;case"server-broadcast":const l=t["room-id"],b=t.topic;this._notifyBroadcastSubs(l,b,t);break;case"join-room-ok":const w=t["room-id"],N=this._presence[w];N&&(N.isLoading=!1),this._notifyPresenceSubs(w);break;case"join-room-error":const R=t["room-id"],D=this._presence[R];D&&(D.error=t.error),this._notifyPresenceSubs(R);break;case"error":this._handleReceiveError(t);break}}_handleReceiveError(t){var e,r,i;const o=t["client-event-id"];if(this.pendingMutations.currentValue.get(o)){this.pendingMutations.set(m=>(m.delete(o),m)),this.notifyAll(),this.notifyAttrsSubs(),this.notifyMutationErrorSubs(t);const d={message:t.message,hint:t.hint};this._finishTransaction(!1,"error",o,d);return}const u=t.q||((e=t["original-event"])===null||e===void 0?void 0:e.q);if(u){this.querySubs.set(d=>{const m=mt(u);return delete d[m],d}),this.notifyQueryError(mt(u),{message:t.message||"Uh-oh, something went wrong. Ping Joe & Stopa."});return}if(((r=t["original-event"])===null||r===void 0?void 0:r.op)==="init"){if(t.type==="record-not-found"&&((i=t.hint)===null||i===void 0?void 0:i["record-type"])==="app-user"){this.changeCurrentUser(null);return}const d={message:t.message||"Uh-oh, something went wrong. Ping Joe & Stopa."};this._setStatus(yt.ERRORED,d),this.notifyAll();return}const c=Object.assign({},t);delete c.message,delete c.hint,console.error(t.message,c),t.hint&&console.error(`This error comes with some debugging information. Here it is: 
`,t.hint)}_setAttrs(t){this.attrs=t.reduce((e,r)=>(e[r.id]=r,e),{}),this.notifyAttrsSubs()}subscribeQuery(t,e){const r=Z(),i=mt(t);this.queryCbs[i]=this.queryCbs[i]||[],this.queryCbs[i].push(e),this.querySubs.set(a=>(a[i]=a[i]||{q:t,result:null,eventId:r},a)),this._trySendAuthed(r,{op:"add-query",q:t});const o=this.getPreviousResult(t);return o&&e(o),()=>{this.queryCbs[i]=this.queryCbs[i].filter(a=>a!==e)}}_rewriteMutations(t,e){if(!t)return e;const r=h=>{const[c,d,m]=h["forward-identity"];return tt(t,d,m)},i=h=>{const[c,d,m]=h["forward-identity"];return At(t,d,m)},o={attrIdMap:{},refSwapAttrIds:new Set},a=h=>{const c=[];for(const d of h){const[m]=d;if(m==="add-attr"){const[U,E]=d,x=r(E);if(x){o.attrIdMap[E.id]=x.id;continue}if(E["value-type"]==="ref"){const _=i(E);if(_){o.attrIdMap[E.id]=_.id,o.refSwapAttrIds.add(E.id);continue}}}const C=hr(o,d);c.push(C)}return c},u=new Map;for(const[h,c]of e.entries())u.set(h,Object.assign(Object.assign({},c),{"tx-steps":a(c["tx-steps"])}));return u}optimisticAttrs(){var t;const e=[...this.pendingMutations.currentValue.values()].flatMap(u=>u["tx-steps"]),r=new Set(e.filter(([u,h])=>u==="delete-attr").map(([u,h])=>h)),i=[];for(const[u,h]of e)if(u==="add-attr")i.push(h);else if(u==="update-attr"&&h.id&&(!((t=this.attrs)===null||t===void 0)&&t[h.id])){const c=Object.assign(Object.assign({},this.attrs[h.id]),h);i.push(c)}const o=[...Object.values(this.attrs||{}),...i].filter(u=>!r.has(u.id));return Object.fromEntries(o.map(u=>[u.id,u]))}dataForResult(t,{store:e,pageInfo:r,aggregate:i}){const a=[...this._rewriteMutations(e.attrs,this.pendingMutations.currentValue).values()].flatMap(c=>c["tx-steps"]),u=Kn(e,a);return Zr({store:u,pageInfo:r,aggregate:i},t)}notifyAll(){Object.keys(this.queryCbs).forEach(t=>{this.notifyOne(t)})}shutdown(){this._isShutdown=!0,this._ws.close()}_sendMutation(t,e){if(e.error){this._finishTransaction(!1,"error",t,{error:e.error,message:e.error.message}),this.pendingMutations.set(i=>(i.delete(t),i));return}if(this.status!==yt.AUTHENTICATED){this._finishTransaction(!0,"enqueued",t);return}const r=Math.max(5e3,this.pendingMutations.currentValue.size*5e3);this._isOnline?(this._trySend(t,e),setTimeout(()=>{this._finishTransaction(!0,"pending",t)},3e3),setTimeout(()=>{if(!this._isOnline)return;const i=this.pendingMutations.currentValue.get(t);i&&!i["tx-id"]&&(this.pendingMutations.set(o=>(o.delete(t),o)),this._finishTransaction(!1,"timeout",t),console.error("mutation timed out",i))},r)):this._finishTransaction(!0,"enqueued",t)}_flushPendingMessages(){Object.keys(this.queryCbs).map(a=>this.querySubs.currentValue[a]).filter(a=>a).forEach(({eventId:a,q:u})=>{this._trySendAuthed(a,{op:"add-query",q:u})}),this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).forEach((a,u)=>{a["tx-id"]||this._sendMutation(u,a)}),Object.keys(this._presence).forEach(a=>{this._trySendAuthed(Z(),{op:"join-room","room-id":a})}),Object.entries(this._presence).forEach(([a,{result:u}])=>{const h=u==null?void 0:u.user;h&&this._trySendAuthed(Z(),{op:"set-presence","room-id":a,data:h})})}_trySendAuthed(t,e){this.status===yt.AUTHENTICATED&&this._trySend(t,e)}_trySend(t,e){this._ws.readyState===mi&&this._ws.send(JSON.stringify(Object.assign({"client-event-id":t},e)))}_startSocket(){this._ws=new WebSocket(`${this.config.websocketURI}?app_id=${this.config.appId}`),this._ws.onopen=this._wsOnOpen,this._ws.onmessage=this._wsOnMessage,this._ws.onclose=this._wsOnClose}getLocalId(t){return X(this,void 0,void 0,function*(){const e=`localToken_${t}`,r=yield this._persister.getItem(e);if(r)return r;if(this._localIdPromises[e])return this._localIdPromises[e];const i=Z();return this._localIdPromises[e]=this._persister.setItem(e,i).then(()=>i),this._localIdPromises[e]})}_replaceUrlAfterOAuth(){if(typeof URL>"u")return;const t=new URL(window.location.href);if(t.searchParams.get(re)){const e=t.toString();t.searchParams.delete(re),t.searchParams.delete("code"),t.searchParams.delete("error");const r=t.pathname+(t.searchParams.size?"?"+t.searchParams:"")+t.hash;if(history.replaceState(history.state,"",r),typeof navigation=="object"&&typeof navigation.addEventListener=="function"&&typeof navigation.removeEventListener=="function"){let i=!1;const o=a=>{var u;i||(i=!0,navigation.removeEventListener("navigate",o),!a.userInitiated&&a.navigationType==="replace"&&((u=a.destination)===null||u===void 0?void 0:u.url)===e&&history.replaceState(history.state,"",r))};navigation.addEventListener("navigate",o)}}}_oauthLoginInit(){return X(this,void 0,void 0,function*(){var t,e,r,i;if(typeof window>"u"||typeof window.location>"u"||typeof URLSearchParams>"u")return null;const o=new URLSearchParams(window.location.search);if(!o.get(re))return null;const a=o.get("error");if(a)return this._replaceUrlAfterOAuth(),{error:{message:a}};const u=o.get("code");if(!u)return null;this._replaceUrlAfterOAuth();try{const{user:h}=yield We({apiURI:this.config.apiURI,appId:this.config.appId,code:u});return this.setCurrentUser(h),null}catch(h){return((t=h==null?void 0:h.body)===null||t===void 0?void 0:t.type)==="record-not-found"&&((r=(e=h==null?void 0:h.body)===null||e===void 0?void 0:e.hint)===null||r===void 0?void 0:r["record-type"])==="app-oauth-code"&&(yield this._hasCurrentUser())?null:{error:{message:((i=h==null?void 0:h.body)===null||i===void 0?void 0:i.message)||"Error logging in."}}}})}_waitForOAuthCallbackResponse(){return X(this,void 0,void 0,function*(){return yield this._oauthCallbackResponse})}__subscribeMutationErrors(t){return this.mutationErrorCbs.push(t),()=>{this.mutationErrorCbs=this.mutationErrorCbs.filter(e=>e!==t)}}subscribeAuth(t){this.authCbs.push(t);const e=this._currentUserCached;e.isLoading||t(this._currentUserCached);let r=!1;return this.getCurrentUser().then(i=>{r||Wt(i,e)||t(i)}),()=>{r=!0,this.authCbs=this.authCbs.filter(i=>i!==t)}}subscribeAttrs(t){return this.attrsCbs.push(t),this.attrs&&t(this.attrs),()=>{this.attrsCbs=this.attrsCbs.filter(e=>e!==t)}}notifyAuthSubs(t){this.authCbs.forEach(e=>e(t))}notifyMutationErrorSubs(t){this.mutationErrorCbs.forEach(e=>e(t))}notifyAttrsSubs(){if(!this.attrs)return;const t=this.optimisticAttrs();this.attrsCbs.forEach(e=>e(t))}setCurrentUser(t){return X(this,void 0,void 0,function*(){yield this._persister.setItem(ie,JSON.stringify(t))})}getCurrentUserCached(){return this._currentUserCached}getCurrentUser(){return X(this,void 0,void 0,function*(){const t=yield this._waitForOAuthCallbackResponse();if(t!=null&&t.error){const i={error:t.error,user:void 0};return this._currentUserCached=Object.assign({isLoading:!1},i),i}const e=yield this._persister.getItem(ie),r={user:JSON.parse(e),error:void 0};return this._currentUserCached=Object.assign({isLoading:!1},r),r})}_hasCurrentUser(){return X(this,void 0,void 0,function*(){const t=yield this._persister.getItem(ie);return JSON.parse(t)!=null})}changeCurrentUser(t){return X(this,void 0,void 0,function*(){var e;const{user:r}=yield this.getCurrentUser();if(!Wt(r,t)){yield this.setCurrentUser(t),this.updateUser(t);try{(e=this._broadcastChannel)===null||e===void 0||e.postMessage({type:"auth"})}catch(i){console.error("Error posting message to broadcast channel",i)}}})}updateUser(t){const e={error:void 0,user:t};this._currentUserCached=Object.assign({isLoading:!1},e),this.querySubs.set(r=>(Object.keys(r).forEach(i=>{delete r[i].result}),r)),this._reconnectTimeoutMs=0,this._ws.close(),this._oauthCallbackResponse=null,this.notifyAuthSubs(e)}sendMagicCode({email:t}){return ni({apiURI:this.config.apiURI,appId:this.config.appId,email:t})}signInWithMagicCode(t){return X(this,arguments,void 0,function*({email:e,code:r}){const i=yield ri({apiURI:this.config.apiURI,appId:this.config.appId,email:e,code:r});return this.changeCurrentUser(i.user),i})}signInWithCustomToken(t){return X(this,void 0,void 0,function*(){const e=yield ii({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:t});this.changeCurrentUser(e.user)})}signOut(){return X(this,void 0,void 0,function*(){var t;const e=yield this.getCurrentUser(),r=(t=e==null?void 0:e.user)===null||t===void 0?void 0:t.refresh_token;if(r)try{yield si({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:r})}catch{}this.changeCurrentUser(null)})}createAuthorizationURL({clientName:t,redirectURL:e}){const{apiURI:r,appId:i}=this.config;return`${r}/runtime/oauth/start?app_id=${i}&client_name=${t}&redirect_uri=${e}`}exchangeCodeForToken(t){return X(this,arguments,void 0,function*({code:e,codeVerifier:r}){const i=yield We({apiURI:this.config.apiURI,appId:this.config.appId,code:e,codeVerifier:r});return this.changeCurrentUser(i.user),i})}issuerURI(){const{apiURI:t,appId:e}=this.config;return`${t}/runtime/${e}`}signInWithIdToken(t){return X(this,arguments,void 0,function*({idToken:e,clientName:r,nonce:i}){var o;const a=yield this.getCurrentUser(),u=(o=a==null?void 0:a.user)===null||o===void 0?void 0:o.refresh_token,h=yield oi({apiURI:this.config.apiURI,appId:this.config.appId,idToken:e,clientName:r,nonce:i,refreshToken:u});return this.changeCurrentUser(h.user),h})}joinRoom(t){return this._trySendAuthed(Z(),{op:"join-room","room-id":t}),()=>{this._cleanupRoom(t)}}_cleanupRoom(t){var e,r,i;!(!((r=(e=this._presence[t])===null||e===void 0?void 0:e.handlers)===null||r===void 0)&&r.length)&&!Object.keys((i=this._broadcastSubs[t])!==null&&i!==void 0?i:{}).length&&(delete this._presence[t],delete this._broadcastSubs[t],this._trySendAuthed(Z(),{op:"leave-room","room-id":t}))}getPresence(t,e,r={}){const i=this._presence[e];return!i||!i.result?null:Object.assign(Object.assign({},di(i.result,r)),{isLoading:i.isLoading,error:i.error})}publishPresence(t,e,r){var i,o;const a=Object.assign(Object.assign({},(o=(i=this._presence[e])===null||i===void 0?void 0:i.result)===null||o===void 0?void 0:o.user),r);this._trySendAuthed(Z(),{op:"set-presence","room-id":e,data:a}),this._presence[e]=this._presence[e]||{},this._presence[e].result=this._presence[e].result||{},this._presence[e].result.user=a,this._notifyPresenceSubs(e)}subscribePresence(t,e,r,i){const o=this.joinRoom(e),a=Object.assign(Object.assign({},r),{roomId:e,cb:i,prev:null});return this._presence[e]=this._presence[e]||{},this._presence[e].isLoading=!0,this._presence[e].handlers=this._presence[e].handlers||[],this._presence[e].handlers.push(a),this._notifyPresenceSub(e,a),()=>{var u,h,c;this._presence[e].handlers=(c=(h=(u=this._presence[e])===null||u===void 0?void 0:u.handlers)===null||h===void 0?void 0:h.filter(d=>d!==a))!==null&&c!==void 0?c:[],o()}}_notifyPresenceSubs(t){var e,r;(r=(e=this._presence[t])===null||e===void 0?void 0:e.handlers)===null||r===void 0||r.forEach(i=>{this._notifyPresenceSub(t,i)})}_notifyPresenceSub(t,e){const r=this.getPresence("",t,e);r&&(e.prev&&!fi(r,e.prev)||(e.prev=r,e.cb(r)))}_setPresencePeers(t,e){const r=Object.assign({},e);delete r[this._sessionId];const i=Object.fromEntries(Object.entries(r).map(([o,a])=>[o,a.data]));this._presence[t]=this._presence[t]||{},this._presence[t].result=this._presence[t].result||{},this._presence[t].result.peers=i}publishTopic({roomType:t,roomId:e,topic:r,data:i}){this._trySendAuthed(Z(),{op:"client-broadcast","room-id":e,roomType:t,topic:r,data:i})}subscribeTopic(t,e,r){const i=this.joinRoom(t);return this._broadcastSubs[t]=this._broadcastSubs[t]||{},this._broadcastSubs[t][e]=this._broadcastSubs[t][e]||[],this._broadcastSubs[t][e].push(r),this._presence[t]=this._presence[t]||{},()=>{this._broadcastSubs[t][e]=this._broadcastSubs[t][e].filter(o=>o!==r),this._broadcastSubs[t][e].length||delete this._broadcastSubs[t][e],i()}}_notifyBroadcastSubs(t,e,r){var i,o,a;(a=(o=(i=this._broadcastSubs)===null||i===void 0?void 0:i[t])===null||o===void 0?void 0:o[e])===null||a===void 0||a.forEach(u=>{var h,c,d,m,C,U;const E=(h=r.data)===null||h===void 0?void 0:h.data,x=r.data["peer-id"]===this._sessionId?(d=(c=this._presence[t])===null||c===void 0?void 0:c.result)===null||d===void 0?void 0:d.user:(U=(C=(m=this._presence[t])===null||m===void 0?void 0:m.result)===null||C===void 0?void 0:C.peers)===null||U===void 0?void 0:U[r.data["peer-id"]];return u(E,x)})}upload(t,e){return X(this,void 0,void 0,function*(){var r;const i=yield this.getCurrentUser(),o=(r=i==null?void 0:i.user)===null||r===void 0?void 0:r.refresh_token,a=t||e.name,u=yield ai({apiURI:this.config.apiURI,appId:this.config.appId,fileName:a,refreshToken:o});return yield ui(u,e)})}getDownloadUrl(t){return X(this,void 0,void 0,function*(){var e;const r=yield this.getCurrentUser(),i=(e=r==null?void 0:r.user)===null||e===void 0?void 0:e.refresh_token;return yield ci({apiURI:this.config.apiURI,appId:this.config.appId,path:t,refreshToken:i})})}deleteFile(t){return X(this,void 0,void 0,function*(){var e;const r=yield this.getCurrentUser(),i=(e=r==null?void 0:r.user)===null||e===void 0?void 0:e.refresh_token;return yield li({apiURI:this.config.apiURI,appId:this.config.appId,path:t,refreshToken:i})})}}let $t;function Ei(n){$t==null||$t.dispose();const t=Oi(),e=ki(a),r=Ii(Ai(n));function i(c){var d;c.source===r.element.contentWindow&&((d=c.data)===null||d===void 0?void 0:d.type)==="close"&&t.isVisible()&&a()}function o(c){const d=c.shiftKey&&c.ctrlKey&&c.key==="0",m=c.key==="Escape"||c.key==="Esc";(d||m)&&a()}function a(){t.isVisible()?t.element.style.display="none":(t.element.style.display="block",t.element.contains(r.element)||t.element.appendChild(r.element))}function u(){t.element.remove(),e.element.remove(),removeEventListener("keydown",o),removeEventListener("message",i)}function h(){document.body.appendChild(t.element),document.body.appendChild(e.element),addEventListener("keydown",o),addEventListener("message",i),$t={dispose:u}}return h()}function Ai(n){return`${window.DEV_DEVTOOL?"http://localhost:3000":"https://instantdb.com"}/_devtool?appId=${n}`}function Ii(n){const t=document.createElement("iframe");return t.src=n,Object.assign(t.style,{width:"100%",height:"100%",borderRadius:"4px",backgroundColor:"white",border:"none"}),{element:t}}function ki(n){const t=`
    <svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect width="512" height="512" fill="black"/>
      <rect x="97.0973" y="91.3297" width="140" height="330" fill="white"/>
    </svg>
  `,e=document.createElement("button");return e.innerHTML=t,Object.assign(e.style,{position:"fixed",bottom:"24px",left:"24px",height:"32px",width:"32px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0",margin:"0",border:"none",cursor:"pointer"}),e.addEventListener("click",n),{element:e}}function Oi(){const n=document.createElement("div");Object.assign(n.style,{position:"fixed",bottom:"24px",right:"24px",left:"60px",top:"72px",display:"block",borderRadius:"4px",border:"1px #ccc solid",boxShadow:"0px 0px 8px #00000044",backgroundColor:"#eee",zIndex:"999990"}),n.style.display="none";function t(){return n.style.display!=="none"}return{element:n,isVisible:t}}const xi=!0,ji={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"};function Ci(){var n;return globalThis.__instantDbStore=(n=globalThis.__instantDbStore)!==null&&n!==void 0?n:{},globalThis.__instantDbStore}const fe=Ci();function Pi(n,t,e){return Mi(n)}function Mi(n,t,e){const r=fe[n.appId];if(r)return r;const i=new Si(Object.assign(Object.assign({},ji),n),bn,mn),o=new Ti(i);return fe[n.appId]=o,typeof window<"u"&&typeof window.location<"u"&&("devtool"in n?n.devtool:xi)&&window.location.hostname==="localhost"&&!globalThis._nodevtool&&Ei(n.appId),o}class Ti{constructor(t){this.tx=ln(),this._reactor=t,this.auth=new Bi(this._reactor),this.storage=new Ui(this._reactor)}transact(t){return this._reactor.pushTx(t)}getLocalId(t){return this._reactor.getLocalId(t)}subscribeQuery(t,e){return this._reactor.subscribeQuery(t,e)}subscribeAuth(t){return this._reactor.subscribeAuth(t)}joinRoom(t="_defaultRoomType",e="_defaultRoomId"){return{leaveRoom:this._reactor.joinRoom(e),subscribeTopic:(i,o)=>this._reactor.subscribeTopic(e,i,o),subscribePresence:(i,o)=>this._reactor.subscribePresence(t,e,i,o),publishTopic:(i,o)=>this._reactor.publishTopic({roomType:t,roomId:e,topic:i,data:o}),publishPresence:i=>this._reactor.publishPresence(t,e,i),getPresence:i=>this._reactor.getPresence(t,e,i)}}shutdown(){delete fe[this._reactor.config.appId],this._reactor.shutdown()}}class Bi{constructor(t){this.db=t,this.sendMagicCode=e=>this.db.sendMagicCode(e),this.signInWithMagicCode=e=>this.db.signInWithMagicCode(e),this.signInWithToken=e=>this.db.signInWithCustomToken(e),this.createAuthorizationURL=e=>this.db.createAuthorizationURL(e),this.signInWithIdToken=e=>this.db.signInWithIdToken(e),this.exchangeOAuthCode=e=>this.db.exchangeCodeForToken(e),this.issuerURI=()=>this.db.issuerURI(),this.signOut=()=>this.db.signOut()}}class Ui{constructor(t){this.db=t,this.upload=(e,r)=>this.db.upload(e,r),this.put=this.upload,this.getDownloadUrl=e=>this.db.getDownloadUrl(e),this.delete=e=>this.db.deleteFile(e)}}function Li(n){requestAnimationFrame(function(){n.forEach(function(t){window.getComputedStyle(document.getElementById(t)).opacity,document.getElementById(t).style.opacity=1})})}function Ri(n,t){n.style.opacity=t,n.style.transition="none",requestAnimationFrame(()=>{n.style.transition=""})}function Ni(n){document.getElementById("tip-txt").innerHTML=n,document.getElementById("tip").open=!0,Li(["tip"]),setTimeout(()=>{document.getElementById("tip").open=!1,Ri(document.getElementById("tip"),0)},3500)}function Ye(n){return n.split(`
`).map(t=>t.trim()).filter(t=>t.length>0)}function Di(n){const t=n[1],e=document.createElement("div");e.innerHTML=t;const r=e.textContent||e.innerText||"",i=r.split(" ");return i.length>20?i.slice(0,20).join(" ")+"...":r}function $i(){return`
        <iframe src="https://einar-method.github.io/dice-app/embed" width="100%" height="350" frameborder="0" allowfullscreen></iframe>
    `}function Fi(){const n=`
        <section class="janken__section">
            <h2>E•M's Janken</h2>
            <p class="green__text">Just pick "rock", "paper", or "scissors" below to get started. Let's play!</p>
            <div class="janken__btn_holder">
            <button class="janken__buttons" id="rock">rock</button>
            <button class="janken__buttons" id="paper">paper</button>
            <button class="janken__buttons" id="scissors">scissors</button>
            </div>
        </section>
    `;return console.log(Ye(n)),Ye(n)}function qi(){document.querySelectorAll("button.janken__buttons").forEach(t=>t.addEventListener("click",e=>{const r=e.target.id,i=Wi(),o=Ji(i,r),a=`You picked ${r}, CJ picked ${i}.<br>${o}`;Ni(a)}))}function Wi(){const n=Math.floor(Math.random()*3);return n===0?"rock":n===1?"scissors":"paper"}function Ji(n,t){let e;return n===t&&(e="It's a draw..."),n==="rock"&&t==="paper"&&(e="You win!"),n==="rock"&&t==="scissors"&&(e="Sorry, you lost :("),n==="paper"&&t==="scissors"&&(e="You win!"),n==="paper"&&t==="rock"&&(e="Sorry, you lost :("),n==="scissors"&&t==="paper"&&(e="Sorry, you lost :("),n==="scissors"&&t==="rock"&&(e="You win!"),e}function Ft(){const n=document.getElementById("toHomeBtn"),t=document.getElementById("toPortfolioBtn"),e=document.getElementById("toMerchBtn"),r=document.getElementById("toBlogBtn");n&&document.getElementById("toHomeBtn").addEventListener("click",function(){document.getElementById("homeBtn").click()}),t&&document.getElementById("toPortfolioBtn").addEventListener("click",function(){document.getElementById("portfolioBtn").click()}),e&&document.getElementById("toMerchBtn").addEventListener("click",function(){document.getElementById("merchBtn").click()}),r&&document.getElementById("toBlogBtn").addEventListener("click",function(){document.getElementById("blogBtn").click()})}function zi(n,t){console.log("Article clicked:",t);const e=n.find(i=>"blogID"+i.id===t),r=n.find(i=>"portfolioItem"+i.id===t);e?qt(e.content):r?t==="portfolioItembd5e5158-d43b-45b8-8889-7927ffbbad99"?(qt(Fi(),!0),qi()):t==="portfolioItem2f0a1276-b0dd-47d2-a675-23846c214d29"?qt($i(),!0):t==="portfolioItem-none"||qt(r.content):console.log("Article not found!")}function qt(n,t){console.table(n);const e=Array.isArray(n)?n.map(i=>i).join(""):n;let r="";if(t!==!0&&(r='<a href="javascript:void(0)" class="blog__closebtn_top">&times;</a>'),!document.getElementById("myNav")){const i=`
    <div id="myNav" class="blogPost__overlay">
        
        <div class="blogPost__overlay_content" id="postContent">
          ${r}
          ${e}
        </div>
        <div class="blogPost__overlay_footer">
            <button class="like-btn">Like</button>
            <button class="scroll-top-btn">To Top</button>
            <button class="blog__closebtn_bottom">&times;</button>
        </div>
    </div>
  `;document.body.insertAdjacentHTML("beforeend",i),t==!0||document.querySelector(".blog__closebtn_top").addEventListener("click",Ke),document.querySelector(".blog__closebtn_bottom").addEventListener("click",Ke),document.querySelector(".like-btn").addEventListener("click",Vi),document.querySelector(".scroll-top-btn").addEventListener("click",Hi)}document.getElementById("myNav").style.width="100%"}function Ke(){const n=document.getElementById("myNav");n&&n.remove()}function Hi(){const n=document.querySelector(".blogPost__overlay_content");n&&n.scrollIntoView({behavior:"smooth",block:"start"})}function Vi(){console.log("User added a like")}function Yi(){return`
      <button class="nav__header_btns" id="homeBtn">home</button>
      <button class="nav__header_btns" id="portfolioBtn">portfolio</button>
      <button class="nav__header_btns" id="merchBtn">merch</button>
      <button class="nav__header_btns" id="blogBtn">blog</button>
    `}function Ki(n){return`
        <dialog id="tip"><strong></strong> <span id="tip-txt"></span></dialog>
        <main class="home__page">
          <section class="welcome__section">
            <img class="cover__image" src="./cjatsakura.webp" alt="An AI altered picture of CJ, aka E•M, by a cherry tree." />
            <div class="welcome__text">
              <p>RPG hobbyist</p>
              <p>Indie game creator</p>
              <p>Freelance web developer</p>
            </div>
            
          </section>

          <section class="links__section">
            <div class="icons">
              <a
                  href="https://aka-em.itch.io/"
                  target="_blank"
                  class="fa-brands fa-itch-io"
              ></a>
            </div>

            <div class="icons">
              <a
                  href="https://github.com/einar-method"
                  target="_blank"
                  class="fa fa-github"
              ></a>
            </div>
            <div class="icons">
              <a
                  href="https://travelingbardgames.substack.com/"
                  target="_blank"
                  class="fa fa-rss"
              ></a>
            </div>
            <div class="icons">
              <a
                  href="https://open.spotify.com/track/1GGLQhjZSB6h0Qkfu2OvAf?si=4cafaec035cb4ed6"
                  class="fa-brands fa-spotify"
                  target="_blank"
              ></a>
            </div>
            <div class="icons">
              <a
                  href="https://ordes.netlify.app/"
                  class="fa-solid fa-globe"
                  target="_blank"
              ></a>
            </div>
            <div class="icons">
              <a
                  href="https://buymeacoffee.com/em.bmc"
                  class="fa-solid fa-mug-hot"
                  target="_blank"
              ></a>
            </div>
          </section>

          <section class="endPage__navigation">
              <div class="endPage__navigation_left" id="toBlogBtn">
                  <a class="fa-solid fa-arrow-turn-down fa-rotate-90"></a>
                  <p>check out short stories and more on the blog</p>
              </div>
              <div class="endPage__navigation_right" id="toPortfolioBtn">
                  <p>see some of my apps and projects in portfolio</p>
                  <a class="fa-solid fa-arrow-right-long"></a>
              </div>
          </section>
        </main>
    `}function Gi(n){return`
      <ul class="portfolio__list">
        ${n.portfolio.map(t=>`
          <li class="blog__post" id="portfolioItem${t.id}">
            <h3>${t.title}</h3>
            <p>${t.description}</p>
            <p>Click to see more</p>
          </li>
        `).join("")}
      </ul>
    `}function Qi(n){return`
        <dialog id="tip"><strong></strong> <span id="tip-txt"></span></dialog>
        <main id="folioGrid">
        <section class="innerGrid">
            ${Gi(n)}
        </section>
        <section class="endPage__navigation">
            <div class="endPage__navigation_left" id="toHomeBtn">
            <a class="fa-solid fa-arrow-left-long"></a>  
            <p>find my links on the homepage</p>
            </div>
            <div class="endPage__navigation_right" id="toMerchBtn">
            <p>check out free and pwyw stuff in the store!</p>
            <a class="fa-solid fa-arrow-right-long"></a>
            </div>
        </section>
        </main>
    `}function Xi(n){return`
        <ul class="merch__list">
        ${n.merch.map(t=>`
            <li class="merchCard" id="merchItem${t.id}">
            <h3>${t.title}</h3>
            <img src="${t.imageLink}" alt="${t.imageAlt}">
            <p>${t.description}</p>
            <a class="merchBtn" href="${t.actionLink}" target="_blank">${t.actionType}</a>
            <a href="${t.mainLink}" target="_blank">${t.mainLinkText}</a>
            </li>
        `).join("")}
        </ul>
    `}function Zi(n){return`
      <dialog id="tip"><strong></strong> <span id="tip-txt"></span></dialog>
      <main id="itchGrid">
        <section class="innerGrid">
          ${Xi(n)}
        </section>
        <section class="endPage__navigation">
          <div class="endPage__navigation_left" id="toPortfolioBtn">
            <a class="fa-solid fa-arrow-left-long"></a>  
            <p>see some of my apps and projects in portfolio</p>
          </div>
          <div class="endPage__navigation_right" id="toBlogBtn">
            <p>check out short stories and more on the blog</p>
            <a class="fa-solid fa-arrow-right-long"></a>
          </div>
        </section>
      </main>
    `}function to(n){return`
      <main class="blog__page" id="blogPage">
        <section class="blog__about">
          <p>
            A place to read fantasy short stories and WIP novels. 
            Sometimes you’ll also find reviews, ideas, or spotlights on 
            worlds, games, material, or tools for any and all RPGs. 
            Occasionally, there will be some real world musings.
          </p>
          <div id="custom-substack-embed"></div>
        </section>
        <!--${no()} -->
        ${eo(n)}
        <section class="endPage__navigation">
          <div class="endPage__navigation_left" id="toMerchBtn">
            <a class="fa-solid fa-arrow-left-long"></a>  
            <p>check out free and pwyw stuff in the store!</p>
          </div>
          <div class="endPage__navigation_right" id="toHomeBtn">
            <p>find my links on the homepage</p>
            <a class="fa-solid fa-tent-arrow-turn-left fa-flip-horizontal"></a>
          </div>
        </section>
      </main>
    `}function eo(n){return`
      <section class="blog__section">
          ${n.blog.map(t=>`
            <article class="blog__post" id="blogID${t.id}">
              <h2 class="blog__header">${t.title}</h2>
              <h3 class="blog__subheader">${t.subtitle}</h3>
              <p class="blog__paragraph">${Di(t.content)}</p>
              <p class="blog__date">Date: ${t.postDate}</p>
            </article>
          `).join("")}
      </section>
    `}function no(){return`
      <div class="blog__section_tab_holder_outer">
        <div id="blogSectionTab" class="blog__section_tab_holder_inner">
          <fieldset 
              id="tab-toggle" 
              class="blog__section_tab_options" 
          >
  
          <p>
              <input 
              type="radio" 
              name="tool-toggle" 
              id="storiesTab" 
              value="storiesTab"
              class="tool-toggle"
              checked>
              <label for="storiesTab">stories</label>
          </p>
  
          <p>
              <input 
              type="radio" 
              name="tool-toggle" 
              id="musingsTab" 
              value="musingsTab"
              class="tool-toggle">
              <label for="musingsTab">musings</label>
          </p>
          <p>
              <input 
              type="radio" 
              name="tool-toggle" 
              id="gamesTab" 
              value="gamesTab"
              class="tool-toggle">
              <label for="gamesTab">games</label>
          </p>
          </fieldset>
        </div>
      </div>
    `}class ro{constructor(){this.buttons=[{name:"home",id:"homeBtn",isActive:!0},{name:"portfolio",id:"portfolioBtn",isActive:!1},{name:"merch",id:"merchBtn",isActive:!1},{name:"blog",id:"blogBtn",isActive:!1}],this.defaultStyle=`
        color: var(--white-color);
        background-color: var(--primary-color);
        border: 0.1px solid var(--white-color);
        border-radius: 0px;
        padding: 5px 5px;
        display: inline-block;
        font-size: 18px;
        letter-spacing: 1px;
        cursor: pointer;
        box-shadow: inset 0 0 0 0 var(--white-color);
        -webkit-transition: ease-out 0.4s;
        -moz-transition: ease-out 0.4s;
        transition: ease-out 0.4s;
        flex-grow: 1;
      `,this.activeStyle=`
        color: var(--tirtary-color);
        background-color: var(--primary-color);
        border-left: 0.1px solid var(--white-color);
        border-right: 0.1px solid var(--white-color);
        border-top: 0.1px solid var(--white-color);
        border-bottom: 0.1px solid var(--white-color);
        border-radius: 0px;
        padding: 5px 5px;
        display: inline-block;
        font-size: 18px;
        letter-spacing: 1px;
        cursor: default;
        box-shadow: inset 0 0 0 25px var(--secondary-color);
        -webkit-transition: ease-out 0.4s;
        -moz-transition: ease-out 0.4s;
        transition: ease-out 0.4s;
        flex-grow: 1;
      `,this.hoverStyle=`
        color: var(--secondary-color);
        background-color: var(--primary-color);
        border: 0.1px solid var(--white-color);
        border-radius: 0px;
        padding: 5px 5px;
        display: inline-block;
        font-size: 18px;
        letter-spacing: 1px;
        cursor: pointer;
        box-shadow: inset 0 0 0 25px var(--white-color);
        -webkit-transition: ease-out 0.4s;
        -moz-transition: ease-out 0.4s;
        transition: ease-out 0.4s;
        flex-grow: 1;
      `}applyStyles(t){const e=document.getElementById(t.id);e.style=t.isActive?this.activeStyle:this.defaultStyle,e.addEventListener("mouseover",()=>{t.isActive||(e.style=this.hoverStyle)}),e.addEventListener("mouseout",()=>{e.style=t.isActive?this.activeStyle:this.defaultStyle})}applyAllStyles(){document.styleSheets[0].insertRule("#homeBtn:hover { background-color: red; }",1),this.buttons.forEach(t=>this.applyStyles(t))}}const io="bcc500de-07a9-4fde-9025-c87906e63bf3",oo=Pi({appId:io});oo.subscribeQuery({blog:{},merch:{},portfolio:{}},n=>{if(n.error){ao(n.error.message);return}n.data&&(so(n.data),console.log("A preview of all data:",n.data))});const wt=document.getElementById("app");function so(n){document.getElementById("navHeader").innerHTML=Yi(),window.navButtons=new ro,window.navButtons.applyAllStyles(),document.querySelectorAll(".nav__header_btns").forEach(t=>{t.addEventListener("click",function(){const e=this.getAttribute("id");uo(e,n)})}),wt.innerHTML="",wn(n)}function ao(n){wt.innerHTML=`
    <div>${n}</div>
  `}function Ge(n){document.querySelectorAll(".blog__post").forEach(t=>{t.addEventListener("click",function(){const e=this.getAttribute("id");zi(n,e)})}),lo()}function uo(n,t){window.navButtons.buttons.forEach(e=>{e.id===n?(e.isActive=!0,wn(t)):e.isActive=!1,window.navButtons.applyStyles(e)})}function wn(n){const t=window.navButtons.buttons.find(e=>e.isActive===!0);t?(console.log(`The active button's id is: ${t.id}`),t.id==="homeBtn"?(console.log("Home button is active"),wt.innerHTML=Ki(),Ft()):t.id==="portfolioBtn"?(console.log("Portfolio button is active"),wt.innerHTML=Qi(n),Ge(n.portfolio),Ft()):t.id==="merchBtn"?(console.log("Merch button is active"),wt.innerHTML=Zi(n),Ft()):t.id==="blogBtn"?(console.log("Blog button is active"),wt.innerHTML=to(n),Ge(n.blog),Ft()):console.log("No active button found")):console.log("No active button found.")}function co(){document.querySelectorAll("*").forEach(t=>{const e=window.getComputedStyle(t);e.position==="fixed"&&e.bottom==="24px"&&e.left==="24px"&&e.height==="32px"&&e.width==="32px"&&e.display==="flex"&&e.alignItems==="center"&&(t.remove(),console.log("Element removed:",t))})}document.addEventListener("DOMContentLoaded",function(){co()});window.CustomSubstackWidget={substackUrl:"travelingbardgames.substack.com",placeholder:"example@mail.com",buttonText:"Subscribe",theme:"custom",colors:{primary:"#212121",input:"#99ca3c",email:"#000000",text:"#FFFFFF"}};function lo(){const n=document.createElement("script");n.src="https://substackapi.com/widget.js",n.async=!0,document.body.appendChild(n)}
