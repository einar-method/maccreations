(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const xt=(()=>{let n=!1;typeof window<"u"&&typeof window.localStorage<"u"?n=!!window.localStorage.getItem("loggingEnabled"):n=!1;function t(e){return(...r)=>{n&&console[e](...r)}}return{info:t("info"),debug:t("debug"),error:t("error")}})();function Bt(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ge={exports:{}};(function(n,t){(function(e){n.exports=e()})(function(){return function e(r,i,o){function a(c,d){if(!i[c]){if(!r[c]){var m=typeof Bt=="function"&&Bt;if(!d&&m)return m(c,!0);if(u)return u(c,!0);throw new Error("Cannot find module '"+c+"'")}d=i[c]={exports:{}},r[c][0].call(d.exports,function(T){var L=r[c][1][T];return a(L||T)},d,d.exports,e,r,i,o)}return i[c].exports}for(var u=typeof Bt=="function"&&Bt,f=0;f<o.length;f++)a(o[f]);return a}({1:[function(e,r,i){(function(o,a,u,f,c,d,m,T,L){var E=e("crypto");function x(b,S){S=M(b,S);var h;return(h=S.algorithm!=="passthrough"?E.createHash(S.algorithm):new B).write===void 0&&(h.write=h.update,h.end=h.update),O(S,h).dispatch(b),h.update||h.end(""),h.digest?h.digest(S.encoding==="buffer"?void 0:S.encoding):(b=h.read(),S.encoding!=="buffer"?b.toString(S.encoding):b)}(i=r.exports=x).sha1=function(b){return x(b)},i.keys=function(b){return x(b,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},i.MD5=function(b){return x(b,{algorithm:"md5",encoding:"hex"})},i.keysMD5=function(b){return x(b,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var _=E.getHashes?E.getHashes().slice():["sha1","md5"],j=(_.push("passthrough"),["buffer","hex","binary","base64"]);function M(b,S){var h={};if(h.algorithm=(S=S||{}).algorithm||"sha1",h.encoding=S.encoding||"hex",h.excludeValues=!!S.excludeValues,h.algorithm=h.algorithm.toLowerCase(),h.encoding=h.encoding.toLowerCase(),h.ignoreUnknown=S.ignoreUnknown===!0,h.respectType=S.respectType!==!1,h.respectFunctionNames=S.respectFunctionNames!==!1,h.respectFunctionProperties=S.respectFunctionProperties!==!1,h.unorderedArrays=S.unorderedArrays===!0,h.unorderedSets=S.unorderedSets!==!1,h.unorderedObjects=S.unorderedObjects!==!1,h.replacer=S.replacer||void 0,h.excludeKeys=S.excludeKeys||void 0,b===void 0)throw new Error("Object argument required.");for(var g=0;g<_.length;++g)_[g].toLowerCase()===h.algorithm.toLowerCase()&&(h.algorithm=_[g]);if(_.indexOf(h.algorithm)===-1)throw new Error('Algorithm "'+h.algorithm+'"  not supported. supported values: '+_.join(", "));if(j.indexOf(h.encoding)===-1&&h.algorithm!=="passthrough")throw new Error('Encoding "'+h.encoding+'"  not supported. supported values: '+j.join(", "));return h}function k(b){if(typeof b=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(b))!=null}function O(b,S,h){h=h||[];function g(l){return S.update?S.update(l,"utf8"):S.write(l,"utf8")}return{dispatch:function(l){return this["_"+((l=b.replacer?b.replacer(l):l)===null?"null":typeof l)](l)},_object:function(l){var v,w=Object.prototype.toString.call(l),D=/\[object (.*)\]/i.exec(w);if(D=(D=D?D[1]:"unknown:["+w+"]").toLowerCase(),0<=(w=h.indexOf(l)))return this.dispatch("[CIRCULAR:"+w+"]");if(h.push(l),u!==void 0&&u.isBuffer&&u.isBuffer(l))return g("buffer:"),g(l);if(D==="object"||D==="function"||D==="asyncfunction")return w=Object.keys(l),b.unorderedObjects&&(w=w.sort()),b.respectType===!1||k(l)||w.splice(0,0,"prototype","__proto__","constructor"),b.excludeKeys&&(w=w.filter(function(R){return!b.excludeKeys(R)})),g("object:"+w.length+":"),v=this,w.forEach(function(R){v.dispatch(R),g(":"),b.excludeValues||v.dispatch(l[R]),g(",")});if(!this["_"+D]){if(b.ignoreUnknown)return g("["+D+"]");throw new Error('Unknown object type "'+D+'"')}this["_"+D](l)},_array:function(l,R){R=R!==void 0?R:b.unorderedArrays!==!1;var w=this;if(g("array:"+l.length+":"),!R||l.length<=1)return l.forEach(function(N){return w.dispatch(N)});var D=[],R=l.map(function(N){var C=new B,q=h.slice();return O(b,C,q).dispatch(N),D=D.concat(q.slice(h.length)),C.read().toString()});return h=h.concat(D),R.sort(),this._array(R,!1)},_date:function(l){return g("date:"+l.toJSON())},_symbol:function(l){return g("symbol:"+l.toString())},_error:function(l){return g("error:"+l.toString())},_boolean:function(l){return g("bool:"+l.toString())},_string:function(l){g("string:"+l.length+":"),g(l.toString())},_function:function(l){g("fn:"),k(l)?this.dispatch("[native]"):this.dispatch(l.toString()),b.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(l.name)),b.respectFunctionProperties&&this._object(l)},_number:function(l){return g("number:"+l.toString())},_xml:function(l){return g("xml:"+l.toString())},_null:function(){return g("Null")},_undefined:function(){return g("Undefined")},_regexp:function(l){return g("regex:"+l.toString())},_uint8array:function(l){return g("uint8array:"),this.dispatch(Array.prototype.slice.call(l))},_uint8clampedarray:function(l){return g("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(l))},_int8array:function(l){return g("int8array:"),this.dispatch(Array.prototype.slice.call(l))},_uint16array:function(l){return g("uint16array:"),this.dispatch(Array.prototype.slice.call(l))},_int16array:function(l){return g("int16array:"),this.dispatch(Array.prototype.slice.call(l))},_uint32array:function(l){return g("uint32array:"),this.dispatch(Array.prototype.slice.call(l))},_int32array:function(l){return g("int32array:"),this.dispatch(Array.prototype.slice.call(l))},_float32array:function(l){return g("float32array:"),this.dispatch(Array.prototype.slice.call(l))},_float64array:function(l){return g("float64array:"),this.dispatch(Array.prototype.slice.call(l))},_arraybuffer:function(l){return g("arraybuffer:"),this.dispatch(new Uint8Array(l))},_url:function(l){return g("url:"+l.toString())},_map:function(l){return g("map:"),l=Array.from(l),this._array(l,b.unorderedSets!==!1)},_set:function(l){return g("set:"),l=Array.from(l),this._array(l,b.unorderedSets!==!1)},_file:function(l){return g("file:"),this.dispatch([l.name,l.size,l.type,l.lastModfied])},_blob:function(){if(b.ignoreUnknown)return g("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return g("domwindow")},_bigint:function(l){return g("bigint:"+l.toString())},_process:function(){return g("process")},_timer:function(){return g("timer")},_pipe:function(){return g("pipe")},_tcp:function(){return g("tcp")},_udp:function(){return g("udp")},_tty:function(){return g("tty")},_statwatcher:function(){return g("statwatcher")},_securecontext:function(){return g("securecontext")},_connection:function(){return g("connection")},_zlib:function(){return g("zlib")},_context:function(){return g("context")},_nodescript:function(){return g("nodescript")},_httpparser:function(){return g("httpparser")},_dataview:function(){return g("dataview")},_signal:function(){return g("signal")},_fsevent:function(){return g("fsevent")},_tlswrap:function(){return g("tlswrap")}}}function B(){return{buf:"",write:function(b){this.buf+=b},end:function(b){this.buf+=b},read:function(){return this.buf}}}i.writeToStream=function(b,S,h){return h===void 0&&(h=S,S={}),O(S=M(b,S),h).dispatch(b)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(e,r,i){(function(o,a,u,f,c,d,m,T,L){(function(E){var x=typeof Uint8Array<"u"?Uint8Array:Array,_=43,j=47,M=48,k=97,O=65,B=45,b=95;function S(h){return h=h.charCodeAt(0),h===_||h===B?62:h===j||h===b?63:h<M?-1:h<M+10?h-M+26+26:h<O+26?h-O:h<k+26?h-k+26:void 0}E.toByteArray=function(h){var g,l;if(0<h.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var v=h.length,v=h.charAt(v-2)==="="?2:h.charAt(v-1)==="="?1:0,w=new x(3*h.length/4-v),D=0<v?h.length-4:h.length,R=0;function N(C){w[R++]=C}for(g=0;g<D;g+=4,0)N((16711680&(l=S(h.charAt(g))<<18|S(h.charAt(g+1))<<12|S(h.charAt(g+2))<<6|S(h.charAt(g+3))))>>16),N((65280&l)>>8),N(255&l);return v==2?N(255&(l=S(h.charAt(g))<<2|S(h.charAt(g+1))>>4)):v==1&&(N((l=S(h.charAt(g))<<10|S(h.charAt(g+1))<<4|S(h.charAt(g+2))>>2)>>8&255),N(255&l)),w},E.fromByteArray=function(h){var g,l,v,w,D=h.length%3,R="";function N(C){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(C)}for(g=0,v=h.length-D;g<v;g+=3)l=(h[g]<<16)+(h[g+1]<<8)+h[g+2],R+=N((w=l)>>18&63)+N(w>>12&63)+N(w>>6&63)+N(63&w);switch(D){case 1:R=(R+=N((l=h[h.length-1])>>2))+N(l<<4&63)+"==";break;case 2:R=(R=(R+=N((l=(h[h.length-2]<<8)+h[h.length-1])>>10))+N(l>>4&63))+N(l<<2&63)+"="}return R}})(i===void 0?this.base64js={}:i)}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(e,r,i){(function(o,a,_,f,c,d,m,T,L){var E=e("base64-js"),x=e("ieee754");function _(s,p,y){if(!(this instanceof _))return new _(s,p,y);var I,A,U,$,V=typeof s;if(p==="base64"&&V=="string")for(s=($=s).trim?$.trim():$.replace(/^\s+|\s+$/g,"");s.length%4!=0;)s+="=";if(V=="number")I=z(s);else if(V=="string")I=_.byteLength(s,p);else{if(V!="object")throw new Error("First argument needs to be a number, array or string.");I=z(s.length)}if(_._useTypedArrays?A=_._augment(new Uint8Array(I)):((A=this).length=I,A._isBuffer=!0),_._useTypedArrays&&typeof s.byteLength=="number")A._set(s);else if(J($=s)||_.isBuffer($)||$&&typeof $=="object"&&typeof $.length=="number")for(U=0;U<I;U++)_.isBuffer(s)?A[U]=s.readUInt8(U):A[U]=s[U];else if(V=="string")A.write(s,0,p);else if(V=="number"&&!_._useTypedArrays&&!y)for(U=0;U<I;U++)A[U]=0;return A}function j(s,p,y,I){return _._charsWritten=bt(function(A){for(var U=[],$=0;$<A.length;$++)U.push(255&A.charCodeAt($));return U}(p),s,y,I)}function M(s,p,y,I){return _._charsWritten=bt(function(A){for(var U,$,V=[],Y=0;Y<A.length;Y++)$=A.charCodeAt(Y),U=$>>8,$=$%256,V.push($),V.push(U);return V}(p),s,y,I)}function k(s,p,y){var I="";y=Math.min(s.length,y);for(var A=p;A<y;A++)I+=String.fromCharCode(s[A]);return I}function O(s,p,y,U){U||(P(typeof y=="boolean","missing or invalid endian"),P(p!=null,"missing offset"),P(p+1<s.length,"Trying to read beyond buffer length"));var A,U=s.length;if(!(U<=p))return y?(A=s[p],p+1<U&&(A|=s[p+1]<<8)):(A=s[p]<<8,p+1<U&&(A|=s[p+1])),A}function B(s,p,y,U){U||(P(typeof y=="boolean","missing or invalid endian"),P(p!=null,"missing offset"),P(p+3<s.length,"Trying to read beyond buffer length"));var A,U=s.length;if(!(U<=p))return y?(p+2<U&&(A=s[p+2]<<16),p+1<U&&(A|=s[p+1]<<8),A|=s[p],p+3<U&&(A+=s[p+3]<<24>>>0)):(p+1<U&&(A=s[p+1]<<16),p+2<U&&(A|=s[p+2]<<8),p+3<U&&(A|=s[p+3]),A+=s[p]<<24>>>0),A}function b(s,p,y,I){if(I||(P(typeof y=="boolean","missing or invalid endian"),P(p!=null,"missing offset"),P(p+1<s.length,"Trying to read beyond buffer length")),!(s.length<=p))return I=O(s,p,y,!0),32768&I?-1*(65535-I+1):I}function S(s,p,y,I){if(I||(P(typeof y=="boolean","missing or invalid endian"),P(p!=null,"missing offset"),P(p+3<s.length,"Trying to read beyond buffer length")),!(s.length<=p))return I=B(s,p,y,!0),2147483648&I?-1*(4294967295-I+1):I}function h(s,p,y,I){return I||(P(typeof y=="boolean","missing or invalid endian"),P(p+3<s.length,"Trying to read beyond buffer length")),x.read(s,p,y,23,4)}function g(s,p,y,I){return I||(P(typeof y=="boolean","missing or invalid endian"),P(p+7<s.length,"Trying to read beyond buffer length")),x.read(s,p,y,52,8)}function l(s,p,y,I,A){if(A||(P(p!=null,"missing value"),P(typeof I=="boolean","missing or invalid endian"),P(y!=null,"missing offset"),P(y+1<s.length,"trying to write beyond buffer length"),kt(p,65535)),A=s.length,!(A<=y))for(var U=0,$=Math.min(A-y,2);U<$;U++)s[y+U]=(p&255<<8*(I?U:1-U))>>>8*(I?U:1-U)}function v(s,p,y,I,A){if(A||(P(p!=null,"missing value"),P(typeof I=="boolean","missing or invalid endian"),P(y!=null,"missing offset"),P(y+3<s.length,"trying to write beyond buffer length"),kt(p,4294967295)),A=s.length,!(A<=y))for(var U=0,$=Math.min(A-y,4);U<$;U++)s[y+U]=p>>>8*(I?U:3-U)&255}function w(s,p,y,I,A){A||(P(p!=null,"missing value"),P(typeof I=="boolean","missing or invalid endian"),P(y!=null,"missing offset"),P(y+1<s.length,"Trying to write beyond buffer length"),Ot(p,32767,-32768)),s.length<=y||l(s,0<=p?p:65535+p+1,y,I,A)}function D(s,p,y,I,A){A||(P(p!=null,"missing value"),P(typeof I=="boolean","missing or invalid endian"),P(y!=null,"missing offset"),P(y+3<s.length,"Trying to write beyond buffer length"),Ot(p,2147483647,-2147483648)),s.length<=y||v(s,0<=p?p:4294967295+p+1,y,I,A)}function R(s,p,y,I,A){A||(P(p!=null,"missing value"),P(typeof I=="boolean","missing or invalid endian"),P(y!=null,"missing offset"),P(y+3<s.length,"Trying to write beyond buffer length"),Lt(p,34028234663852886e22,-34028234663852886e22)),s.length<=y||x.write(s,p,y,I,23,4)}function N(s,p,y,I,A){A||(P(p!=null,"missing value"),P(typeof I=="boolean","missing or invalid endian"),P(y!=null,"missing offset"),P(y+7<s.length,"Trying to write beyond buffer length"),Lt(p,17976931348623157e292,-17976931348623157e292)),s.length<=y||x.write(s,p,y,I,52,8)}i.Buffer=_,i.SlowBuffer=_,i.INSPECT_MAX_BYTES=50,_.poolSize=8192,_._useTypedArrays=function(){try{var s=new ArrayBuffer(0),p=new Uint8Array(s);return p.foo=function(){return 42},p.foo()===42&&typeof p.subarray=="function"}catch{return!1}}(),_.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},_.isBuffer=function(s){return!(s==null||!s._isBuffer)},_.byteLength=function(s,p){var y;switch(s+="",p||"utf8"){case"hex":y=s.length/2;break;case"utf8":case"utf-8":y=st(s).length;break;case"ascii":case"binary":case"raw":y=s.length;break;case"base64":y=ut(s).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":y=2*s.length;break;default:throw new Error("Unknown encoding")}return y},_.concat=function(s,p){if(P(J(s),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),s.length===0)return new _(0);if(s.length===1)return s[0];if(typeof p!="number")for(A=p=0;A<s.length;A++)p+=s[A].length;for(var y=new _(p),I=0,A=0;A<s.length;A++){var U=s[A];U.copy(y,I),I+=U.length}return y},_.prototype.write=function(s,p,y,I){isFinite(p)?isFinite(y)||(I=y,y=void 0):(Y=I,I=p,p=y,y=Y),p=Number(p)||0;var A,U,$,V,Y=this.length-p;switch((!y||Y<(y=Number(y)))&&(y=Y),I=String(I||"utf8").toLowerCase()){case"hex":A=function(at,et,nt,K){nt=Number(nt)||0;var H=at.length-nt;(!K||H<(K=Number(K)))&&(K=H),P((H=et.length)%2==0,"Invalid hex string"),H/2<K&&(K=H/2);for(var vt=0;vt<K;vt++){var Se=parseInt(et.substr(2*vt,2),16);P(!isNaN(Se),"Invalid hex string"),at[nt+vt]=Se}return _._charsWritten=2*vt,vt}(this,s,p,y);break;case"utf8":case"utf-8":U=this,$=p,V=y,A=_._charsWritten=bt(st(s),U,$,V);break;case"ascii":case"binary":A=j(this,s,p,y);break;case"base64":U=this,$=p,V=y,A=_._charsWritten=bt(ut(s),U,$,V);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":A=M(this,s,p,y);break;default:throw new Error("Unknown encoding")}return A},_.prototype.toString=function(s,p,y){var I,A,U,$,V=this;if(s=String(s||"utf8").toLowerCase(),p=Number(p)||0,(y=y!==void 0?Number(y):V.length)===p)return"";switch(s){case"hex":I=function(Y,at,et){var nt=Y.length;(!at||at<0)&&(at=0),(!et||et<0||nt<et)&&(et=nt);for(var K="",H=at;H<et;H++)K+=F(Y[H]);return K}(V,p,y);break;case"utf8":case"utf-8":I=function(Y,at,et){var nt="",K="";et=Math.min(Y.length,et);for(var H=at;H<et;H++)Y[H]<=127?(nt+=Ut(K)+String.fromCharCode(Y[H]),K=""):K+="%"+Y[H].toString(16);return nt+Ut(K)}(V,p,y);break;case"ascii":case"binary":I=k(V,p,y);break;case"base64":A=V,$=y,I=(U=p)===0&&$===A.length?E.fromByteArray(A):E.fromByteArray(A.slice(U,$));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":I=function(Y,at,et){for(var nt=Y.slice(at,et),K="",H=0;H<nt.length;H+=2)K+=String.fromCharCode(nt[H]+256*nt[H+1]);return K}(V,p,y);break;default:throw new Error("Unknown encoding")}return I},_.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},_.prototype.copy=function(s,p,y,I){if(p=p||0,(I=I||I===0?I:this.length)!==(y=y||0)&&s.length!==0&&this.length!==0){P(y<=I,"sourceEnd < sourceStart"),P(0<=p&&p<s.length,"targetStart out of bounds"),P(0<=y&&y<this.length,"sourceStart out of bounds"),P(0<=I&&I<=this.length,"sourceEnd out of bounds"),I>this.length&&(I=this.length);var A=(I=s.length-p<I-y?s.length-p+y:I)-y;if(A<100||!_._useTypedArrays)for(var U=0;U<A;U++)s[U+p]=this[U+y];else s._set(this.subarray(y,y+A),p)}},_.prototype.slice=function(s,p){var y=this.length;if(s=q(s,y,0),p=q(p,y,y),_._useTypedArrays)return _._augment(this.subarray(s,p));for(var I=p-s,A=new _(I,void 0,!0),U=0;U<I;U++)A[U]=this[U+s];return A},_.prototype.get=function(s){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(s)},_.prototype.set=function(s,p){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(s,p)},_.prototype.readUInt8=function(s,p){if(p||(P(s!=null,"missing offset"),P(s<this.length,"Trying to read beyond buffer length")),!(s>=this.length))return this[s]},_.prototype.readUInt16LE=function(s,p){return O(this,s,!0,p)},_.prototype.readUInt16BE=function(s,p){return O(this,s,!1,p)},_.prototype.readUInt32LE=function(s,p){return B(this,s,!0,p)},_.prototype.readUInt32BE=function(s,p){return B(this,s,!1,p)},_.prototype.readInt8=function(s,p){if(p||(P(s!=null,"missing offset"),P(s<this.length,"Trying to read beyond buffer length")),!(s>=this.length))return 128&this[s]?-1*(255-this[s]+1):this[s]},_.prototype.readInt16LE=function(s,p){return b(this,s,!0,p)},_.prototype.readInt16BE=function(s,p){return b(this,s,!1,p)},_.prototype.readInt32LE=function(s,p){return S(this,s,!0,p)},_.prototype.readInt32BE=function(s,p){return S(this,s,!1,p)},_.prototype.readFloatLE=function(s,p){return h(this,s,!0,p)},_.prototype.readFloatBE=function(s,p){return h(this,s,!1,p)},_.prototype.readDoubleLE=function(s,p){return g(this,s,!0,p)},_.prototype.readDoubleBE=function(s,p){return g(this,s,!1,p)},_.prototype.writeUInt8=function(s,p,y){y||(P(s!=null,"missing value"),P(p!=null,"missing offset"),P(p<this.length,"trying to write beyond buffer length"),kt(s,255)),p>=this.length||(this[p]=s)},_.prototype.writeUInt16LE=function(s,p,y){l(this,s,p,!0,y)},_.prototype.writeUInt16BE=function(s,p,y){l(this,s,p,!1,y)},_.prototype.writeUInt32LE=function(s,p,y){v(this,s,p,!0,y)},_.prototype.writeUInt32BE=function(s,p,y){v(this,s,p,!1,y)},_.prototype.writeInt8=function(s,p,y){y||(P(s!=null,"missing value"),P(p!=null,"missing offset"),P(p<this.length,"Trying to write beyond buffer length"),Ot(s,127,-128)),p>=this.length||(0<=s?this.writeUInt8(s,p,y):this.writeUInt8(255+s+1,p,y))},_.prototype.writeInt16LE=function(s,p,y){w(this,s,p,!0,y)},_.prototype.writeInt16BE=function(s,p,y){w(this,s,p,!1,y)},_.prototype.writeInt32LE=function(s,p,y){D(this,s,p,!0,y)},_.prototype.writeInt32BE=function(s,p,y){D(this,s,p,!1,y)},_.prototype.writeFloatLE=function(s,p,y){R(this,s,p,!0,y)},_.prototype.writeFloatBE=function(s,p,y){R(this,s,p,!1,y)},_.prototype.writeDoubleLE=function(s,p,y){N(this,s,p,!0,y)},_.prototype.writeDoubleBE=function(s,p,y){N(this,s,p,!1,y)},_.prototype.fill=function(s,p,y){if(p=p||0,y=y||this.length,P(typeof(s=typeof(s=s||0)=="string"?s.charCodeAt(0):s)=="number"&&!isNaN(s),"value is not a number"),P(p<=y,"end < start"),y!==p&&this.length!==0){P(0<=p&&p<this.length,"start out of bounds"),P(0<=y&&y<=this.length,"end out of bounds");for(var I=p;I<y;I++)this[I]=s}},_.prototype.inspect=function(){for(var s=[],p=this.length,y=0;y<p;y++)if(s[y]=F(this[y]),y===i.INSPECT_MAX_BYTES){s[y+1]="...";break}return"<Buffer "+s.join(" ")+">"},_.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(_._useTypedArrays)return new _(this).buffer;for(var s=new Uint8Array(this.length),p=0,y=s.length;p<y;p+=1)s[p]=this[p];return s.buffer};var C=_.prototype;function q(s,p,y){return typeof s!="number"?y:p<=(s=~~s)?p:0<=s||0<=(s+=p)?s:0}function z(s){return(s=~~Math.ceil(+s))<0?0:s}function J(s){return(Array.isArray||function(p){return Object.prototype.toString.call(p)==="[object Array]"})(s)}function F(s){return s<16?"0"+s.toString(16):s.toString(16)}function st(s){for(var p=[],y=0;y<s.length;y++){var I=s.charCodeAt(y);if(I<=127)p.push(s.charCodeAt(y));else for(var A=y,U=(55296<=I&&I<=57343&&y++,encodeURIComponent(s.slice(A,y+1)).substr(1).split("%")),$=0;$<U.length;$++)p.push(parseInt(U[$],16))}return p}function ut(s){return E.toByteArray(s)}function bt(s,p,y,I){for(var A=0;A<I&&!(A+y>=p.length||A>=s.length);A++)p[A+y]=s[A];return A}function Ut(s){try{return decodeURIComponent(s)}catch{return"�"}}function kt(s,p){P(typeof s=="number","cannot write a non-number as a number"),P(0<=s,"specified a negative value for writing an unsigned value"),P(s<=p,"value is larger than maximum value for type"),P(Math.floor(s)===s,"value has a fractional component")}function Ot(s,p,y){P(typeof s=="number","cannot write a non-number as a number"),P(s<=p,"value larger than maximum allowed value"),P(y<=s,"value smaller than minimum allowed value"),P(Math.floor(s)===s,"value has a fractional component")}function Lt(s,p,y){P(typeof s=="number","cannot write a non-number as a number"),P(s<=p,"value larger than maximum allowed value"),P(y<=s,"value smaller than minimum allowed value")}function P(s,p){if(!s)throw new Error(p||"Failed assertion")}_._augment=function(s){return s._isBuffer=!0,s._get=s.get,s._set=s.set,s.get=C.get,s.set=C.set,s.write=C.write,s.toString=C.toString,s.toLocaleString=C.toString,s.toJSON=C.toJSON,s.copy=C.copy,s.slice=C.slice,s.readUInt8=C.readUInt8,s.readUInt16LE=C.readUInt16LE,s.readUInt16BE=C.readUInt16BE,s.readUInt32LE=C.readUInt32LE,s.readUInt32BE=C.readUInt32BE,s.readInt8=C.readInt8,s.readInt16LE=C.readInt16LE,s.readInt16BE=C.readInt16BE,s.readInt32LE=C.readInt32LE,s.readInt32BE=C.readInt32BE,s.readFloatLE=C.readFloatLE,s.readFloatBE=C.readFloatBE,s.readDoubleLE=C.readDoubleLE,s.readDoubleBE=C.readDoubleBE,s.writeUInt8=C.writeUInt8,s.writeUInt16LE=C.writeUInt16LE,s.writeUInt16BE=C.writeUInt16BE,s.writeUInt32LE=C.writeUInt32LE,s.writeUInt32BE=C.writeUInt32BE,s.writeInt8=C.writeInt8,s.writeInt16LE=C.writeInt16LE,s.writeInt16BE=C.writeInt16BE,s.writeInt32LE=C.writeInt32LE,s.writeInt32BE=C.writeInt32BE,s.writeFloatLE=C.writeFloatLE,s.writeFloatBE=C.writeFloatBE,s.writeDoubleLE=C.writeDoubleLE,s.writeDoubleBE=C.writeDoubleBE,s.fill=C.fill,s.inspect=C.inspect,s.toArrayBuffer=C.toArrayBuffer,s}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(e,r,i){(function(o,a,E,f,c,d,m,T,L){var E=e("buffer").Buffer,x=4,_=new E(x);_.fill(0),r.exports={hash:function(j,M,k,O){for(var B=M(function(l,v){l.length%x!=0&&(w=l.length+(x-l.length%x),l=E.concat([l,_],w));for(var w,D=[],R=v?l.readInt32BE:l.readInt32LE,N=0;N<l.length;N+=x)D.push(R.call(l,N));return D}(j=E.isBuffer(j)?j:new E(j),O),8*j.length),M=O,b=new E(k),S=M?b.writeInt32BE:b.writeInt32LE,h=0;h<B.length;h++)S.call(b,B[h],4*h,!0);return b}}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(e,r,i){(function(o,a,E,f,c,d,m,T,L){var E=e("buffer").Buffer,x=e("./sha"),_=e("./sha256"),j=e("./rng"),M={sha1:x,sha256:_,md5:e("./md5")},k=64,O=new E(k);function B(l,v){var w=M[l=l||"sha1"],D=[];return w||b("algorithm:",l,"is not yet supported"),{update:function(R){return E.isBuffer(R)||(R=new E(R)),D.push(R),R.length,this},digest:function(R){var N=E.concat(D),N=v?function(C,q,z){E.isBuffer(q)||(q=new E(q)),E.isBuffer(z)||(z=new E(z)),q.length>k?q=C(q):q.length<k&&(q=E.concat([q,O],k));for(var J=new E(k),F=new E(k),st=0;st<k;st++)J[st]=54^q[st],F[st]=92^q[st];return z=C(E.concat([J,z])),C(E.concat([F,z]))}(w,v,N):w(N);return D=null,R?N.toString(R):N}}}function b(){var l=[].slice.call(arguments).join(" ");throw new Error([l,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}O.fill(0),i.createHash=function(l){return B(l)},i.createHmac=B,i.randomBytes=function(l,v){if(!v||!v.call)return new E(j(l));try{v.call(this,void 0,new E(j(l)))}catch(w){v(w)}};var S,h=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],g=function(l){i[l]=function(){b("sorry,",l,"is not implemented yet")}};for(S in h)g(h[S])}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(e,r,i){(function(o,a,u,f,c,d,m,T,L){var E=e("./helpers");function x(b,S){b[S>>5]|=128<<S%32,b[14+(S+64>>>9<<4)]=S;for(var h=1732584193,g=-271733879,l=-1732584194,v=271733878,w=0;w<b.length;w+=16){var D=h,R=g,N=l,C=v,h=j(h,g,l,v,b[w+0],7,-680876936),v=j(v,h,g,l,b[w+1],12,-389564586),l=j(l,v,h,g,b[w+2],17,606105819),g=j(g,l,v,h,b[w+3],22,-1044525330);h=j(h,g,l,v,b[w+4],7,-176418897),v=j(v,h,g,l,b[w+5],12,1200080426),l=j(l,v,h,g,b[w+6],17,-1473231341),g=j(g,l,v,h,b[w+7],22,-45705983),h=j(h,g,l,v,b[w+8],7,1770035416),v=j(v,h,g,l,b[w+9],12,-1958414417),l=j(l,v,h,g,b[w+10],17,-42063),g=j(g,l,v,h,b[w+11],22,-1990404162),h=j(h,g,l,v,b[w+12],7,1804603682),v=j(v,h,g,l,b[w+13],12,-40341101),l=j(l,v,h,g,b[w+14],17,-1502002290),h=M(h,g=j(g,l,v,h,b[w+15],22,1236535329),l,v,b[w+1],5,-165796510),v=M(v,h,g,l,b[w+6],9,-1069501632),l=M(l,v,h,g,b[w+11],14,643717713),g=M(g,l,v,h,b[w+0],20,-373897302),h=M(h,g,l,v,b[w+5],5,-701558691),v=M(v,h,g,l,b[w+10],9,38016083),l=M(l,v,h,g,b[w+15],14,-660478335),g=M(g,l,v,h,b[w+4],20,-405537848),h=M(h,g,l,v,b[w+9],5,568446438),v=M(v,h,g,l,b[w+14],9,-1019803690),l=M(l,v,h,g,b[w+3],14,-187363961),g=M(g,l,v,h,b[w+8],20,1163531501),h=M(h,g,l,v,b[w+13],5,-1444681467),v=M(v,h,g,l,b[w+2],9,-51403784),l=M(l,v,h,g,b[w+7],14,1735328473),h=k(h,g=M(g,l,v,h,b[w+12],20,-1926607734),l,v,b[w+5],4,-378558),v=k(v,h,g,l,b[w+8],11,-2022574463),l=k(l,v,h,g,b[w+11],16,1839030562),g=k(g,l,v,h,b[w+14],23,-35309556),h=k(h,g,l,v,b[w+1],4,-1530992060),v=k(v,h,g,l,b[w+4],11,1272893353),l=k(l,v,h,g,b[w+7],16,-155497632),g=k(g,l,v,h,b[w+10],23,-1094730640),h=k(h,g,l,v,b[w+13],4,681279174),v=k(v,h,g,l,b[w+0],11,-358537222),l=k(l,v,h,g,b[w+3],16,-722521979),g=k(g,l,v,h,b[w+6],23,76029189),h=k(h,g,l,v,b[w+9],4,-640364487),v=k(v,h,g,l,b[w+12],11,-421815835),l=k(l,v,h,g,b[w+15],16,530742520),h=O(h,g=k(g,l,v,h,b[w+2],23,-995338651),l,v,b[w+0],6,-198630844),v=O(v,h,g,l,b[w+7],10,1126891415),l=O(l,v,h,g,b[w+14],15,-1416354905),g=O(g,l,v,h,b[w+5],21,-57434055),h=O(h,g,l,v,b[w+12],6,1700485571),v=O(v,h,g,l,b[w+3],10,-1894986606),l=O(l,v,h,g,b[w+10],15,-1051523),g=O(g,l,v,h,b[w+1],21,-2054922799),h=O(h,g,l,v,b[w+8],6,1873313359),v=O(v,h,g,l,b[w+15],10,-30611744),l=O(l,v,h,g,b[w+6],15,-1560198380),g=O(g,l,v,h,b[w+13],21,1309151649),h=O(h,g,l,v,b[w+4],6,-145523070),v=O(v,h,g,l,b[w+11],10,-1120210379),l=O(l,v,h,g,b[w+2],15,718787259),g=O(g,l,v,h,b[w+9],21,-343485551),h=B(h,D),g=B(g,R),l=B(l,N),v=B(v,C)}return Array(h,g,l,v)}function _(b,S,h,g,l,v){return B((S=B(B(S,b),B(g,v)))<<l|S>>>32-l,h)}function j(b,S,h,g,l,v,w){return _(S&h|~S&g,b,S,l,v,w)}function M(b,S,h,g,l,v,w){return _(S&g|h&~g,b,S,l,v,w)}function k(b,S,h,g,l,v,w){return _(S^h^g,b,S,l,v,w)}function O(b,S,h,g,l,v,w){return _(h^(S|~g),b,S,l,v,w)}function B(b,S){var h=(65535&b)+(65535&S);return(b>>16)+(S>>16)+(h>>16)<<16|65535&h}r.exports=function(b){return E.hash(b,x,16)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(e,r,i){(function(o,a,u,f,c,d,m,T,L){r.exports=function(E){for(var x,_=new Array(E),j=0;j<E;j++)!(3&j)&&(x=4294967296*Math.random()),_[j]=x>>>((3&j)<<3)&255;return _}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(e,r,i){(function(o,a,u,f,c,d,m,T,L){var E=e("./helpers");function x(M,k){M[k>>5]|=128<<24-k%32,M[15+(k+64>>9<<4)]=k;for(var O,B,b,S=Array(80),h=1732584193,g=-271733879,l=-1732584194,v=271733878,w=-1009589776,D=0;D<M.length;D+=16){for(var R=h,N=g,C=l,q=v,z=w,J=0;J<80;J++){S[J]=J<16?M[D+J]:j(S[J-3]^S[J-8]^S[J-14]^S[J-16],1);var F=_(_(j(h,5),(F=g,B=l,b=v,(O=J)<20?F&B|~F&b:!(O<40)&&O<60?F&B|F&b|B&b:F^B^b)),_(_(w,S[J]),(O=J)<20?1518500249:O<40?1859775393:O<60?-1894007588:-899497514)),w=v,v=l,l=j(g,30),g=h,h=F}h=_(h,R),g=_(g,N),l=_(l,C),v=_(v,q),w=_(w,z)}return Array(h,g,l,v,w)}function _(M,k){var O=(65535&M)+(65535&k);return(M>>16)+(k>>16)+(O>>16)<<16|65535&O}function j(M,k){return M<<k|M>>>32-k}r.exports=function(M){return E.hash(M,x,20,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(e,r,i){(function(o,a,u,f,c,d,m,T,L){function E(k,O){var B=(65535&k)+(65535&O);return(k>>16)+(O>>16)+(B>>16)<<16|65535&B}function x(k,O){var B,b=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),S=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),h=new Array(64);k[O>>5]|=128<<24-O%32,k[15+(O+64>>9<<4)]=O;for(var g,l,v=0;v<k.length;v+=16){for(var w=S[0],D=S[1],R=S[2],N=S[3],C=S[4],q=S[5],z=S[6],J=S[7],F=0;F<64;F++)h[F]=F<16?k[F+v]:E(E(E((l=h[F-2],j(l,17)^j(l,19)^M(l,10)),h[F-7]),(l=h[F-15],j(l,7)^j(l,18)^M(l,3))),h[F-16]),B=E(E(E(E(J,j(l=C,6)^j(l,11)^j(l,25)),C&q^~C&z),b[F]),h[F]),g=E(j(g=w,2)^j(g,13)^j(g,22),w&D^w&R^D&R),J=z,z=q,q=C,C=E(N,B),N=R,R=D,D=w,w=E(B,g);S[0]=E(w,S[0]),S[1]=E(D,S[1]),S[2]=E(R,S[2]),S[3]=E(N,S[3]),S[4]=E(C,S[4]),S[5]=E(q,S[5]),S[6]=E(z,S[6]),S[7]=E(J,S[7])}return S}var _=e("./helpers"),j=function(k,O){return k>>>O|k<<32-O},M=function(k,O){return k>>>O};r.exports=function(k){return _.hash(k,x,32,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(e,r,i){(function(o,a,u,f,c,d,m,T,L){i.read=function(E,x,_,j,v){var k,O,B=8*v-j-1,b=(1<<B)-1,S=b>>1,h=-7,g=_?v-1:0,l=_?-1:1,v=E[x+g];for(g+=l,k=v&(1<<-h)-1,v>>=-h,h+=B;0<h;k=256*k+E[x+g],g+=l,h-=8);for(O=k&(1<<-h)-1,k>>=-h,h+=j;0<h;O=256*O+E[x+g],g+=l,h-=8);if(k===0)k=1-S;else{if(k===b)return O?NaN:1/0*(v?-1:1);O+=Math.pow(2,j),k-=S}return(v?-1:1)*O*Math.pow(2,k-j)},i.write=function(E,x,_,j,M,w){var O,B,b=8*w-M-1,S=(1<<b)-1,h=S>>1,g=M===23?Math.pow(2,-24)-Math.pow(2,-77):0,l=j?0:w-1,v=j?1:-1,w=x<0||x===0&&1/x<0?1:0;for(x=Math.abs(x),isNaN(x)||x===1/0?(B=isNaN(x)?1:0,O=S):(O=Math.floor(Math.log(x)/Math.LN2),x*(j=Math.pow(2,-O))<1&&(O--,j*=2),2<=(x+=1<=O+h?g/j:g*Math.pow(2,1-h))*j&&(O++,j/=2),S<=O+h?(B=0,O=S):1<=O+h?(B=(x*j-1)*Math.pow(2,M),O+=h):(B=x*Math.pow(2,h-1)*Math.pow(2,M),O=0));8<=M;E[_+l]=255&B,l+=v,B/=256,M-=8);for(O=O<<M|B,b+=M;0<b;E[_+l]=255&O,l+=v,O/=256,b-=8);E[_+l-v]|=128*w}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(e,r,i){(function(o,a,u,f,c,d,m,T,L){var E,x,_;function j(){}(o=r.exports={}).nextTick=(x=typeof window<"u"&&window.setImmediate,_=typeof window<"u"&&window.postMessage&&window.addEventListener,x?function(M){return window.setImmediate(M)}:_?(E=[],window.addEventListener("message",function(M){var k=M.source;k!==window&&k!==null||M.data!=="process-tick"||(M.stopPropagation(),0<E.length&&E.shift()())},!0),function(M){E.push(M),window.postMessage("process-tick","*")}):function(M){setTimeout(M,0)}),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=j,o.addListener=j,o.once=j,o.off=j,o.removeListener=j,o.removeAllListeners=j,o.emit=j,o.binding=function(M){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(M){throw new Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(Ge);var wn=Ge.exports;const mt=wn.MD5;function it(n){for(var t=arguments.length,e=Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+n+(e.length?" "+e.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function St(n){return!!n&&!!n[W]}function ht(n){return!!n&&(function(t){if(!t||typeof t!="object")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;var r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object||typeof r=="function"&&Function.toString.call(r)===Mn}(n)||Array.isArray(n)||!!n[je]||!!n.constructor[je]||fe(n)||he(n))}function Et(n,t,e){e===void 0&&(e=!1),It(n)===0?(e?Object.keys:ve)(n).forEach(function(r){e&&typeof r=="symbol"||t(r,n[r],n)}):n.forEach(function(r,i){return t(i,r,n)})}function It(n){var t=n[W];return t?t.i>3?t.i-4:t.i:Array.isArray(n)?1:fe(n)?2:he(n)?3:0}function ie(n,t){return It(n)===2?n.has(t):Object.prototype.hasOwnProperty.call(n,t)}function Sn(n,t){return It(n)===2?n.get(t):n[t]}function Qe(n,t,e){var r=It(n);r===2?n.set(t,e):r===3?(n.delete(t),n.add(e)):n[t]=e}function En(n,t){return n===t?n!==0||1/n==1/t:n!=n&&t!=t}function fe(n){return jn&&n instanceof Map}function he(n){return Tn&&n instanceof Set}function G(n){return n.o||n.t}function pe(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var t=Cn(n);delete t[W];for(var e=ve(t),r=0;r<e.length;r++){var i=e[r],o=t[i];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),t)}function ge(n,t){return t===void 0&&(t=!1),ye(n)||St(n)||!ht(n)||(It(n)>1&&(n.set=n.add=n.clear=n.delete=An),Object.freeze(n),t&&Et(n,function(e,r){return ge(r,!0)},!0)),n}function An(){it(2)}function ye(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function lt(n){var t=se[n];return t||it(18,n),t}function In(n,t){se[n]||(se[n]=t)}function Ft(){return Mt}function Qt(n,t){t&&(lt("Patches"),n.u=[],n.s=[],n.v=t)}function Wt(n){oe(n),n.p.forEach(kn),n.p=null}function oe(n){n===Mt&&(Mt=n.l)}function Ee(n){return Mt={p:[],l:Mt,h:n,m:!0,_:0}}function kn(n){var t=n[W];t.i===0||t.i===1?t.j():t.O=!0}function Xt(n,t){t._=t.p.length;var e=t.p[0],r=n!==void 0&&n!==e;return t.h.g||lt("ES5").S(t,n,r),r?(e[W].P&&(Wt(t),it(4)),ht(n)&&(n=Jt(t,n),t.l||zt(t,n)),t.u&&lt("Patches").M(e[W].t,n,t.u,t.s)):n=Jt(t,e,[]),Wt(t),t.u&&t.v(t.u,t.s),n!==Xe?n:void 0}function Jt(n,t,e){if(ye(t))return t;var r=t[W];if(!r)return Et(t,function(o,a){return Ae(n,r,t,o,a,e)},!0),t;if(r.A!==n)return t;if(!r.P)return zt(n,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=r.i===4||r.i===5?r.o=pe(r.k):r.o;Et(r.i===3?new Set(i):i,function(o,a){return Ae(n,r,i,o,a,e)}),zt(n,i,!1),e&&n.u&&lt("Patches").R(r,e,n.u,n.s)}return r.o}function Ae(n,t,e,r,i,o){if(St(i)){var a=Jt(n,i,o&&t&&t.i!==3&&!ie(t.D,r)?o.concat(r):void 0);if(Qe(e,r,a),!St(a))return;n.m=!1}if(ht(i)&&!ye(i)){if(!n.h.F&&n._<1)return;Jt(n,i),t&&t.A.l||zt(n,i)}}function zt(n,t,e){e===void 0&&(e=!1),n.h.F&&n.m&&ge(t,e)}function Zt(n,t){var e=n[W];return(e?G(e):n)[t]}function Ie(n,t){if(t in n)for(var e=Object.getPrototypeOf(n);e;){var r=Object.getOwnPropertyDescriptor(e,t);if(r)return r;e=Object.getPrototypeOf(e)}}function dt(n){n.P||(n.P=!0,n.l&&dt(n.l))}function te(n){n.o||(n.o=pe(n.t))}function Tt(n,t,e){var r=fe(t)?lt("MapSet").N(t,e):he(t)?lt("MapSet").T(t,e):n.g?function(i,o){var a=Array.isArray(i),u={i:a?1:0,A:o?o.A:Ft(),P:!1,I:!1,D:{},l:o,t:i,k:null,o:null,j:null,C:!1},f=u,c=ae;a&&(f=[u],c=jt);var d=Proxy.revocable(f,c),m=d.revoke,T=d.proxy;return u.k=T,u.j=m,T}(t,e):lt("ES5").J(t,e);return(e?e.A:Ft()).p.push(r),r}function On(n){return St(n)||it(22,n),function t(e){if(!ht(e))return e;var r,i=e[W],o=It(e);if(i){if(!i.P&&(i.i<4||!lt("ES5").K(i)))return i.t;i.I=!0,r=ke(e,o),i.I=!1}else r=ke(e,o);return Et(r,function(a,u){i&&Sn(i.t,a)===u||Qe(r,a,t(u))}),o===3?new Set(r):r}(n)}function ke(n,t){switch(t){case 2:return new Map(n);case 3:return Array.from(n)}return pe(n)}function xn(){function n(u,f){function c(){this.constructor=u}i(u,f),u.prototype=(c.prototype=f.prototype,new c)}function t(u){u.o||(u.D=new Map,u.o=new Map(u.t))}function e(u){u.o||(u.o=new Set,u.t.forEach(function(f){if(ht(f)){var c=Tt(u.A.h,f,u);u.p.set(f,c),u.o.add(c)}else u.o.add(f)}))}function r(u){u.O&&it(3,JSON.stringify(G(u)))}var i=function(u,f){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var m in d)d.hasOwnProperty(m)&&(c[m]=d[m])})(u,f)},o=function(){function u(c,d){return this[W]={i:2,l:d,A:d?d.A:Ft(),P:!1,I:!1,o:void 0,D:void 0,t:c,k:this,C:!1,O:!1},this}n(u,Map);var f=u.prototype;return Object.defineProperty(f,"size",{get:function(){return G(this[W]).size}}),f.has=function(c){return G(this[W]).has(c)},f.set=function(c,d){var m=this[W];return r(m),G(m).has(c)&&G(m).get(c)===d||(t(m),dt(m),m.D.set(c,!0),m.o.set(c,d),m.D.set(c,!0)),this},f.delete=function(c){if(!this.has(c))return!1;var d=this[W];return r(d),t(d),dt(d),d.t.has(c)?d.D.set(c,!1):d.D.delete(c),d.o.delete(c),!0},f.clear=function(){var c=this[W];r(c),G(c).size&&(t(c),dt(c),c.D=new Map,Et(c.t,function(d){c.D.set(d,!1)}),c.o.clear())},f.forEach=function(c,d){var m=this;G(this[W]).forEach(function(T,L){c.call(d,m.get(L),L,m)})},f.get=function(c){var d=this[W];r(d);var m=G(d).get(c);if(d.I||!ht(m)||m!==d.t.get(c))return m;var T=Tt(d.A.h,m,d);return t(d),d.o.set(c,T),T},f.keys=function(){return G(this[W]).keys()},f.values=function(){var c,d=this,m=this.keys();return(c={})[Rt]=function(){return d.values()},c.next=function(){var T=m.next();return T.done?T:{done:!1,value:d.get(T.value)}},c},f.entries=function(){var c,d=this,m=this.keys();return(c={})[Rt]=function(){return d.entries()},c.next=function(){var T=m.next();if(T.done)return T;var L=d.get(T.value);return{done:!1,value:[T.value,L]}},c},f[Rt]=function(){return this.entries()},u}(),a=function(){function u(c,d){return this[W]={i:3,l:d,A:d?d.A:Ft(),P:!1,I:!1,o:void 0,t:c,k:this,p:new Map,O:!1,C:!1},this}n(u,Set);var f=u.prototype;return Object.defineProperty(f,"size",{get:function(){return G(this[W]).size}}),f.has=function(c){var d=this[W];return r(d),d.o?!!d.o.has(c)||!(!d.p.has(c)||!d.o.has(d.p.get(c))):d.t.has(c)},f.add=function(c){var d=this[W];return r(d),this.has(c)||(e(d),dt(d),d.o.add(c)),this},f.delete=function(c){if(!this.has(c))return!1;var d=this[W];return r(d),e(d),dt(d),d.o.delete(c)||!!d.p.has(c)&&d.o.delete(d.p.get(c))},f.clear=function(){var c=this[W];r(c),G(c).size&&(e(c),dt(c),c.o.clear())},f.values=function(){var c=this[W];return r(c),e(c),c.o.values()},f.entries=function(){var c=this[W];return r(c),e(c),c.o.entries()},f.keys=function(){return this.values()},f[Rt]=function(){return this.values()},f.forEach=function(c,d){for(var m=this.values(),T=m.next();!T.done;)c.call(d,T.value,T.value,this),T=m.next()},u}();In("MapSet",{N:function(u,f){return new o(u,f)},T:function(u,f){return new a(u,f)}})}var Oe,Mt,be=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",jn=typeof Map<"u",Tn=typeof Set<"u",xe=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Xe=be?Symbol.for("immer-nothing"):((Oe={})["immer-nothing"]=!0,Oe),je=be?Symbol.for("immer-draftable"):"__$immer_draftable",W=be?Symbol.for("immer-state"):"__$immer_state",Rt=typeof Symbol<"u"&&Symbol.iterator||"@@iterator",Mn=""+Object.prototype.constructor,ve=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Cn=Object.getOwnPropertyDescriptors||function(n){var t={};return ve(n).forEach(function(e){t[e]=Object.getOwnPropertyDescriptor(n,e)}),t},se={},ae={get:function(n,t){if(t===W)return n;var e=G(n);if(!ie(e,t))return function(i,o,a){var u,f=Ie(o,a);return f?"value"in f?f.value:(u=f.get)===null||u===void 0?void 0:u.call(i.k):void 0}(n,e,t);var r=e[t];return n.I||!ht(r)?r:r===Zt(n.t,t)?(te(n),n.o[t]=Tt(n.A.h,r,n)):r},has:function(n,t){return t in G(n)},ownKeys:function(n){return Reflect.ownKeys(G(n))},set:function(n,t,e){var r=Ie(G(n),t);if(r!=null&&r.set)return r.set.call(n.k,e),!0;if(!n.P){var i=Zt(G(n),t),o=i==null?void 0:i[W];if(o&&o.t===e)return n.o[t]=e,n.D[t]=!1,!0;if(En(e,i)&&(e!==void 0||ie(n.t,t)))return!0;te(n),dt(n)}return n.o[t]===e&&typeof e!="number"&&(e!==void 0||t in n.o)||(n.o[t]=e,n.D[t]=!0,!0)},deleteProperty:function(n,t){return Zt(n.t,t)!==void 0||t in n.t?(n.D[t]=!1,te(n),dt(n)):delete n.D[t],n.o&&delete n.o[t],!0},getOwnPropertyDescriptor:function(n,t){var e=G(n),r=Reflect.getOwnPropertyDescriptor(e,t);return r&&{writable:!0,configurable:n.i!==1||t!=="length",enumerable:r.enumerable,value:e[t]}},defineProperty:function(){it(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){it(12)}},jt={};Et(ae,function(n,t){jt[n]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),jt.deleteProperty=function(n,t){return jt.set.call(this,n,t,void 0)},jt.set=function(n,t,e){return ae.set.call(this,n[0],t,e,n[0])};var Pn=function(){function n(e){var r=this;this.g=xe,this.F=!0,this.produce=function(i,o,a){if(typeof i=="function"&&typeof o!="function"){var u=o;o=i;var f=r;return function(x){var _=this;x===void 0&&(x=u);for(var j=arguments.length,M=Array(j>1?j-1:0),k=1;k<j;k++)M[k-1]=arguments[k];return f.produce(x,function(O){var B;return(B=o).call.apply(B,[_,O].concat(M))})}}var c;if(typeof o!="function"&&it(6),a!==void 0&&typeof a!="function"&&it(7),ht(i)){var d=Ee(r),m=Tt(r,i,void 0),T=!0;try{c=o(m),T=!1}finally{T?Wt(d):oe(d)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(x){return Qt(d,a),Xt(x,d)},function(x){throw Wt(d),x}):(Qt(d,a),Xt(c,d))}if(!i||typeof i!="object"){if((c=o(i))===void 0&&(c=i),c===Xe&&(c=void 0),r.F&&ge(c,!0),a){var L=[],E=[];lt("Patches").M(i,c,L,E),a(L,E)}return c}it(21,i)},this.produceWithPatches=function(i,o){if(typeof i=="function")return function(c){for(var d=arguments.length,m=Array(d>1?d-1:0),T=1;T<d;T++)m[T-1]=arguments[T];return r.produceWithPatches(c,function(L){return i.apply(void 0,[L].concat(m))})};var a,u,f=r.produce(i,o,function(c,d){a=c,u=d});return typeof Promise<"u"&&f instanceof Promise?f.then(function(c){return[c,a,u]}):[f,a,u]},typeof(e==null?void 0:e.useProxies)=="boolean"&&this.setUseProxies(e.useProxies),typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze)}var t=n.prototype;return t.createDraft=function(e){ht(e)||it(8),St(e)&&(e=On(e));var r=Ee(this),i=Tt(this,e,void 0);return i[W].C=!0,oe(r),i},t.finishDraft=function(e,r){var i=e&&e[W],o=i.A;return Qt(o,r),Xt(void 0,o)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!xe&&it(20),this.g=e},t.applyPatches=function(e,r){var i;for(i=r.length-1;i>=0;i--){var o=r[i];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}i>-1&&(r=r.slice(i+1));var a=lt("Patches").$;return St(e)?a(e,r):this.produce(e,function(u){return a(u,r)})},n}(),rt=new Pn,Un=rt.produce;rt.produceWithPatches.bind(rt);rt.setAutoFreeze.bind(rt);rt.setUseProxies.bind(rt);rt.applyPatches.bind(rt);rt.createDraft.bind(rt);rt.finishDraft.bind(rt);function Ze(n,t){const e=Object.keys(n),r=Object.keys(t);return e.length===r.length&&Object.keys(n).every(i=>t.hasOwnProperty(i))}function Te(n,t){return Object.keys(n).length===Object.keys(t).length&&Object.keys(n).every(e=>t.hasOwnProperty(e)&&n[e]===t[e])}function qt(n,t){return typeof n!="object"||typeof t!="object"||n===null||t===null?n===t:Ze(n,t)?Object.keys(n).every(e=>qt(n[e],t[e])):!1}function tn(n,t){if(!_t(n)||!_t(t))return t;const e={};for(const r of Object.keys(n))e[r]=n[r];for(const r of Object.keys(t)){if(t[r]===null)continue;const i=_t(n[r])&&_t(t[r]);e[r]=i?tn(n[r],t[r]):t[r]}return e}function en(n,t,e){if(!_t(n))return n;const r={};for(const[i,o]of Object.entries(n))r[i]=_t(o)?en(o,t,e):o===t?e:o;return r}function _t(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}xn();function Ln(n){return n.cardinality==="one"}function me(n){return n["value-type"]==="ref"}function Bn(n){return n["value-type"]==="blob"}function Ht(n,t){return n[t]}function _e(n,t){return t.reduce((e,r)=>e&&e.get(r),n)}function ft(n,t){if(t.length===0)throw new Error("path must have at least one element");if(t.length===1){n.delete(t[0]);return}const[e,...r]=t;n.has(e)&&ft(n.get(e),r)}function ct(n,t,e){if(t.length===0)throw new Error("path must have at least one element");if(t.length===1){n.set(t[0],e);return}const[r,...i]=t;let o=n.get(r);o||(o=new Map,n.set(r,o)),ct(o,i,e)}function nn(n,t){const e=new Map,r=new Map,i=new Map;for(const o of t){const[a,u,f,c]=o,d=Ht(n,u);if(!d){console.warn("no such attr",a,n);continue}me(d)&&ct(i,[f,u,a],o),ct(e,[a,u,f],o),ct(r,[u,a,f],o)}return{eav:e,aev:r,vae:i}}function Me(n,t,e,r){const i=nn(n,t);return i.attrs=n,i.cardinalityInference=e,i.linkIndex=r,i}function Yt(n,t){var e,r;let i;if(Array.isArray(t[0])){const[a,u]=t[0],f=n.aev.get(a);if(!f)return null;i=(e=gt(f,2).find(d=>d[2]===u))===null||e===void 0?void 0:e[0]}else i=t[0];if(!i)return null;const o=t[2];if(Array.isArray(o)&&o.length===2&&n.aev.get(o[0])){const[a,u]=o,f=n.aev.get(a);if(!f)return null;const d=(r=gt(f,2).find(x=>x[2]===u))===null||r===void 0?void 0:r[0];if(!d)return null;const[m,T,L,...E]=t;return[i,T,d,...E]}else{const[a,...u]=t;return[i,...u]}}function Rn(n,t){const e=Yt(n,t);if(!e)return;const[r,i,o]=e,a=Ht(n.attrs,i);a&&(ft(n.eav,[r,i,o]),ft(n.aev,[i,r,o]),me(a)&&ft(n.vae,[o,i,r]))}let Dn=0;function rn(n,t,e){const[r,i,o]=e;let a;const u=_e(n.ea,[r,i,o]);return u&&(a=u[3]),a||Date.now()*10+Dn++}function Nn(n,t){var e;const r=Yt(n,t);if(!r)return;const[i,o,a]=r,u=Ht(n.attrs,o);if(!u)return;const f=_e(n.eav,[i,o,a]),c=(e=f==null?void 0:f[3])!==null&&e!==void 0?e:rn(n,u,r),d=[i,o,a,c];Ln(u)?(ct(n.eav,[i,o],new Map([[a,d]])),ct(n.aev,[o,i],new Map([[a,d]]))):(ct(n.eav,[i,o,a],d),ct(n.aev,[o,i,a],d)),me(u)&&ct(n.vae,[a,o,i],d)}function $n(n,t){var e;const r=Yt(n,t);if(!r)return;const[i,o,a]=r,u=Ht(n.attrs,o);if(!u)return;if(!Bn(u))throw new Error("merge operation is not supported for links");const f=_e(n.eav,[i,o]);if(!f)return;const c=(e=f.values().next())===null||e===void 0?void 0:e.value;if(!c)return;const d=c[2],m=tn(d,a),T=[i,o,m,rn(n,u,c)];ct(n.eav,[i,o],new Map([[m,T]]))}function qn(n,t){const e=Yt(n,t);if(!e)return;const[r]=e,i=n.eav.get(r);if(i)for(const a of i.keys())ft(n.aev,[a,r]);ft(n.eav,[r]);const o=n.vae.get(r)&&gt(n.vae.get(r),2);o&&o.forEach(a=>{const[u,f,c]=a;ft(n.eav,[u,f,c]),ft(n.aev,[f,u,c])}),ft(n.vae,[r])}function on(n,t){const e=nn(n.attrs,t);Object.keys(e).forEach(r=>{n[r]=e[r]})}function Fn(n,[t]){n.attrs[t.id]=t}function sn(n){return gt(n.eav,3)}function Wn(n,[t]){if(!n.attrs[t])return;const e=sn(n).filter(([r,i])=>i!==t);delete n.attrs[t],on(n,e)}function Jn(n,[t]){const e=n.attrs[t.id];e&&(n.attrs[t.id]=Object.assign(Object.assign({},e),t),on(n,sn(n)))}function zn(n,t){const[e,...r]=t;switch(e){case"add-triple":Nn(n,r);break;case"deep-merge-triple":$n(n,r);break;case"retract-triple":Rn(n,r);break;case"delete-entity":qn(n,r);break;case"add-attr":Fn(n,r);break;case"delete-attr":Wn(n,r);break;case"update-attr":Jn(n,r);break;default:throw new Error(`unhandled transaction action: ${e}`)}}function gt(n,t,e=[]){if(!n||t===0)return e;if(t===1){for(const r of n.values())e.push(r);return e}for(const r of n.values())gt(r,t-1,e);return e}function Dt(n,t){const e=[],r=t.in?t.in:[t];for(const i of r){const o=n.get(i);o&&e.push(o)}return e}function Vn(n,t,e){let r="";return n!==void 0&&(r+="e"),t!==void 0&&(r+="a"),e!==void 0&&(r+="v"),r}function Hn(n,[t,e,r]){var i,o;switch(Vn(t,e,r)){case"e":{const u=n.eav.get(t);return gt(u,2)}case"ea":{const u=(i=n.eav.get(t))===null||i===void 0?void 0:i.get(e);return gt(u,1)}case"eav":{const u=(o=n.eav.get(t))===null||o===void 0?void 0:o.get(e);return u?Dt(u,r):[]}case"ev":{const u=n.eav.get(t);if(!u)return[];const f=[];for(const c of u.values())f.push(...Dt(c,r));return f}case"av":{const u=n.aev.get(e);if(!u)return[];const f=[];for(const c of u.values())f.push(...Dt(c,r));return f}case"v":{const u=[];for(const f of n.eav.values())for(const c of f.values())u.push(...Dt(c,r))}default:return gt(n.eav,3)}}function Yn(n,t){return Un(n,e=>{t.forEach(r=>{zn(e,r)})})}function Kn(n){return typeof n=="string"&&n.startsWith("?")}function Gn(n,t,e){if(e.hasOwnProperty(n)){const r=e[n];return an(r,t,e)}return Object.assign(Object.assign({},e),{[n]:t})}function Ce(n,t,e){return n===t?e:null}function Qn(n,t,e){const{in:r}=n;return r&&r.includes(t)?e:null}function Xn(n){switch(typeof n){case"string":return n.startsWith("?")?Gn:Ce;case"object":return Qn;default:return Ce}}function an(n,t,e){return e?Xn(n)(n,t,e):null}function Zn(n,t,e){return n.reduce((r,i,o)=>{const a=t[o];return an(i,a,r)},e)}function tr(n,t,e){return rr(n,t,e).map(r=>Zn(t,r,e)).filter(r=>r)}function er(n,t,e){return t.or?t.or.patterns.flatMap(r=>ue(n,r,e)):t.and?t.and.patterns.reduce((r,i)=>ue(n,i,r),e):e.flatMap(r=>tr(n,t,r))}function ue(n,t,e=[{}]){return t.reduce((r,i)=>er(n,i,r),e)}function we(n,t){return Array.isArray(t)?t.map(e=>we(n,e)):Kn(t)?n[t]:t}function nr(n,{find:t,where:e}){return ue(n,e).map(i=>we(i,t))}function rr(n,t,e){return Hn(n,we(e,t))}let Nt;const ir=new Uint8Array(16);function or(){if(!Nt&&(Nt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Nt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Nt(ir)}const Q=[];for(let n=0;n<256;++n)Q.push((n+256).toString(16).slice(1));function sr(n,t=0){return Q[n[t+0]]+Q[n[t+1]]+Q[n[t+2]]+Q[n[t+3]]+"-"+Q[n[t+4]]+Q[n[t+5]]+"-"+Q[n[t+6]]+Q[n[t+7]]+"-"+Q[n[t+8]]+Q[n[t+9]]+"-"+Q[n[t+10]]+Q[n[t+11]]+Q[n[t+12]]+Q[n[t+13]]+Q[n[t+14]]+Q[n[t+15]]}const ar=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Pe={randomUUID:ar};function ur(n,t,e){if(Pe.randomUUID&&!t&&!n)return Pe.randomUUID();n=n||{};const r=n.random||(n.rng||or)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,sr(r)}function Ue(n){const t=n.replace(/-/g,""),e=[];for(let r=0;r<t.length;r+=2)e.push(parseInt(t.substring(r,r+2),16));return e}function cr(n,t){for(let e=0;e<n.length;e++){if(n[e]<t[e])return-1;if(n[e]>t[e])return 1}return 0}function Le(n,t){return cr(Ue(n),Ue(t))}function Z(){return ur()}function ce(n,t,e){return new Proxy({},{get:(r,i)=>i==="__ops"?e:o=>ce(n,t,[...e,[i,n,t,o]])})}function le(n){return n.startsWith("lookup__")}function un(n){const[t,e,...r]=n.split("__");return[e,JSON.parse(r.join("__"))]}function lr(n){return new Proxy({},{get(t,e){return le(e)?ce(n,un(e),[]):ce(n,e,[])}})}function cn(){return new Proxy({},{get(n,t){return lr(t)}})}cn();function dr(n){return n.__ops}function fr(n,t){const{attrIdMap:e,refSwapAttrIds:r}=n,i=[];for(const a of t){const u=e[a];if(u)i.push(u);else if(Array.isArray(a)&&a.length==2&&e[a[0]]){const[f,c]=a;i.push([e[f],c])}else i.push(a)}const[o]=t;if((o==="add-triple"||o==="retract-triple")&&r.has(t[2])){const a=i[1];i[1]=i[3],i[3]=a}return i}function tt(n,t,e){return Object.values(n).find(r=>{const[i,o,a]=r["forward-identity"];return o===t&&a===e})}function At(n,t,e){return Object.values(n).find(r=>{const i=r["reverse-identity"];if(!i)return!1;const[o,a,u]=i;return a===t&&u===e})}function hr(n){if(Array.isArray(n))return n;const t=Object.entries(n);if(t.length!==1)throw new Error("lookup must be an object with a single unique attr and value.");return t[0]}function ln(n,t,e){return e.indexOf(".")!==-1&&!tt(n,t,e)}function dn(n){const[t,e,...r]=n.split(".");if(r.length>0||e!=="id")throw new Error(`${n} is not a valid lookup attribute.`);return t}function pr(n,t,e){if(!ln(n,t,e))return tt(n,t,e);const r=dn(e),i=tt(n,t,r);if(i&&i["value-type"]!=="ref")throw new Error(`${e} does not reference a valid link attribute.`);return i}function fn(n){return typeof n=="string"&&!le(n)?null:typeof n=="string"&&le(n)?un(n):hr(n)}function ot(n,t,e){const r=fn(e);if(r===null)return e;const[i,o]=r,a=pr(n,t,i);if(!a||!a["unique?"])throw new Error(`${i} is not a unique attribute.`);return[a.id,o]}function gr(n,[t,e,r]){return Object.entries(r).flatMap(([o,a])=>{const u=Array.isArray(a)?a:[a],f=tt(n,t,o),c=At(n,t,o);return u.map(d=>f?["add-triple",ot(n,t,e),f.id,ot(n,f["reverse-identity"][1],d)]:["add-triple",ot(n,c["forward-identity"][1],d),c.id,ot(n,t,e)])})}function yr(n,[t,e,r]){return Object.entries(r).flatMap(([o,a])=>{const u=Array.isArray(a)?a:[a],f=tt(n,t,o),c=At(n,t,o);return u.map(d=>f?["retract-triple",ot(n,t,e),f.id,ot(n,f["reverse-identity"][1],d)]:["retract-triple",ot(n,c["forward-identity"][1],d),c.id,ot(n,t,e)])})}function br(n,[t,e,r]){const i=ot(n,t,e);return[["id",ot(n,t,e)]].concat(Object.entries(r)).map(([a,u])=>{const f=tt(n,t,a);return["add-triple",i,f.id,u]})}function vr(n,[t,e]){return[["delete-entity",ot(n,t,e)]]}function mr(n,[t,e,r]){const i=ot(n,t,e),o=Object.entries(r).map(([u,f])=>{const c=tt(n,t,u),d=en(f,void 0,null);return["deep-merge-triple",i,c.id,d]});return[["add-triple",i,tt(n,t,"id").id,i]].concat(o)}function _r(n,[t,...e]){switch(t){case"merge":return mr(n,e);case"update":return br(n,e);case"link":return gr(n,e);case"unlink":return yr(n,e);case"delete":return vr(n,e);default:throw new Error(`unsupported action ${t}`)}}function Be(n,t,e){const r=Z(),o=[Z(),n,t];return Object.assign({id:r,"forward-identity":o,"value-type":"blob",cardinality:"one","unique?":!1,"index?":!1,isUnsynced:!0},e||{})}function Re(n,t,e){const r=Z(),i=Z(),o=Z();return Object.assign({id:r,"forward-identity":[i,n,t],"reverse-identity":[o,t,n],"value-type":"ref",cardinality:"many","unique?":!1,"index?":!1,isUnsynced:!0},e||{})}const wr=new Set(["update","merge","link","unlink"]),Sr=new Set(["link","unlink"]),Er=new Set(["update","merge"]),Ar=new Set(["link","unlink","update","merge","delete"]),hn={"unique?":!0,"index?":!0},Ir=Object.assign(Object.assign({},hn),{cardinality:"one"});function kr(n,t){const[e,r,i]=[new Set,Object.assign({},n),[]];function o(u){r[u.id]=u,i.push(["add-attr",u]),e.add(u.id)}function a(u){u!=null&&u.isUnsynced&&!e.has(u.id)&&(i.push(["add-attr",u]),e.add(u.id))}for(const u of t){const[f,c,d,m]=u;if(Ar.has(f)){const T=fn(d);if(T){const L=T[0];if(ln(r,c,L)){const E=dn(L),x=tt(r,c,E),_=At(r,c,E);!x&&!_&&o(Re(c,E,Ir)),a(x),a(_)}else{const E=tt(r,c,L);E||o(Be(c,L,hn)),a(E)}}}}for(const u of t){const[f,c,d,m]=u;if(wr.has(f)){const T=Object.keys(m);T.push("id");for(const L of T){const E=tt(r,c,L);if(a(E),Er.has(f)&&(E||o(Be(c,L))),Sr.has(f)){const x=At(r,c,L);!E&&!x&&o(Re(c,L)),a(x)}}}}return[r,i]}function Or(n,t){const r=(Array.isArray(t)?t:[t]).flatMap(u=>dr(u)),[i,o]=kr(n,r),a=r.flatMap(u=>_r(i,u));return[...o,...a]}let xr=0;function Vt(n){return Kt(`_${n}`,xr++)}function Kt(n,t){return`?${n}-${t}`}class Ct extends Error{constructor(t){super(t),this.name="AttrNotFoundError"}}function jr(n,t){const e=Object.values(n.attrs).find(r=>{var i;return r["primary?"]&&((i=r["forward-identity"])===null||i===void 0?void 0:i[1])===t});return e||tt(n.attrs,t,"id")}function Tr(n,t){const e=jr(n,t);if(!e)throw new Ct(`Could not find id attr for ${t}`);return e}function De(n,t,e,r){return[Mr(n,t,e,r),Cr(n,e,r)]}function Mr(n,t,e,r){return[n(e,r),Tr(t,e).id,n(e,r),Vt("time")]}function Cr(n,t,e){return[n(t,e),n("attr",e),n("val",e),n("time",e)]}function Pr(n,t,e){return n.map(r=>r===t?e:r)}function pn(n,t,e,r,i){const o=tt(t.attrs,e,i),a=At(t.attrs,e,i),u=o||a;if(!u)throw new Ct(`Could not find attr for ${[e,i]}`);if(u["value-type"]!=="ref")throw new Error(`Attr ${u.id} is not a ref`);const[f,c]=u["forward-identity"],[d,m]=u["reverse-identity"],T=r+1,L=o?[n(c,r),u.id,n(m,T),Vt("time")]:[n(c,T),u.id,n(m,r),Vt("time")];return[o?m:c,T,L,u,!!o]}function Ur(n,t,e,r,i,o){const a=tt(t.attrs,e,i);if(!a)throw new Ct(`No attr for etype = ${e} label = ${i} value-label`);return[n(e,r),a.id,o,Vt("time")]}function Lr(n,t,e,r,i){const[o,a,u]=i.reduce((f,c)=>{const[d,m,T]=f,[L,E,x]=pn(n,t,d,m,c);return[L,E,[...T,x]]},[e,r,[]]);return[o,a,u]}function Br(n,t,e,r,i,o){const a=i.slice(0,i.length-1),u=i[i.length-1],[f,c,d]=Lr(n,t,e,r,a),m=Ur(n,t,f,c,u,o);return d.concat([m])}function Rr(n,t){return t?[t].concat(n):n}function Dr([n,t]){return n==="or"&&Array.isArray(t)}function Nr([n,t]){return n==="and"&&Array.isArray(t)}function $r(n,t,e){return(r,i)=>r==t?n(r,i):`${n(r,i)}-${e}`}function Ne(n,t,e,r,i,o){const a=o.map((f,c)=>{const d=$r(n,r,c);return gn(d,e,r,i,f)}),u=n(r,i);return{[t]:{patterns:a,joinSym:u}}}function gn(n,t,e,r,i){return Object.entries(i).flatMap(([o,a])=>{if(Dr([o,a]))return Ne(n,"or",t,e,r,a);if(Nr([o,a]))return Ne(n,"and",t,e,r,a);const u=o.split(".");return Br(n,t,e,r,u,a)})}function qr(n,t,e,r){const i=Kt;return r?gn(i,n,t,e,r).concat(De(i,n,t,e)):De(i,n,t,e)}function Fr(n,t,e){return[n(t,e),n("attr",e),n("val",e),n("time",e)]}function Wr(n,t,e,r,i,o){const[a,u,f,c,d]=pn(n,t,e,r,i),m=Pr(f,n(e,r),o);return[a,u,m,c,d]}function Jr(n,t,{etype:e,level:r,form:i},o){const a=Object.keys(i).filter(u=>u!=="$");return a.length?Object.entries(o).map(([u,f])=>a.map(d=>{var m,T,L;const E=!!(t.cardinalityInference&&(!((L=(T=(m=t.linkIndex)===null||m===void 0?void 0:m[e])===null||T===void 0?void 0:T[d])===null||L===void 0)&&L.isSingular));try{const[x,_,j]=Wr(n,t,e,r,d,u),M=yn(t,{etype:x,level:_,form:i[d],join:j}),k=E?M[0]:M;return{[d]:k}}catch(x){if(x instanceof Ct)return{[d]:E?void 0:[]};throw x}}).reduce((d,m)=>Object.assign(Object.assign({},d),m),f)):Object.values(o)}function zr(n,t){const e=n[t];return e["value-type"]==="ref"&&e["forward-identity"][2]!=="id"}function $e(n,t){switch(n){case"asc":switch(t){case"number":return(e,r)=>e<r;case"uuid":return(e,r)=>Le(e,r)===-1}case"desc":switch(t){case"number":return(e,r)=>e>r;case"uuid":return(e,r)=>Le(e,r)===1}}}function Vr(n,t,[e,r,i,o]){return $e(t,"number")(o,n[3])||o===n[3]&&$e(t,"uuid")(e,n[0])}function Hr(n,t,e,r,i){const o=r==null?void 0:r["start-cursor"],a=[],u=nr(n,i).sort((f,c)=>{const d=f[3],m=c[3];return e==="desc"?m-d:d-m}).reduce((f,c)=>{const[d,m,T]=c;if(zr(n.attrs,m))return f;const L=n.attrs[m],[E,x,_]=L["forward-identity"];return x!==t||(o&&m===o[1]&&Vr(o,e,c)&&a.push(d),f[d]=f[d]||{},f[d][_]=T),f},{});for(const f of a)delete u[f];return u}function Yr(n){var t;const e=(t=n.$)===null||t===void 0?void 0:t.order;return e&&e[Object.keys(e)[0]]||"asc"}function Kr(n,{etype:t,level:e,form:r,join:i,pageInfo:o}){var a,u,f,c,d,m,T;const L=((a=r.$)===null||a===void 0?void 0:a.limit)||((u=r.$)===null||u===void 0?void 0:u.first)||((f=r.$)===null||f===void 0?void 0:f.last),E=(c=r.$)===null||c===void 0?void 0:c.offset,x=(d=r.$)===null||d===void 0?void 0:d.before,_=(m=r.$)===null||m===void 0?void 0:m.after;if((E||x||_)&&(!o||!o["start-cursor"]))return[];const j=Rr(qr(n,t,e,(T=r.$)===null||T===void 0?void 0:T.where),i),M=Fr(Kt,t,e),k=Hr(n,t,Yr(r),o,{where:j,find:M});if(L!=null){const O=Object.entries(k);return O.length<=L?k:Object.fromEntries(O.slice(0,L))}return k}function Gr(n,t){try{return Kr(n,t)}catch(e){if(e instanceof Ct)return{};throw e}}function yn(n,t){const e=Gr(n,t);return Jr(Kt,n,t,e)}function Qr(n){const t={};for(const[e,r]of Object.entries(n))t[e]={startCursor:r["start-cursor"],endCursor:r["end-cursor"],hasNextPage:r["has-next-page?"],hasPreviousPage:r["has-previous-page?"]};return t}function Xr({store:n,pageInfo:t,aggregate:e},r){const o={data:Object.keys(r).reduce((a,u)=>(e!=null&&e[u]||(a[u]=yn(n,{etype:u,form:r[u],level:0,pageInfo:t==null?void 0:t[u]})),a),{})};return t&&(o.pageInfo=Qr(t)),e&&(o.aggregate=e),o}var qe=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function f(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,f)}c((r=r.apply(n,t||[])).next())})};class bn{constructor(t){this.dbName=t,this._storeName="kv",this._dbPromise=this._init()}_init(){return new Promise((t,e)=>{const r=indexedDB.open(this.dbName,1);r.onerror=i=>{e(i)},r.onsuccess=i=>{t(i.target.result)},r.onupgradeneeded=i=>{i.target.result.createObjectStore(this._storeName)}})}getItem(t){return qe(this,void 0,void 0,function*(){const e=yield this._dbPromise;return new Promise((r,i)=>{const u=e.transaction([this._storeName],"readonly").objectStore(this._storeName).get(t);u.onerror=f=>{i(f)},u.onsuccess=f=>{u.result?r(u.result):r(null)}})})}setItem(t,e){return qe(this,void 0,void 0,function*(){const r=yield this._dbPromise;return new Promise((i,o)=>{const f=r.transaction([this._storeName],"readwrite").objectStore(this._storeName).put(e,t);f.onerror=c=>{o(c)},f.onsuccess=c=>{i()}})})}}var Zr=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function f(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,f)}c((r=r.apply(n,t||[])).next())})};class vn{static getIsOnline(){return Zr(this,void 0,void 0,function*(){return navigator.onLine})}static listen(t){const e=()=>{t(!0)},r=()=>{t(!1)};return addEventListener("online",e),addEventListener("offline",r),()=>{removeEventListener("online",e),removeEventListener("offline",r)}}}var ti=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function f(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,f)}c((r=r.apply(n,t||[])).next())})};function pt(n,t){return ti(this,void 0,void 0,function*(){const e=yield fetch(n,t),r=yield e.json();return e.status===200?Promise.resolve(r):Promise.reject({status:e.status,body:r})})}var Pt=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function f(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,f)}c((r=r.apply(n,t||[])).next())})};function ei({apiURI:n,appId:t,email:e}){return pt(`${n}/runtime/auth/send_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":t,email:e})})}function ni(n){return Pt(this,arguments,void 0,function*({apiURI:t,appId:e,email:r,code:i}){return yield pt(`${t}/runtime/auth/verify_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,email:r,code:i})})})}function ri(n){return Pt(this,arguments,void 0,function*({apiURI:t,appId:e,refreshToken:r}){return yield pt(`${t}/runtime/auth/verify_refresh_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,"refresh-token":r})})})}function Fe(n){return Pt(this,arguments,void 0,function*({apiURI:t,appId:e,code:r,codeVerifier:i}){return yield pt(`${t}/runtime/oauth/token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,code:r,code_verifier:i})})})}function ii(n){return Pt(this,arguments,void 0,function*({apiURI:t,appId:e,nonce:r,idToken:i,clientName:o,refreshToken:a}){return yield pt(`${t}/runtime/oauth/id_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,nonce:r,id_token:i,client_name:o,refresh_token:a})})})}function oi(n){return Pt(this,arguments,void 0,function*({apiURI:t,appId:e,refreshToken:r}){return yield pt(`${t}/runtime/signout`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:e,refresh_token:r})})})}var Gt=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function f(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,f)}c((r=r.apply(n,t||[])).next())})};function si(n){return Gt(this,arguments,void 0,function*({apiURI:t,appId:e,fileName:r,refreshToken:i,metadata:o={}}){const{data:a}=yield pt(`${t}/storage/signed-upload-url`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${i}`},body:JSON.stringify({app_id:e,filename:r})});return a})}function ai(n,t){return Gt(this,void 0,void 0,function*(){return(yield fetch(n,{method:"PUT",body:t,headers:{"Content-Type":t.type}})).ok})}function ui(n){return Gt(this,arguments,void 0,function*({apiURI:t,appId:e,path:r,refreshToken:i}){const{data:o}=yield pt(`${t}/storage/signed-download-url?app_id=${e}&filename=${encodeURIComponent(r)}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return o})}function ci(n){return Gt(this,arguments,void 0,function*({apiURI:t,appId:e,path:r,refreshToken:i}){const{data:o}=yield pt(`${t}/storage/files?app_id=${e}&filename=${encodeURIComponent(r)}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return o})}function We(n,t){if(!t)return n;const e={};return t.forEach(r=>{e[r]=n[r]}),e}function li(n,t){var e,r;const i={peers:{}};if(t&&"user"in t?t.user:!0){const a=We((e=n.user)!==null&&e!==void 0?e:{},t==null?void 0:t.keys);i.user=a}for(const a of Object.keys((r=n.peers)!==null&&r!==void 0?r:{})){const u=(t==null?void 0:t.peers)===void 0,f=Array.isArray(t==null?void 0:t.peers)&&(t==null?void 0:t.peers.includes(a));if(u||f){const c=We(n.peers[a],t==null?void 0:t.keys);i.peers[a]=c}}return i}function di(n,t){if(n.isLoading!==t.isLoading||n.error!==t.error||(n.user||t.user)&&(!n.user||!t.user||!Te(n.user,t.user))||!Ze(n.peers,t.peers))return!0;for(const r of Object.keys(n.peers))if(!Te(n.peers[r],t.peers[r]))return!0;return!1}class fi{constructor(){this.promise=new Promise((t,e)=>{this._resolve=t,this._reject=e})}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}var Je=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function f(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,f)}c((r=r.apply(n,t||[])).next())})};class ze{constructor(t,e,r,i,o=u=>JSON.stringify(u),a=u=>JSON.parse(u)){this._persister=t,this._key=e,this._onMerge=i,this._loadedCbs=[],this._isLoading=!0,this.currentValue=r,this.toJSON=o,this.fromJSON=a,this._load()}_load(){return Je(this,void 0,void 0,function*(){const t=this.fromJSON(yield this._persister.getItem(this._key));this._isLoading=!1,this._onMerge(t,this.currentValue);for(const e of this._loadedCbs)e()})}waitForLoaded(){return Je(this,void 0,void 0,function*(){if(!this._isLoading)return;yield new Promise(e=>{this._loadedCbs.push(e)})})}set(t,e){this.currentValue=t(this.currentValue),this._isLoading||setTimeout(()=>{this._persister.setItem(this._key,this.toJSON(this.currentValue)),e&&e()},0)}}function mn(n,t=[]){n.forEach(e=>{const{data:r}=e,{"datalog-result":i}=r,{"join-rows":o}=i;for(const a of o)for(const u of a)t.push(u);mn(e["child-nodes"],t)})}function Ve(n){const t=[];return mn(n,t),t}function hi(n,t){return t instanceof Map?{__type:"m",entries:[...t.entries()]}:t}function pi(n,t){return t&&typeof t=="object"&&t.__type==="m"?new Map(t.entries):t}function gi(n){return JSON.stringify(n,hi)}function yi(n){return JSON.parse(n,pi)}function bi(n){return Object.values(n.links).reduce((t,e)=>{var r,i,o,a;return(r=t[o=e.forward.on])!==null&&r!==void 0||(t[o]={}),t[e.forward.on][e.forward.label]={isForward:!0,isSingular:e.forward.has==="one",link:e},(i=t[a=e.reverse.on])!==null&&i!==void 0||(t[a]={}),t[e.reverse.on][e.reverse.label]={isForward:!1,isSingular:e.reverse.has==="one",link:e},t},{})}var X=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function u(d){try{c(r.next(d))}catch(m){a(m)}}function f(d){try{c(r.throw(d))}catch(m){a(m)}}function c(d){d.done?o(d.value):i(d.value).then(u,f)}c((r=r.apply(n,t||[])).next())})};const yt={CONNECTING:"connecting",OPENED:"opened",AUTHENTICATED:"authenticated",CLOSED:"closed",ERRORED:"errored"},vi=1,mi={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"},ee="_instant_oauth_redirect",ne="currentUser";function _i(){return typeof window<"u"||typeof chrome<"u"}class wi{constructor(t,e=bn,r=vn){this._isOnline=!0,this._isShutdown=!1,this.status=yt.CONNECTING,this.queryCbs={},this.authCbs=[],this.attrsCbs=[],this.mutationErrorCbs=[],this.mutationDeferredStore=new Map,this._reconnectTimeoutId=null,this._reconnectTimeoutMs=0,this._localIdPromises={},this._errorMessage=null,this._oauthCallbackResponse=null,this._linkIndex=null,this._presence={},this._broadcastSubs={},this._currentUserCached={isLoading:!0,error:void 0,user:void 0},this._onMergeQuerySubs=(i,o)=>{const a=i||{},u=Object.assign({},o);Object.entries(o).forEach(([c,d])=>{var m;const T=(m=a==null?void 0:a[c])===null||m===void 0?void 0:m.result,L=d.result;T&&!L&&(u[c].result=T)}),Object.keys(a).filter(c=>!o[c]).slice(0,10).forEach(c=>{u[c]=a[c]}),this.querySubs.set(c=>u),this.notifyAll()},this._onMergePendingMutations=(i,o)=>{const a=new Map([...i.entries(),...o.entries()]);this.pendingMutations.set(f=>a),this._rewriteMutations(this.attrs,i).forEach((f,c)=>{!o.has(c)&&!f["tx-id"]&&this._sendMutation(c,f)})},this.getPreviousResult=i=>{var o,a,u;const f=mt(i),c=this._errorMessage,d=(u=(a=(o=this.querySubs)===null||o===void 0?void 0:o.currentValue)===null||a===void 0?void 0:a[f])===null||u===void 0?void 0:u.result;if(c)return{error:c};if(d)return this.dataForResult(i,d)},this.notifyOne=i=>{const o=this.queryCbs[i]||[];if(!o)return;const a=this._errorMessage;if(a){o.forEach(m=>m({error:a}));return}const{q:u,result:f,iqlResult:c}=this.querySubs.currentValue[i]||{};if(!f)return;const d=this.dataForResult(u,f);qt(d.data,c)||(this.querySubs.currentValue[i].iqlResult=f.data,o.forEach(m=>m(d)))},this.notifyQueryError=(i,o)=>{(this.queryCbs[i]||[]).forEach(u=>u({error:o}))},this.pushTx=i=>{try{const o=Or(this.optimisticAttrs(),i);return this.pushOps(o)}catch(o){return this.pushOps([],o)}},this.pushOps=(i,o)=>{const a=Z(),u={op:"transact","tx-steps":i,error:o};this.pendingMutations.set(c=>(c.set(a,u),c));const f=new fi;return this.mutationDeferredStore.set(a,f),this._sendMutation(a,u),this.notifyAll(),f.promise},this._wsOnOpen=()=>{xt.info("[socket] connected"),this._setStatus(yt.OPENED),this.getCurrentUser().then(i=>{var o;this._trySend(Z(),{op:"init","app-id":this.config.appId,"refresh-token":(o=i.user)===null||o===void 0?void 0:o.refresh_token,"__admin-token":this.config.__adminToken})})},this._wsOnMessage=i=>{this._handleReceive(JSON.parse(i.data.toString()))},this._wsOnError=i=>{xt.error("[socket] error: ",i)},this._wsOnClose=()=>{if(this._setStatus(yt.CLOSED),this._isShutdown){xt.info("[socket-close] socket has been shut down and will not reconnect");return}xt.info("[socket-close] scheduling reconnect",this._reconnectTimeoutMs),setTimeout(()=>{if(this._reconnectTimeoutMs=Math.min(this._reconnectTimeoutMs+1e3,1e4),!this._isOnline){xt.info("[socket-close] we are offline, no need to start socket");return}this._startSocket()},this._reconnectTimeoutMs)},this.config=Object.assign(Object.assign({},mi),t),this.config.schema&&(this._linkIndex=bi(this.config.schema)),_i()&&(typeof BroadcastChannel=="function"&&(this._broadcastChannel=new BroadcastChannel("@instantdb"),this._broadcastChannel.addEventListener("message",i=>X(this,void 0,void 0,function*(){var o;if(((o=i.data)===null||o===void 0?void 0:o.type)==="auth"){const a=yield this.getCurrentUser();this.updateUser(a.user)}}))),this._oauthCallbackResponse=this._oauthLoginInit(),this._initStorage(e),this.getCurrentUser(),r.getIsOnline().then(i=>{this._isOnline=i,this._startSocket(),r.listen(o=>{o!==this._isOnline&&(this._isOnline=o,this._isOnline&&this._startSocket())})}))}_initStorage(t){this._persister=new t(`instant_${this.config.appId}_4`),this.querySubs=new ze(this._persister,"querySubs",{},this._onMergeQuerySubs,gi,yi),this.pendingMutations=new ze(this._persister,"pendingMutations",new Map,this._onMergePendingMutations,e=>JSON.stringify([...e.entries()]),e=>new Map(JSON.parse(e)))}_finishTransaction(t,e,r,i){const o=this.mutationDeferredStore.get(r);this.mutationDeferredStore.delete(r),!o&&!t&&console.error("Mutation failed",Object.assign({status:e,clientId:r},i)),o&&(t?o.resolve({status:e,clientId:r}):o.reject(Object.assign({status:e,clientId:r},i)))}_setStatus(t,e){this.status=t,this._errorMessage=e}_cleanPendingMutations(t){this.pendingMutations.set(e=>{const r=new Map(e);return[...e.entries()].forEach(([i,o])=>{o["tx-id"]<=t&&r.delete(i)}),r})}_handleReceive(t){var e,r,i,o;const a=!!this.config.schema&&("cardinalityInference"in this.config?!!this.config.cardinalityInference:!0);switch(t.op){case"init-ok":this._setStatus(yt.AUTHENTICATED),this._reconnectTimeoutMs=0,this._setAttrs(t.attrs),this._flushPendingMessages(),this._sessionId=t["session-id"];break;case"add-query-ok":const{q:u,result:f,"processed-tx-id":c}=t;this._cleanPendingMutations(c);const d=mt(u),m=(r=(e=f==null?void 0:f[0])===null||e===void 0?void 0:e.data)===null||r===void 0?void 0:r["page-info"],T=(o=(i=f==null?void 0:f[0])===null||i===void 0?void 0:i.data)===null||o===void 0?void 0:o.aggregate,L=Ve(f),E=Me(this.attrs,L,a,this._linkIndex);this.querySubs.set(C=>(C[d].result={store:E,pageInfo:m,aggregate:T},C)),this.notifyOne(d);break;case"refresh-ok":const{computations:x,attrs:_,"processed-tx-id":j}=t;this._cleanPendingMutations(j),this._setAttrs(_);const M=x.map(C=>{var q,z,J,F;const st=C["instaql-query"],ut=C["instaql-result"],bt=mt(st),Ut=Ve(ut),kt=Me(this.attrs,Ut,a,this._linkIndex),Ot=(z=(q=ut==null?void 0:ut[0])===null||q===void 0?void 0:q.data)===null||z===void 0?void 0:z["page-info"],Lt=(F=(J=ut==null?void 0:ut[0])===null||J===void 0?void 0:J.data)===null||F===void 0?void 0:F.aggregate;return{hash:bt,store:kt,pageInfo:Ot,aggregate:Lt}});M.forEach(({hash:C,store:q,pageInfo:z,aggregate:J})=>{this.querySubs.set(F=>(F[C].result={store:q,pageInfo:z,aggregate:J},F))}),M.forEach(({hash:C})=>{this.notifyOne(C)});break;case"transact-ok":const{"client-event-id":k,"tx-id":O}=t,b=this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).get(k);if(!b)break;const S=Object.assign(Object.assign({},b),{"tx-id":O});this.pendingMutations.set(C=>(C.set(k,S),C)),this._finishTransaction(!0,"synced",k);const h=b["tx-steps"].filter(([C,...q])=>C==="add-attr").map(([C,q])=>q).concat(Object.values(this.attrs));this._setAttrs(h);break;case"refresh-presence":const g=t["room-id"];this._setPresencePeers(g,t.data),this._notifyPresenceSubs(g);break;case"server-broadcast":const l=t["room-id"],v=t.topic;this._notifyBroadcastSubs(l,v,t);break;case"join-room-ok":const w=t["room-id"],D=this._presence[w];D&&(D.isLoading=!1),this._notifyPresenceSubs(w);break;case"join-room-error":const R=t["room-id"],N=this._presence[R];N&&(N.error=t.error),this._notifyPresenceSubs(R);break;case"error":this._handleReceiveError(t);break}}_handleReceiveError(t){var e,r,i;const o=t["client-event-id"];if(this.pendingMutations.currentValue.get(o)){this.pendingMutations.set(m=>(m.delete(o),m)),this.notifyAll(),this.notifyAttrsSubs(),this.notifyMutationErrorSubs(t);const d={message:t.message,hint:t.hint};this._finishTransaction(!1,"error",o,d);return}const u=t.q||((e=t["original-event"])===null||e===void 0?void 0:e.q);if(u){this.querySubs.set(d=>{const m=mt(u);return delete d[m],d}),this.notifyQueryError(mt(u),{message:t.message||"Uh-oh, something went wrong. Ping Joe & Stopa."});return}if(((r=t["original-event"])===null||r===void 0?void 0:r.op)==="init"){if(t.type==="record-not-found"&&((i=t.hint)===null||i===void 0?void 0:i["record-type"])==="app-user"){this.changeCurrentUser(null);return}const d={message:t.message||"Uh-oh, something went wrong. Ping Joe & Stopa."};this._setStatus(yt.ERRORED,d),this.notifyAll();return}const c=Object.assign({},t);delete c.message,delete c.hint,console.error(t.message,c),t.hint&&console.error(`This error comes with some debugging information. Here it is: 
`,t.hint)}_setAttrs(t){this.attrs=t.reduce((e,r)=>(e[r.id]=r,e),{}),this.notifyAttrsSubs()}subscribeQuery(t,e){const r=Z(),i=mt(t);this.queryCbs[i]=this.queryCbs[i]||[],this.queryCbs[i].push(e),this.querySubs.set(a=>(a[i]=a[i]||{q:t,result:null,eventId:r},a)),this._trySendAuthed(r,{op:"add-query",q:t});const o=this.getPreviousResult(t);return o&&e(o),()=>{this.queryCbs[i]=this.queryCbs[i].filter(a=>a!==e)}}_rewriteMutations(t,e){if(!t)return e;const r=f=>{const[c,d,m]=f["forward-identity"];return tt(t,d,m)},i=f=>{const[c,d,m]=f["forward-identity"];return At(t,d,m)},o={attrIdMap:{},refSwapAttrIds:new Set},a=f=>{const c=[];for(const d of f){const[m]=d;if(m==="add-attr"){const[L,E]=d,x=r(E);if(x){o.attrIdMap[E.id]=x.id;continue}if(E["value-type"]==="ref"){const _=i(E);if(_){o.attrIdMap[E.id]=_.id,o.refSwapAttrIds.add(E.id);continue}}}const T=fr(o,d);c.push(T)}return c},u=new Map;for(const[f,c]of e.entries())u.set(f,Object.assign(Object.assign({},c),{"tx-steps":a(c["tx-steps"])}));return u}optimisticAttrs(){var t;const e=[...this.pendingMutations.currentValue.values()].flatMap(u=>u["tx-steps"]),r=new Set(e.filter(([u,f])=>u==="delete-attr").map(([u,f])=>f)),i=[];for(const[u,f]of e)if(u==="add-attr")i.push(f);else if(u==="update-attr"&&f.id&&(!((t=this.attrs)===null||t===void 0)&&t[f.id])){const c=Object.assign(Object.assign({},this.attrs[f.id]),f);i.push(c)}const o=[...Object.values(this.attrs||{}),...i].filter(u=>!r.has(u.id));return Object.fromEntries(o.map(u=>[u.id,u]))}dataForResult(t,{store:e,pageInfo:r,aggregate:i}){const a=[...this._rewriteMutations(e.attrs,this.pendingMutations.currentValue).values()].flatMap(c=>c["tx-steps"]),u=Yn(e,a);return Xr({store:u,pageInfo:r,aggregate:i},t)}notifyAll(){Object.keys(this.queryCbs).forEach(t=>{this.notifyOne(t)})}shutdown(){this._isShutdown=!0,this._ws.close()}_sendMutation(t,e){if(e.error){this._finishTransaction(!1,"error",t,{error:e.error,message:e.error.message}),this.pendingMutations.set(i=>(i.delete(t),i));return}if(this.status!==yt.AUTHENTICATED){this._finishTransaction(!0,"enqueued",t);return}const r=Math.max(5e3,this.pendingMutations.currentValue.size*5e3);this._isOnline?(this._trySend(t,e),setTimeout(()=>{this._finishTransaction(!0,"pending",t)},3e3),setTimeout(()=>{if(!this._isOnline)return;const i=this.pendingMutations.currentValue.get(t);i&&!i["tx-id"]&&(this.pendingMutations.set(o=>(o.delete(t),o)),this._finishTransaction(!1,"timeout",t),console.error("mutation timed out",i))},r)):this._finishTransaction(!0,"enqueued",t)}_flushPendingMessages(){Object.keys(this.queryCbs).map(a=>this.querySubs.currentValue[a]).filter(a=>a).forEach(({eventId:a,q:u})=>{this._trySendAuthed(a,{op:"add-query",q:u})}),this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).forEach((a,u)=>{a["tx-id"]||this._sendMutation(u,a)}),Object.keys(this._presence).forEach(a=>{this._trySendAuthed(Z(),{op:"join-room","room-id":a})}),Object.entries(this._presence).forEach(([a,{result:u}])=>{const f=u==null?void 0:u.user;f&&this._trySendAuthed(Z(),{op:"set-presence","room-id":a,data:f})})}_trySendAuthed(t,e){this.status===yt.AUTHENTICATED&&this._trySend(t,e)}_trySend(t,e){this._ws.readyState===vi&&this._ws.send(JSON.stringify(Object.assign({"client-event-id":t},e)))}_startSocket(){this._ws=new WebSocket(`${this.config.websocketURI}?app_id=${this.config.appId}`),this._ws.onopen=this._wsOnOpen,this._ws.onmessage=this._wsOnMessage,this._ws.onclose=this._wsOnClose}getLocalId(t){return X(this,void 0,void 0,function*(){const e=`localToken_${t}`,r=yield this._persister.getItem(e);if(r)return r;if(this._localIdPromises[e])return this._localIdPromises[e];const i=Z();return this._localIdPromises[e]=this._persister.setItem(e,i).then(()=>i),this._localIdPromises[e]})}_replaceUrlAfterOAuth(){if(typeof URL>"u")return;const t=new URL(window.location.href);if(t.searchParams.get(ee)){const e=t.toString();t.searchParams.delete(ee),t.searchParams.delete("code"),t.searchParams.delete("error");const r=t.pathname+(t.searchParams.size?"?"+t.searchParams:"")+t.hash;if(history.replaceState(history.state,"",r),typeof navigation=="object"&&typeof navigation.addEventListener=="function"&&typeof navigation.removeEventListener=="function"){let i=!1;const o=a=>{var u;i||(i=!0,navigation.removeEventListener("navigate",o),!a.userInitiated&&a.navigationType==="replace"&&((u=a.destination)===null||u===void 0?void 0:u.url)===e&&history.replaceState(history.state,"",r))};navigation.addEventListener("navigate",o)}}}_oauthLoginInit(){return X(this,void 0,void 0,function*(){var t,e,r,i;if(typeof window>"u"||typeof window.location>"u"||typeof URLSearchParams>"u")return null;const o=new URLSearchParams(window.location.search);if(!o.get(ee))return null;const a=o.get("error");if(a)return this._replaceUrlAfterOAuth(),{error:{message:a}};const u=o.get("code");if(!u)return null;this._replaceUrlAfterOAuth();try{const{user:f}=yield Fe({apiURI:this.config.apiURI,appId:this.config.appId,code:u});return this.setCurrentUser(f),null}catch(f){return((t=f==null?void 0:f.body)===null||t===void 0?void 0:t.type)==="record-not-found"&&((r=(e=f==null?void 0:f.body)===null||e===void 0?void 0:e.hint)===null||r===void 0?void 0:r["record-type"])==="app-oauth-code"&&(yield this._hasCurrentUser())?null:{error:{message:((i=f==null?void 0:f.body)===null||i===void 0?void 0:i.message)||"Error logging in."}}}})}_waitForOAuthCallbackResponse(){return X(this,void 0,void 0,function*(){return yield this._oauthCallbackResponse})}__subscribeMutationErrors(t){return this.mutationErrorCbs.push(t),()=>{this.mutationErrorCbs=this.mutationErrorCbs.filter(e=>e!==t)}}subscribeAuth(t){this.authCbs.push(t);const e=this._currentUserCached;e.isLoading||t(this._currentUserCached);let r=!1;return this.getCurrentUser().then(i=>{r||qt(i,e)||t(i)}),()=>{r=!0,this.authCbs=this.authCbs.filter(i=>i!==t)}}subscribeAttrs(t){return this.attrsCbs.push(t),this.attrs&&t(this.attrs),()=>{this.attrsCbs=this.attrsCbs.filter(e=>e!==t)}}notifyAuthSubs(t){this.authCbs.forEach(e=>e(t))}notifyMutationErrorSubs(t){this.mutationErrorCbs.forEach(e=>e(t))}notifyAttrsSubs(){if(!this.attrs)return;const t=this.optimisticAttrs();this.attrsCbs.forEach(e=>e(t))}setCurrentUser(t){return X(this,void 0,void 0,function*(){yield this._persister.setItem(ne,JSON.stringify(t))})}getCurrentUserCached(){return this._currentUserCached}getCurrentUser(){return X(this,void 0,void 0,function*(){const t=yield this._waitForOAuthCallbackResponse();if(t!=null&&t.error){const i={error:t.error,user:void 0};return this._currentUserCached=Object.assign({isLoading:!1},i),i}const e=yield this._persister.getItem(ne),r={user:JSON.parse(e),error:void 0};return this._currentUserCached=Object.assign({isLoading:!1},r),r})}_hasCurrentUser(){return X(this,void 0,void 0,function*(){const t=yield this._persister.getItem(ne);return JSON.parse(t)!=null})}changeCurrentUser(t){return X(this,void 0,void 0,function*(){var e;const{user:r}=yield this.getCurrentUser();if(!qt(r,t)){yield this.setCurrentUser(t),this.updateUser(t);try{(e=this._broadcastChannel)===null||e===void 0||e.postMessage({type:"auth"})}catch(i){console.error("Error posting message to broadcast channel",i)}}})}updateUser(t){const e={error:void 0,user:t};this._currentUserCached=Object.assign({isLoading:!1},e),this.querySubs.set(r=>(Object.keys(r).forEach(i=>{delete r[i].result}),r)),this._reconnectTimeoutMs=0,this._ws.close(),this._oauthCallbackResponse=null,this.notifyAuthSubs(e)}sendMagicCode({email:t}){return ei({apiURI:this.config.apiURI,appId:this.config.appId,email:t})}signInWithMagicCode(t){return X(this,arguments,void 0,function*({email:e,code:r}){const i=yield ni({apiURI:this.config.apiURI,appId:this.config.appId,email:e,code:r});return this.changeCurrentUser(i.user),i})}signInWithCustomToken(t){return X(this,void 0,void 0,function*(){const e=yield ri({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:t});this.changeCurrentUser(e.user)})}signOut(){return X(this,void 0,void 0,function*(){var t;const e=yield this.getCurrentUser(),r=(t=e==null?void 0:e.user)===null||t===void 0?void 0:t.refresh_token;if(r)try{yield oi({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:r})}catch{}this.changeCurrentUser(null)})}createAuthorizationURL({clientName:t,redirectURL:e}){const{apiURI:r,appId:i}=this.config;return`${r}/runtime/oauth/start?app_id=${i}&client_name=${t}&redirect_uri=${e}`}exchangeCodeForToken(t){return X(this,arguments,void 0,function*({code:e,codeVerifier:r}){const i=yield Fe({apiURI:this.config.apiURI,appId:this.config.appId,code:e,codeVerifier:r});return this.changeCurrentUser(i.user),i})}issuerURI(){const{apiURI:t,appId:e}=this.config;return`${t}/runtime/${e}`}signInWithIdToken(t){return X(this,arguments,void 0,function*({idToken:e,clientName:r,nonce:i}){var o;const a=yield this.getCurrentUser(),u=(o=a==null?void 0:a.user)===null||o===void 0?void 0:o.refresh_token,f=yield ii({apiURI:this.config.apiURI,appId:this.config.appId,idToken:e,clientName:r,nonce:i,refreshToken:u});return this.changeCurrentUser(f.user),f})}joinRoom(t){return this._trySendAuthed(Z(),{op:"join-room","room-id":t}),()=>{this._cleanupRoom(t)}}_cleanupRoom(t){var e,r,i;!(!((r=(e=this._presence[t])===null||e===void 0?void 0:e.handlers)===null||r===void 0)&&r.length)&&!Object.keys((i=this._broadcastSubs[t])!==null&&i!==void 0?i:{}).length&&(delete this._presence[t],delete this._broadcastSubs[t],this._trySendAuthed(Z(),{op:"leave-room","room-id":t}))}getPresence(t,e,r={}){const i=this._presence[e];return!i||!i.result?null:Object.assign(Object.assign({},li(i.result,r)),{isLoading:i.isLoading,error:i.error})}publishPresence(t,e,r){var i,o;const a=Object.assign(Object.assign({},(o=(i=this._presence[e])===null||i===void 0?void 0:i.result)===null||o===void 0?void 0:o.user),r);this._trySendAuthed(Z(),{op:"set-presence","room-id":e,data:a}),this._presence[e]=this._presence[e]||{},this._presence[e].result=this._presence[e].result||{},this._presence[e].result.user=a,this._notifyPresenceSubs(e)}subscribePresence(t,e,r,i){const o=this.joinRoom(e),a=Object.assign(Object.assign({},r),{roomId:e,cb:i,prev:null});return this._presence[e]=this._presence[e]||{},this._presence[e].isLoading=!0,this._presence[e].handlers=this._presence[e].handlers||[],this._presence[e].handlers.push(a),this._notifyPresenceSub(e,a),()=>{var u,f,c;this._presence[e].handlers=(c=(f=(u=this._presence[e])===null||u===void 0?void 0:u.handlers)===null||f===void 0?void 0:f.filter(d=>d!==a))!==null&&c!==void 0?c:[],o()}}_notifyPresenceSubs(t){var e,r;(r=(e=this._presence[t])===null||e===void 0?void 0:e.handlers)===null||r===void 0||r.forEach(i=>{this._notifyPresenceSub(t,i)})}_notifyPresenceSub(t,e){const r=this.getPresence("",t,e);r&&(e.prev&&!di(r,e.prev)||(e.prev=r,e.cb(r)))}_setPresencePeers(t,e){const r=Object.assign({},e);delete r[this._sessionId];const i=Object.fromEntries(Object.entries(r).map(([o,a])=>[o,a.data]));this._presence[t]=this._presence[t]||{},this._presence[t].result=this._presence[t].result||{},this._presence[t].result.peers=i}publishTopic({roomType:t,roomId:e,topic:r,data:i}){this._trySendAuthed(Z(),{op:"client-broadcast","room-id":e,roomType:t,topic:r,data:i})}subscribeTopic(t,e,r){const i=this.joinRoom(t);return this._broadcastSubs[t]=this._broadcastSubs[t]||{},this._broadcastSubs[t][e]=this._broadcastSubs[t][e]||[],this._broadcastSubs[t][e].push(r),this._presence[t]=this._presence[t]||{},()=>{this._broadcastSubs[t][e]=this._broadcastSubs[t][e].filter(o=>o!==r),this._broadcastSubs[t][e].length||delete this._broadcastSubs[t][e],i()}}_notifyBroadcastSubs(t,e,r){var i,o,a;(a=(o=(i=this._broadcastSubs)===null||i===void 0?void 0:i[t])===null||o===void 0?void 0:o[e])===null||a===void 0||a.forEach(u=>{var f,c,d,m,T,L;const E=(f=r.data)===null||f===void 0?void 0:f.data,x=r.data["peer-id"]===this._sessionId?(d=(c=this._presence[t])===null||c===void 0?void 0:c.result)===null||d===void 0?void 0:d.user:(L=(T=(m=this._presence[t])===null||m===void 0?void 0:m.result)===null||T===void 0?void 0:T.peers)===null||L===void 0?void 0:L[r.data["peer-id"]];return u(E,x)})}upload(t,e){return X(this,void 0,void 0,function*(){var r;const i=yield this.getCurrentUser(),o=(r=i==null?void 0:i.user)===null||r===void 0?void 0:r.refresh_token,a=t||e.name,u=yield si({apiURI:this.config.apiURI,appId:this.config.appId,fileName:a,refreshToken:o});return yield ai(u,e)})}getDownloadUrl(t){return X(this,void 0,void 0,function*(){var e;const r=yield this.getCurrentUser(),i=(e=r==null?void 0:r.user)===null||e===void 0?void 0:e.refresh_token;return yield ui({apiURI:this.config.apiURI,appId:this.config.appId,path:t,refreshToken:i})})}deleteFile(t){return X(this,void 0,void 0,function*(){var e;const r=yield this.getCurrentUser(),i=(e=r==null?void 0:r.user)===null||e===void 0?void 0:e.refresh_token;return yield ci({apiURI:this.config.apiURI,appId:this.config.appId,path:t,refreshToken:i})})}}let $t;function Si(n){$t==null||$t.dispose();const t=ki(),e=Ii(a),r=Ai(Ei(n));function i(c){var d;c.source===r.element.contentWindow&&((d=c.data)===null||d===void 0?void 0:d.type)==="close"&&t.isVisible()&&a()}function o(c){const d=c.shiftKey&&c.ctrlKey&&c.key==="0",m=c.key==="Escape"||c.key==="Esc";(d||m)&&a()}function a(){t.isVisible()?t.element.style.display="none":(t.element.style.display="block",t.element.contains(r.element)||t.element.appendChild(r.element))}function u(){t.element.remove(),e.element.remove(),removeEventListener("keydown",o),removeEventListener("message",i)}function f(){document.body.appendChild(t.element),document.body.appendChild(e.element),addEventListener("keydown",o),addEventListener("message",i),$t={dispose:u}}return f()}function Ei(n){return`${window.DEV_DEVTOOL?"http://localhost:3000":"https://instantdb.com"}/_devtool?appId=${n}`}function Ai(n){const t=document.createElement("iframe");return t.src=n,Object.assign(t.style,{width:"100%",height:"100%",borderRadius:"4px",backgroundColor:"white",border:"none"}),{element:t}}function Ii(n){const t=`
    <svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect width="512" height="512" fill="black"/>
      <rect x="97.0973" y="91.3297" width="140" height="330" fill="white"/>
    </svg>
  `,e=document.createElement("button");return e.innerHTML=t,Object.assign(e.style,{position:"fixed",bottom:"24px",left:"24px",height:"32px",width:"32px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0",margin:"0",border:"none",cursor:"pointer"}),e.addEventListener("click",n),{element:e}}function ki(){const n=document.createElement("div");Object.assign(n.style,{position:"fixed",bottom:"24px",right:"24px",left:"60px",top:"72px",display:"block",borderRadius:"4px",border:"1px #ccc solid",boxShadow:"0px 0px 8px #00000044",backgroundColor:"#eee",zIndex:"999990"}),n.style.display="none";function t(){return n.style.display!=="none"}return{element:n,isVisible:t}}const Oi=!0,xi={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"};function ji(){var n;return globalThis.__instantDbStore=(n=globalThis.__instantDbStore)!==null&&n!==void 0?n:{},globalThis.__instantDbStore}const de=ji();function Ti(n,t,e){return Mi(n)}function Mi(n,t,e){const r=de[n.appId];if(r)return r;const i=new wi(Object.assign(Object.assign({},xi),n),bn,vn),o=new Ci(i);return de[n.appId]=o,typeof window<"u"&&typeof window.location<"u"&&("devtool"in n?n.devtool:Oi)&&window.location.hostname==="localhost"&&!globalThis._nodevtool&&Si(n.appId),o}class Ci{constructor(t){this.tx=cn(),this._reactor=t,this.auth=new Pi(this._reactor),this.storage=new Ui(this._reactor)}transact(t){return this._reactor.pushTx(t)}getLocalId(t){return this._reactor.getLocalId(t)}subscribeQuery(t,e){return this._reactor.subscribeQuery(t,e)}subscribeAuth(t){return this._reactor.subscribeAuth(t)}joinRoom(t="_defaultRoomType",e="_defaultRoomId"){return{leaveRoom:this._reactor.joinRoom(e),subscribeTopic:(i,o)=>this._reactor.subscribeTopic(e,i,o),subscribePresence:(i,o)=>this._reactor.subscribePresence(t,e,i,o),publishTopic:(i,o)=>this._reactor.publishTopic({roomType:t,roomId:e,topic:i,data:o}),publishPresence:i=>this._reactor.publishPresence(t,e,i),getPresence:i=>this._reactor.getPresence(t,e,i)}}shutdown(){delete de[this._reactor.config.appId],this._reactor.shutdown()}}class Pi{constructor(t){this.db=t,this.sendMagicCode=e=>this.db.sendMagicCode(e),this.signInWithMagicCode=e=>this.db.signInWithMagicCode(e),this.signInWithToken=e=>this.db.signInWithCustomToken(e),this.createAuthorizationURL=e=>this.db.createAuthorizationURL(e),this.signInWithIdToken=e=>this.db.signInWithIdToken(e),this.exchangeOAuthCode=e=>this.db.exchangeCodeForToken(e),this.issuerURI=()=>this.db.issuerURI(),this.signOut=()=>this.db.signOut()}}class Ui{constructor(t){this.db=t,this.upload=(e,r)=>this.db.upload(e,r),this.put=this.upload,this.getDownloadUrl=e=>this.db.getDownloadUrl(e),this.delete=e=>this.db.deleteFile(e)}}window.onload=function(){console.log("The dice module has loaded.")};function Li(n,t){return Math.floor(Math.random()*(t-n+1))+n}function Bi(n){requestAnimationFrame(function(){n.forEach(function(t){window.getComputedStyle(document.getElementById(t)).opacity,document.getElementById(t).style.opacity=1})})}function He(n,t){n.style.opacity=t,n.style.transition="none",requestAnimationFrame(()=>{n.style.transition=""})}function Ri(){const n=Math.floor(Math.random()*6)+1;console.log("Dice rolled: "+n)}function Di(){return`
    <p class="green__text">Need to roll some dice?</p>
    <div id="dice-tab" >
                <section class="button-wrapper">
                  <div id="dice-btns">  
                    <div class="dice-box">
                      <p>
                          <input 
                          type="text" 
                          name="formula-input" 
                          id="formula-input"
                          class="dice-input" 
                          pattern="d+dd+(kl|kh|fr)?"
                          title="Enter a valid dice formula, such as 2d20kh"
                          placeholder="#d#"
                          autocomplete="off">
                      </p>
                      <button id="formula-btn">Roll</button> 
                    </div>
                    <button class="glide-main" id="dice-reset">Clear</button>
                  </div>
                </section>
              
                <section class="dice-results">
                  <dialog id="🎲🎲">Final Roll: <span id="final-roll"></span></dialog>
                  <dialog id="🎲">All Rolls: <span id="all-roll"></span></dialog>
                </section>
            </div>
    `}function Ni(){document.getElementById("formula-input").value="",He(document.getElementById("🎲🎲"),0),He(document.getElementById("🎲"),0)}function $i(n,t,e){const r={amount:n,face:t,type:e},i=[];for(let f=0;f<r.amount;f++)i.push(Li(1,r.face));let o=0;r.type=="fr"?(o=i.reduce((f,c)=>f+c,0),console.log("The final roll is:",o)):r.type=="kh"?(o=Math.max(...i),console.log("With a boon, final roll is:",o)):r.type=="kl"?(o=Math.min(...i),console.log("With a bane, final roll is:",o)):console.error("Invalid die type");const a=document.getElementById("all-roll"),u=document.getElementById("final-roll");a.innerHTML=i.join(", "),u.innerHTML=o,document.getElementById("🎲🎲").open=!0,document.getElementById("🎲").open=!0,Bi(["🎲","🎲🎲"])}function qi(){document.getElementById("formula-input").addEventListener("keydown",function(n){n.key==="Enter"&&(n.preventDefault(),document.getElementById("formula-btn").click())}),document.getElementById("formula-btn").onclick=()=>{const n=document.getElementById("formula-input");if(!n.value)alert("Please enter a dice formula, such as 2d20");else if(n.value.length>12)alert("Entry too long or incorrect formula.");else{const t={amount:1,face:6,type:"fr"},e=n.value.match(/^(\d+)d(\d+)(kl|kh|fr)?$/);e?(t.amount=parseInt(e[1],10),t.face=parseInt(e[2],10),t.type=e[3]||"fr",console.log("Dice formula was accepted:",t),$i(t.amount,t.face,t.type)):alert("Incorrect formula format. Please use a format like '2d20', '4d4kh', '3d6kl', etc.")}},document.getElementById("dice-reset").onclick=()=>{Ni()}}window.onload=function(){console.log("The utils script has loaded.")};function Fi(n){requestAnimationFrame(function(){n.forEach(function(t){window.getComputedStyle(document.getElementById(t)).opacity,document.getElementById(t).style.opacity=1})})}function Wi(n,t){n.style.opacity=t,n.style.transition="none",requestAnimationFrame(()=>{n.style.transition=""})}function Ji(n){document.getElementById("tip-txt").innerHTML=n,document.getElementById("tip").open=!0,Fi(["tip"]),setTimeout(()=>{document.getElementById("tip").open=!1,Wi(document.getElementById("tip"),0)},3500)}window.onload=function(){console.log("The script importer has loaded.")};function zi(){return['<section class="janken__section">',"<h2>E•M's Janken</h2>",`<p class="green__text">Just pick "rock", "paper", or "scissors" below to get started. Let's play!</p>`,'<div class="janken__btn_holder">','<button class="janken__buttons" id="rock">rock</button>','<button class="janken__buttons" id="paper">paper</button>','<button class="janken__buttons" id="scissors">scissors</button>',"</div>","</section>"]}function Vi(){document.querySelectorAll("button.janken__buttons").forEach(t=>t.addEventListener("click",e=>{const r=e.target.id,i=Hi(),o=Yi(i,r),a=`You picked ${r}, CJ picked ${i}.<br>${o}`;Ji(a)}))}function Hi(){const n=Math.floor(Math.random()*3);return n===0?"rock":n===1?"scissors":"paper"}function Yi(n,t){let e;return n===t&&(e="It's a draw..."),n==="rock"&&t==="paper"&&(e="You win!"),n==="rock"&&t==="scissors"&&(e="Sorry, you lost :("),n==="paper"&&t==="scissors"&&(e="You win!"),n==="paper"&&t==="rock"&&(e="Sorry, you lost :("),n==="scissors"&&t==="paper"&&(e="Sorry, you lost :("),n==="scissors"&&t==="rock"&&(e="You win!"),e}const Ki="bcc500de-07a9-4fde-9025-c87906e63bf3",Gi=Ti({appId:Ki});Gi.subscribeQuery({blog:{},merch:{},portfolio:{}},n=>{if(n.error){Xi(n.error.message);return}n.data&&(Qi(n.data),console.log(n.data))});const wt=document.getElementById("app");function Qi(n){document.getElementById("navHeader").innerHTML=ao(),window.navButtons=new po,window.navButtons.applyAllStyles(),document.querySelectorAll(".nav__header_btns").forEach(e=>{e.addEventListener("click",function(){const r=this.getAttribute("id");go(r,n)})}),wt.innerHTML="",console.log(n);const{blog:t}=n;console.log(t),_n(t)}function Xi(n){wt.innerHTML=`
    <div>${n}</div>
  `}function Zi(n){return`
    <dialog id="tip"><strong></strong> <span id="tip-txt"></span></dialog>
    <main class="home__page">
      <section class="welcome__text">
        <figure>
          <img class="cover__image" src="Assests/em-anime.webp" alt="An AI generated paitning of CJ, aka E•M, in a fantasy setting." />
          </figure>
        <!-- <h1>Æinär's Library</h1> -->
        <p class="about-blurb">
          Aspiring game developer; WIP web developer; RPG hobbyist. 
        </p>
      </section>

      <section>
        <br />
        <div class="icon__holder">
          <div class="icons">
            <a
              href="https://aka-em.itch.io/"
              target="_blank"
              class="fa-brands fa-itch-io"
            ></a>
          </div>
    
          <div class="icons">
            <a
              href="https://github.com/einar-method"
              target="_blank"
              class="fa fa-github"
            ></a>
          </div>
          <div class="icons">
            <a
              href="https://travelingbardgames.substack.com/"
              target="_blank"
              class="fa fa-rss"
            ></a>
          </div>
          <div class="icons">
            <a
              href="https://open.spotify.com/track/1GGLQhjZSB6h0Qkfu2OvAf?si=4cafaec035cb4ed6"
              class="fa-brands fa-spotify"
              target="_blank"
            ></a>
          </div>
          <div class="icons">
            <a
              href="https://ordes.netlify.app/"
              class="fa-solid fa-globe"
              target="_blank"
            ></a>
          </div>
          <div class="icons">
            <a
              href="https://buymeacoffee.com/em.bmc"
              class="fa-solid fa-mug-hot"
              target="_blank"
            ></a>
          </div>
        </div>
        <br />
      </section>

      <section class="dice__section">
        ${Di()}
      </section>

      <p class"endPage__navigation">Go to portfolio to see my work</p>
    </main>
  `}function to(n){return`
    <ul class="merchList">
      ${n.portfolio.map(t=>`
        <li class="blog__post" id="portfolioItem${t.id}">
          <h3>${t.title}</h3>
          <p>${t.description}</p>
          <p>Click to see more</p>
        </li>
      `).join("")}
    </ul>
  `}function eo(n){return`
    <dialog id="tip"><strong></strong> <span id="tip-txt"></span></dialog>
    <main id="folioGrid">
      <section class="innerGrid">
        ${to(n)}
      </section>
    </main>
  `}function no(n){return`
    <ul class="merchList">
      ${n.merch.map(t=>`
        <li class="merchCard" id="merchItem${t.id}">
          <h3>${t.title}</h3>
          <img src="${t.imageLink}" alt="${t.imageAlt}">
          <p>${t.description}</p>
          <a class="merchBtn" href="${t.actionLink}" target="_blank">${t.actionType}</a>
          <a href="${t.mainLink}" target="_blank">${t.mainLinkText}</a>
        </li>
      `).join("")}
    </ul>
  `}function ro(n){return`
    <dialog id="tip"><strong></strong> <span id="tip-txt"></span></dialog>
    <main id="itchGrid">
      <section class="innerGrid">
        ${no(n)}
      </section>
    </main>
  `}function io(n){return`
    <main class="blog__page" id="blogPage">
      ${so()}
      ${oo(n)}
    </main>
  `}function Ye(n){document.querySelectorAll(".blog__post").forEach(t=>{t.addEventListener("click",function(){const e=this.getAttribute("id");co(n,e)})})}function oo(n){return`
    <section class="blog__section">
        ${n.blog.map(t=>`
          <article class="blog__post" id="blogID${t.id}">
            <h2 class="blog__header">${t.title}</h2>
            <h3 class="blog__subheader">${t.subtitle}</h3>
            <p class="blog__paragraph">${uo(t.content)}</p>
            <p class="blog__date">Date: ${t.postDate}</p>
          </article>
        `).join("")}
    </section>
  `}function so(){return`
    <div class="blog__section_tab_holder_outer">
      <div id="blogSectionTab" class="blog__section_tab_holder_inner">
        <fieldset 
            id="tab-toggle" 
            class="blog__section_tab_options" 
        >

        <p>
            <input 
            type="radio" 
            name="tool-toggle" 
            id="storiesTab" 
            value="storiesTab"
            class="tool-toggle"
            checked>
            <label for="storiesTab">stories</label>
        </p>

        <p>
            <input 
            type="radio" 
            name="tool-toggle" 
            id="musingsTab" 
            value="musingsTab"
            class="tool-toggle">
            <label for="musingsTab">musings</label>
        </p>
        <p>
            <input 
            type="radio" 
            name="tool-toggle" 
            id="gamesTab" 
            value="gamesTab"
            class="tool-toggle">
            <label for="gamesTab">games</label>
        </p>
        </fieldset>
      </div>
    </div>
  `}function ao(){return`
    <button class="nav__header_btns" id="homeBtn">home</button>
    <button class="nav__header_btns" id="portfolioBtn">portfolio</button>
    <button class="nav__header_btns" id="merchBtn">merch</button>
    <button class="nav__header_btns" id="blogBtn">blog</button>
  `}function uo(n){const t=n[1],e=document.createElement("div");e.innerHTML=t;const r=e.textContent||e.innerText||"",i=r.split(" ");return i.length>20?i.slice(0,20).join(" ")+"...":r}function co(n,t){console.log("Article clicked:",t);const e=n.find(i=>"blogID"+i.id===t),r=n.find(i=>"portfolioItem"+i.id===t);e?re(e.content):r?t==="portfolioItembd5e5158-d43b-45b8-8889-7927ffbbad99"?(console.error(t),re(zi()),Vi()):re(r.content):console.log("Article not found!")}function re(n){if(!document.getElementById("myNav")){const t=`
    <div id="myNav" class="blogPost__overlay">
        
        <div class="blogPost__overlay_content" id="postContent">
          <a href="javascript:void(0)" class="blog__closebtn_top">&times;</a>
          ${n.map(e=>e).join("")}
        </div>
        <div class="blogPost__overlay_footer">
            <button class="like-btn">Like</button>
            <button class="scroll-top-btn">To Top</button>
            <button class="blog__closebtn_bottom">&times;</button>
        </div>
    </div>
  `;document.body.insertAdjacentHTML("beforeend",t),document.querySelector(".blog__closebtn_top").addEventListener("click",Ke),document.querySelector(".blog__closebtn_bottom").addEventListener("click",Ke),document.querySelector(".like-btn").addEventListener("click",fo),document.querySelector(".scroll-top-btn").addEventListener("click",lo)}document.getElementById("myNav").style.width="100%"}function Ke(){const n=document.getElementById("myNav");n&&n.remove()}function lo(){const n=document.querySelector(".blogPost__overlay_content");n&&n.scrollIntoView({behavior:"smooth",block:"start"})}function fo(){console.log("User added a like")}function ho(){document.querySelectorAll("*").forEach(t=>{const e=window.getComputedStyle(t);e.position==="fixed"&&e.bottom==="24px"&&e.left==="24px"&&e.height==="32px"&&e.width==="32px"&&e.display==="flex"&&e.alignItems==="center"&&(t.remove(),console.log("Element removed:",t))})}document.addEventListener("DOMContentLoaded",function(){ho()});class po{constructor(){this.buttons=[{name:"home",id:"homeBtn",isActive:!0},{name:"portfolio",id:"portfolioBtn",isActive:!1},{name:"merch",id:"merchBtn",isActive:!1},{name:"blog",id:"blogBtn",isActive:!1}],this.defaultStyle=`
      color: var(--white-color);
      background-color: var(--primary-color);
      border: 0.1px solid var(--white-color);
      border-radius: 0px;
      padding: 5px 5px;
      display: inline-block;
      font-size: 18px;
      letter-spacing: 1px;
      cursor: pointer;
      box-shadow: inset 0 0 0 0 var(--white-color);
      -webkit-transition: ease-out 0.4s;
      -moz-transition: ease-out 0.4s;
      transition: ease-out 0.4s;
      flex-grow: 1;
    `,this.activeStyle=`
      color: var(--tirtary-color);
      background-color: var(--primary-color);
      border-left: 0.1px solid var(--white-color);
      border-right: 0.1px solid var(--white-color);
      border-top: 0.1px solid var(--white-color);
      border-bottom: 0.1px solid var(--white-color);
      border-radius: 0px;
      padding: 5px 5px;
      display: inline-block;
      font-size: 18px;
      letter-spacing: 1px;
      cursor: default;
      box-shadow: inset 0 0 0 25px var(--secondary-color);
      -webkit-transition: ease-out 0.4s;
      -moz-transition: ease-out 0.4s;
      transition: ease-out 0.4s;
      flex-grow: 1;
    `,this.hoverStyle=`
      color: var(--secondary-color);
      background-color: var(--primary-color);
      border: 0.1px solid var(--white-color);
      border-radius: 0px;
      padding: 5px 5px;
      display: inline-block;
      font-size: 18px;
      letter-spacing: 1px;
      cursor: pointer;
      box-shadow: inset 0 0 0 25px var(--white-color);
      -webkit-transition: ease-out 0.4s;
      -moz-transition: ease-out 0.4s;
      transition: ease-out 0.4s;
      flex-grow: 1;
    `}applyStyles(t){const e=document.getElementById(t.id);e.style=t.isActive?this.activeStyle:this.defaultStyle,e.addEventListener("mouseover",()=>{t.isActive||(e.style=this.hoverStyle)}),e.addEventListener("mouseout",()=>{e.style=t.isActive?this.activeStyle:this.defaultStyle})}applyAllStyles(){document.styleSheets[0].insertRule("#homeBtn:hover { background-color: red; }",1),this.buttons.forEach(t=>this.applyStyles(t))}}function go(n,t){window.navButtons.buttons.forEach(e=>{e.id===n?(e.isActive=!0,_n(t)):e.isActive=!1,window.navButtons.applyStyles(e)})}function _n(n){const t=window.navButtons.buttons.find(e=>e.isActive===!0);t?(console.log(`The active button's id is: ${t.id}`),t.id==="homeBtn"?(console.log("Home button is active"),wt.innerHTML=Zi(),Ri(),qi()):t.id==="portfolioBtn"?(console.log("Portfolio button is active"),wt.innerHTML=eo(n),Ye(n.portfolio)):t.id==="merchBtn"?(console.log("Merch button is active"),wt.innerHTML=ro(n)):t.id==="blogBtn"?(console.log("Blog button is active"),wt.innerHTML=io(n),Ye(n.blog)):console.log("No active button found")):console.log("No active button found.")}
